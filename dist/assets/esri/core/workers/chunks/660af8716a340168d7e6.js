self.webpackChunkRemoteClient([86],{475:function(e,t,r){"use strict";function s(e,t,r){const s=e.clone(),n=1<<s.level,o=s.col+t,a=s.row+r;return o<0&&o!==s.col?(s.col=o+n,s.world-=1):o>=n?(s.col=o-n,s.world+=1):s.col=o,s.row=a,s}r.d(t,"a",(function(){return s})),r(458)},476:function(e,t,r){"use strict";var s=r(14),n=(r(4),r(2),r(5),r(15)),o=r(18),a=(r(25),r(35),r(36),r(171));let i=class extends a.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(s.a)([Object(n.b)({readOnly:!0})],i.prototype,"supportsTileUpdates",null),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"remoteClient",void 0),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"service",void 0),Object(s.a)([Object(n.b)()],i.prototype,"spatialReference",null),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"tileInfo",void 0),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"tileStore",void 0),i=Object(s.a)([Object(o.a)("esri.views.2d.layers.features.processors.BaseProcessor")],i);var c=i;t.a=c},683:function(e,t,r){"use strict";r.r(t);var s=r(14),n=(r(4),r(0)),o=(r(2),r(5),r(15),r(18)),a=(r(25),r(35),r(36),r(3)),i=r(184),c=r(172),l=r(1);r(99),(()=>{if(!("document"in l.a))return()=>null;const e=document.createElement("canvas");e.getContext("2d");e.height=512,e.width=1})();var d=r(475),u=r(476);class h{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends u.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&Object(i.a)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const s=this._tileKeyToFeatureSets.get(e.key.id);if(Object(n.h)(t.addOrUpdate)&&s.set(t.addOrUpdate.instance,t),t.end){const e=this.tileStore.tiles.map((e=>{const t=[],s=function(e){const t=new Map,r=256,s=c.n;return t.set(Object(d.a)(e,-1,-1).id,new h([-s,-s],[s-r,s-r,s,s])),t.set(Object(d.a)(e,0,-1).id,new h([0,-s],[0,s-r,s,s])),t.set(Object(d.a)(e,1,-1).id,new h([s,-s],[0,s-r,r,s])),t.set(Object(d.a)(e,-1,0).id,new h([-s,0],[s-r,0,s,s])),t.set(Object(d.a)(e,1,0).id,new h([s,0],[0,0,r,s])),t.set(Object(d.a)(e,-1,1).id,new h([-s,s],[s-r,0,s,r])),t.set(Object(d.a)(e,0,1).id,new h([0,s],[0,0,s,r])),t.set(Object(d.a)(e,1,1).id,new h([s,s],[0,0,r,r])),t}(e.key);this._tileKeyToFeatureSets.forEach(((r,o)=>{if(o===e.key.id)r.forEach((e=>Object(n.a)(e.addOrUpdate,(e=>t.push(e)))));else if(s.has(o)){const e=s.get(o),[a,i]=e.offset,[c,l,d,u]=e.extent;r.forEach((e=>Object(n.a)(e.addOrUpdate,(e=>{const r=e.transform(a,i).extent(c,l,d,u);t.push(r)}))))}}));const o=function(e,t,r,s){const{blurRadius:n,fieldOffset:o,field:a}=t,i=new Float64Array(262144),c=function(e){const t=Math.round(3*e),r=2*e*e,s=new Float64Array(2*t+1);for(let n=0;n<=s.length;n++)s[n]=Math.exp(-((n-t)**2)/r)/Math.sqrt(2*Math.PI)*(e/2);return s}(n),l=Math.round(3*n);let d,u=Number.NEGATIVE_INFINITY;const h=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(a,o),f=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const r=e.readLegacyPointGeometry(),s=+h(e),n=r.x-l,o=r.y-l,a=Math.max(0,n),p=Math.max(0,o),b=Math.min(512,r.y+l),y=Math.min(512,r.x+l);for(let e=p;e<b;e++){const t=c[e-o];for(let r=a;r<y;r++){const o=c[r-n];d=i[512*e+r]+=t*o*s,d>u&&(u=d)}}}}return{matrix:i.buffer,max:u}}(t,this._schema.mesh),a={tileKey:e.key.id,intensityInfo:o},i=[o.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",a,{...r,transferList:i})}));await Object(a.b)(e)}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};f=Object(s.a)([Object(o.a)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);var p=f;t.default=p}});