self.webpackChunkRemoteClient([32,4,16,41,152,208,210],{102:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(2),i(5),i(15)),n=i(18),o=(i(25),i(35),i(36),i(52)),l=i(89);let c=r=class extends o.a{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return this.value*l.a[this.unit]}clone(){return new r({value:this.value,unit:this.unit})}};Object(s.a)([Object(a.b)({type:Number,json:{write:!0},nonNullable:!0})],c.prototype,"value",void 0),Object(s.a)([Object(a.b)({type:l.c.apiValues,json:{type:l.c.jsonValues,read:l.c.read,write:l.c.write},nonNullable:!0})],c.prototype,"unit",void 0),c=r=Object(s.a)([Object(n.a)("esri.TimeInterval")],c);var d=c;t.a=d},106:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5),i(15)),o=i(55),l=i(54),c=i(18),d=i(53),u=(i(25),i(35),i(36),i(52)),p=i(81),h=i(305);let b=r=class extends u.a{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Object(h.a)(t.value):e}writeExpression(e,t,i){null!=this.value&&(e=Object(h.a)(this.value)),t[i]=e}clone(){return new r({expression:this.expression,title:this.title,value:this.value})}};Object(s.a)([Object(n.b)({type:String,json:{write:{allowNull:!0}}})],b.prototype,"expression",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"title",void 0),Object(s.a)([Object(n.b)({json:{read:!1,write:!1}})],b.prototype,"value",void 0),Object(s.a)([Object(l.a)("expression",["expression","value"])],b.prototype,"readExpression",null),Object(s.a)([Object(d.a)("expression")],b.prototype,"writeExpression",null),b=r=Object(s.a)([Object(c.a)("esri.layers.support.LabelExpressionInfo")],b);var y,f=b,m=i(358);const g=new o.a({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function v(e){return!e||"service"!==e.origin&&!(e.layer&&"map-image"===e.layer.type)}let O=y=class extends u.a{constructor(e){super(e),this.type="label",this.name=null,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.maxScale=0,this.minScale=0,this.symbol=m.a,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=function(e,t,i){switch(t){case"=":return e==i;case"<>":return e!=i;case">":return e>i;case">=":return e>=i;case"<":return e<i;case"<=":return e<=i}return!1};try{if(null==e)return!0;const r=e.split(" ");if(3===r.length)return i(t[r[0]],r[1],r[2]);if(7===r.length){const e=i(t[r[0]],r[1],r[2]),s=r[3],a=i(t[r[4]],r[5],r[6]);switch(s){case"AND":return e&&a;case"OR":return e||a}}return!1}catch(t){console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i,r){if(this.labelExpressionInfo&&(v(r)||r&&"service"===r.origin))if(null!=this.labelExpressionInfo.value)e=Object(h.f)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=Object(h.e)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(null==e&&null!=this.labelExpression&&v(r))e=new f({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return Object(h.b)(this)}getLabelExpressionArcade(){return Object(h.c)(this)}getLabelExpressionSingleField(){return Object(h.d)(this)}hash(){return JSON.stringify(this)}clone(){return new y({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Object(a.a)(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:Object(a.a)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],O.prototype,"name",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],O.prototype,"deconflictionStrategy",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:{allowNull:!0}}})],O.prototype,"labelExpression",void 0),Object(s.a)([Object(l.a)("labelExpression")],O.prototype,"readLabelExpression",null),Object(s.a)([Object(d.a)("labelExpression")],O.prototype,"writeLabelExpression",null),Object(s.a)([Object(n.b)({type:f,json:{write:{overridePolicy:(e,t,i)=>v(i)?{allowNull:!0}:{enabled:!1}}}})],O.prototype,"labelExpressionInfo",void 0),Object(s.a)([Object(d.a)("labelExpressionInfo")],O.prototype,"writeLabelExpressionInfo",null),Object(s.a)([Object(n.b)({type:g.apiValues,json:{type:g.jsonValues,read:g.read,write:g.write}})],O.prototype,"labelPlacement",void 0),Object(s.a)([Object(n.b)({type:Number})],O.prototype,"maxScale",void 0),Object(s.a)([Object(d.a)("maxScale")],O.prototype,"writeMaxScale",null),Object(s.a)([Object(n.b)({type:Number})],O.prototype,"minScale",void 0),Object(s.a)([Object(d.a)("minScale")],O.prototype,"writeMinScale",null),Object(s.a)([Object(n.b)({types:p.d,json:{origins:{"web-scene":{types:p.g,write:p.j,default:null}},write:p.j,default:null}})],O.prototype,"symbol",void 0),Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],O.prototype,"useCodedValues",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],O.prototype,"where",void 0),O=y=Object(s.a)([Object(c.a)("esri.layers.support.LabelClass")],O);var j=O;t.a=j},109:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5),i(15)),o=i(54),l=i(18),c=i(53),d=(i(25),i(35),i(36),i(52)),u=i(89),p=i(84),h=i(102);let b=r=class extends d.a{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new r({respectsDaylightSaving:e,timezone:t})}};Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],b.prototype,"respectsDaylightSaving",void 0),Object(s.a)([Object(o.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],b.prototype,"readRespectsDaylightSaving",null),Object(s.a)([Object(n.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],b.prototype,"timezone",void 0),b=r=Object(s.a)([Object(l.a)("esri.layers.support.TimeReference")],b);var y,f=b;let m=y=class extends d.a{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new p.a({start:i,end:r})}writeFullTimeExtent(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new h.a({value:t.timeInterval,unit:u.c.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new h.a({value:t.defaultTimeInterval,unit:u.c.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:l,useTime:c}=this;return new y({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:Object(a.a)(n),fullTimeExtent:Object(a.a)(o),trackIdField:l,useTime:c})}};Object(s.a)([Object(n.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],m.prototype,"cumulative",void 0),Object(s.a)([Object(n.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],m.prototype,"endField",void 0),Object(s.a)([Object(n.b)({type:p.a,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"fullTimeExtent",void 0),Object(s.a)([Object(o.a)("fullTimeExtent",["timeExtent"])],m.prototype,"readFullTimeExtent",null),Object(s.a)([Object(c.a)("fullTimeExtent")],m.prototype,"writeFullTimeExtent",null),Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],m.prototype,"hasLiveData",void 0),Object(s.a)([Object(n.b)({type:h.a,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"interval",void 0),Object(s.a)([Object(o.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],m.prototype,"readInterval",null),Object(s.a)([Object(c.a)("interval")],m.prototype,"writeInterval",null),Object(s.a)([Object(n.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],m.prototype,"startField",void 0),Object(s.a)([Object(n.b)({type:f,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"timeReference",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"trackIdField",void 0),Object(s.a)([Object(n.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],m.prototype,"useTime",void 0),m=y=Object(s.a)([Object(l.a)("esri.layers.support.TimeInfo")],m);var g=m;t.a=g},121:function(e,t,i){"use strict";function r(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function s(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function n(e,t){const i=t||a(e),r=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===r?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return s}))},122:function(e,t,i){"use strict";i.d(t,"a",(function(){return q})),i.d(t,"b",(function(){return B}));var r=i(4),s=i(16),a=i(3),n=i(48),o=i(2),l=i(41);const c=o.a.getLogger("esri.core.workers.Connection");var d=i(104),u=i(10),p=i(19),h=i(25),b=i(67),y=i(78);i(118);const f={};var m=i(1);class g{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...i)=>e[t](...i)}))}}const v=m.a.MutationObserver||m.a.WebKitMutationObserver,O=function(){let e;if(m.a.process&&m.a.process.nextTick)e=e=>{m.a.process.nextTick(e)};else if(m.a.Promise)e=e=>{m.a.Promise.resolve().then(e)};else if(v){const t=[],i=document.createElement("div");new v((()=>{for(;t.length>0;)t.shift()()})).observe(i,{attributes:!0}),e=e=>{t.push(e),i.setAttribute("queueStatus","1")}}return e}(),j=(()=>{const e=m.a.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:i,bubbles:r=!1,cancelable:s=!1}=t,a=document.createEvent("Event");return a.initEvent(e,r,s),a.data=i,a}}return(t,i)=>new e(t,i)})();var w=class{constructor(){this._dispatcher=new g,this._isInitialized=!1,this._workerPostMessage({type:u.a.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){O((()=>{this._workerMessageHandler(j("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,i){this._dispatcher.addEventListener(e,t,i)}removeEventListener(e,t,i){this._dispatcher.removeEventListener(e,t,i)}_workerPostMessage(e){O((()=>{this.dispatchEvent(j("message",{data:e}))}))}async _workerMessageHandler(e){const t=Object(u.d)(e);if(t)switch(t.type){case u.a.CONFIGURE:this._isInitialized||this._workerPostMessage({type:u.a.CONFIGURED});break;case u.a.OPEN:{const{modulePath:e,jobId:i}=t;let r=await n.default.loadWorker(e);r||(r=await import(e));const s=n.default.connect(r);this._workerPostMessage({type:u.a.OPENED,jobId:i,data:s});break}}}};const _=o.a.getLogger("esri.core.workers");r.a.add("esri-workers-arraybuffer-transfer",!Object(r.a)("safari")||Object(r.a)("safari")>=12);const{CONFIGURED:I,CONFIGURE:S,HANDSHAKE:M}=u.a;let x;try{x=URL.createObjectURL(new Blob(['var esriConfig,workerPath,globalId=0,outgoing=new Map,configured=!1,HANDSHAKE=0,CONFIGURE=1,CONFIGURED=2,OPEN=3,OPENED=4,RESPONSE=5,INVOKE=6,ABORT=7;function createAbortError(){var e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,r,t){var o=t&&t.signal,n=globalId++;return new Promise((function(t,a){if(o){if(o.aborted)return a(createAbortError());o.addEventListener("abort",(function(){outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),a(createAbortError()))}))}outgoing.set(n,{resolve:t,reject:a}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=o,data:r})}))}function messageHandler(e){var r=receiveMessage(e);if(r){var t=r.jobId;switch(r.type){case CONFIGURE:var o=r.configure;if(configured)return;configured=!0,esriConfig=o.esriConfig,workerPath=esriConfig.workers.workerPath,self.dojoConfig=o.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(o.loaderConfig)),self.postMessage({type:CONFIGURED});break;case OPEN:var n;function a(e){var r=n.connect(e);self.postMessage({type:OPENED,jobId:t,data:r},[r])}"function"==typeof define&&define.amd?require([workerPath],(function(e){(n=e.default||e).loadWorker(r.modulePath).then((function(e){return e||new Promise((function(e){require([r.modulePath],e)}))})).then(a)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((function(e){return(n=e.default).loadWorker(r.modulePath)})).then((function(e){return e||System.import(r.modulePath)})).then(a):(self.RemoteClient||importScripts(workerPath),(n=self.RemoteClient.default||self.RemoteClient).loadWorker(r.modulePath).then(a));break;case RESPONSE:if(outgoing.has(t)){var i=outgoing.get(t);outgoing.delete(t),r.error?i.reject(JSON.parse(r.error)):i.resolve(r.data)}}}}self.addEventListener("message",messageHandler),self.postMessage({type:HANDSHAKE});'],{type:"text/javascript"}))}catch(e){}const T="Failed to create Worker. Fallback to execute module in main thread";async function E(e){return new Promise((t=>{function i(a){const n=Object(u.d)(a);if(n)switch(n.type){case M:!function(e){let t;if(null!=p.a.default){const e={...p.a};delete e.default,t=JSON.parse(JSON.stringify(e))}else t=JSON.parse(JSON.stringify(p.a));t.assetsPath=Object(h.y)(t.assetsPath),t.locale=Object(b.b)(),t.has={"csp-restrictions":Object(r.a)("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Object(r.a)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":Object(r.a)("esri-2d-query-centroid-enabled"),"esri-atomics":Object(r.a)("esri-atomics"),"esri-shared-array-buffer":Object(r.a)("esri-shared-array-buffer"),"esri-tiles-debug":Object(r.a)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Object(r.a)("esri-workers-arraybuffer-transfer"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Object(h.y)(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Object(h.y)(t.workers.workerPath):t.workers.workerPath=Object(h.y)(Object(y.a)("esri/core/workers/RemoteClient.js"));const i=p.a.workers.loaderConfig,s=function(e){var t;const i={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(i.async=!0),e.hasOwnProperty("isDebug")||(i.isDebug=!1),e.baseUrl||(i.baseUrl=f.baseUrl),null==(t=f.packages)||t.forEach((e=>{!function(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}(i.packages,e)})),i}({baseUrl:null==i?void 0:i.baseUrl,locale:Object(b.b)(),has:{"csp-restrictions":Object(r.a)("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1,...null==i?void 0:i.has},map:{...null==i?void 0:i.map},paths:{...null==i?void 0:i.paths},packages:(null==i?void 0:i.packages)||[]});e.postMessage({type:S,configure:{esriConfig:t,loaderConfig:s}})}(e);break;case I:e.removeEventListener("message",i),e.removeEventListener("error",s),t(e)}}function s(t){t.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",s),_.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new w).addEventListener("message",i),e.addEventListener("error",s)}e.addEventListener("message",i),e.addEventListener("error",s)}))}const F=o.a.getLogger("esri.core.workers"),{ABORT:C,INVOKE:L,OPEN:P,OPENED:A,RESPONSE:k}=u.a;class R{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),F.error(e)}))}static async create(e){const t=await async function(){if(!Object(r.a)("esri-workers"))return E(new w);let e;if(x)try{e=new Worker(x)}catch(t){_.warn(T,event),e=new w}else _.warn(T,event),e=new w;return E(e)}();return new R(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:i}=t,r=Object(u.b)();return new Promise(((t,s)=>{const n={resolve:t,reject:s,abortHandle:Object(a.p)(i,(()=>{this._outJobs.delete(r),this._post({type:C,jobId:r})}))};this._outJobs.set(r,n),this._post({type:P,jobId:r,modulePath:e})}))}_onMessage(e){const t=Object(u.d)(e);if(t)switch(t.type){case A:this._onOpenedMessage(t);break;case k:this._onResponseMessage(t);break;case C:this._onAbortMessage(t);break;case L:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);r&&(r.controller&&r.controller.abort(),t.delete(i))}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:s}=e,n=s?Object(a.d)():null,o=this._inJobs,l=d.e[t];let c;try{if("function"!=typeof l)throw new TypeError(t+" is not a function");c=l.call(null,r,{signal:n?n.signal:null})}catch(e){return void this._post({type:k,jobId:i,error:Object(u.e)(e)})}Object(a.n)(c)?(o.set(i,{controller:n,promise:c}),c.then((e=>{o.has(i)&&(o.delete(i),this._post({type:k,jobId:i},e))}),(e=>{o.has(i)&&(o.delete(i),e||(e={message:"Error encountered at method"+t}),Object(a.l)(e)||this._post({type:k,jobId:i,error:Object(u.e)(e||{message:"Error encountered at method "+t})}))}))):this._post({type:k,jobId:i},c)}_onOpenedMessage(e){var t;const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),null==(t=s.abortHandle)||t.remove(),s.resolve(r))}_onResponseMessage(e){var t;const{jobId:i,error:r,data:a}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),null==(t=n.abortHandle)||t.remove(),r?n.reject(s.a.fromJSON(JSON.parse(r))):n.resolve(a))}_post(e,t,i){return Object(u.c)(this.worker,e,t,i)}}var N=R;let D=Object(r.a)("esri-workers-debug")?1:Object(r.a)("host-browser")?navigator.hardwareConcurrency-1:0;D||(D=Object(r.a)("safari")&&Object(r.a)("mac")||Object(r.a)("trident")?7:2);let V=0;const U=[];function B(e,t){return G(e,{client:t})}async function G(e,t){const i=new class{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((i,r)=>{let s=!0;const o=e=>{Object(a.t)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let s=0;s<e.length;++s){const l=e[s];Object(a.n)(l)?this._clientPromises[s]=l.then((e=>(this._clients[s]=new n.default(e,t),o(i),this._clients[s])),(()=>(o(r),null))):(this._clients[s]=new n.default(l,t),this._clientPromises[s]=Promise.resolve(this._clients[s]),o(i))}}))}broadcast(e,t,i){const r=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const a=this._clientPromises[s];r[s]=a.then((r=>r.invoke(e,t,i)))}return r}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let t=0;t<this._clients.length;++t){const i=this._clients[t];if(i){if(!i.isBusy())return Promise.resolve(i)}else e=e||[],e.push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,t,i){let r=null;return Array.isArray(i)?(c.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),r={transferList:i}):r=i,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((i=>i.invoke(e,t,r)))}on(e,t){return Promise.all(this._clientPromises).then((()=>Object(l.a)(this._clients.map((i=>i.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let i=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((s=>{t[r]=s.openPort(),0==--i&&e(t)}))}))}get test(){return{numClients:this._clients.length}}};return await i.open(e,t),i}async function q(e,t={}){if("string"!=typeof e)throw new s.a("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(Object(r.a)("host-webworker")&&!Object(r.a)("esri-workers")&&(i="local"),"local"===i){let i=await n.default.loadWorker(e);i||(i=await import(e)),Object(a.t)(t.signal);const r=t.client||i;return G([n.default.connect(i)],{...t,client:r})}if(await async function(){if(H)return H;z=Object(a.d)();const e=[];for(let t=0;t<D;t++){const i=N.create(t).then((e=>(U[t]=e,e)));e.push(i)}return H=Promise.all(e),H}(),Object(a.t)(t.signal),"dedicated"===i){const i=V++%D;return G([await U[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,D);if(i<D){const r=new Array(i);for(let s=0;s<i;++s){const i=V++%D;r[s]=U[i].open(e,t)}return G(r,t)}}return G(U.map((i=>i.open(e,t))),t)}let z,H=null},126:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(2),i(5),i(15)),n=i(18),o=(i(25),i(35),i(36),i(94));let l=r=class extends o.a{constructor(e){super(e),this.type="selection"}clone(){return new r}};Object(s.a)([Object(a.b)({type:["selection"]})],l.prototype,"type",void 0),l=r=Object(s.a)([Object(n.a)("esri.layers.support.FeatureReductionSelection")],l);var c=l;t.a=c},130:function(e,t,i){"use strict";var r=i(14),s=(i(4),i(6)),a=(i(2),i(5),i(15)),n=i(55),o=i(18),l=i(53),c=(i(25),i(35),i(36),i(52));const d=new n.a({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let u=class extends c.a{constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}writeDrawingTool(e,t){t.drawingTool=d.toJSON(e)}writePrototype(e,t){t.prototype=Object(s.c)(Object(s.a)(e),!0)}writeThumbnail(e,t){t.thumbnail=Object(s.c)(Object(s.a)(e))}};Object(r.a)([Object(a.b)({json:{write:!0}})],u.prototype,"name",void 0),Object(r.a)([Object(a.b)({json:{write:!0}})],u.prototype,"description",void 0),Object(r.a)([Object(a.b)({json:{read:d.read,write:d.write}})],u.prototype,"drawingTool",void 0),Object(r.a)([Object(l.a)("drawingTool")],u.prototype,"writeDrawingTool",null),Object(r.a)([Object(a.b)({json:{write:!0}})],u.prototype,"prototype",void 0),Object(r.a)([Object(l.a)("prototype")],u.prototype,"writePrototype",null),Object(r.a)([Object(a.b)({json:{write:!0}})],u.prototype,"thumbnail",void 0),Object(r.a)([Object(l.a)("thumbnail")],u.prototype,"writeThumbnail",null),u=Object(r.a)([Object(o.a)("esri.layers.support.FeatureTemplate")],u);var p=u;t.a=p},131:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5),i(15)),o=i(18),l=(i(25),i(35),i(36),i(52)),c=i(79),d=i(64),u=i(70);let p=r=class extends l.a{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new r({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],p.prototype,"statisticType",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],p.prototype,"onStatisticField",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],p.prototype,"onStatisticValueExpression",void 0),p=r=Object(s.a)([Object(o.a)("esri.layers.support.OutStatistic")],p);var h,b=p;let y=h=class extends l.a{constructor(){super(...arguments),this.name=null}clone(){return new h({name:this.name,outStatistic:this.outStatistic.clone()})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],y.prototype,"name",void 0),Object(s.a)([Object(n.b)({type:b,json:{write:!0}})],y.prototype,"outStatistic",void 0),y=h=Object(s.a)([Object(o.a)("esri.layers.support.AggregateField")],y);var f,m=y,g=i(106);let v=f=class extends l.a{constructor(e){super(e),this.type="cluster",this.clusterRadius=Object(d.e)("80px"),this.clusterMinSize=Object(d.e)("12px"),this.clusterMaxSize=Object(d.e)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new f({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Object(a.a)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Object(a.a)(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Object(a.a)(this.popupTemplate)})}};Object(s.a)([Object(n.b)({type:["cluster"],readOnly:!0,json:{write:!0}})],v.prototype,"type",void 0),Object(s.a)([Object(n.b)({type:Number,cast:e=>"auto"===e?e:Object(d.e)(e),json:{write:!0}})],v.prototype,"clusterRadius",void 0),Object(s.a)([Object(n.b)({type:Number,cast:d.e,json:{write:!0}})],v.prototype,"clusterMinSize",void 0),Object(s.a)([Object(n.b)({type:Number,cast:d.e,json:{write:!0}})],v.prototype,"clusterMaxSize",void 0),Object(s.a)([Object(n.b)(u.g)],v.prototype,"popupEnabled",void 0),Object(s.a)([Object(n.b)({type:c.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],v.prototype,"popupTemplate",void 0),Object(s.a)([Object(n.b)({type:[g.a],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],v.prototype,"labelingInfo",void 0),Object(s.a)([Object(n.b)(u.c)],v.prototype,"labelsVisible",void 0),Object(s.a)([Object(n.b)({type:[m],json:{write:!0}})],v.prototype,"fields",void 0),v=f=Object(s.a)([Object(o.a)("esri.layers.support.FeatureReductionCluster")],v);var O=v;t.a=O},133:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(2),i(5),i(15)),n=i(55),o=i(54),l=i(38),c=i(18),d=i(53),u=(i(25),i(35),i(36),i(24)),p=i(52),h=i(69);const b=Object(n.b)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),y=b.jsonValues.slice();Object(u.g)(y,"orthometric");const f=Object(n.b)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let m=r=class extends p.a{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return b.write(e,t,i)}readHeightModel(e,t,i){return b.read(e)||(i&&i.messages&&i.messages.push(function(e,t){return new l.a("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:i})),null)}readHeightUnit(e,t,i){return f.read(e)||(i&&i.messages&&i.messages.push(g(e,{context:i})),null)}readHeightUnitService(e,t,i){return Object(h.p)(e)||f.read(e)||(i&&i.messages&&i.messages.push(g(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new r({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=Object(h.f)(t);return new r({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new r;return t.read(e,{origin:"web-scene"}),t}};function g(e,t){return new l.a("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}Object(s.a)([Object(a.b)({type:b.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:y,default:"ellipsoidal"}}}})],m.prototype,"heightModel",void 0),Object(s.a)([Object(d.a)("web-scene","heightModel")],m.prototype,"writeHeightModel",null),Object(s.a)([Object(o.a)(["web-scene","service"],"heightModel")],m.prototype,"readHeightModel",null),Object(s.a)([Object(a.b)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:f.jsonValues,write:f.write}}}})],m.prototype,"heightUnit",void 0),Object(s.a)([Object(o.a)("web-scene","heightUnit")],m.prototype,"readHeightUnit",null),Object(s.a)([Object(o.a)("service","heightUnit")],m.prototype,"readHeightUnitService",null),Object(s.a)([Object(a.b)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],m.prototype,"vertCRS",void 0),Object(s.a)([Object(o.a)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],m.prototype,"readVertCRS",null),m=r=Object(s.a)([Object(c.a)("esri.geometry.HeightModelInfo")],m);var v=m;t.a=v},134:function(e,t,i){"use strict";i.r(t);var r,s=i(14),a=i(4),n=i(9),o=i(0),l=i(2),c=i(15),d=i(66),u=i(55),p=i(54),h=i(31),b=i(18),y=i(53),f=i(16),m=i(25),g=(i(35),i(36),i(3)),v=i(57),O=i(60),j=i(61),w=i(68),_=i(79),I=i(58),S=i(81),M=i(83),x=i(87),T=(i(127),i(143),i(152)),E=(i(179),i(189),i(190),i(187)),F=i(188),C=i(193),L=i(90),P=i(91),A=i(133),k=i(70),R=i(103),N=i(136),D=i(6),V=i(52),U=i(5);let B=r=class extends V.a{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new r({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],B.prototype,"expression",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],B.prototype,"name",void 0),Object(s.a)([Object(c.b)({type:["boolean"],json:{write:!0}})],B.prototype,"returnType",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],B.prototype,"title",void 0),B=r=Object(s.a)([Object(b.a)("esri.form.ExpressionInfo")],B);var G=B;const q=e=>{let t=class extends e{constructor(){super(...arguments),this.description=null,this.label=null,this.visibilityExpression=null}};return Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"description",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"label",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"visibilityExpression",void 0),t=Object(s.a)([Object(b.a)("esri.form.elements.ElementMixin")],t),t};let z=class extends(q(V.a)){constructor(e){super(e),this.type=null}};var H;Object(s.a)([Object(c.b)()],z.prototype,"type",void 0),z=Object(s.a)([Object(b.a)("esri.form.elements.Element")],z);let W=H=class extends V.a{constructor(e){super(e),this.type=null}clone(){return new H({type:this.type})}};Object(s.a)([Object(c.b)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],W.prototype,"type",void 0),W=H=Object(s.a)([Object(b.a)("esri.form.elements.inputs.AttachmentInput")],W);var $,J=W;let Q=$=class extends z{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new $({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],Q.prototype,"attachmentKeyword",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],Q.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:J,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Q.prototype,"input",void 0),Object(s.a)([Object(c.b)({type:["attachment"],json:{read:!1,write:!0}})],Q.prototype,"type",void 0),Q=$=Object(s.a)([Object(b.a)("esri.form.elements.AttachmentElement")],Q);var K=Q,Z=i(124);let Y=class extends V.a{constructor(e){super(e),this.type=null}};Object(s.a)([Object(c.b)()],Y.prototype,"type",void 0),Y=Object(s.a)([Object(b.a)("esri.form.elements.inputs.Input")],Y);var X,ee=Y;let te=X=class extends ee{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new X}};Object(s.a)([Object(c.b)({type:["barcode-scanner"],json:{read:!1,write:!0}})],te.prototype,"type",void 0),te=X=Object(s.a)([Object(b.a)("esri.form.elements.inputs.BarcodeScannerInput")],te);var ie,re=te;let se=ie=class extends ee{constructor(e){super(e),this.type="combo-box"}clone(){return new ie}};Object(s.a)([Object(c.b)({type:["combo-box"],json:{read:!1,write:!0}})],se.prototype,"type",void 0),se=ie=Object(s.a)([Object(b.a)("esri.form.elements.inputs.ComboBoxInput")],se);var ae,ne=se;function oe(e){return null!=e?new Date(e):null}function le(e){return e?e.getTime():null}let ce=ae=class extends ee{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return oe(t.max)}writeMax(e,t){t.max=le(e)}readMin(e,t){return oe(t.min)}writeMin(e,t){t.min=le(e)}clone(){return new ae({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};Object(s.a)([Object(c.b)({type:Boolean,json:{write:!0,default:!1}})],ce.prototype,"includeTime",void 0),Object(s.a)([Object(c.b)({type:Date,json:{type:Number,write:!0}})],ce.prototype,"max",void 0),Object(s.a)([Object(p.a)("max")],ce.prototype,"readMax",null),Object(s.a)([Object(y.a)("max")],ce.prototype,"writeMax",null),Object(s.a)([Object(c.b)({type:Date,json:{type:Number,write:!0}})],ce.prototype,"min",void 0),Object(s.a)([Object(p.a)("min")],ce.prototype,"readMin",null),Object(s.a)([Object(y.a)("min")],ce.prototype,"writeMin",null),Object(s.a)([Object(c.b)({type:["datetime-picker"],json:{read:!1,write:!0}})],ce.prototype,"type",void 0),ce=ae=Object(s.a)([Object(b.a)("esri.form.elements.inputs.DateTimePickerInput")],ce);var de,ue=ce;let pe=de=class extends ee{constructor(e){super(e),this.type="radio-buttons"}clone(){return new de}};Object(s.a)([Object(c.b)({type:["radio-buttons"],json:{read:!1,write:!0}})],pe.prototype,"type",void 0),pe=de=Object(s.a)([Object(b.a)("esri.form.elements.inputs.RadioButtonsInput")],pe);var he,be=pe;let ye=he=class extends ee{constructor(e){super(e),this.maxLength=null,this.minLength=0,this.type=null}clone(){return new he({maxLength:this.maxLength,minLength:this.minLength,type:this.type})}};Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],ye.prototype,"maxLength",void 0),Object(s.a)([Object(c.b)({type:Number,json:{default:0,write:!0}})],ye.prototype,"minLength",void 0),Object(s.a)([Object(c.b)()],ye.prototype,"type",void 0),ye=he=Object(s.a)([Object(b.a)("esri.form.elements.inputs.support.TextInput")],ye);var fe=ye;let me=class extends fe{constructor(e){super(e),this.type="text-area"}};Object(s.a)([Object(c.b)({type:["text-area"],json:{read:!1,write:!0}})],me.prototype,"type",void 0),me=Object(s.a)([Object(b.a)("esri.form.elements.inputs.TextAreaInput")],me);var ge=me;let ve=class extends fe{constructor(e){super(e),this.type="text-box"}};Object(s.a)([Object(c.b)({type:["text-box"],json:{read:!1,write:!0}})],ve.prototype,"type",void 0),ve=Object(s.a)([Object(b.a)("esri.form.elements.inputs.TextBoxInput")],ve);const Oe={base:ee,key:"type",typeMap:{"barcode-scanner":re,"combo-box":ne,"datetime-picker":ue,"radio-buttons":be,"text-area":ge,"text-box":ve}};var je;let we=je=class extends z{constructor(e){super(e),this.domain=null,this.editable=!0,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field"}clone(){return new je({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({types:Z.d,json:{read:{reader:Z.b},write:!0}})],we.prototype,"domain",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],we.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],we.prototype,"fieldName",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],we.prototype,"hint",void 0),Object(s.a)([Object(c.b)({types:Oe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],we.prototype,"input",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],we.prototype,"requiredExpression",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:!1,write:!0}})],we.prototype,"type",void 0),we=je=Object(s.a)([Object(b.a)("esri.form.elements.FieldElement")],we);var _e,Ie=we,Se=i(232);let Me=_e=class extends z{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new _e({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Object(D.a)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],Me.prototype,"displayCount",void 0),Object(s.a)([Object(c.b)({type:["list"],json:{write:!0}})],Me.prototype,"displayType",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],Me.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:[Se.a],json:{write:!0}})],Me.prototype,"orderByFields",void 0),Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],Me.prototype,"relationshipId",void 0),Object(s.a)([Object(c.b)({type:["relationship"],json:{read:!1,write:!0}})],Me.prototype,"type",void 0),Me=_e=Object(s.a)([Object(b.a)("esri.form.elements.RelationshipElement")],Me);var xe,Te=Me;function Ee(e){return{typesWithGroup:{base:z,key:"type",typeMap:{attachment:K,field:Ie,group:e,relationship:Te}},typesWithoutGroup:{base:z,key:"type",typeMap:{attachment:K,field:Ie,relationship:Te}}}}function Fe(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function Ce(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function Le(e,t,i=!0){return e?e.map((e=>Object(U.k)(i?t.typesWithGroup:t.typesWithoutGroup,e))):null}let Pe=xe=class extends z{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Le(e,Ae,!1)}readElements(e,t){return Fe(t.formElements,Ae,!1)}writeElements(e,t){t.formElements=Ce(e,Ae,!1)}clone(){return new xe({description:this.description,elements:Object(D.a)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({json:{write:!0}})],Pe.prototype,"elements",void 0),Object(s.a)([Object(d.a)("elements")],Pe.prototype,"castElements",null),Object(s.a)([Object(p.a)("elements",["formElements"])],Pe.prototype,"readElements",null),Object(s.a)([Object(y.a)("elements")],Pe.prototype,"writeElements",null),Object(s.a)([Object(c.b)({type:["collapsed","expanded"],json:{default:"expanded",write:!0}})],Pe.prototype,"initialState",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:!1,write:!0}})],Pe.prototype,"type",void 0),Pe=xe=Object(s.a)([Object(b.a)("esri.form.elements.GroupElement")],Pe);const Ae=Ee(Pe);var ke;const Re=Ee(Pe);let Ne=ke=class extends V.a{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Le(e,Re)}readElements(e,t){return Fe(t.formElements,Re)}writeElements(e,t){t.formElements=Ce(e,Re)}clone(){return new ke({description:this.description,expressionInfos:Object(D.a)(this.expressionInfos),elements:Object(D.a)(this.elements),title:this.title})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],Ne.prototype,"description",void 0),Object(s.a)([Object(c.b)({json:{write:!0}})],Ne.prototype,"elements",void 0),Object(s.a)([Object(d.a)("elements")],Ne.prototype,"castElements",null),Object(s.a)([Object(p.a)("elements",["formElements"])],Ne.prototype,"readElements",null),Object(s.a)([Object(y.a)("elements")],Ne.prototype,"writeElements",null),Object(s.a)([Object(c.b)({type:[G],json:{write:!0}})],Ne.prototype,"expressionInfos",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],Ne.prototype,"title",void 0),Ne=ke=Object(s.a)([Object(b.a)("esri.form.FormTemplate")],Ne);var De=Ne,Ve=i(72),Ue=i(114),Be=i(163),Ge=(i(59),i(156)),qe=i(80),ze=i(65),He=i(122),We=i(150),$e=i(199);let Je=0;const Qe=l.a.getLogger("esri.layers.graphics.sources.MemorySource");let Ke=class extends(qe.a.LoadableMixin(Object(Ge.b)(j.a))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=Object(o.h)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}get workerGeometryType(){const e=this.layer&&this.layer.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);Object($e.a)(e,this.layer.spatialReference,i);const r=Ve.default.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const e of r.features){const t=e.attributes[s],i=this._idToClientGraphic.get(t);i&&(e.geometry=i.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new f.a("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return Object($e.a)(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:O.a.fromJSON(e.extent)})))}_applyEdits(e){if(!this._connection)throw new f.a("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[],a=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const t of e.deleteFeatures){const e=a(t);null!=e&&r.push(e)}const n=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const t of e.updateFeatures)if(s.push(this._serializeFeature(t)),n){const e=a(t);null!=e&&n.set(e,t)}return Object(We.b)(i?i.features:null,s,this.layer.spatialReference),this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r}).then((({fullExtent:e,featureEditResults:t})=>{if(this.fullExtent=e,i&&i.finish(t.uidToObjectId),this._idToClientGraphic){if(n)for(const e of t.updateResults){if(!e.success)continue;const t=n.get(e.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}return this._createEditsResult(t)}))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new f.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let s=0;s<e.length;s++){const a=e[s],n=this._serializeFeature(a);!r&&Object(o.h)(a.geometry)&&(r=a.geometry.type),i[s]=n,t.set(""+n.uid,a)}const s=this;return{features:i,inferredGeometryType:r,finish(e){const i=s.sourceJSON.objectIdField;for(const r in e){const a=e[r],n=t.get(r);n&&(n.attributes||(n.attributes={}),-1===a?delete n.attributes[i]:n.attributes[i]=a,s._addIdToClientGraphic(n))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];null!=i&&this._idToClientGraphic.set(i,e)}_requiresClientGraphicMapping(){const e=this.layer.geometryType||this.sourceJSON.geometryType;return this._geometryTypeRequiresClientGraphicMapping(e)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(Je++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return Object(o.g)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Ue.a.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Object(He.a)("MemorySourceWorker",{strategy:Object(a.a)("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,l="defaults"===this.layer.originOf("spatialReference"),c=this._prepareAddFeatures(this.items);this.on("before-changes",(e=>{Qe.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()}));const d={features:c.features,fields:t&&t.map((e=>e.toJSON())),geometryType:Be.c.toJSON(this.workerGeometryType),hasM:s,hasZ:n,objectIdField:r,spatialReference:l?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},u=await this._connection.invoke("load",d,{signal:e});for(const e of u.warnings)Qe.warn(e.message,{layer:this.layer,warning:e});u.featureErrors.length&&Qe.warn(`Encountered ${u.featureErrors.length} validation errors while loading features`,u.featureErrors);const p=u.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(p.geometryType=Be.c.toJSON(c.inferredGeometryType)),"mesh"!==p.geometryType&&"mesh"!==this.layer.geometryType||(p.hasZ=!0),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(u.assignedObjectIds)}};var Ze;Object(s.a)([(Ze={Type:ze.a,ensureType:Object(U.m)(ze.a)},(e,t)=>{e[t]=Ze})],Ke.prototype,"itemType",void 0),Object(s.a)([Object(c.b)()],Ke.prototype,"type",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],Ke.prototype,"layer",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ke.prototype,"workerGeometryType",null),Object(s.a)([Object(c.b)()],Ke.prototype,"sourceJSON",void 0),Ke=Object(s.a)([Object(b.a)("esri.layers.graphics.sources.MemorySource")],Ke);var Ye,Xe=Ke,et=i(151),tt=i(125),it=i(169),rt=i(97),st=i(158),at=i(108),nt=i(109),ot=i(147);let lt=Ye=class extends V.a{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Ye({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};Object(s.a)([Object(c.b)({constructOnly:!0})],lt.prototype,"name",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],lt.prototype,"fields",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],lt.prototype,"isAscending",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],lt.prototype,"isUnique",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],lt.prototype,"description",void 0),lt=Ye=Object(s.a)([Object(b.a)("esri.layers.support.FeatureIndex")],lt);var ct=i(94),dt=i(106),ut=i(131),pt=i(126),ht=i(180),bt=i(130),yt=i(159),ft=i(170),mt=i(69);let gt=class extends V.a{constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};Object(s.a)([Object(c.b)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],gt.prototype,"shapeAreaField",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],gt.prototype,"shapeLengthField",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:e=>mt.a.read(e)||mt.i.read(e)}})],gt.prototype,"units",void 0),gt=Object(s.a)([Object(b.a)("esri.layers.support.GeometryFieldsInfo")],gt);var vt=gt,Ot=i(173);const jt=new u.a({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),wt=new u.a({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let _t=class extends V.a{constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};Object(s.a)([Object(c.b)({json:{read:jt.read,write:jt.write}})],_t.prototype,"cardinality",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"composite",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"id",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"keyField",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"keyFieldInRelationshipTable",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"name",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"relatedTableId",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],_t.prototype,"relationshipTableId",void 0),Object(s.a)([Object(c.b)({json:{read:wt.read,write:wt.write}})],_t.prototype,"role",void 0),_t=Object(s.a)([Object(b.a)("esri.layers.support.Relationship")],_t);var It=_t,St=i(113),Mt=i(148),xt=i(174),Tt=i(144),Et=i(105),Ft=i(138);const Ct=new u.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Lt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Pt="FeatureLayer",At=l.a.getLogger("esri.layers.FeatureLayer");function kt(e){return e&&e instanceof j.a}function Rt(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function Nt(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}const Dt=Object(ft.a)();function Vt(e,t,i){const r=!(null==i||!i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Ut=class extends(Object(tt.a)(Object(ot.a)(Object(at.a)(Object(st.a)(Object(et.a)(Object(R.a)(Object(rt.a)(Object(L.a)(Object(it.a)(x.a)))))))))){constructor(...e){super(...e),this._handles=new M.a,this.capabilities=null,this.charts=null,this.copyright=null,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingEnabled=!0,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=v.a.WGS84,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(j.a.ofType(lt)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;null==(e=this.source)||e.destroy(),this._handles&&(this._handles.destroy(),this._handles=null)}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(o.h)(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this._initLayerProperties(e))));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch((e=>e)).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new f.a("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:null!=i.lastEditDate?new Date(i.lastEditDate):null}:null}readFeatureReduction(e,t){return Object(ht.a)(e,t)}writeWebSceneFeatureReduction(e,t,i,r){Object(ht.c)(e,t,"layerDefinition.featureReduction",r)}get fieldsIndex(){return new N.a(this.fields||[])}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}writeIsTable(e,t,i,r){null!=r&&r.writeLayerSchema&&Object(n.c)(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeGlobalID"===e.type)return e.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeOID"===e.type)return e.name}get parsedUrl(){const e=this.url?Object(m.I)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=Object(m.x)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=Object(m.x)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Object(w.f)(e,this.fields),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const e=Object(C.b)(r,t,i)||void 0;return e||At.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}if(t.defaultSymbol)return t.types&&t.types.length?new T.a({defaultSymbol:Bt(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map((e=>({id:e.id,symbol:Bt(e.symbol,e,i)})))}):new E.a({symbol:Bt(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(kt(t)&&this._resetMemorySource(t),kt(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof j.a?new Xe({layer:this,items:e}):e:null}readSource(e,t){const i=Ve.default.fromJSON(t.featureSet);return new Xe({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map((e=>bt.a.fromJSON(e))),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?Object(P.h)(this.url,i):i;let t=i;if(!t&&this.url){const e=Object(P.e)(this.url);Object(o.h)(e)&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),Object(P.a)(t)}if("item-title"===this.sublayerTitleMode&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i){const e=Object(w.i)(t.fields,i);e&&(i=e.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map((e=>(e=yt.a.fromJSON(e),this._fixTemplates(e.templates,r),this._fixTemplates(e.templates,s),e)))}set url(e){const t=Object(P.g)(this,e,At);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){Object(P.i)(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("addAttachment"in this.source))throw new f.a(Pt,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)}))}updateAttachment(e,t,i){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("updateAttachment"in this.source))throw new f.a(Pt,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)}))}async applyEdits(e,t){const r=await i.e(24).then(i.bind(null,621));return await this.load(),r.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Object(xt.a)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load({signal:e});const t=await i.e(69).then(i.bind(null,622));Object(g.t)(e);const r=await new t.default({layer:this}).load({signal:e});return this.emit("graphics-source-create",{graphicsSource:r}),r}createQuery(){const e=new Et.a,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:i,timeExtent:r}=this;return e.timeExtent=null!=i&&null!=r?r.offset(-i.value,i.unit):r||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("deleteAttachments"in this.source))throw new f.a(Pt,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)}))}fetchRecomputedExtents(e){return this.load({signal:null==e?void 0:e.signal}).then((()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new f.a(Pt,"Layer source does not support fetchUpdates capability")}))}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let s=null;return i.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(s=e),!!s)})),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=Tt.a.from(e),this.load().then((()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new f.a(Pt,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:i,globalIds:r,num:s,size:a,start:n,where:o}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const l=i&&i.length>1,c=t&&t.length,d=r&&r.length,u=a&&a.length;if(l||c||d||u||s||n||o)throw new f.a(Pt,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||o))throw new f.a(Pt,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new f.a(Pt,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)}))}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(Et.a.from(e)||this.createQuery(),t))).then((e=>{if(e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Et.a.from(e)||this.createQuery(),t);throw new f.a(Pt,"Layer source does not support queryObjectIds capability")}))}queryFeatureCount(e,t){return this.load().then((()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Et.a.from(e)||this.createQuery(),t);throw new f.a(Pt,"Layer source does not support queryFeatureCount capability")}))}queryExtent(e,t){return this.load().then((()=>{if(this.source.queryExtent)return this.source.queryExtent(Et.a.from(e)||this.createQuery(),t);throw new f.a(Pt,"Layer source does not support queryExtent capability")}))}queryRelatedFeatures(e,t){return this.load().then((()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Ft.a.from(e),t);throw new f.a(Pt,"Layer source does not support queryRelatedFeatures capability")}))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Ft.a.from(e),t);throw new f.a(Pt,"Layer source does not support queryRelatedFeaturesCount capability")}))}read(e,t){const i=e.featureCollection;if(i){const e=i.layers;e&&1===e.length&&(super.read(e[0],t),null!=i.showLegend&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var i,r;const s=(t={...t,writeLayerSchema:null!=(i=null==(r=t)?void 0:r.writeLayerSchema)?i:this._hasMemorySource()}).origin,a=t.layerContainerType,n=t.messages;if(this.isTable){if("web-scene"===s||"web-map"===s&&"tables"!==a)return n&&n.push(new f.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null;if(this._hasMemorySource())return n&&n.push(new f.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using an in-memory Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&"web-map"===s&&"tables"===a)return n&&n.push(new f.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null;return super.write(e,t)}_readEditingEnabled(e,t,i){var r;let s=null==(r=e.layerDefinition)?void 0:r.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,!(t&&"web-map"===(null==i?void 0:i.origin)&&!this._hasMemorySource()&&s)||this._hasEditingCapability(s))}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,i,r){if(!e){var s,a;const e=null!=(s=this.capabilities)&&null!=(a=s.operations)&&a.supportsSync?"Query,Sync":"Query";Object(n.c)("layerDefinition.capabilities",e,t),!i||null!=r&&r.writeLayerSchema||(t.capabilities=e)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new f.a(Pt,"feature is missing the identifying attribute "+i)):Promise.reject(new f.a(Pt,"'attributes' are required on a feature to query attachments")):Promise.reject(new f.a(Pt,"A feature is required to add/delete/update attachments")):Promise.reject(new f.a(Pt,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Object(I.default)(this.url,{query:{f:"json",...this.customParameters},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Object(w.f)(this.renderer,this.fields),Object(w.g)(this.timeInfo,this.fields),Object(Mt.a)(this,{origin:"service"})}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const i=e.prototype&&e.prototype.attributes;i&&t&&delete i[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new f.a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new f.a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this._handles.add([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((e=>{const i=Lt[e.name];i&&(t[i]=!!e.isEnabled)})),t}_readDataCapabilities(e){return{isVersioned:Rt(e,"isDataVersioned",!1),supportsAttachment:Rt(e,"hasAttachments",!1),supportsM:Rt(e,"hasM",!1),supportsZ:Rt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Rt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=-1!==i.indexOf("editing");let s=r&&-1!==i.indexOf("create"),a=r&&-1!==i.indexOf("delete"),n=r&&-1!==i.indexOf("update");const o=-1!==i.indexOf("changetracking");return r&&!(s||a||n)&&(s=a=n=!0),{supportsCalculate:Rt(t,"supportsCalculate",!1),supportsTruncate:Rt(t,"supportsTruncate",!1),supportsValidateSql:Rt(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:a,supportsEditing:r,supportsChangeTracking:o,supportsQuery:-1!==i.indexOf("query"),supportsQueryAttachments:Rt(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Rt(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==i.indexOf("sync"),supportsUpdate:n,supportsExceedsLimitStatistics:Rt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(e.supportedQueryFormats||"").split(",").reduce(((e,t)=>{const i=t.toLowerCase().trim();return i&&e.add(i),e}),new Set);return{supportsStatistics:Rt(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Rt(t,"supportsPercentileStatistics",!1),supportsCentroid:Rt(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Rt(t,"supportsQueryWithDistance",!1),supportsDistinct:Rt(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Rt(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Rt(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Rt(t,"supportsHavingClause",!1),supportsOrderBy:Rt(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Rt(t,"supportsPagination",!1),supportsQuantization:Rt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Rt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Rt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Rt(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Rt(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Rt(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Rt(e,"useStandardizedQueries",!1),supportsQueryByOthers:Rt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Rt(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:s.has("pbf"),supportsDisjointSpatialRelationship:Rt(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Rt(t,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:Nt(e,"maxRecordCountFactor",void 0),maxRecordCount:Nt(e,"maxRecordCount",void 0),standardMaxRecordCount:Nt(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:Nt(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Rt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Rt(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Rt(e,"allowGeometryUpdates",!0),supportsGlobalId:Rt(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:Rt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Rt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Rt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Rt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Rt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Rt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Rt(t,"allowOthersToUpdate",!0)}}};Object(s.a)([Object(c.b)({readOnly:!0,json:{read:!1}})],Ut.prototype,"capabilities",void 0),Object(s.a)([Object(p.a)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Ut.prototype,"readCapabilities",null),Object(s.a)([Object(c.b)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ut.prototype,"charts",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"createQueryVersion",null),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Ut.prototype,"copyright",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Ut.prototype,"displayField",void 0),Object(s.a)([Object(c.b)({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],Ut.prototype,"definitionExpression",void 0),Object(s.a)([Object(c.b)({types:S.i,readOnly:!0})],Ut.prototype,"defaultSymbol",void 0),Object(s.a)([Object(c.b)({type:St.a})],Ut.prototype,"dynamicDataSource",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"editFieldsInfo",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Ut.prototype,"editingEnabled",void 0),Object(s.a)([Object(p.a)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ut.prototype,"readEditingEnabled",null),Object(s.a)([Object(p.a)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ut.prototype,"readEditingEnabledFromWebMap",null),Object(s.a)([Object(y.a)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ut.prototype,"writeEditingEnabled",null),Object(s.a)([Object(y.a)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ut.prototype,"writeEditingEnabledToWebMap",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"editingInfo",void 0),Object(s.a)([Object(p.a)("editingInfo")],Ut.prototype,"readEditingInfo",null),Object(s.a)([Object(c.b)(k.b)],Ut.prototype,"elevationInfo",void 0),Object(s.a)([Object(c.b)({types:{key:"type",base:ct.a,typeMap:{selection:pt.a,cluster:ut.a}},json:{write:{target:"layerDefinition.featureReduction"}}})],Ut.prototype,"featureReduction",void 0),Object(s.a)([Object(p.a)("featureReduction",["layerDefinition.featureReduction"])],Ut.prototype,"readFeatureReduction",null),Object(s.a)([Object(y.a)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:ht.b}})],Ut.prototype,"writeWebSceneFeatureReduction",null),Object(s.a)([Object(c.b)({...Dt.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Vt}}}}})],Ut.prototype,"fields",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"fieldsIndex",null),Object(s.a)([Object(c.b)({type:De,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ut.prototype,"formTemplate",void 0),Object(s.a)([Object(c.b)({type:O.a,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Ut.prototype,"fullExtent",void 0),Object(s.a)([Object(c.b)()],Ut.prototype,"gdbVersion",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:vt,json:{read:{source:"geometryProperties"}}})],Ut.prototype,"geometryFieldsInfo",void 0),Object(s.a)([Object(c.b)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Ct.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Vt,writer(e,t,i){const r=e?Ct.toJSON(e):null;r&&Object(n.c)(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:Ct.read}}})],Ut.prototype,"geometryType",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Ut.prototype,"hasM",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Ut.prototype,"hasZ",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:A.a})],Ut.prototype,"heightModelInfo",void 0),Object(s.a)([Object(c.b)({type:Date})],Ut.prototype,"historicMoment",void 0),Object(s.a)([Object(c.b)({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],Ut.prototype,"id",void 0),Object(s.a)([Object(c.b)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ut.prototype,"isTable",void 0),Object(s.a)([Object(p.a)("service","isTable",["type","geometryType"]),Object(p.a)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ut.prototype,"readIsTable",null),Object(s.a)([Object(y.a)("web-map","isTable")],Ut.prototype,"writeIsTable",null),Object(s.a)([Object(c.b)(k.c)],Ut.prototype,"labelsVisible",void 0),Object(s.a)([Object(c.b)({type:[dt.a],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Ot.a},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Ot.a},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ut.prototype,"labelingInfo",void 0),Object(s.a)([Object(c.b)(k.f)],Ut.prototype,"opacity",void 0),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],Ut.prototype,"layerId",void 0),Object(s.a)([Object(c.b)(k.d)],Ut.prototype,"legendEnabled",void 0),Object(s.a)([Object(c.b)({type:["show","hide"]})],Ut.prototype,"listMode",void 0),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],Ut.prototype,"minScale",void 0),Object(s.a)([Object(p.a)("service","minScale",["minScale","effectiveMinScale"])],Ut.prototype,"readMinScale",null),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],Ut.prototype,"maxScale",void 0),Object(s.a)([Object(p.a)("service","maxScale",["maxScale","effectiveMaxScale"])],Ut.prototype,"readMaxScale",null),Object(s.a)([Object(c.b)({type:String})],Ut.prototype,"globalIdField",void 0),Object(s.a)([Object(p.a)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Object(p.a)("service","globalIdField",["globalIdField","fields"])],Ut.prototype,"readGlobalIdFieldFromService",null),Object(s.a)([Object(c.b)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Vt}}}}})],Ut.prototype,"objectIdField",void 0),Object(s.a)([Object(p.a)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Object(p.a)("service","objectIdField",["objectIdField","fields"])],Ut.prototype,"readObjectIdFieldFromService",null),Object(s.a)([Object(c.b)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ut.prototype,"operationalLayerType",void 0),Object(s.a)([Object(c.b)(Dt.outFields)],Ut.prototype,"outFields",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"parsedUrl",null),Object(s.a)([Object(c.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ut.prototype,"path",void 0),Object(s.a)([Object(c.b)(k.g)],Ut.prototype,"popupEnabled",void 0),Object(s.a)([Object(c.b)({type:_.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ut.prototype,"popupTemplate",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"defaultPopupTemplate",null),Object(s.a)([Object(c.b)({type:[It],readOnly:!0})],Ut.prototype,"relationships",void 0),Object(s.a)([Object(c.b)({types:F.a,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:F.b,write:{target:"layerDefinition.drawingInfo.renderer",writer:C.c}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:null==i?void 0:i.writeLayerSchema}),writer:C.c}}})],Ut.prototype,"renderer",null),Object(s.a)([Object(p.a)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Object(p.a)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ut.prototype,"readRenderer",null),Object(s.a)([Object(c.b)()],Ut.prototype,"sourceJSON",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Ut.prototype,"returnM",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Ut.prototype,"returnZ",void 0),Object(s.a)([Object(c.b)(k.j)],Ut.prototype,"screenSizePerspectiveEnabled",void 0),Object(s.a)([Object(c.b)()],Ut.prototype,"source",null),Object(s.a)([Object(d.a)("source")],Ut.prototype,"castSource",null),Object(s.a)([Object(p.a)("portal-item","source",["featureSet"]),Object(p.a)("web-map","source",["featureSet"])],Ut.prototype,"readSource",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"serviceDefinitionExpression",void 0),Object(s.a)([Object(p.a)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Ut.prototype,"readServiceDefinitionExpression",null),Object(s.a)([Object(c.b)({type:v.a,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Ut.prototype,"spatialReference",void 0),Object(s.a)([Object(c.b)({type:[bt.a]})],Ut.prototype,"templates",void 0),Object(s.a)([Object(p.a)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ut.prototype,"readTemplates",null),Object(s.a)([Object(c.b)({type:nt.a})],Ut.prototype,"timeInfo",void 0),Object(s.a)([Object(c.b)()],Ut.prototype,"title",void 0),Object(s.a)([Object(p.a)("service","title",["name"]),Object(p.a)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ut.prototype,"readTitle",null),Object(s.a)([Object(p.a)("web-map","title",["layerDefinition.name","title"])],Ut.prototype,"readTitleFromWebMap",null),Object(s.a)([Object(c.b)({type:String})],Ut.prototype,"sublayerTitleMode",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Ut.prototype,"trackIdField",void 0),Object(s.a)([Object(c.b)({json:{read:!1}})],Ut.prototype,"type",void 0),Object(s.a)([Object(c.b)({type:String})],Ut.prototype,"typeIdField",void 0),Object(s.a)([Object(p.a)("service","typeIdField"),Object(p.a)("typeIdField",["layerDefinition.typeIdField"])],Ut.prototype,"readTypeIdField",null),Object(s.a)([Object(c.b)({type:[yt.a]})],Ut.prototype,"types",void 0),Object(s.a)([Object(p.a)("service","types",["types"]),Object(p.a)("types",["layerDefinition.types"])],Ut.prototype,"readTypes",null),Object(s.a)([Object(c.b)({readOnly:!0,json:{write:!1}})],Ut.prototype,"serverGens",void 0),Object(s.a)([Object(c.b)({type:j.a.ofType(lt),readOnly:!0})],Ut.prototype,"indexes",void 0),Object(s.a)([Object(c.b)(k.k)],Ut.prototype,"url",null),Object(s.a)([Object(y.a)("url")],Ut.prototype,"writeUrl",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ut.prototype,"userIsAdmin",void 0),Object(s.a)([Object(c.b)({json:{origins:{service:{read:!0}},read:!1}})],Ut.prototype,"version",void 0),Object(s.a)([Object(p.a)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Ut.prototype,"readVersion",null),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ut.prototype,"visible",void 0),Object(s.a)([Object(p.a)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ut.prototype,"readVisible",null),Ut=Object(s.a)([Object(b.a)("esri.layers.FeatureLayer")],Ut);const Bt=Object(h.b)({types:S.a});var Gt=Ut;t.default=Gt},138:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5)),o=i(15),l=i(18),c=i(53),d=(i(25),i(35),i(36),i(52)),u=i(57),p=(i(59),i(113));let h=r=class extends d.a{constructor(e){super(e),this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}clone(){return new r(Object(a.a)({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};Object(s.a)([Object(o.b)({type:p.a,json:{write:!0}})],h.prototype,"dynamicDataSource",void 0),Object(s.a)([Object(o.b)({type:String,json:{write:!0}})],h.prototype,"gdbVersion",void 0),Object(s.a)([Object(o.b)({type:Number,json:{write:!0}})],h.prototype,"geometryPrecision",void 0),Object(s.a)([Object(o.b)({type:Date})],h.prototype,"historicMoment",void 0),Object(s.a)([Object(c.a)("historicMoment")],h.prototype,"_writeHistoricMoment",null),Object(s.a)([Object(o.b)({type:Number,json:{write:!0}})],h.prototype,"maxAllowableOffset",void 0),Object(s.a)([Object(o.b)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),Object(s.a)([Object(o.b)({type:[String],json:{write:!0}})],h.prototype,"orderByFields",void 0),Object(s.a)([Object(o.b)({type:[String],json:{write:!0}})],h.prototype,"outFields",void 0),Object(s.a)([Object(o.b)({type:u.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],h.prototype,"outSpatialReference",void 0),Object(s.a)([Object(o.b)({json:{write:!0}})],h.prototype,"relationshipId",void 0),Object(s.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0),Object(s.a)([Object(c.a)("start"),Object(c.a)("num")],h.prototype,"writeStart",null),Object(s.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,"num",void 0),Object(s.a)([Object(o.b)({json:{write:!0}})],h.prototype,"returnGeometry",void 0),Object(s.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],h.prototype,"returnM",void 0),Object(s.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],h.prototype,"returnZ",void 0),Object(s.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],h.prototype,"where",void 0),h=r=Object(s.a)([Object(l.a)("esri.tasks.support.RelationshipQuery")],h),h.from=Object(n.m)(h);var b=h;t.a=b},142:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},s=function(e,t){for(var i=0,a=e.length;i<a;i++){var n=e[i];Array.isArray(n)?s(n,t):null!=n&&!1!==n&&(n.hasOwnProperty("vnodeSelector")||(n=r(n)),t.push(n))}},a=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var a=[];return s(i,a),{vnodeSelector:e,properties:t||void 0,children:a,text:void 0,domNode:null}}},144:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5)),o=i(15),l=i(18),c=i(53),d=(i(25),i(35),i(36),i(52));let u=r=class extends d.a{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new r(Object(a.a)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};Object(s.a)([Object(o.b)({type:[String],json:{write:!0}})],u.prototype,"attachmentTypes",void 0),Object(s.a)([Object(o.b)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],u.prototype,"attachmentsWhere",void 0),Object(s.a)([Object(o.b)({type:[String],json:{write:!0}})],u.prototype,"keywords",void 0),Object(s.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"globalIds",void 0),Object(s.a)([Object(o.b)({json:{write:!0}})],u.prototype,"name",void 0),Object(s.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],u.prototype,"num",void 0),Object(s.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"objectIds",void 0),Object(s.a)([Object(o.b)({type:Boolean,json:{default:!1,write:!0}})],u.prototype,"returnMetadata",void 0),Object(s.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"size",void 0),Object(s.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],u.prototype,"start",void 0),Object(s.a)([Object(c.a)("start"),Object(c.a)("num")],u.prototype,"writeStart",null),Object(s.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],u.prototype,"where",void 0),u=r=Object(s.a)([Object(l.a)("esri.tasks.support.AttachmentQuery")],u),u.from=Object(n.m)(u);var p=u;t.a=p},147:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(14),s=(i(4),i(2),i(5),i(15)),a=i(54),n=i(18),o=(i(25),i(35),i(36),i(68)),l=i(89),c=i(84),d=i(102),u=i(109);const p=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const r=i.timeOffset,s=l.c.fromJSON(i.timeOffsetUnits);return r&&s?new d.a({value:r,unit:s}):null}set timeInfo(e){Object(o.g)(e,this.fields),this._set("timeInfo",e)}};return Object(r.a)([Object(s.b)({type:c.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(r.a)([Object(s.b)({type:d.a})],t.prototype,"timeOffset",void 0),Object(r.a)([Object(a.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(r.a)([Object(s.b)({value:null,type:u.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(r.a)([Object(s.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(r.a)([Object(n.a)("esri.layers.mixins.TemporalLayer")],t),t}},148:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(38),s=i(3),a=i(92);async function n(e,t,i){const n=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(n&&"unique-value"===n.type&&n.styleOrigin){const o=await Object(a.c)(n.populateFromStyle());if(Object(s.t)(i),!1===o.ok){const i=o.error;t&&t.messages&&t.messages.push(new r.a("renderer:style-reference","Failed to create unique value renderer from style reference: "+i.message,{error:i,context:t})),e.clear("renderer",t.origin)}}}},151:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(14),s=(i(4),i(0)),a=i(2),n=(i(5),i(15)),o=i(18),l=(i(25),i(35),i(36),i(91));const c=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=Object(l.e)(this.url);if(Object(s.h)(e)&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",Object(l.f)(e,a.a.getLogger(this.declaredClass)))}};return Object(r.a)([Object(n.b)()],t.prototype,"title",null),Object(r.a)([Object(n.b)({type:String})],t.prototype,"url",null),t=Object(r.a)([Object(o.a)("esri.layers.mixins.ArcGISService")],t),t}},159:function(e,t,i){"use strict";var r=i(14),s=(i(4),i(6)),a=(i(2),i(5),i(15)),n=i(54),o=i(18),l=i(53),c=(i(25),i(35),i(36),i(52)),d=i(141),u=i(139),p=i(140),h=(i(124),i(130));let b=class extends c.a{constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(r.type){case"range":t[i]=p.a.fromJSON(r);break;case"codedValue":t[i]=d.a.fromJSON(r);break;case"inherited":t[i]=u.a.fromJSON(r)}}return t}writeDomains(e,t){const i={};for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t]&&e[t].toJSON());Object(s.c)(i),t.domains=i}readTemplates(e){return e&&e.map((e=>new h.a(e)))}writeTemplates(e,t){t.templates=e&&e.map((e=>e.toJSON()))}};Object(r.a)([Object(a.b)({json:{write:!0}})],b.prototype,"id",void 0),Object(r.a)([Object(a.b)({json:{write:!0}})],b.prototype,"name",void 0),Object(r.a)([Object(a.b)({json:{write:!0}})],b.prototype,"domains",void 0),Object(r.a)([Object(n.a)("domains")],b.prototype,"readDomains",null),Object(r.a)([Object(l.a)("domains")],b.prototype,"writeDomains",null),Object(r.a)([Object(a.b)({json:{write:!0}})],b.prototype,"templates",void 0),Object(r.a)([Object(n.a)("templates")],b.prototype,"readTemplates",null),Object(r.a)([Object(l.a)("templates")],b.prototype,"writeTemplates",null),b=Object(r.a)([Object(o.a)("esri.layers.support.FeatureType")],b);var y=b;t.a=y},168:function(e,t,i){"use strict";var r=i(14),s=(i(4),i(2),i(5),i(15)),a=i(18),n=i(25),o=(i(35),i(36),i(23));let l=class extends o.a{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?Object(n.I)(e):null}_encode(e,t,i){const r={};for(const s in e){if("declaredClass"===s)continue;const a=e[s];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){r[s]=[];for(let e=0;e<a.length;e++)r[s][e]=this._encode(a[e])}else if("object"==typeof a)if(a.toJSON){const e=a.toJSON(i&&i[s]);r[s]=t?e:JSON.stringify(e)}else r[s]=t?a:JSON.stringify(a);else r[s]=a}return r}};Object(r.a)([Object(s.b)({readOnly:!0})],l.prototype,"parsedUrl",null),Object(r.a)([Object(s.b)()],l.prototype,"requestOptions",void 0),Object(r.a)([Object(s.b)({type:String})],l.prototype,"url",void 0),l=Object(r.a)([Object(a.a)("esri.tasks.Task")],l);var c=l;t.a=c},169:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(14),s=(i(4),i(2),i(5),i(15)),a=i(18);i(25),i(35),i(36);const n=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return Object(r.a)([Object(s.b)({json:{write:!0,origins:{"web-scene":{write:!1}}}})],t.prototype,"customParameters",void 0),t=Object(r.a)([Object(a.a)("esri.layers.mixins.CustomParametersMixin")],t),t}},170:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(2),s=i(68),a=i(82);const n=r.a.getLogger("esri.layers.support.fieldProperties");function o(){return{fields:{type:[a.a],value:null},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)Object(s.k)(this.fields,t)||n.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Object(s.e)(this.fields,e)}}}}},171:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return c}));var r=i(14),s=i(15),a=i(18),n=i(23),o=i(83),l=i(240);const c=e=>{let t=class extends e{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new o.a}get updatingHandles(){return this._get("updatingHandles")||new l.a}};return Object(r.a)([Object(s.b)({readOnly:!0})],t.prototype,"handles",null),Object(r.a)([Object(s.b)({readOnly:!0})],t.prototype,"updatingHandles",null),t=Object(r.a)([Object(a.a)("esri.core.HandleOwner")],t),t};let d=class extends(c(n.a)){};d=Object(r.a)([Object(a.a)("esri.core.HandleOwner")],d)},173:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(106);const s=/\[([^\[\]]+)\]/gi;function a(e,t,i){return e?e.map((e=>{const a=new r.a;if(a.read(e,i),a.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;a.labelExpression=a.labelExpression.replace(s,((t,i)=>`[${function(e,t){if(!t)return e;const i=e.toLowerCase();for(let e=0;e<t.length;e++){const r=t[e].name;if(r.toLowerCase()===i)return r}return e}(i,e)}]`))}return a})):null}},174:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i(68),s=(i(220),i(270)),a=(i(286),i(297)),n=i(246),o=i(271),l=(i(272),i(247),i(79));const c=["oid","global-id"],d=["oid","global-id","guid"];function u({displayField:e,editFieldsInfo:t,fields:i,objectIdField:a,title:n},c){if(!i)return null;const d=m({editFieldsInfo:t,fields:i,objectIdField:a},c);if(!d.length)return null;const u=function(e){const t=Object(r.h)(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}({titleBase:n,fields:i,displayField:e}),p=[new o.a,new s.a];return new l.a({title:u,content:p,fieldInfos:d})}const p=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],h=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!(y(e.name,t)||i&&e.name===i||c.indexOf(e.type)>-1||p.some((t=>t.test(e.name))));function b(e,t){return"oid"===e.type?-1:"oid"===t.type?1:v(e)?-1:v(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function y(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:a}=t;return-1!==[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),a&&a.toLowerCase()].indexOf(e.toLowerCase())}function f(e,t){return e.editable&&-1===d.indexOf(e.type)&&!y(e.name,t)}function m({editFieldsInfo:e,fields:t,objectIdField:i},r){return function(e,t){const i=e;return t&&(e=e.filter((e=>-1===t.indexOf(e.type)))),e===i&&(e=e.slice()),e.sort(b),e}(t,(null==r?void 0:r.ignoreFieldTypes)||O).map((t=>new n.a({fieldName:t.name,isEditable:f(t,e),label:t.alias,format:g(t),visible:h(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:null==r?void 0:r.visibleFieldNames})})))}function g(e){switch(e.type){case"small-integer":case"integer":case"single":return new a.a({digitSeparator:!0,places:0});case"double":return new a.a({digitSeparator:!0,places:2});case"date":return new a.a({dateFormat:"long-month-day-year"});default:return null}}function v(e){return"name"===(e.name&&e.name.toLowerCase())||"name"===(e.alias&&e.alias.toLowerCase())||void 0}const O=["geometry","blob","raster","guid","xml"]},177:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return c}));const r=[252,146,31,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},a={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},n={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},o={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},d={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},179:function(e,t,i){"use strict";i.r(t);var r,s=i(14),a=(i(4),i(6)),n=i(0),o=i(39),l=i(2),c=(i(5),i(15)),d=i(18),u=i(53),p=i(16),h=(i(25),i(35),i(36),i(3)),b=i(202),y=i(68),f=i(62),m=i(242),g=i(58),v=i(127),O=i(221),j=i(215);const w=l.a.getLogger("esri.renderers.DictionaryRenderer"),_={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let I=r=class extends(Object(O.a)(v.a)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new j.a(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){null!=r&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new r({config:Object(a.a)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Object(a.a)(this.fieldMap),url:Object(a.a)(this.url),visualVariables:Object(a.a)(this.visualVariables)})}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(e){if(Object(h.l)(e))return this._dictionaryPromise=null,null}const r={};if(this.fieldMap)for(const t of this._symbolFields){const i=this.fieldMap[t];if(i&&null!==e.attributes[i]&&void 0!==e.attributes[i]){const s=""+e.attributes[i];r[t]=s}else r[t]=""}const s=i(r,t);if(!s||"string"!=typeof s)return null;const a=Object(o.b)(s).toString(),l=this._symbolCache.get(a);if(l)return l.catch((()=>{this._symbolCache.pop(a)})),l;const c=s.split(";"),d=[],u=[];for(const e of c)if(e&&0!==e.length)if(-1===e.indexOf("po:"))if(-1!==e.indexOf("|"))for(const t of e.split("|"))this._itemNames.has(t)&&d.push(t);else this._itemNames.has(e)&&d.push(e);else{const t=e.substr(3).split("|");if(3===t.length){const e=t[0],i=t[1];let r=t[2];if("DashTemplate"===i)r=r.split(" ").map((e=>Number(e)));else if("Color"===i){const e=new f.a(r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);u.push({primitiveName:e,propertyName:i,value:r})}}const p=!Object(n.h)(e.geometry)||!e.geometry.hasZ&&"point"===e.geometry.type,b=this._cimPartsToCIMSymbol(d,u,p,t);return this._symbolCache.put(a,b,1),b}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(y.a)(e,t,this.scaleExpression);const i=t.map((e=>e.name));for(const t in this.fieldMap)i.indexOf(this.fieldMap[t])<0||e.add(this.fieldMap[t])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void w.error("no valid URL!");const t=Object(n.h)(e)?e.abortOptions:null,i=Object(g.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:r}]=await Promise.all([i,Object(b.e)()]);if(!r)throw this._dictionaryPromise=null,new p.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,a=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=a.symbol;const o={};if(this.config){const e=this.config;for(const t in e)o[t]=e[t]}for(const e of a.configuration)o.hasOwnProperty(e.name)||(o[e.name]=e.value);const l=[];if(Object(n.h)(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const i=this.fieldMap[t],r=e.fields.filter((e=>e.name===i));r.length>0&&l.push({...r[0],name:t})}return this._dictionaryPromise=Object(b.b)(s,Object(n.h)(e)?e.spatialReference:null,l,o).then((e=>{const t={scale:0};return(i,r)=>{const s=e.repurposeFeature({geometry:null,attributes:i});return t.scale=Object(n.h)(r)?r.scale:void 0,e.evaluate({$feature:s,$view:t})}})).catch((e=>(w.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),r=Object(g.default)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,r);try{return(await r).data}catch(t){return this._ongoingRequests.delete(e),Promise.reject(t)}}_combineSymbolParts(e,t,i){if(!e||0===e.length)return null;const r={...e[0]};if(e.length>1){r.symbolLayers=[];for(const t of e){const e=t;r.symbolLayers.unshift(...e.symbolLayers)}}return i&&(r.callout=_),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,i,r){const s=new Array(e.length);for(let t=0;t<e.length;t++)s[t]=this._getSymbolPart(e[t],r);const a=await Promise.all(s);return new m.a({data:this._combineSymbolParts(a,t,i)})}};Object(s.a)([Object(c.b)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],I.prototype,"config",void 0),Object(s.a)([Object(c.b)({type:Object,json:{write:!0}})],I.prototype,"fieldMap",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],I.prototype,"scaleExpression",void 0),Object(s.a)([Object(u.a)("scaleExpression")],I.prototype,"writeData",null),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],I.prototype,"scaleExpressionTitle",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],I.prototype,"url",void 0),Object(s.a)([Object(u.a)("visualVariables")],I.prototype,"writeVisualVariables",null),I=r=Object(s.a)([Object(d.a)("esri.renderers.DictionaryRenderer")],I);var S=I;t.default=S},180:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return d}));var r=i(9),s=i(16),a=i(94),n=i(131),o=i(126);const l={key:"type",base:a.a,typeMap:{selection:o.a}};function c(e,t){const i=(t=t.layerDefinition||t).featureReduction;if(i)switch(i.type){case"selection":return o.a.fromJSON(i);case"cluster":return n.a.fromJSON(i)}return null}function d(e,t,i,a){const n=function(e,t,i){return e?"selection"!==e.type?(i.messages&&i.messages.push(new s.a("featureReduction:unsupported",`FeatureReduction of type '${e.declaredClass}' are not supported in scenes.`,{featureReduction:e,context:i})),null):e.write({},i):null}(e,0,a);n&&Object(r.c)(i,n,t)}},184:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return b}));var r=i(0),s=i(7),a=i(23),n=i(61);const o=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function l(e){return e instanceof a.a}function c(e){return e instanceof n.a?Object.keys(e.items):l(e)?Object(s.a)(e).keys():e?Object.keys(e):[]}function d(e,t){return e instanceof n.a?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function p(e,t){const i=e.diff;if(i&&"function"==typeof i)return i(e,t);const s=c(e),a=c(t);if(0===s.length&&0===a.length)return;if(!s.length||!a.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const n=a.filter((e=>-1===s.indexOf(e))),h=s.filter((e=>-1===a.indexOf(e))),b=s.filter((i=>a.indexOf(i)>-1&&d(e,i)!==d(t,i))).concat(n,h).sort(),y=u(e);if(y&&o.indexOf(y)>-1&&b.length)return{type:"complete",oldValue:e,newValue:t};let f;const m=l(e)&&l(t);for(const s of b){const a=d(e,s),n=d(t,s);let o;(m||"function"!=typeof a&&"function"!=typeof n)&&a!==n&&(null==a&&null==n||(o=i&&i[s]&&"function"==typeof i[s]?i[s](a,n):"object"==typeof a&&"object"==typeof n&&u(a)===u(n)?p(a,n):{type:"complete",oldValue:a,newValue:n},Object(r.h)(o)&&(Object(r.h)(f)?f.diff[s]=o:f={type:"partial",diff:{[s]:o}})))}return f}function h(e,t){if(Object(r.g)(e))return!1;const i=t.split(".");let s=e;for(const e of i){if("complete"===s.type)return!0;if("partial"!==s.type)return!1;{const t=s.diff[e];if(!t)return!1;s=t}}return!0}function b(e,t){for(const i of t)if(h(e,i))return!0;return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:p(e,t)}},185:function(e,t,i){"use strict";var r=i(14),s=(i(4),i(2)),a=i(15),n=i(66),o=i(18),l=(i(25),i(35)),c=(i(36),i(8)),d=i(3),u=i(27),p=i(111),h=i(67),b=i(85),y=(i(118),i(156)),f=i(83),m=i(37),g=i(302),v=i(77),O=(i(256),i(321));const j=s.a.getLogger("esri.widgets.Widget");let w=0;const _=Object(O.a)();let I=!1,S=class extends(Object(y.b)(p.a.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new f.a,this._projector=_,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=Object(d.i)((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await Object(d.j)(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{this[t]=await Object(b.a)(e)})));for(const t of e)t.error&&j.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()}));const i="esri-widget-uid-"+Object(l.a)(),r=this.render.bind(this);let s=!1;this._trackingTarget=new u.a((()=>this.scheduleRender()));const a=()=>{if(!s||this.destroyed)return null;const e=r();return e.properties?e.properties.key||(e.properties.key=i):e.properties={key:i},e};this.render=()=>{if(I)return a();let e;this._trackingTarget.clear(),I=!0;try{e=Object(c.b)(this._trackingTarget,a)}finally{I=!1}return e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{s=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch(d.u)}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return Object(g.a)(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+w++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return v.a.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e;this.destroyed||(this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(Object(m.a)(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(Object(h.c)((async()=>{await this._loadLocale().catch(d.u),this.scheduleRender()}))),this._internalHandles.add(Object(m.i)(this,"container",(async e=>{this.destroyed||this._attach(e)}))))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Object(r.a)([Object(a.b)({value:null})],S.prototype,"container",null),Object(r.a)([Object(n.a)("container")],S.prototype,"castContainer",null),Object(r.a)([Object(a.b)({aliasOf:"container"})],S.prototype,"domNode",void 0),Object(r.a)([Object(a.b)()],S.prototype,"iconClass",void 0),Object(r.a)([Object(a.b)()],S.prototype,"id",null),Object(r.a)([Object(a.b)()],S.prototype,"label",void 0),Object(r.a)([Object(a.b)()],S.prototype,"renderable",null),Object(r.a)([Object(a.b)()],S.prototype,"viewModel",void 0),Object(r.a)([Object(a.b)()],S.prototype,"visible",void 0),S=Object(r.a)([Object(o.a)("esri.widgets.Widget")],S);var M=S;t.a=M},186:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return f})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return O})),i.d(t,"g",(function(){return h}));var r=i(95),s=i(0),a=i(2),n=i(62),o=i(65),l=i(121),c=i(86);const d=a.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=new o.a,p=Math.PI,h=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"color"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void d.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const a="number"==typeof t,o=a?null:t,l=o&&o.attributes;let c=a?t:null;const u=r.field,{ipData:p,hasExpression:h}=r.cache;let b=r.cache.compiledFunc;if(!u&&!h){const e=r.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(h){if(!Object(s.h)(i)||!Object(s.h)(i.arcade))return void d.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,a=t.getViewInfo(e),n=t.createExecContext(o,a);if(!b){const e=t.createSyntaxTree(r.valueExpression);b=t.createFunction(e),r.cache.compiledFunc=b}c=t.executeFunction(b,n)}else l&&(c=l[u]);const y=r.normalizationField,f=l?parseFloat(l[y]):void 0;if(null!=c&&(!y||a||!isNaN(f)&&0!==f)){isNaN(f)||a||(c/=f);const e=j(c,p);if(e){const t=e[0],a=e[1],o=t===a?r.stops[t].color:n.a.blendColors(r.stops[t].color,r.stops[a].color,e[2],Object(s.h)(i)?i.color:void 0);return new n.a(o)}}}function y(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"opacity"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void d.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const a="number"==typeof t,n=a?null:t,o=n&&n.attributes;let l=a?t:null;const c=r.field,{ipData:u,hasExpression:p}=r.cache;let h=r.cache.compiledFunc;if(!c&&!p){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(p){if(Object(s.g)(i)||Object(s.g)(i.arcade))return void d.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,a=t.getViewInfo(e),o=t.createExecContext(n,a);if(!h){const e=t.createSyntaxTree(r.valueExpression);h=t.createFunction(e),r.cache.compiledFunc=h}l=t.executeFunction(h,o)}else o&&(l=o[c]);const b=r.normalizationField,y=o?parseFloat(o[b]):void 0;if(null!=l&&(!b||a||!isNaN(y)&&0!==y)){isNaN(y)||a||(l/=y);const e=j(l,u);if(e){const t=e[0],i=e[1];if(t===i)return r.stops[t].opacity;{const s=r.stops[t].opacity;return s+(r.stops[i].opacity-s)*e[2]}}}}function f(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"rotation"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void d.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const a=r.axis||"heading",n="heading"===a&&"arithmetic"===r.rotationType?90:0,o="heading"===a&&"arithmetic"===r.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,u=r.field,{hasExpression:p}=r.cache;let h=r.cache.compiledFunc,b=0;if(!u&&!p)return b;if(p){if(Object(s.g)(i)||Object(s.g)(i.arcade))return void d.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,a=t.getViewInfo(e),n=t.createExecContext(l,a);if(!h){const e=t.createSyntaxTree(r.valueExpression);h=t.createFunction(e),r.cache.compiledFunc=h}b=t.executeFunction(h,n)}else c&&(b=c[u]||0);return b="number"!=typeof b||isNaN(b)?null:n+o*b,b}function m(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"size"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void d.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const a=function(e,t,i,r,a){switch(t.transformationType){case"additive":return function(e,t,i,r){return e+(g(t.minSize,i,r)||t.minDataValue)}(e,t,i,r);case"constant":return function(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return null==s&&(s=e.minSize),g(s,t,i)}(t,i,r);case"clamped-linear":return function(e,t,i,r){const a=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=g(t.minSize,i,r),o=g(t.maxSize,i,r),l=Object(s.h)(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?p*(n/2)**2:n*n,i=t+a*((e?p*(o/2)**2:o*o)-t);return e?2*Math.sqrt(i/p):Math.sqrt(i)}return n+a*(o-n)}(e,t,i,r);case"proportional":return function(e,t,i,r){const a=Object(s.h)(r)?r.shape:void 0,n=e/t.minDataValue,o=g(t.minSize,i,r),l=g(t.maxSize,i,r);let c=null;return c="circle"===a?2*Math.sqrt(n*(o/2)**2):"square"===a||"diamond"===a||"image"===a?Math.sqrt(n*o**2):n*o,v(c,o,l)}(e,t,i,r);case"stops":return function(e,t,i,r,s){const[a,n,o]=j(e,s);if(a===n)return g(t.stops[a].size,i,r);{const e=g(t.stops[a].size,i,r);return e+(g(t.stops[n].size,i,r)-e)*o}}(e,t,i,r,a);case"real-world-size":return function(e,t,i,r){const a=(Object(s.h)(r)&&r.resolution?r.resolution:1)*c.a[t.valueUnit],n=g(t.minSize,i,r),o=g(t.maxSize,i,r),{valueRepresentation:l}=t;let d=null;return d="area"===l?2*Math.sqrt(e/p)/a:"radius"===l||"distance"===l?2*e/a:e/a,v(d,n,o)}(e,t,i,r);case"identity":return e;case"unknown":return null}}(function(e,t,i){const r="number"==typeof t,a=r?null:t,n=a&&a.attributes;let o=r?t:null;const{isScaleDriven:c}=e.cache;let u=e.cache.compiledFunc;if(c){const t=Object(s.h)(i)?i.scale:void 0,r=Object(s.h)(i)?i.view:void 0;o=null==t||"3d"===r?function(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!r)switch(e.inputValueType){case"expression":{if(Object(s.g)(i)||Object(s.g)(i.arcade))return void d.error("Use of arcade expressions requires an arcade context");const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},r=i.arcade.arcadeUtils,n=r.getViewInfo(t),l=r.createExecContext(a,n);if(!u){const t=r.createSyntaxTree(e.valueExpression);u=r.createFunction(t),e.cache.compiledFunc=u}o=r.executeFunction(u,l);break}case"field":n&&(o=n[e.field]);break;case"unknown":o=null}if(!Object(l.d)(o))return null;if(r||!e.normalizationField)return o;const p=n?parseFloat(n[e.normalizationField]):null;return Object(l.d)(p)&&0!==p?o/p:null}(r,t,i),r,t,i,r.cache.ipData);return null==a||isNaN(a)?0:a}function g(e,t,i){return null==e?null:Object(l.c)(e)?m(e,t,i):Object(l.d)(e)?e:null}function v(e,t,i){return Object(l.d)(i)&&e>i?i:Object(l.d)(t)&&e<t?t:e}function O(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&"3d"===i||t))return null;const s={scale:t,view:i};let a=g(e.minSize,u,s),n=g(e.maxSize,u,s);if(null!=a||null!=n){if(a>n){const e=n;n=a,a=e}return{minSize:a,maxSize:n}}}function j(e,t){if(!t)return;let i=0,r=t.length-1;return t.some(((t,s)=>e<t?(r=s,!0):(i=s,!1))),[i,r,(e-t[i])/(t[r]-t[i])]}function w(e,t,i){const s=["proportional","proportional","proportional"];for(const a of e){const e=a.useSymbolValue?"symbol-value":m(a,t,i);switch(a.axis){case"width":s[0]=e;break;case"depth":s[1]=e;break;case"height":s[2]=e;break;case"width-and-depth":s[0]=e,s[1]=e;break;case"all":case void 0:case null:s[0]=e,s[1]=e,s[2]=e;break;default:Object(r.a)(a.axis)}}return s}},187:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5),i(15)),o=i(56),l=i(18),c=(i(25),i(35),i(36),i(127)),d=i(221),u=i(363);let p=r=class extends(Object(d.a)(c.a)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((i=>i.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new r({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Object(a.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],p.prototype,"description",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],p.prototype,"label",void 0),Object(s.a)([Object(n.b)(u.b)],p.prototype,"symbol",void 0),Object(s.a)([Object(o.a)({simple:"simple"})],p.prototype,"type",void 0),p=r=Object(s.a)([Object(l.a)("esri.renderers.SimpleRenderer")],p);var h=p;t.a=h},188:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var r=i(127),s=i(143),a=i(152),n=i(179),o=i(189),l=i(190),c=i(187);const d={key:"type",base:r.a,typeMap:{heatmap:l.a,simple:c.a,"unique-value":a.a,"class-breaks":s.a,"dot-density":o.a,dictionary:n.default},errorContext:"renderer"},u={key:"type",base:r.a,typeMap:{simple:c.a,"unique-value":a.a,"class-breaks":s.a},errorContext:"renderer"}},189:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=i(2),o=i(5),l=i(15),c=i(157),d=i(56),u=i(18),p=(i(25),i(35),i(36),i(68)),h=i(62),b=i(153),y=i(219),f=i(127),m=i(221),g=i(66),v=i(52);const O=n.a.getLogger("esri.renderers.support.AttributeColorInfo");let j=r=class extends v.a{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(O.error(".field: field must be a string value"),null):Object(o.l)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new r({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};Object(s.a)([Object(l.b)({type:h.a,json:{type:[Number],write:!0}})],j.prototype,"color",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],j.prototype,"field",void 0),Object(s.a)([Object(g.a)("field")],j.prototype,"castField",null),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],j.prototype,"label",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],j.prototype,"valueExpression",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],j.prototype,"valueExpressionTitle",void 0),j=r=Object(s.a)([Object(u.a)("esri.renderers.support.AttributeColorInfo")],j);var w,_=j;let I=w=class extends v.a{constructor(){super(...arguments),this.unit=null}clone(){return new w({unit:this.unit})}};Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],I.prototype,"unit",void 0),I=w=Object(s.a)([Object(u.a)("esri.renderers.support.DotDensityLegendOptions")],I);var S,M=I;let x=S=class extends(Object(m.a)(f.a)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new h.a([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new b.a,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new y.a({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new S({attributes:Object(a.a)(this.attributes),backgroundColor:Object(a.a)(this.backgroundColor),dotBlendingEnabled:Object(a.a)(this.dotBlendingEnabled),dotShape:Object(a.a)(this.dotShape),dotSize:Object(a.a)(this.dotSize),dotValue:Object(a.a)(this.dotValue),legendOptions:Object(a.a)(this.legendOptions),outline:Object(a.a)(this.outline),referenceScale:Object(a.a)(this.referenceScale),visualVariables:Object(a.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map((e=>e.field||e.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Object(p.a)(e,t,i.valueExpression),i.field&&e.add(i.field)}};Object(s.a)([Object(l.b)({type:[_],json:{write:!0}})],x.prototype,"attributes",void 0),Object(s.a)([Object(l.b)({type:h.a,json:{write:!0}})],x.prototype,"backgroundColor",void 0),Object(s.a)([Object(l.b)({type:Boolean}),Object(c.a)("dotBlendingEnabled")],x.prototype,"blendDots",void 0),Object(s.a)([Object(l.b)({type:Boolean,json:{write:!0}})],x.prototype,"dotBlendingEnabled",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!1}})],x.prototype,"dotShape",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!1}})],x.prototype,"dotSize",void 0),Object(s.a)([Object(l.b)({type:M,json:{write:!0}})],x.prototype,"legendOptions",void 0),Object(s.a)([Object(l.b)({type:b.a,json:{default:null,write:!0}})],x.prototype,"outline",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],x.prototype,"dotValue",void 0),Object(s.a)([Object(l.b)({type:Number}),Object(c.a)("dotValue")],x.prototype,"referenceDotValue",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],x.prototype,"referenceScale",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],x.prototype,"seed",void 0),Object(s.a)([Object(d.a)({dotDensity:"dot-density"})],x.prototype,"type",void 0),x=S=Object(s.a)([Object(u.a)("esri.renderers.DotDensityRenderer")],x);var T=x;t.a=T},190:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=(i(2),i(5),i(15)),o=i(56),l=i(18),c=(i(25),i(35),i(36),i(68)),d=i(62),u=i(127),p=i(52);let h=r=class extends p.a{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new r({color:this.color,ratio:this.ratio})}};Object(s.a)([Object(n.b)({type:d.a,json:{write:!0}})],h.prototype,"color",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],h.prototype,"ratio",void 0),h=r=Object(s.a)([Object(l.a)("esri.renderers.support.HeatmapColorStop")],h);var b,y=h;let f=b=class extends u.a{constructor(e){super(e),this.blurRadius=10,this.colorStops=[new y({ratio:0,color:new d.a("rgba(255, 140, 0, 0)")}),new y({ratio:.75,color:new d.a("rgba(255, 140, 0, 1)")}),new y({ratio:.9,color:new d.a("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const i=this.field;i&&"string"==typeof i&&Object(c.b)(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new b({blurRadius:this.blurRadius,colorStops:Object(a.a)(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],f.prototype,"blurRadius",void 0),Object(s.a)([Object(n.b)({type:[y],json:{write:!0}})],f.prototype,"colorStops",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],f.prototype,"field",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:null==i})}}})],f.prototype,"fieldOffset",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],f.prototype,"maxPixelIntensity",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],f.prototype,"minPixelIntensity",void 0),Object(s.a)([Object(o.a)({heatmap:"heatmap"})],f.prototype,"type",void 0),f=b=Object(s.a)([Object(l.a)("esri.renderers.HeatmapRenderer")],f);var m=f;t.a=m},192:function(e,t,i){"use strict";function r(e){return function(t,i){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}i.d(t,"a",(function(){return r}))},193:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return l})),i(4);var r=i(9),s=i(38),a=i(31),n=i(16),o=i(188);function l(e,t,i,s){const a=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":default:return!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new n.a("renderer:unsupported",`Renderer of type '${e.declaredClass}' are not supported in scenes.`,{renderer:e,context:t})),null):null}(e,s);a&&Object(r.c)(i,a,t)}function c(e,t){return u(e,null,t)}const d=Object(a.b)({types:o.a});function u(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i&&i.messages&&i.messages.push(new s.a("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):d(e,t,i):null}},204:function(e,t,i){"use strict";var r=i(14),s=i(15),a=i(18),n=i(61),o=i(83);let l=class extends n.a{constructor(e){super(e),this._handles=new o.a,this.root=null}initialize(){this._handles.add(this.rootCollectionNames.map((e=>this.watch("root."+e,(()=>this.updateCollections()),!0)))),this.updateCollections()}destroy(){this.root=null,this.refresh(),this._handles.destroy(),this._handles=null}updateCollections(){this._collections=this.rootCollectionNames.map((e=>this.get("root."+e))).filter((e=>null!=e)),this.refresh()}refresh(){const e=this._handles;e.remove("collections");const t=new Array;let i=0;for(const e of this._collections)i=this._processCollection(t,i,e);this.splice(i,this.length);for(const i of t)e.add(i.on("after-changes",(()=>this.refresh())),"collections")}_createNewInstance(e){return new n.a(e)}_processCollection(e,t,i){return i?(e.push(i),i.forEach((i=>{if(i){if(!this.itemFilterFunction||this.itemFilterFunction(i)){const e=this.indexOf(i,t);e>=0?e!==t&&this.reorder(i,t):this.add(i,t),++t}this.getChildrenFunction&&(t=this._processCollection(e,t,this.getChildrenFunction(i)))}})),t):t}};Object(r.a)([Object(s.b)()],l.prototype,"rootCollectionNames",void 0),Object(r.a)([Object(s.b)()],l.prototype,"root",void 0),Object(r.a)([Object(s.b)()],l.prototype,"getChildrenFunction",void 0),Object(r.a)([Object(s.b)()],l.prototype,"itemFilterFunction",void 0),l=Object(r.a)([Object(a.a)("esri.core.CollectionFlattener")],l);var c=l;t.a=c},205:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l}));var r=i(0),s=i(61),a=i(80),n=i(92);async function o(e,t){return await e.load(),l(e,t)}async function l(e,t){const i=[],o=(...e)=>{for(const t of e)Object(r.g)(t)||(Array.isArray(t)?o(...t):s.a.isCollection(t)?t.forEach((e=>o(e))):a.a.isLoadable(t)&&i.push(t))};t(o);let l=null;if(await Object(n.b)(i,(async e=>{!1!==(await Object(n.c)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load())).ok||l||(l=e)})),l)throw l.loadError;return e}},215:function(e,t,i){"use strict";var r=i(264);t.a=class{constructor(e,t){this._storage=new r.b,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},228:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(2),i(5)),n=i(15),o=i(18),l=(i(25),i(35),i(36),i(52));const c={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let d=r=class extends l.a{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find((e=>e.name===i));return s?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find((e=>e.name===t));return r&&r.value||null}({tagName:r,tags:s.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return c[t]||null}clone(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};Object(s.a)([Object(n.b)({type:String})],d.prototype,"contentType",void 0),Object(s.a)([Object(n.b)()],d.prototype,"exifInfo",void 0),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"orientationInfo",null),Object(s.a)([Object(n.b)({type:a.a})],d.prototype,"id",void 0),Object(s.a)([Object(n.b)({type:String})],d.prototype,"globalId",void 0),Object(s.a)([Object(n.b)({type:String})],d.prototype,"keywords",void 0),Object(s.a)([Object(n.b)({type:String})],d.prototype,"name",void 0),Object(s.a)([Object(n.b)({json:{read:!1}})],d.prototype,"parentGlobalId",void 0),Object(s.a)([Object(n.b)({json:{read:!1}})],d.prototype,"parentObjectId",void 0),Object(s.a)([Object(n.b)({type:a.a})],d.prototype,"size",void 0),Object(s.a)([Object(n.b)({json:{read:!1}})],d.prototype,"url",void 0),d=r=Object(s.a)([Object(o.a)("esri.layers.support.AttachmentInfo")],d);var u=d;t.a=u},233:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return c}));var r=i(25),s=i(104),a=i(58),n=i(195),o=i(228);function l(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function c(e,t){const i={};for(const a of e){const{parentObjectId:e,parentGlobalId:n,attachmentInfos:l}=a;for(const a of l){const{id:l}=a,c=Object(r.b)(Object(s.a)(`${t}/${e}/attachments/${l}`)),d=o.a.fromJSON(a);d.set({url:c,parentObjectId:e,parentGlobalId:n}),i[e]?i[e].push(d):i[e]=[d]}}return i}function d(e,t,i){let r={query:Object(n.a)({...e.query,f:"json",...l(t)})};return i&&(r={...i,...r,query:{...i.query,...r.query}}),Object(a.default)(e.path+"/queryAttachments",r)}},240:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(14),s=i(13),a=i(15),n=i(18),o=i(40),l=i(33),c=i(23),d=i(83),u=i(37);let p=class extends c.a{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new d.a,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i,r=0){const s=0!=(1&r),a=++this.handleId;s||this.installSyncUpdatingWatch(e,t,a);const n=0!=(2&r)?Object(u.a)(e,t,i,s):e.watch(t,i,s);return this.handles.add(n,a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionPropertyChange(e,t,i,r=0){const s=0!=(2&r),a=++this.handleId;return this.handles.add([Object(u.b)(e,t,"after-changes",this.createSyncUpdatingCallback()),Object(u.b)(e,t,"change",i,s?e=>{i({added:e.items,removed:[],moved:[],target:e})}:void 0)],a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionChange(e,t,i=0){const r=0!=(2&i),s=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],s),r&&t({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(s)}}}addPromise(e){if(!e)return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(h)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(e,t,i){const r=this.createSyncUpdatingCallback(),a=Object(l.a)((()=>Object(s.c)(e,t)),r);return this.handles.add(a,i),a}createSyncUpdatingCallback(){return()=>{this.handles.remove(h),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Object(o.b)((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(h))})),h)}}};Object(r.a)([Object(a.b)({readOnly:!0})],p.prototype,"updating",void 0),p=Object(r.a)([Object(n.a)("esri.views.support.WatchUpdatingTracking")],p);const h=-42},250:function(e,t,i){"use strict";var r=i(14),s=i(4),a=i(0),n=(i(2),i(5),i(15)),o=i(18),l=(i(25),i(35),i(36),i(60)),c=(i(59),i(72)),d=i(113),u=i(144),p=i(105),h=i(138),b=i(168),y=i(95),f=i(137),m=i(150);function g(e,t){return t}function v(e,t,i,r){switch(i){case 0:return _(e,t+r,0);case 1:return"lowerLeft"===e.originPosition?_(e,t+r,1):function({translate:e,scale:t},i,r){return e[r]-i*t[r]}(e,t+r,1)}}function O(e,t,i,r){switch(i){case 2:return _(e,t,2);default:return v(e,t,i,r)}}function j(e,t,i,r){switch(i){case 2:return _(e,t,3);default:return v(e,t,i,r)}}function w(e,t,i,r){switch(i){case 3:return _(e,t,3);default:return O(e,t,i,r)}}function _({translate:e,scale:t},i,r){return e[r]+i*t[r]}class I{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=g,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=Object(m.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const i of e.features)t(i.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const i=e.fields.map((e=>e.name));this.AttributesConstructor=function(){for(const e of i)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,i)=>this.addCoordinatePoint(e,t,i),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,i)=>this.addCoordinatePolygon(e,t,i),this.createGeometry=e=>this.createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,i)=>this.addCoordinatePolyline(e,t,i),this.createGeometry=e=>this.createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,i)=>this.addCoordinateMultipoint(e,t,i),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:Object(y.a)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}addLength(e,t,i){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:i,queryGeometryType:r}=t,s=Object(f.w)(i.clone(),i,!1,!1,this.transform),a=Object(f.h)(s,r,!1,!1);e.queryGeometryType=r,e.queryGeometry={...a}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let i=0;return t<=1&&(i=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,i)}addCoordinatePolyline(e,t,i){this.dehydratedAddPointsCoordinate(e.paths,t,i)}addCoordinatePolygon(e,t,i){this.dehydratedAddPointsCoordinate(e.rings,t,i)}addCoordinateMultipoint(e,t,i){0===i&&e.points.push([]);const r=this.transformPathLikeValue(t,i);e.points[e.points.length-1].push(r)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,i){0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const r=this.transformPathLikeValue(t,i),s=e[e.length-1];0===i&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),s.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=r}deriveApplyTransform(e){const{hasZ:t,hasM:i}=e;return t&&i?w:t?O:i?j:v}}var S=i(203),M=i(233),x=i(58),T=i(195);function E(e,t){const i=e.toJSON();return i.objectIds&&(i.objectIds=i.objectIds.join(",")),i.orderByFields&&(i.orderByFields=i.orderByFields.join(",")),!i.outFields||null!=t&&t.returnCountOnly?delete i.outFields:-1!==i.outFields.indexOf("*")?i.outFields="*":i.outFields=i.outFields.join(","),i.outSpatialReference&&(i.outSR=i.outSR.wkid||JSON.stringify(i.outSR.toJSON()),delete i.outSpatialReference),i.dynamicDataSource&&(i.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i}async function F(e,t,i={},r){const s=Object(T.a)({...e.query,f:"json",...r,...E(t,r)});return Object(x.default)(e.path+"/queryRelatedRecords",{...i,query:{...i.query,...s}})}let C=class extends b.a{constructor(e){super(e),this.dynamicDataSource=null,this.format="json",this.gdbVersion=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then((e=>c.default.fromJSON(e)))}async executeJSON(e,t){var i;const r={...this.requestOptions,...t},a=this._normalizeQuery(e),n=null!=(null==(i=e.outStatistics)?void 0:i[0]),o=Object(s.a)("featurelayer-pbf-statistics"),l=!n||o;let c;if("pbf"===this.format&&l){const t=!a.quantizationParameters;try{c=(await Object(S.executeQueryPBF)(this.parsedUrl,a,new I({sourceSpatialReference:this.sourceSpatialReference,applyTransform:t}),r)).data}catch(e){if("query:parsing-pbf"!==e.name)throw e;this.format="json"}}return"json"!==this.format&&l||(c=(await Object(S.executeQuery)(this.parsedUrl,a,this.sourceSpatialReference,r)).data),this._normalizeFields(c.fields),c}executeForCount(e,t){return Object(S.executeQueryForCount)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then((e=>e.data.count))}executeForExtent(e,t){return Object(S.executeQueryForExtent)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then((e=>({count:e.data.count,extent:l.a.fromJSON(e.data.extent)})))}executeForIds(e,t){return Object(S.executeQueryForIds)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then((e=>e.data.objectIds))}executeRelationshipQuery(e,t){return e=h.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,i){const r=await F(e,t,i),s=r.data,a=s.geometryType,n=s.spatialReference,o={};for(const e of s.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:n,hasZ:!!s.hasZ,hasM:!!s.hasM,features:e.relatedRecords};if(null!=e.objectId)o[e.objectId]=t;else for(const i in e)e.hasOwnProperty(i)&&"relatedRecords"!==i&&(o[e[i]]=t)}return{...r,data:o}}(this.parsedUrl,e,{...this.requestOptions,...t}).then((e=>{const t=e.data,i={};return Object.keys(t).forEach((e=>i[e]=c.default.fromJSON(t[e]))),i}))}executeRelationshipQueryForCount(e,t){return e=h.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,i){const r=await F(e,t,i,{returnCountOnly:!0}),s=r.data,a={};for(const e of s.relatedRecordGroups)null!=e.objectId&&(a[e.objectId]=e.count);return{...r,data:a}}(this.parsedUrl,e,{...this.requestOptions,...t}).then((e=>e.data))}executeAttachmentQuery(e,t){return Object(M.a)(this.parsedUrl,u.a.from(e),{...this.requestOptions,...t}).then((e=>Object(M.b)(e.data.attachmentGroups,this.parsedUrl.path)))}_normalizeQuery(e){const t=p.a.from(e);if(!this.gdbVersion&&!this.dynamicDataSource)return t;const i=t===e?t.clone():t;return i.gdbVersion=e.gdbVersion||this.gdbVersion,i.dynamicDataSource=e.dynamicDataSource?d.a.from(e.dynamicDataSource):this.dynamicDataSource,i}_normalizeFields(e){if(Object(a.h)(this.fieldsIndex)&&Object(a.h)(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}};Object(r.a)([Object(n.b)({type:d.a})],C.prototype,"dynamicDataSource",void 0),Object(r.a)([Object(n.b)()],C.prototype,"fieldsIndex",void 0),Object(r.a)([Object(n.b)()],C.prototype,"format",void 0),Object(r.a)([Object(n.b)()],C.prototype,"gdbVersion",void 0),Object(r.a)([Object(n.b)()],C.prototype,"sourceSpatialReference",void 0),C=Object(r.a)([Object(o.a)("esri.tasks.QueryTask")],C);var L=C;t.a=L},256:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return w}));var r=i(77);const s="http://www.w3.org/",a=s+"2000/svg",n=s+"1999/xlink";let o,l=[],c=(e,t)=>{let i={};return Object.keys(e).forEach((t=>{i[t]=e[t]})),t&&Object.keys(t).forEach((e=>{i[e]=t[e]})),i},d=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),u=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},p=(e,t,i)=>{if(""!==t.vnodeSelector)for(let r=i;r<e.length;r++)if(d(e[r],t))return r;return-1},h=(e,t,i,r)=>{let s=e[t];if(""===s.vnodeSelector)return;let a=s.properties;if(!(a?void 0===a.key?a.bind:a.key:void 0))for(let a=0;a<e.length;a++)if(a!==t){let t=e[a];if(d(t,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},b=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},y=[],f=!1,m=e=>{(e.children||[]).forEach(m),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},g=()=>{f=!1,y.forEach(m),y.length=0},v=e=>{y.push(e),f||(f=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(g,{timeout:16}):setTimeout(g,16))},O=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i){t.style.pointerEvents="none";let r=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void i(t,r,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},j=(e,t,i)=>{if(!t)return;let s=i.eventHandlerInterceptor,o=Object.keys(t),l=o.length;for(let c=0;c<l;c++){let l=o[c],d=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)I(e,d,!0);else if("classes"===l){let t=Object.keys(d),i=t.length;for(let r=0;r<i;r++){let i=t[r];d[i]&&e.classList.add(i)}}else if("styles"===l){let t=Object.keys(d),r=t.length;for(let s=0;s<r;s++){let r=t[s],a=d[r];a&&(u(a),i.styleApplyer(e,r,a))}}else if("key"!==l&&null!=d){let o=typeof d;"function"===o?(0===l.lastIndexOf("on",0)&&(s&&(d=s(l,d,e,t)),"oninput"===l&&function(){let e=d;d=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=d):i.namespace===a?"href"===l?e.setAttributeNS(n,l,d):e.setAttribute(l,d):"string"===o&&"value"!==l?"innerHTML"===l?e[l]=r.f.sanitize(d):e.setAttribute(l,d):e[l]=d}}},w=(e,t,i)=>{((e,t,i)=>{if(t)for(let r of t)_(r,e,void 0,i)})(e,t.children,i),t.text&&(e.textContent=t.text),j(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},_=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,l=t.ownerDocument;if(""===o)s=e.domNode=l.createTextNode(e.text),void 0!==i?t.insertBefore(s,i):t.appendChild(s);else{for(let d=0;d<=o.length;++d){let u=o.charAt(d);if(d===o.length||"."===u||"#"===u){let u=o.charAt(n-1),p=o.slice(n,d);"."===u?s.classList.add(p):"#"===u?s.id=p:("svg"===p&&(r=c(r,{namespace:a})),void 0!==r.namespace?s=e.domNode=l.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||l.createElement(p),"input"===p&&e.properties&&void 0!==e.properties.type&&s.setAttribute("type",e.properties.type)),void 0!==i?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=d+1}}w(s,e,r)}},I=(e,t,i)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,i)}))},S=(e,t,i,s)=>{if(!i)return;let o=!1,l=Object.keys(i),c=l.length;for(let d=0;d<c;d++){let c=l[d],p=i[c],h=t[c];if("class"===c)h!==p&&(I(e,h,!1),I(e,p,!0));else if("classes"===c){let t=e.classList,i=Object.keys(p),r=i.length;for(let e=0;e<r;e++){let r=i[e],s=!!p[r];s!==!!h[r]&&(o=!0,s?t.add(r):t.remove(r))}}else if("styles"===c){let t=Object.keys(p),i=t.length;for(let r=0;r<i;r++){let i=t[r],a=p[i];a!==h[i]&&(o=!0,a?(u(a),s.styleApplyer(e,i,a)):s.styleApplyer(e,i,""))}}else if(p||"string"!=typeof h||(p=""),"value"===c){let t=e[c];t!==p&&(e["oninput-value"]?t===e["oninput-value"]:p!==h)&&(e[c]=p,e["oninput-value"]=void 0),p!==h&&(o=!0)}else if(p!==h){let t=typeof p;"function"===t&&s.eventHandlerInterceptor||(s.namespace===a?"href"===c?e.setAttributeNS(n,c,p):e.setAttribute(c,p):"string"===t?"innerHTML"===c?e[c]=r.f.sanitize(p):"role"===c&&""===p?e.removeAttribute(c):e.setAttribute(c,p):e[c]!==p&&(e[c]=p),o=!0)}}return o};o=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(e,r),t.domNode=e,s=!0,s}t.domNode=r}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(i=c(i,{namespace:a})),e.text!==t.text&&(n=!0,void 0===t.text?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=((e,t,i,r,s)=>{if(i===r)return!1;r=r||l;let a,n=(i=i||l).length,c=r.length,u=0,y=0,f=!1;for(;y<c;){let l=u<n?i[u]:void 0,c=r[y];if(void 0!==l&&d(l,c))f=o(l,c,s)||f,u++;else{let l=p(i,c,u+1);if(l>=0){for(a=u;a<l;a++)O(i[a]),h(i,a,e,"removed");f=o(i[l],c,s)||f,u=l+1}else _(c,t,u<n?i[u].domNode:void 0,s),b(c),h(r,y,e,"added")}y++}if(n>u)for(a=u;a<n;a++)O(i[a]),h(i,a,e,"removed");return f})(t,r,e.children,t.children,i)||n,n=S(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let M=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,o(r,i,t)},domNode:e.domNode})},257:function(e,t,i){"use strict";function r(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:s(e[t])}}}function s(e){return function(t,...i){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...i):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),t.target.click())}}i.d(t,"a",(function(){return r}))},259:function(e,t,i){"use strict";function r(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);i.push(...r)}}i.d(t,"a",(function(){return r}))},274:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i(6),s=i(9),a=i(0),n=i(32),o=i(16);const l=new Set(["bing-maps","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"]),c=new Set(["csv","feature","geo-rss","group","kml","tile","unknown","unsupported","vector-tile","web-tile"]);function d(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function u(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new o.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(function(e,t){if(t.restrictedWebMapWriting){const i=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return!Object(a.h)(i)||i.has(e.type)&&!d(e)}return!0}(e,i)){const t={};return e.write(t,i)?t:null}return Object(a.h)(t)&&function(e,t){if(function(e,t){if(d(e)){const i=Object(s.b)("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&("maxScale"in e&&(r.maxScale=Object(n.b)(e.maxScale)),"minScale"in e&&(r.minScale=Object(n.b)(e.minScale)))}else"group"!==e.type&&("maxScale"in e&&(t.maxScale=Object(n.b)(e.maxScale)),"minScale"in e&&(t.minScale=Object(n.b)(e.minScale)))}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=Object(n.b)(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if(d(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=Object(r.a)(t)),t}},276:function(e,t,i){"use strict";function r(e,t,i){return t.flatten((({sublayers:e})=>e)).length!==e.length||!!e.some((e=>e.originIdOf("minScale")>i||e.originIdOf("maxScale")>i||e.originIdOf("renderer")>i||e.originIdOf("labelingInfo")>i||e.originIdOf("opacity")>i||e.originIdOf("labelsVisible")>i||e.originIdOf("source")>i))||!a(e,t)}function s(e,t,i){return!!e.some((e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===i.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!a(e,t)}function a(e,t){if(!e||!e.length)return!0;const i=t.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:t}of e){for(;r<s&&i[r]!==t;)r++;if(r>=s)return!1}return!0}function n(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r}))},293:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=i(2),o=i(5),l=i(7),c=i(15),d=i(66),u=i(54),p=i(18),h=i(53),b=i(16),y=i(25),f=(i(35),i(26)),m=(i(36),i(60)),g=(i(59),i(61)),v=i(68),O=i(164),j=i(79),w=i(58),_=i(80),I=i(81),S=(i(127),i(143),i(152),i(179),i(189),i(190),i(187),i(188)),M=(i(193),i(90)),x=i(82),T=i(136),E=i(106),F=i(159),C=i(254),L=i(113),P=i(174),A=i(105),k=i(171);function R(e){return e&&"esriSMS"===e.type}function N(e,t,i){var r;return{ignoreOrigin:!0,enabled:!!i&&"map-image"===(null==(r=i.layer)?void 0:r.type)&&(i.writeSublayerStructure||this.originIdOf(t)>=Object(f.d)(i.origin))}}function D(e,t,i){var r;return{enabled:!!i&&"tile"===(null==(r=i.layer)?void 0:r.type)&&this._isOverridden(t)}}function V(e,t,i){return{ignoreOrigin:!0,enabled:i&&i.writeSublayerStructure||!1}}function U(e,t,i){return{ignoreOrigin:!0,enabled:!!i&&(i.writeSublayerStructure||this.originIdOf(t)>=Object(f.d)(i.origin))}}const B=n.a.getLogger("esri.layers.support.Sublayer");let G=0;const q=new Set;q.add("layer"),q.add("parent"),q.add("loaded"),q.add("loadStatus"),q.add("loadError"),q.add("loadWarnings");let z=r=class extends(Object(k.b)(Object(M.a)(Object(O.a)(_.a)))){constructor(e){super(e),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null}async load(e){return this.addResolvingPromise((async()=>{var t;if(!this.layer&&!this.url)throw new b.a("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let i=null;if(!this.layer||this.originIdOf("url")>2||"data-layer"===(null==(t=this.source)?void 0:t.type))i=(await Object(w.default)(this.url,{responseType:"json",query:{f:"json"},...e})).data;else{var r;let t=this.id;"map-layer"===(null==(r=this.source)?void 0:r.type)&&(t=this.source.mapLayerId),i=await this.layer.fetchSublayerInfo(t,e)}i&&(this.sourceJSON=i,this.read({layerDefinition:i},{origin:"service"}))})()),this}readCapabilities(e,t){const i=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map((e=>e.trim())):[];return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:-1!==i.indexOf("query")}}}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get fieldsIndex(){return new T.a(this.fields||[])}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeGlobalID"===e.type)return e.name}get id(){const e=this._get("id");return null==e?G++:e}set id(e){this._get("id")!==e&&(!1!==this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,t,i,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map((e=>e.write({},r)))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach((t=>t.layer=e))}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeOID"===e.type)return e.name}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,t){const i=t.layerDefinition;return 1-.01*(null!=i.transparency?i.transparency:i.drawingInfo.transparency)}writeOpacity(e,t,i,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=Object(o.e)(this.parent.id):t.parentLayerId=-1}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){if(e)for(const t of e.getSymbols())if(Object(I.h)(t)){B.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new C.a({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return Object(o.m)(g.a.ofType(r),e)}writeSublayers(e,t,i){this.get("sublayers.length")&&(t[i]=this.sublayers.map((e=>e.id)).toArray().reverse())}readTypeIdField(e,t){const i=(t=t.layerDefinition||t).typeIdField;if(i){const e=Object(v.i)(t.fields,i);if(e)return e.name}return null}get url(){var e,t;const i=null!=(e=null==(t=this.layer)?void 0:t.parsedUrl)?e:this._lastParsedUrl,r=this.source;if(!i)return null;if(this._lastParsedUrl=i,"map-layer"===(null==r?void 0:r.type))return`${i.path}/${r.mapLayerId}`;const s={layer:JSON.stringify({source:this.source})};return`${i.path}/dynamicLayer?${Object(y.C)(s)}`}set url(e){e?this._override("url",e):this._clearOverride("url")}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,t,i,r){t[i]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=Object(l.a)(this),t=new r;return Object(l.a)(t).store=e.clone(q),this.commitProperty("url"),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return Object(P.a)(this,e)}createQuery(){return new A.a({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var e,t;if(this.hasOwnProperty("sublayers"))return null;const r=null==(e=this.layer)?void 0:e.parsedUrl,s=new(0,(await Promise.all([i.e(16),i.e(152)]).then(i.bind(null,134))).default)({url:r.path});return r&&this.source&&("map-layer"===this.source.type?s.layerId=this.source.mapLayerId:s.dynamicDataSource=this.source),null!=this.layer.refreshInterval&&(s.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(s.definitionExpression=this.definitionExpression),this.originIdOf("labelingInfo")>2&&(s.labelingInfo=Object(a.a)(this.labelingInfo)),this.originIdOf("labelsVisible")>0&&(s.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>0&&(s.legendEnabled=this.legendEnabled),this.originIdOf("visible")>0&&(s.visible=this.visible),this.originIdOf("minScale")>0&&(s.minScale=this.minScale),this.originIdOf("maxScale")>0&&(s.maxScale=this.maxScale),this.originIdOf("opacity")>0&&(s.opacity=this.opacity),this.originIdOf("popupTemplate")>0&&(s.popupTemplate=Object(a.a)(this.popupTemplate)),this.originIdOf("renderer")>2&&(s.renderer=Object(a.a)(this.renderer)),"data-layer"===(null==(t=this.source)?void 0:t.type)&&(s.dynamicDataSource=this.source.clone()),this.originIdOf("title")>0&&(s.title=this.title),"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(s.customParameters=this.layer.customParameters),"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(s.customParameters=this.layer.customParameters),s}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let s=null;return i.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(s=e),!!s)})),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}queryFeatures(e=this.createQuery(),t){return this.load().then((()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new b.a("Sublayer.queryFeatures","this layer doesn't support queries.");return Promise.all([Promise.resolve().then(i.bind(null,203)),i.e(210).then(i.bind(null,72))])})).then((([{executeQuery:i},{default:r}])=>i(this.url,A.a.from(e),this.layer?this.layer.spatialReference:null,{...t,query:{...this.layer.customParameters}}).then((e=>r.fromJSON(e.data))))).then((e=>(e&&e.features&&e.features.forEach((e=>{e.sourceLayer=this})),e)))}toExportImageJSON(){var e;const t={id:this.id,source:(null==(e=this.source)?void 0:e.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(t.definitionExpression=this.definitionExpression);const i=["renderer","labelingInfo","opacity","labelsVisible"].reduce(((e,t)=>(e[t]=this.originIdOf(t),e)),{});if(Object.keys(i).some((e=>i[e]>2))){const e=t.drawingInfo={};i.renderer>2&&(e.renderer=this.renderer?this.renderer.toJSON():null),i.labelsVisible>2&&(e.showLabels=this.labelsVisible),this.labelsVisible&&i.labelingInfo>2&&(e.labelingInfo=this.labelingInfo?this.labelingInfo.map((e=>e.write({},{origin:"service"}))):null,e.showLabels=!0),i.opacity>2&&(e.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(e.renderer)}return t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,(e=>{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.outline&&e.outline.color?e.color=e.outline.color:e.color=[0,0,0,0])}))}_forEachSimpleMarkerSymbols(e,t){if(e){const i="uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[];for(const e of i)R(e.symbol)&&t(e.symbol);"symbol"in e&&R(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&R(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){const i=this.layer,r=this._get(e);let s,a;switch(e){case"definitionExpression":s="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":s="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":s="supportsDynamicLayers",a="supportsModification"}const n=Object(l.a)(this).getDefaultOrigin();if("service"!==n){if(s&&!1===this.get("layer.capabilities.exportMap."+s))return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${s}'`);if(a&&!1===this.get("capabilities.exportMap."+a))return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${a}'`)}"source"!==e||"not-loaded"===this.loadStatus?(this._set(e,t),"service"!==n&&r!==t&&i&&i.emit&&i.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null,e.layer=null})),this.handles.removeAll()),e&&(e.forEach((e=>{e.parent=this,e.layer=this.layer})),this.handles.add([e.on("after-add",(({item:e})=>{e.parent=this,e.layer=this.layer})),e.on("after-remove",(({item:e})=>{e.parent=null,e.layer=null})),e.on("before-changes",(e=>{const t=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==t||t||(B.error(new b.a("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),e.preventDefault())}))]))}_logLockedError(e,t){B.error(new b.a("sublayer:locked",`Property '${e}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:t,sublayer:this,layer:this.layer}))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};z.test={isMapImageLayerOverridePolicy:e=>e===V||e===N,isTileImageLayerOverridePolicy:e=>e===D},Object(s.a)([Object(c.b)({readOnly:!0})],z.prototype,"capabilities",void 0),Object(s.a)([Object(u.a)("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],z.prototype,"readCapabilities",null),Object(s.a)([Object(c.b)({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:N}}})],z.prototype,"definitionExpression",null),Object(s.a)([Object(c.b)({type:[x.a],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],z.prototype,"fields",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],z.prototype,"fieldsIndex",null),Object(s.a)([Object(c.b)({type:m.a,json:{read:{source:"layerDefinition.extent"}}})],z.prototype,"fullExtent",void 0),Object(s.a)([Object(c.b)({type:String})],z.prototype,"globalIdField",void 0),Object(s.a)([Object(u.a)("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],z.prototype,"readGlobalIdFieldFromService",null),Object(s.a)([Object(c.b)({type:o.a,json:{write:{ignoreOrigin:!0}}})],z.prototype,"id",null),Object(s.a)([Object(c.b)({value:null,type:[E.a],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:V}}})],z.prototype,"labelingInfo",null),Object(s.a)([Object(h.a)("labelingInfo")],z.prototype,"writeLabelingInfo",null),Object(s.a)([Object(c.b)({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:V}}})],z.prototype,"labelsVisible",null),Object(s.a)([Object(c.b)({value:null})],z.prototype,"layer",null),Object(s.a)([Object(c.b)({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:U}}})],z.prototype,"legendEnabled",void 0),Object(s.a)([Object(c.b)({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],z.prototype,"listMode",null),Object(s.a)([Object(c.b)({type:Number,value:0,json:{write:{overridePolicy:V}}})],z.prototype,"minScale",null),Object(s.a)([Object(u.a)("minScale",["minScale","layerDefinition.minScale"])],z.prototype,"readMinScale",null),Object(s.a)([Object(c.b)({type:Number,value:0,json:{write:{overridePolicy:V}}})],z.prototype,"maxScale",null),Object(s.a)([Object(u.a)("maxScale",["maxScale","layerDefinition.maxScale"])],z.prototype,"readMaxScale",null),Object(s.a)([Object(c.b)({type:String})],z.prototype,"objectIdField",void 0),Object(s.a)([Object(u.a)("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],z.prototype,"readObjectIdFieldFromService",null),Object(s.a)([Object(c.b)({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:V}}})],z.prototype,"opacity",null),Object(s.a)([Object(u.a)("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],z.prototype,"readOpacity",null),Object(s.a)([Object(h.a)("opacity")],z.prototype,"writeOpacity",null),Object(s.a)([Object(c.b)({json:{type:o.a,write:{target:"parentLayerId",allowNull:!0,overridePolicy:V}}})],z.prototype,"parent",void 0),Object(s.a)([Object(h.a)("parent")],z.prototype,"writeParent",null),Object(s.a)([Object(c.b)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:U,writer(e,t,i){t[i]=!e}}}})],z.prototype,"popupEnabled",void 0),Object(s.a)([Object(c.b)({type:j.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:U}}})],z.prototype,"popupTemplate",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],z.prototype,"defaultPopupTemplate",null),Object(s.a)([Object(c.b)({types:S.a,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:V},origins:{"web-scene":{types:S.b,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:V}}}}})],z.prototype,"renderer",null),Object(s.a)([Object(c.b)({types:{key:"type",base:null,typeMap:{"data-layer":L.a,"map-layer":C.a}},cast(e){if(e){if("mapLayerId"in e)return Object(o.d)(C.a,e);if("dataSource"in e)return Object(o.d)(L.a,e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:V}}})],z.prototype,"source",null),Object(s.a)([Object(c.b)()],z.prototype,"sourceJSON",void 0),Object(s.a)([Object(c.b)({value:null,json:{type:[o.a],write:{target:"subLayerIds",allowNull:!0,overridePolicy:V}}})],z.prototype,"sublayers",null),Object(s.a)([Object(d.a)("sublayers")],z.prototype,"castSublayers",null),Object(s.a)([Object(h.a)("sublayers")],z.prototype,"writeSublayers",null),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:U}}})],z.prototype,"title",void 0),Object(s.a)([Object(c.b)({type:String})],z.prototype,"typeIdField",void 0),Object(s.a)([Object(u.a)("typeIdField",["layerDefinition.typeIdField"])],z.prototype,"readTypeIdField",null),Object(s.a)([Object(c.b)({type:[F.a],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],z.prototype,"types",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:D}}})],z.prototype,"url",null),Object(s.a)([Object(c.b)({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:V}}})],z.prototype,"visible",null),Object(s.a)([Object(h.a)("visible")],z.prototype,"writeVisible",null),z=r=Object(s.a)([Object(p.a)("esri.layers.support.Sublayer")],z);var H=z;t.a=H},302:function(e,t,i){"use strict";function r(e){return"string"==typeof e?document.getElementById(e):e}function s(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function a(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a})),(()=>{if("function"==typeof Element.prototype.closest)return(e,t)=>e.closest(t);Element.prototype.matches||Element.prototype.msMatchesSelector})()},305:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return d}));var r=i(39);const s="__begin__",a="__end__",n=new RegExp(s,"ig"),o=new RegExp(a,"ig"),l=new RegExp("^"+s,"i"),c=new RegExp(a+"$","i");function d(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function u(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function p(e){const t=u(e);if(!t)return null;switch(t.type){case"conventional":return b(t.expression);case"arcade":return t.expression}return null}function h(e){const t=u(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e.match(y);return t&&t[1].trim()||null}(t.expression);case"arcade":return v(t.expression)}return null}function b(e){let t;return e?(t=Object(r.c)(e,(e=>s+'$feature["'+e+'"]'+a)),t=l.test(t)?t.replace(l,""):'"'+t,t=c.test(t)?t.replace(c,""):t+'"',t=t.replace(n,'" + ').replace(o,' + "')):t='""',t}const y=/^\s*\{([^}]+)\}\s*$/i,f=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,m=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,g=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function v(e){if(!e)return null;let t=f.exec(e)||m.exec(e);return t?t[1]||t[3]:(t=g.exec(e),t?t[2]:null)}},306:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i(85),s=i(78);async function a(e){if(!e)return;const t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,i=await Object(r.a)("esri/t9n/basemaps");return i[e]||i[t]}const n={streets:{id:"streets",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Object(s.a)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}}},312:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(14),s=(i(4),i(2)),a=(i(5),i(15)),n=i(18),o=(i(25),i(35),i(36),i(3)),l=i(61),c=i(178),d=i(87);function u(e){return e&&"group"===e.type}function p(e,t,i){let r,s;if(e)for(let a=0,n=e.length;a<n;a++){if(r=e.getItemAt(a),r[t]===i)return r;if(u(r)&&(s=p(r.layers,t,i),s))return s}}const h=s.a.getLogger("esri.support.LayersMixin"),b=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new l.a;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||h.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},i=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item))),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>i(e.item)))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",Object(c.b)(e,this._get("layers")))}add(e,t){const i=this.layers;t=i.getNextIndex(t),e instanceof d.a?e.parent===this?this.reorder(e,t):i.add(e,t):Object(o.n)(e)?e.then((e=>{this.destroyed||this.add(e,t)})):h.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const i=this.layers;t=i.getNextIndex(t),e.slice().forEach((e=>{e.parent!==this?(i.add(e,t),t+=1):this.reorder(e,t)}))}findLayerById(e){return p(this.layers,"id",e)}findLayerByUid(e){return p(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return Object(r.a)([Object(a.b)()],t.prototype,"layers",null),t=Object(r.a)([Object(n.a)("esri.support.LayersMixin")],t),t}},313:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(14),s=(i(4),i(2)),a=(i(5),i(15)),n=i(18),o=(i(25),i(35),i(36),i(61)),l=i(178);const c="esri.support.TablesMixin",d=s.a.getLogger(c);function u(e){return e&&"group"===e.type}function p(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const s=e.getItemAt(r);if(s[t]===i)return s;if(u(s)){const e=p(s.tables,t,i);if(e)return e}}}const h=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new o.a,this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&d.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",Object(l.b)(e,this._get("tables")))}findTableById(e){return p(this.tables,"id",e)}findTableByUid(e){return p(this.tables,"uid",e)}};return Object(r.a)([Object(a.b)()],t.prototype,"tables",null),t=Object(r.a)([Object(n.a)(c)],t),t}},320:function(e,t,i){"use strict";function r(e){return e&&"function"==typeof e.render}function s(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r})),i(77),i(257),i(192),i(4),i(2),i(43),i(259),i(142)},321:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(256);const s={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{"-"===t.charAt(0)?e.style.setProperty(t,i):e.style[t]=i}};let a,n=e=>Object(r.c)(s,e),o=(e,t,i)=>(i=n(i),Object(r.a)(t,e,void 0,i),Object(r.b)(t,i)),l=(e,t,i)=>(i=n(i),Object(r.a)(t,e.parentNode,e,i),Object(r.b)(t,i)),c=(e,t,i)=>(i=n(i),t.domNode=e,Object(r.d)(e,t,i),Object(r.b)(t,i)),d=(e,t,i)=>(i=n(i),Object(r.a)(t,e.parentNode,e,i),e.parentNode.removeChild(e),Object(r.b)(t,i)),u=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};a=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let p=(e,t)=>{let i=e;return t.forEach((e=>{i=i&&i.children?a(i.children,(t=>t.domNode===e)):void 0})),i},h=(e,t,i)=>{let r=function(r){i("domEvent",r);let s=t(),a=u(r.currentTarget,s.domNode);a.reverse();let n,o=p(s.getLastRender(),a);return e.scheduleRender(),o&&(n=o.properties["on"+r.type].apply(o.properties.bind||this,arguments)),i("domEventProcessed",r),n};return(e,t,i,s)=>r},b=e=>{let t,i,r=n(e),s=r.performanceLogger,a=!0,u=!1,p=[],b=[],y=(e,i,a)=>{let n;r.eventHandlerInterceptor=h(t,(()=>n),s),n=e(i,a(),r),p.push(n),b.push(a)},f=()=>{if(i=void 0,a){a=!1,s("renderStart",void 0);for(let e=0;e<p.length;e++){let t=b[e]();s("rendered",void 0),p[e].update(t),s("patched",void 0)}s("renderDone",void 0),a=!0}};return t={renderNow:f,scheduleRender:()=>{i||u||(i=requestAnimationFrame(f))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),u=!0},resume:()=>{u=!1,a=!0,t.scheduleRender()},append:(e,t)=>{y(o,e,t)},insertBefore:(e,t)=>{y(l,e,t)},merge:(e,t)=>{y(c,e,t)},replace:(e,t)=>{y(d,e,t)},detach:e=>{for(let t=0;t<b.length;t++)if(b[t]===e)return b.splice(t,1),p.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},329:function(e,t,i){"use strict";i.r(t);var r,s=i(14),a=(i(4),i(6)),n=i(0),o=i(2),l=(i(5),i(15)),c=i(18),d=i(53),u=i(25),p=(i(35),i(36),i(3)),h=i(52),b=i(57),y=i(61),f=i(178),m=i(80),g=i(88),v=i(205),O=i(119),j=i(306),w=i(274);let _=0;const I=o.a.getLogger("esri.Basemap");let S=r=class extends(Object(h.b)(m.a)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+_++,this.baseLayers=new y.a,this.referenceLayers=new y.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&I.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=e=>{e.parent=null};this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>i(e.item))),this.referenceLayers.on("after-remove",(e=>i(e.item)))}initialize(){this.when().catch((e=>{I.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const e of t)e.destroy();const i=this.referenceLayers.removeAll();for(const e of i)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Object(f.b)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e?(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=Object(w.a)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);Object(n.h)(t)&&r.push(t)})),this.referenceLayers.forEach((e=>{const t=Object(w.a)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);Object(n.h)(t)&&(t.isReference=!0,r.push(t))})),t.baseMapLayers=r):t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Object(f.b)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Object(v.a)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new r({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=Object(a.a)(e);return t.url&&Object(u.v)(t.url)&&(t.url="https:"+t.url),t.templateUrl&&Object(u.v)(t.templateUrl)&&(t.templateUrl="https:"+t.templateUrl),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;Object(p.t)(e);const r=[];if(t){const i=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,i,e)),t.data.id&&!t.data.title){const e=t.data.id;r.push(Object(j.b)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,r){const s=this.resourceInfo&&this.resourceInfo.context,a=this.portalItem&&this.portalItem.portal||s&&s.portal||null,n=s&&"web-scene"===s.origin?"web-scene":"web-map",{populateOperationalLayers:o}=await i.e(77).then(i.bind(null,442)),l=[];if(Object(p.t)(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const i={context:{origin:n,url:t,portal:a,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},r=o(this.baseLayers,e.baseMapLayers.filter((e=>!e.isReference)),i);l.push(r);const s=o(this.referenceLayers,e.baseMapLayers.filter((e=>e.isReference)),i);l.push(s)}await Object(p.j)(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=Object(u.I)(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||g.a.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||g.a.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=j.a[e];return t?r.fromJSON(t):null}};Object(s.a)([Object(l.b)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:y.a}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],S.prototype,"baseLayers",null),Object(s.a)([Object(l.b)({type:String,json:{origins:{"web-scene":{write:!0}}}})],S.prototype,"id",void 0),Object(s.a)([Object(l.b)({type:O.default})],S.prototype,"portalItem",void 0),Object(s.a)([Object(l.b)()],S.prototype,"referenceLayers",null),Object(s.a)([Object(l.b)({readOnly:!0})],S.prototype,"resourceInfo",void 0),Object(s.a)([Object(l.b)({type:b.a})],S.prototype,"spatialReference",void 0),Object(s.a)([Object(l.b)()],S.prototype,"thumbnailUrl",void 0),Object(s.a)([Object(l.b)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],S.prototype,"title",void 0),Object(s.a)([Object(d.a)("title")],S.prototype,"writeTitle",null),S=r=Object(s.a)([Object(c.a)("esri.Basemap")],S);var M=S;t.default=M},341:function(e,t,i){"use strict";i.r(t);var r,s=i(14),a=i(4),n=i(0),o=i(2),l=i(5),c=i(15),d=i(54),u=i(18),p=i(53),h=i(16),b=(i(25),i(35),i(26)),y=(i(36),i(3)),f=i(60),m=i(58),g=i(205),v=i(87),O=i(84),j=i(90),w=i(70),_=i(103),I=i(365),S=i(151),M=i(125),x=i(169),T=i(97),E=i(158),F=i(108),C=i(147),L=i(171),P=i(366),A=i(293),k=i(276),R=i(367),N=i(23),D=i(157),V=i(40),U=i(93),B=i(57),G=i(111),q=i(61),z=i(156),H=i(80),W=i(204),$=i(66),J=i(329),Q=i(95),K=i(6),Z=i(52),Y=i(62),X=i(191),ee=i(178),te=i(56);let ie=r=class extends Z.a{constructor(e){super(e),this.type="none"}clone(){return new r({type:this.type})}};var re;Object(s.a)([Object(te.a)({none:"none",stayAbove:"stay-above"})],ie.prototype,"type",void 0),ie=r=Object(s.a)([Object(u.a)("esri.ground.NavigationConstraint")],ie);const se=o.a.getLogger("esri.Ground");let ae=re=class extends(Object(Z.b)(H.a)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new q.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&se.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))}initialize(){this.when().catch((e=>{se.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Object(ee.b)(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e?(r={...r,layerContainerType:"ground"},e.forEach((e=>{if("write"in e){const t={};Object(Q.b)(e)().write(t,r)&&s.push(t)}else r&&r.messages&&r.messages.push(new h.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=s):t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Object(g.a)(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:r}=await i.e(25).then(i.bind(null,542));Object(y.t)(t);const s=new r,a=this.layers.filter(ne).toArray();return s.queryAll(a,e,t)}async createElevationSampler(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:r}=await i.e(25).then(i.bind(null,542));Object(y.t)(t);const s=new r,a=this.layers.filter(ne).toArray();return s.createSamplerAll(a,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:Object(K.a)(this.surfaceColor),navigationConstraint:Object(K.a)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new re({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,r){const s=t&&t.origin||"web-scene",a=t&&t.portal||null,n=t&&t.url||null;return i.e(80).then(i.bind(null,442)).then((({populateOperationalLayers:t})=>{Object(y.t)(r);const i=[];if(e.layers&&Array.isArray(e.layers)){const r={context:{origin:s,url:n,portal:a,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};i.push(t(this.layers,e.layers,r))}return Object(y.j)(i)})).then((()=>{}))}};function ne(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}Object(s.a)([Object(c.b)({json:{read:!1}})],ae.prototype,"layers",null),Object(s.a)([Object(p.a)("layers")],ae.prototype,"writeLayers",null),Object(s.a)([Object(c.b)({readOnly:!0})],ae.prototype,"resourceInfo",void 0),Object(s.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:l.a,read:{reader:X.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Object(X.a)(e)},target:"transparency"}}})],ae.prototype,"opacity",void 0),Object(s.a)([Object(c.b)({type:Y.a,json:{type:[l.a],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],ae.prototype,"surfaceColor",void 0),Object(s.a)([Object(c.b)({type:ie,json:{write:!0}})],ae.prototype,"navigationConstraint",void 0),ae=re=Object(s.a)([Object(u.a)("esri.Ground")],ae);var oe=ae,le=i(306);const ce=o.a.getLogger("esri.support.basemapUtils");const de=o.a.getLogger("esri.support.groundUtils"),ue={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var pe=i(312),he=i(313);const be=o.a.getLogger("esri.Map");let ye=class extends(Object(he.a)(Object(pe.a)(G.a.EventedMixin(N.a)))){constructor(e){super(e),this.allLayers=new W.a({root:this,rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:e=>e.layers}),this.allTables=this._createTablesFlattener(this),this.basemap=null,this.ground=new oe,this._basemapCache={}}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),function(e){for(const t in e){const i=e[t];!1===(null==i?void 0:i.destroyed)&&i.destroy(),delete e[t]}}(this._basemapCache),this._basemapCache=null}castBasemap(e){return function(e,t){var i;let r;if("string"==typeof e){if(!(e in le.a)){const t=Object.keys(le.a).map((e=>`"${e}"`)).join(", ");return ce.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=J.default.fromId(e),t&&(t[e]=r))}else r=Object(l.m)(J.default,e);return null!=(i=r)&&i.destroyed&&(ce.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}(e,this._basemapCache)}castGround(e){return function(e){let t;return"string"==typeof e?e in ue?t=new oe({resourceInfo:{data:{layers:[ue[e]]}}}):de.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=Object(l.m)(oe,e),t}(e)||(be.error("Map.ground may not be set to null or undefined"),this._get("ground"))}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}_createTablesFlattener(e){return new W.a({root:e,rootCollectionNames:["tables","layers"],getChildrenFunction:e=>e&&"group"===e.type?this._createTablesFlattener(e):null,itemFilterFunction:e=>this._isMapOrGroupLayer(e.parent)&&e.parent.tables.includes(e)})}_isMapOrGroupLayer(e){return e&&(e===this||this._isGroupLayer(e))}_isGroupLayer(e){return e&&"group"===e.type}};Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:[]})],ye.prototype,"allLayers",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],ye.prototype,"allTables",void 0),Object(s.a)([Object(c.b)({type:J.default})],ye.prototype,"basemap",void 0),Object(s.a)([Object($.a)("basemap")],ye.prototype,"castBasemap",null),Object(s.a)([Object(c.b)({type:oe,nonNullable:!0})],ye.prototype,"ground",void 0),Object(s.a)([Object($.a)("ground")],ye.prototype,"castGround",null),ye=Object(s.a)([Object(u.a)("esri.Map")],ye);var fe=ye,me=i(37),ge=i(133),ve=i(368);let Oe=class extends N.a{constructor(e){super(e),this.view=null,this.baseLayerViews=new q.a,this.referenceLayerViews=new q.a,this._loadingHandle=Object(me.a)(this,"view.map.basemap",(e=>{e&&e.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};Object(s.a)([Object(c.b)({constructOnly:!0})],Oe.prototype,"view",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Oe.prototype,"baseLayerViews",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Oe.prototype,"referenceLayerViews",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Oe.prototype,"suspended",null),Object(s.a)([Object(c.b)({type:Boolean,readOnly:!0})],Oe.prototype,"updating",null),Oe=Object(s.a)([Object(u.a)("esri.views.BasemapView")],Oe);var je=i(240);function we(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}const _e=o.a.getLogger("esri.views.LayerViewManager");class Ie{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=Object(y.d)(),this._deferred=Object(y.f)(),this._started=!1,this.done=!1,Object(y.o)(this._controller.signal,(()=>{const t=new h.a("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{var r,s;let a,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)a=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new h.a("layer:view-not-supported","No layerview implementation was found");const r=await this.layerViewImporter.importLayerView(t);Object(y.t)(e),a="default"in r?new r.default({layer:t,view:i}):new r({layer:t,view:i})}const l=()=>{o=Object(n.m)(o),a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};o=Object(y.o)(e,l),Object(y.t)(e);try{await a.when()}catch(e){throw l(),e}if(!(null==(r=this._map)||null==(s=r.allLayers)?void 0:s.includes(t)))return l(),void this._deferred.reject(new h.a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=a,t.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:t,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new h.a("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let Se=class extends L.a{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new je.a,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const t=null==(e=this.view.map)?void 0:e.allLayers;if(t)for(const e of t)this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e)},this._reschedule=()=>(Object(n.g)(this._workPromise)&&(this._workPromise=Object(y.f)()),this.handles.remove("reschedule"),this.handles.add(Object(V.b)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var e,t,i;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),Object(n.g)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const s=new W.a({root:this,rootCollectionNames:this._rootCollectionNames,getChildrenFunction:e=>e.layers});if(!s)return this._workPromise.resolve(),void(this._workPromise=null);for(const e of s)this._createLayerView(e);this._refreshCollections();for(const[e,t]of this._layerLayerViewInfoMap)s.includes(e)||(this._layerLayerViewInfoMap.delete(t.layer),t.destroy());const a=s.filter((e=>"group"===e.type)).map((e=>e.layers)),o=[null==r||null==(e=r.ground)?void 0:e.layers,null==r||null==(t=r.basemap)?void 0:t.baseLayers,null==r||null==(i=r.basemap)?void 0:i.referenceLayers,null==r?void 0:r.layers,...a].filter((e=>!!e));this.handles.add(o.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([Object(me.b)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),Object(me.a)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return!(!Object(n.h)(this._workPromise)&&!this._watchUpdatingTracking.updating)||we(this._layerLayerViewInfoMap,(e=>!e.done))}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){return await this._reschedule(),this._layerLayerViewInfoMap.has(e)?this._layerLayerViewInfoMap.get(e).promise:Promise.reject(new h.a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e}))}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const a=e.layerView;a.layer=s,a.parent=i,t.getItemAt(r)!==a&&t.splice(r,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),void this.notifyChange("updating");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Ie(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{var i,r;t&&(Object(y.l)(t)||"cancelled:layerview-create"===t.name)||_e.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:"no title"}', id:'${null!=(r=e.id)?r:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating")}};Object(s.a)([Object(c.b)()],Se.prototype,"_workPromise",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Se.prototype,"_watchUpdatingTracking",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Se.prototype,"_layersToLayerViews",null),Object(s.a)([Object(c.b)({readOnly:!0})],Se.prototype,"_rootCollectionNames",null),Object(s.a)([Object(c.b)()],Se.prototype,"layerViewImporter",void 0),Object(s.a)([Object(c.b)()],Se.prototype,"supportsGround",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Se.prototype,"updating",null),Object(s.a)([Object(c.b)({constructOnly:!0})],Se.prototype,"view",void 0),Se=Object(s.a)([Object(u.a)("esri.views.LayerViewManager")],Se);var Me=Se;let xe=class extends N.a{constructor(e){super(e),this.factor=1.5,this.offsetX=0,this.offsetY=0,this.position=null,this.size=120,this.mask=null,this.maskEnabled=!0,this.overlay=null,this.overlayEnabled=!0,this.visible=!1}get version(){return this.commitProperty("factor"),this.commitProperty("offsetX"),this.commitProperty("offsetY"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("mask"),this.commitProperty("maskEnabled"),this.commitProperty("overlay"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};Object(s.a)([Object(c.b)({type:Number})],xe.prototype,"factor",void 0),Object(s.a)([Object(c.b)({type:Number})],xe.prototype,"offsetX",void 0),Object(s.a)([Object(c.b)({type:Number})],xe.prototype,"offsetY",void 0),Object(s.a)([Object(c.b)()],xe.prototype,"position",void 0),Object(s.a)([Object(c.b)({type:Number,range:{min:0}})],xe.prototype,"size",void 0),Object(s.a)([Object(c.b)()],xe.prototype,"mask",void 0),Object(s.a)([Object(c.b)()],xe.prototype,"maskEnabled",void 0),Object(s.a)([Object(c.b)()],xe.prototype,"overlay",void 0),Object(s.a)([Object(c.b)()],xe.prototype,"overlayEnabled",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],xe.prototype,"version",null),Object(s.a)([Object(c.b)({type:Boolean})],xe.prototype,"visible",void 0),xe=Object(s.a)([Object(u.a)("esri.views.Magnifier")],xe);var Te=xe,Ee=i(83);function Fe(e){return"refresh"in e}let Ce=class extends N.a{constructor(){super(...arguments),this._handles=new Ee.a,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",(()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(()=>this._restartTicking())),this.watch("view.ready",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>Fe(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((t=>{if(Fe(t)){const i=Math.round(6e4*t.refreshInterval),r=this._currentTick%i==0,s=e-t.refreshTimestamp<5400;i&&r&&!s&&t.refresh(e)}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach((i=>{Fe(i)&&i.layer&&e.push(i.watch("refreshInterval",t),i.layer.on("refresh",(()=>{i.refresh(Date.now())})))})),e}_getCommonInterval(e){const t=(e,i)=>isNaN(e)||isNaN(i)?0:i<=0?e:t(i,e%i);return e.toArray().reduce(((e,i)=>t(Math.round(6e4*i.refreshInterval),e)),0)}};Object(s.a)([Object(c.b)()],Ce.prototype,"view",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ce.prototype,"tickInterval",null),Ce=Object(s.a)([Object(u.a)("esri.views.RefreshManager")],Ce);var Le=Ce,Pe=i(99),Ae=i(64);class ke{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const Re=o.a.getLogger("esri.views.input.InputHandler");class Ne{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Re.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let r;"function"==typeof t?(i=t,r=[]):r=t||[];const s="string"==typeof e?new ke(e,r):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},n=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),a(),this._manager&&this._manager.updateDependencies()}},o=new De(s,i,{onPause:n,onRemove:n,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),a(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[s.eventType];return l||(l=[],this._incoming[s.eventType]=l),l.push(o),a(),this._manager&&this._manager.updateDependencies(),o}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new Ve(e,{onEmit:(e,t,i,r)=>{this._manager.emit(e.eventType,t,i,r)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Re.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class De{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Ve{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}var Ue=i(346),Be=i(17);const Ge=Object(a.a)("mac")?"Meta":"Ctrl",qe={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)qe[e]=String.fromCharCode(e);for(let e=1;e<25;e++)qe[111+e]="F"+e;for(let e=65;e<91;e++)qe[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function ze(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class He extends Ne{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const We=o.a.getLogger("esri.views.input.InputManager");let $e=class extends N.a{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Ge,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=Qe.INTERNAL){if(this._nameToGroup[e])return void We.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void We.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=r;for(let e=r.handlers.length-1;e>=0;e--){const t=r.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,r,s,a)=>{this._emitInputEvent(t.priorityIndex+1,e,i,r,a,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(r,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):We.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s)for(const t of r.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of r.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)ze(e)||t.add(e)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(r(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(r(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const a=t.native;s("Alt",!(!a||!a.altKey)),s("Ctrl",!(!a||!a.ctrlKey)),s("Shift",!(!a||!a.shiftKey)),s("Meta",!(!a||!a.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new He((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Qe.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],Qe.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,a=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,a),r?(a.add(s),1===a.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):a.has(s)&&(a.delete(s),0===a.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,a){const n=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),o=void 0!==s&&s,l={event:new Je(t,i,n,a||this._activeKeyModifiers,o),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new Ue.a,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}}_pausePropagation(e){const t=new Ue.a;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};Object(s.a)([Object(c.b)({readOnly:!0})],$e.prototype,"hasPendingInputs",null),Object(s.a)([Object(c.b)()],$e.prototype,"eventSource",void 0),Object(s.a)([Object(c.b)()],$e.prototype,"recognizers",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],$e.prototype,"latestPointerType",void 0),$e=Object(s.a)([Object(u.a)("esri.views.input.InputManager")],$e);class Je{constructor(e,t,i,r,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=r,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const Qe={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},Ke=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Ze={};function Ye(e){return!!Ze[e]}Ke.forEach((e=>{Ze[e]=!0}));class Xe{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,r){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!Ye(t))return!1;return!0}(s))return s.some(Ye)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,n;Array.isArray(t)?n=t:(a=t,n=[]),"function"==typeof i?a=i:r=i,r=null!=r?r:Qe.DEFAULT;const o=this.createUniqueGroupName(),l=new et(this.view,s,n,a);this.handlers.set(o,{handler:l,priority:r});for(const e of s){const t=this.handlerCounts.get(e)||0;this.handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(o,[l],r),{remove:()=>this.removeHandler(o,s)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,"viewEvents_"+this.counter}}class et extends Ne{constructor(e,t,i,r){super(!0),this.view=e;for(const e of t)switch(e){case"click":this.registerIncoming("click",i,(e=>r(this.wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",i,(e=>r(this.wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(e=>r(this.wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(e=>r(this.wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",i,(e=>r(this.wrapHold(e))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this.wrapDrag(e);t&&r(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>r(this.wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>r(this.wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>r(this.wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>r(this.wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>r(this.wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>r(this.wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>r(this.wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>r(this.wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>r(this.wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{r(this.wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{r(this.wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{r(this.wrapBlur(e))}))}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:a,native:n,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"click",pointerType:t,button:i,buttons:r,x:s,y:a,native:n,timestamp:c,screenPoint:Object(Ae.b)(s,a),mapPoint:this.getMapPoint(s,a),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:a,native:n,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"double-click",pointerType:t,button:i,buttons:r,x:s,y:a,native:n,timestamp:c,mapPoint:this.getMapPoint(s,a),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:a,native:n,eventId:o}=e.data,l=n.pointerId,{cancelable:c,timestamp:d}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:a,native:n,timestamp:d,mapPoint:this.getMapPoint(s,a),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:a,native:n,eventId:o}=e.data,l=n.pointerId,{cancelable:c,timestamp:d}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:a,native:n,timestamp:d,mapPoint:this.getMapPoint(s,a),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:i,buttons:r,x:s,y:a,native:n}=e.data,{cancelable:o,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:r,x:s,y:a,native:n,timestamp:l,mapPoint:this.getMapPoint(s,a),cancelable:o,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap(Object(Ae.b)(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:i,y:r}=t.center,{action:s,pointerType:a,button:n}=t;if("start"===s&&(this.latestDragStart=t),!this.latestDragStart)return;const o=t.pointer.native,l=t.buttons,{cancelable:c,timestamp:d}=e,u={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===s&&(this.latestDragStart=void 0),{type:"drag",action:s,x:i,y:r,origin:u,pointerType:a,button:n,buttons:l,radius:t.radius,angle:Object(Pe.k)(t.angle),native:o,timestamp:d,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:i,native:r}=e.data,{cancelable:s,timestamp:a}=e;return{type:"key-down",key:t,repeat:i,native:r,timestamp:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:r,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:i,y:r,button:s,buttons:a,native:n,eventId:o}=e.data,l=n.pointerId,c=n.pointerType,{cancelable:d,timestamp:u}=e;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:a,native:n,timestamp:u,eventId:o,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:i,buttons:r,native:s,eventId:a}=e.data.currentEvent,{button:n}=e.data.startEvent,o=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:p}=e;return{type:"pointer-drag",x:t,y:i,pointerId:o,pointerType:l,button:n,buttons:r,action:c,origin:d,native:s,timestamp:p,eventId:a,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:r}=e,{x:s,y:a,deltaY:n,native:o}=i;return{type:"mouse-wheel",x:s,y:a,deltaY:n,native:o,timestamp:r,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:i,device:r}=e.data,{cancelable:s,timestamp:a}=e,{buttons:n,axes:o}=i;return{type:"gamepad",device:r,timestamp:a,action:t,buttons:n,axes:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}i(302),i(256);var tt=i(321);let it=class extends N.a{constructor(){super(...arguments),this.items=new q.a,this._watchUpdatingTracking=new je.a,this._callbacks=new Map,this._projector=Object(tt.a)(),this._hiddenProjector=Object(tt.a)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const a={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const e=r.domNode.getBoundingClientRect();a.left=e.left,a.top=e.top,a.right=e.right,a.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return a}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font="10px "+getComputedStyle(this.surface).fontFamily,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};Object(s.a)([Object(c.b)({readOnly:!0})],it.prototype,"surface",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],it.prototype,"items",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],it.prototype,"needsRender",null),Object(s.a)([Object(c.b)({readOnly:!0})],it.prototype,"_watchUpdatingTracking",void 0),Object(s.a)([Object(c.b)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],it.prototype,"updating",void 0),it=Object(s.a)([Object(u.a)("esri.views.overlay.ViewOverlay")],it);var rt=i(43),st=i(167);function at(e,t,i,r){let s=null,a=1e3;"number"==typeof t?(a=t,r=i):(s=null!=t?t:null,a=i);let n,o=0;const l=()=>{o=0,e.apply(r,n)},c=(...e)=>{s&&s.apply(r,e),n=e,a?o||(o=setTimeout(l,a)):l()};return c.remove=()=>{o&&(clearTimeout(o),o=0)},c.forceUpdate=()=>{o&&(clearTimeout(o),l())},c.hasPendingUpdates=()=>!!o,c}i(118);var nt=i(77),ot=i(257),lt=i(192),ct=i(259),dt=i(142),ut=i(185),pt=i(320);const ht=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>Object(pt.b)(e)&&!e.destroyed?Object(dt.a)("div",{key:e},e.render()):e instanceof HTMLElement?Object(dt.a)("div",{key:e,bind:e,afterCreate:this._attachToNode}):Object(pt.a)(e)?Object(dt.a)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=Object(s.a)([Object(u.a)("esri.widgets.Feature.ContentMixin")],t),t};var bt=i(39),yt=i(107);i(69);const ft=["B","kB","MB","GB","TB"];var mt=i(65),gt=i(144),vt=i(228),Ot=i(68),jt=i(116),wt=i(297);const _t=o.a.getLogger("esri.widgets.Feature.support.featureUtils"),It=/href=(""|'')/gi,St=/(\{([^\{\r\n]+)\})/g,Mt=/\'/g,xt=/^\s*expression\//i,Tt=/(\n)/gi,Et=/[\u00A0-\u9999<>\&]/gim,Ft=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Ct=/^(?:mailto:|tel:)/,Lt=Object(jt.a)("short-date-short-time");function Pt(e){if(!Object(n.g)(e))return e.get("sourceLayer")||e.get("layer")}async function At(e,t){return"function"==typeof e?e.call(null,t):e}function kt(e=""){if(e)return!Ct.test(e.trim().toLowerCase())}function Rt(e,t){const i=function(e,t){if(!function(e){return xt.test(e)}(t)||!e)return null;const i=t.replace(xt,"").toLowerCase();let r;return e.some((e=>e.name.toLowerCase()===i&&(r=e,!0))),r}(t,null==e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Nt(e,t){const i=Dt(t,e);return i?i.name:e}function Dt(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function Vt(e){return(""+e).trim()}function Ut({formattedAttributes:e,template:t,fieldInfoMap:i}){return Vt(function(e){return e.replace(It,"")}(Object(bt.c)(Object(bt.c)(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i))),e)))}function Bt(e,t){return e.replace(St,((e,i,r)=>{const s=Dt(t,r);return s?`{${s.name}}`:i}))}function Gt(e,t,i){const r=Bt(e,i);return r?r.replace(Ft,((e,i,r)=>function(e,t,i){const r=(t=Vt(t))&&"{"!==t[0];return Object(bt.c)(e,function(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const s="%27",a=(i?encodeURIComponent(r):r).replace(Mt,s);t[e]=a}}(e,i,t))),i}(i,r))}(e,i||r,t))):r}function qt(e,t){const i=t.fieldInfos,r=t.fieldName,s=zt(i,r),a=null==s?void 0:s.clone(),n=t.preventPlacesFormatting,o=Dt(t.layer,r);if(a&&o&&"date"===o.type){const e=a.format||new wt.a;e.dateFormat=e.dateFormat||"short-date-short-time",a.format=e}const l=a&&a.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?e:n?Object(yt.b)(e,{...Object(yt.a)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function zt(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(r=e,0)))),r}function Ht(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const i=e&&e.fieldInfos;i&&t.push(...i)}})),t):t}function Wt(e){return e.replace(Et,(e=>`&#${e.charCodeAt(0)};`))}function $t(e){return"string"==typeof e?e.replace(Tt,'<br class="esri-text-new-line" />'):e}function Jt({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:a}){const n={...t};return null==a||a.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((i=>Zt({attributes:e,graphic:i,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((i=>Zt({attributes:e,graphic:i,relatedInfo:t}))))}(n,e))),Object.keys(n).forEach((t=>{const a=n[t];n[t]=function(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:a,graphic:n}=e;if(null==t)return"";const o=function({fieldName:e,value:t,graphic:i,layer:r}){if(Kt(e))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;const s=r.getFieldDomain(e,{feature:i});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:n,layer:a});if(o)return o;const l=function({fieldName:e,graphic:t,layer:i}){if(Kt(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}({fieldName:i,graphic:n,layer:a});if(l)return l;if(s.get(i.toLowerCase()))return qt(t,{fieldInfos:r,fieldName:i,layer:a});const c=a&&a.fieldsIndex;return c&&c.isDateField(i)?Object(jt.b)(t,Lt):$t(t)}({fieldName:t,fieldInfos:e,fieldInfoMap:s,layer:i,value:a,graphic:r})})),n}async function Qt({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t)return;const{returnGeometry:a}=t;"function"==typeof i.load&&await i.load(s);const n=e.attributes[i.objectIdField];if(null==n)return;const o=[n],l=await t.getRequiredFields(i.fields),c=Object(Ot.d)(l,e),d=c?[]:l;if(c&&!a)return;const u=await async function(e,t){const{layer:i,graphic:r,outFields:s,objectIds:a,returnGeometry:n,spatialReference:o}=e,l=a[0];if("number"!=typeof l){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:l,requiredFields:s},a=new h.a("layer-query-features-invalid-objectid",e,t);throw _t.warn(e,t),a}if("function"!=typeof i.queryFeatures){const e="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:s},a=new h.a("layer-query-features-unsupported",e,t);throw _t.warn(e,t),a}const c=i.createQuery();return c.objectIds=a,c.outFields=s,c.returnGeometry=!!n,c.outSpatialReference=o,(await i.queryFeatures(c,t)).features[0]}({layer:i,graphic:e,outFields:d,objectIds:o,returnGeometry:a,spatialReference:r},s);u&&(u.geometry&&(e.geometry=u.geometry),u.attributes&&(e.attributes={...e.attributes,...u.attributes}))}function Kt(e=""){return!!e&&-1!==e.indexOf("relationships/")}function Zt({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach((r=>{const s=function(e){return e?`relationships/${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:r});e[s]=t.attributes[r]}))}const Yt={editing:!1,operations:{add:!0,update:!0,delete:!0}},Xt=q.a.ofType(vt.a);let ei=class extends L.a{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Yt},this.activeAttachmentInfo=null,this.attachmentInfos=new Xt,this.graphic=null,this.mode="view",this.handles.add([Object(me.a)(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Yt,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new h.a("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new gt.a({objectIds:[i],returnMetadata:!0}),s=[],a=e.queryAttachments(r).then((e=>e[i]||s)).catch((()=>s));this._getAttachmentsPromise=a,this.notifyChange("state");const n=await a;return t.removeAll(),n.length&&t.addMany(n),this._getAttachmentsPromise=null,this.notifyChange("state"),n}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new h.a("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new h.a("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new h.a("invalid-layer","addAttachment(): A valid layer is required.");const a=t.addAttachment(r,e).then((e=>this._queryAttachment(e.objectId))),n=await a;return i.add(n),n}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new h.a("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new h.a("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new h.a("invalid-layer","deleteAttachment(): A valid layer is required.");const a=t.deleteAttachments(r,[e.id]).then((()=>e)),n=await a;return i.remove(n),n}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:a}=this;if(!e)throw new h.a("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new h.a("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!a.operations.update)throw new h.a("invalid-abilities","updateAttachment(): Update abilities are required.");const n=r.findIndex((e=>e===t));if(!i||"function"!=typeof i.updateAttachment)throw new h.a("invalid-layer","updateAttachment(): A valid layer is required.");const o=i.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),l=await o;return r.splice(n,1,l),l}async _queryAttachment(e){if(!e)throw new h.a("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new gt.a({objectIds:[i],attachmentsWhere:"AttachmentId="+e,returnMetadata:!0});return t.queryAttachments(r).then((e=>e[i][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=Pt(e);this._attachmentLayer=t?"scene"===t.type&&Object(n.h)(t.associatedLayer)?t.associatedLayer:t:null}};Object(s.a)([Object(c.b)()],ei.prototype,"abilities",void 0),Object(s.a)([Object($.a)("abilities")],ei.prototype,"castAbilities",null),Object(s.a)([Object(c.b)()],ei.prototype,"activeAttachmentInfo",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:Xt})],ei.prototype,"attachmentInfos",void 0),Object(s.a)([Object(c.b)({type:mt.a})],ei.prototype,"graphic",void 0),Object(s.a)([Object(c.b)()],ei.prototype,"mode",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],ei.prototype,"state",null),Object(s.a)([Object(c.b)({readOnly:!0})],ei.prototype,"supportsResizeAttachments",null),ei=Object(s.a)([Object(u.a)("esri.widgets.Attachments.AttachmentsViewModel")],ei);var ti=ei,ii=i(78);const ri={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},si="esri-attachments__item-button",ai="esri-attachments__form-node",ni="esri-attachments__file-fieldset",oi="esri-attachments__file-label",li="esri-attachments__file-name",ci="esri-attachments__file-input",di="esri-attachments__metadata-fieldset",ui="esri-button",pi="esri-button--disabled",hi="esri-button--secondary",bi="esri-button--tertiary",yi="esri-button--third",fi="esri-button--small",mi="esri-button--half",gi=window.CSS;let vi=class extends ut.a{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new ti,this.visibleElements={...ri},this._supportsImageOrientation=gi&&gi.supports&&gi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(Object(me.b)(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),Object(me.a)(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return{...ri,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new h.a("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new h.a("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new h.a("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Object(dt.a)("div",{class:this.classes("esri-attachments","esri-widget")},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Object(dt.a)("div",{key:"error-message",class:"esri-attachments__error-message"},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Object(dt.a)("div",{class:"esri-attachments__loader-container",key:"loader"},Object(dt.a)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?Object(dt.a)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?Object(dt.a)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(ui,bi,fi,mi,e&&pi)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Object(dt.a)("button",{type:"submit",disabled:i,class:this.classes(ui,hi,fi,mi,{[pi]:i})},this.messages.add):null,a=t?Object(dt.a)("span",{key:"file-name",class:li},t.name):null,n=Object(dt.a)("form",{bind:this,afterCreate:nt.g,afterRemoved:nt.c,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Object(dt.a)("fieldset",{class:ni},a,Object(dt.a)("label",{class:this.classes(oi,ui,hi)},t?this.messages.changeFile:this.messages.selectFile,Object(dt.a)("input",{class:ci,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return Object(dt.a)("div",{key:"add-form-container",class:ai},n)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:a,size:n,url:o}=e,{abilities:l}=i,c=s||!r,d=l.editing&&l.operations.delete&&t.deleteButton?Object(dt.a)("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(ui,fi,bi,"esri-attachments__delete-button",{[pi]:s})},this.messages.delete):null,u=l.editing&&l.operations.update&&t.updateButton?Object(dt.a)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(ui,fi,yi,{[pi]:c})},this.messages.update):null,p=this.visibleElements.cancelUpdateButton?Object(dt.a)("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(ui,fi,bi,yi,{[pi]:s})},this.messages.cancel):null,h=r?Object(dt.a)("span",{key:"file-name",class:li},r.name):null,b=l.editing&&l.operations.update?Object(dt.a)("fieldset",{key:"file",class:ni},h,Object(dt.a)("label",{class:this.classes(oi,ui,hi)},this.messages.changeFile,Object(dt.a)("input",{class:ci,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,y=Object(dt.a)("fieldset",{key:"size",class:di},Object(dt.a)("label",null,function(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(1024));i=Object(Pe.c)(i,0,ft.length-1);const r=Object(yt.b)(t/1024**i,{maximumFractionDigits:2});return Object(bt.c)(e.units.bytes[ft[i]],{fileSize:r})}(this.messagesUnits,n))),f=Object(dt.a)("fieldset",{key:"content-type",class:di},Object(dt.a)("label",null,a)),m=Object(dt.a)("form",{bind:this,afterCreate:nt.g,afterRemoved:nt.c,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Object(dt.a)("div",{class:"esri-attachments__metadata"},y,f),b,Object(dt.a)("div",{class:"esri-attachments__actions"},d,p,u));return Object(dt.a)("div",{key:"edit-form-container",class:ai},Object(dt.a)("a",{class:"esri-attachments__item-link",href:o,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Object(dt.a)("div",{class:"esri-attachments__item-link-overlay"},Object(dt.a)("span",{class:"esri-attachments__item-link-overlay-icon"},Object(dt.a)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Object(dt.a)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Object(dt.a)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),m)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:a}=e,n=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(r),o=this._getCSSTransform(e,n),l=o?{transform:o,"image-orientation":"none"}:{},c=-1===a.indexOf("?")?"?":"&",d=n?`${a}${c}w=${t}`:function(e){const t=Object(ii.a)("esri/themes/base/images/files/");return e?"text/plain"===e?t+"text-32.svg":"application/pdf"===e?t+"pdf-32.svg":"text/csv"===e?t+"csv-32.svg":"application/gpx+xml"===e?t+"gpx-32.svg":"application/x-dwf"===e?t+"cad-32.svg":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?t+"code-32.svg":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?t+"zip-32.svg":-1!==e.indexOf("image/")?t+"image-32.svg":-1!==e.indexOf("audio/")?t+"sound-32.svg":-1!==e.indexOf("video/")?t+"video-32.svg":-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?t+"excel-32.svg":-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?t+"word-32.svg":-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?t+"report-32.svg":t+"generic-32.svg":t+"generic-32.svg"}(r),u={"esri-attachments__item-mask--icon":!n},p={"esri-attachments__image--resizable":i};return Object(dt.a)("div",{class:this.classes(u,"esri-attachments__item-mask")},Object(dt.a)("img",{styles:l,alt:s,src:d,class:this.classes(p,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:a}=e,n=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),o=r.editing?Object(dt.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",Object(nt.e)()?"esri-icon-left":"esri-icon-right")}):null,l=[n,Object(dt.a)("label",{class:"esri-attachments__label"},Object(dt.a)("span",{class:"esri-attachments__filename"},s||this.messages.noTitle),o)],c=r.editing?Object(dt.a)("button",{key:"details-button",bind:this,class:si,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Object(dt.a)("a",{key:"details-link",class:si,href:a,target:"_blank"},l);return Object(dt.a)("li",{class:"esri-attachments__item",key:e},c)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,a=r&&r.length,n={"esri-attachments__container--list":"preview"!==e,"esri-attachments__container--preview":"preview"===e},o=s.editing&&s.operations.add&&i.addButton?Object(dt.a)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(ui,bi,"esri-attachments__add-attachment-button"),type:"button"},Object(dt.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=a?Object(dt.a)("ul",{class:"esri-attachments__items"},r.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):Object(dt.a)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return Object(dt.a)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",n)},l,o)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};Object(s.a)([Object(D.a)("viewModel.abilities")],vi.prototype,"abilities",void 0),Object(s.a)([Object(c.b)()],vi.prototype,"displayType",void 0),Object(s.a)([Object(D.a)("viewModel.graphic")],vi.prototype,"graphic",void 0),Object(s.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],vi.prototype,"label",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/Attachments/t9n/Attachments")],vi.prototype,"messages",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/core/t9n/Units")],vi.prototype,"messagesUnits",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],vi.prototype,"selectedFile",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],vi.prototype,"submitting",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],vi.prototype,"error",void 0),Object(s.a)([Object(c.b)({type:ti})],vi.prototype,"viewModel",void 0),Object(s.a)([Object(c.b)()],vi.prototype,"visibleElements",void 0),Object(s.a)([Object($.a)("visibleElements")],vi.prototype,"castVisibleElements",null),vi=Object(s.a)([Object(u.a)("esri.widgets.Attachments")],vi);var Oi=vi;let ji=class extends ti{constructor(e){super(e),this.description=null,this.title=null}};Object(s.a)([Object(c.b)()],ji.prototype,"description",void 0),Object(s.a)([Object(c.b)()],ji.prototype,"title",void 0),ji=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ji);var wi=ji;let _i=class extends ut.a{constructor(e,t){super(e,t),this.description=null,this.title=null}render(){return Object(dt.a)("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Object(dt.a)("h2",{key:"title",class:"esri-feature-element-info__title"},e):null}renderDescription(){const{description:e}=this;return e?Object(dt.a)("div",{key:"description",class:"esri-feature-element-info__description"},e):null}};Object(s.a)([Object(c.b)()],_i.prototype,"description",void 0),Object(s.a)([Object(c.b)()],_i.prototype,"title",void 0),_i=Object(s.a)([Object(u.a)("esri.widgets.Feature.support.FeatureElementInfo")],_i);var Ii=_i;let Si=class extends ut.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Oi,this.description=null,this.displayType=null,this.graphic=null,this.title=null,this.viewModel=new wi}initialize(){this._featureElementInfo=new Ii,Object(me.a)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())),Object(me.a)(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return Object(dt.a)("div",{class:"esri-feature-attachments"},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}};Object(s.a)([Object(c.b)({readOnly:!0})],Si.prototype,"attachmentsWidget",void 0),Object(s.a)([Object(D.a)("viewModel.description")],Si.prototype,"description",void 0),Object(s.a)([Object(D.a)("attachmentsWidget.displayType")],Si.prototype,"displayType",void 0),Object(s.a)([Object(D.a)("viewModel.graphic")],Si.prototype,"graphic",void 0),Object(s.a)([Object(D.a)("viewModel.title")],Si.prototype,"title",void 0),Object(s.a)([Object(c.b)({type:wi})],Si.prototype,"viewModel",void 0),Si=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureAttachments")],Si);var Mi=Si;let xi=class extends(Object(L.b)(N.a)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Object(me.a)(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(At(i,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=At(e,{graphic:t}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};Object(s.a)([Object(c.b)({readOnly:!0})],xi.prototype,"created",void 0),Object(s.a)([Object(c.b)()],xi.prototype,"creator",void 0),Object(s.a)([Object(c.b)()],xi.prototype,"destroyer",void 0),Object(s.a)([Object(c.b)({type:mt.a})],xi.prototype,"graphic",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],xi.prototype,"state",null),xi=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],xi);var Ti=xi;let Ei=class extends ut.a{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{kt(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return Object(dt.a)("div",{class:"esri-feature-content__loader-container",key:"loader"},Object(dt.a)("div",{class:"esri-feature-content__loader"}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Object(dt.a)("div",{key:t,bind:t,afterCreate:this._attachToNode}):Object(pt.b)(t)?Object(dt.a)("div",{key:t},!t.destroyed&&t.render()):Object(dt.a)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return Object(dt.a)("div",{class:"esri-feature-content"},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};Object(s.a)([Object(D.a)("viewModel.creator")],Ei.prototype,"creator",void 0),Object(s.a)([Object(D.a)("viewModel.graphic")],Ei.prototype,"graphic",void 0),Object(s.a)([Object(c.b)({type:Ti})],Ei.prototype,"viewModel",void 0),Ei=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureContent")],Ei);var Fi=Ei,Ci=i(246),Li=i(416);let Pi=class extends N.a{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=Rt(r,e),i.push(r)})),i}};Object(s.a)([Object(c.b)()],Pi.prototype,"attributes",void 0),Object(s.a)([Object(c.b)({type:[Li.a]})],Pi.prototype,"expressionInfos",void 0),Object(s.a)([Object(c.b)()],Pi.prototype,"description",void 0),Object(s.a)([Object(c.b)({type:[Ci.a]})],Pi.prototype,"fieldInfos",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Pi.prototype,"formattedFieldInfos",null),Object(s.a)([Object(c.b)()],Pi.prototype,"title",void 0),Pi=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Pi);var Ai=Pi;const ki=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let Ri=class extends ut.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new Ai,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Ii,Object(me.a)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,a=i?null==i[r]?"":i[r]:"",n=!(!e.format||!e.format.dateFormat),o="number"!=typeof a||n?function(e,t){if("string"!=typeof t||!t)return t;const i=function(e){let t=null;return ki.some((i=>(i.pattern.test(e)&&(t=i),!!t))),t}(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],a=Object(bt.c)(Object(bt.c)(i.label,{messages:e,hierPart:s}),{appName:i.appName}),n=i.target?` target="${i.target}"`:"",o="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${n} href="$1"${o}>${a}</a>`)}(this.messagesURIUtils,a):this._forceLTR(a),l={"esri-feature-fields__field-data--date":n};return Object(dt.a)("tr",{key:`fields-element-info-row-${r}-${t}`},Object(dt.a)("th",{key:`fields-element-info-row-header-${r}-${t}`,class:"esri-feature-fields__field-header",innerHTML:s}),Object(dt.a)("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes("esri-feature-fields__field-data",l),innerHTML:o}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?Object(dt.a)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},Object(dt.a)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return Object(dt.a)("div",{class:"esri-feature-fields"},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return"&lrm;"+e}};Object(s.a)([Object(D.a)("viewModel.attributes")],Ri.prototype,"attributes",void 0),Object(s.a)([Object(D.a)("viewModel.description")],Ri.prototype,"description",void 0),Object(s.a)([Object(D.a)("viewModel.expressionInfos")],Ri.prototype,"expressionInfos",void 0),Object(s.a)([Object(D.a)("viewModel.fieldInfos")],Ri.prototype,"fieldInfos",void 0),Object(s.a)([Object(D.a)("viewModel.title")],Ri.prototype,"title",void 0),Object(s.a)([Object(c.b)({type:Ai})],Ri.prototype,"viewModel",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/Feature/t9n/Feature")],Ri.prototype,"messages",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/support/t9n/uriUtils")],Ri.prototype,"messagesURIUtils",void 0),Ri=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureFields")],Ri);var Ni=Ri,Di=i(461),Vi=i(245),Ui=i(105),Bi=i(138),Gi=i(250);const qi=o.a.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),zi=new Map;function Hi(e){if(!Kt(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}let Wi=class extends N.a{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,fieldInfoMap:r,layer:s}=this,a={...i,...e};return null==t?void 0:t.map((t=>{if(!t)return null;const n=t.title?Gt(t.title,a,s):"";t.title=n?Ut({formattedAttributes:i,template:n,fieldInfoMap:r}):"";const o=t.caption?Gt(t.caption,a,s):"";t.caption=o?Ut({formattedAttributes:i,template:o,fieldInfoMap:r}):"";const l=t.altText?Gt(t.altText,a,s):"";if(t.altText=l?Ut({formattedAttributes:i,template:l,fieldInfoMap:r}):"","image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:i,layer:s}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:r}=t;return this._setChartValue({value:r,chartType:t.type,attributes:e,formattedAttributes:i,layer:s}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:a,sourceURL:n}=i;if(n){const e=Bt(n,s);i.sourceURL=Ut({formattedAttributes:r,template:e,fieldInfoMap:t})}if(a){const e=Bt(a,s);i.linkURL=Ut({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:a}=e,{popupTemplate:n,relatedInfos:o}=this,{fields:l,normalizeField:c}=t;if(t.fields=function(e,t){return e&&e.map((e=>Nt(e,t)))}(l,a),c&&(t.normalizeField=Nt(c,a)),!l.some((e=>!!(null!=r[e]||Kt(e)&&o.size))))return;const d=null==n?void 0:n.fieldInfos;l.forEach((e=>{if(Kt(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:d,fieldName:e,formattedAttributes:r,chartType:s,value:t})]);const a=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:e,fieldInfos:d});t.series.push(a)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:a,value:n}=e,o=[],l=Hi(r),{layerId:c,fieldName:d}=l,u=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!u)return o;const{relatedFeatures:p,relation:h}=u;if(!h||!p)return o;const{cardinality:b}=h;return p.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===d&&o.push(this._getChartOption({value:n,attributes:t,formattedAttributes:s,fieldName:r,chartType:a,relatedFieldName:e,fieldInfos:i}))}))})),"one-to-many"===b||"many-to-many"===b?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:r,formattedAttributes:s,fieldName:a,relatedFieldName:n,fieldInfos:o,chartType:l}=e,{layer:c}=this,{normalizeField:d,tooltipField:u}=i,p=d?Kt(d)?r[Hi(d).fieldName]:r[d]:null,h=n&&void 0!==r[n]?r[n]:void 0!==r[a]?r[a]:s[a],b=void 0===h?null:h&&p?h/p:h,y=new Di.a({value:b});if(Kt(a)){const e=Hi(a),t=Hi(u),i=t?t.fieldName:null,s=qt(b,{fieldInfos:o,fieldName:n,layer:c,preventPlacesFormatting:!!p}),d=e?e.label||e.fieldName:n,h=i&&void 0!==r[i]?r[i]:d;return y.tooltip=this._getTooltip({label:h,value:s,chartType:l}),y}const f=zt(o,a),m=Nt(a,c),g=u&&void 0!==s[u]?s[u]:Rt(f||new Ci.a({fieldName:m}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),v=s[m];return y.tooltip=this._getTooltip({label:g,value:v,chartType:l}),y}};Object(s.a)([Object(c.b)()],Wi.prototype,"activeMediaInfoIndex",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Wi.prototype,"activeMediaInfo",null),Object(s.a)([Object(c.b)()],Wi.prototype,"attributes",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"description",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"fieldInfoMap",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"formattedAttributes",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Wi.prototype,"formattedMediaInfos",null),Object(s.a)([Object(c.b)()],Wi.prototype,"layer",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Wi.prototype,"formattedMediaInfoCount",null),Object(s.a)([Object(c.b)()],Wi.prototype,"mediaInfos",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"popupTemplate",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"relatedInfos",void 0),Object(s.a)([Object(c.b)()],Wi.prototype,"title",void 0),Wi=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Wi);var $i=Wi,Ji=i(67),Qi=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Ki=[{name:"default",colors:[].concat(Qi.slice(30,39),Qi.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Zi=new Map([["ar",()=>i.e(162).then(i.bind(null,623)).then((function(e){return e.a}))],["bs-ba",()=>i.e(163).then(i.bind(null,624)).then((function(e){return e.b}))],["ca-es",()=>i.e(164).then(i.bind(null,625)).then((function(e){return e.c}))],["cs-cz",()=>i.e(165).then(i.bind(null,626)).then((function(e){return e.c}))],["da-dk",()=>i.e(166).then(i.bind(null,627)).then((function(e){return e.d}))],["de-de",()=>i.e(168).then(i.bind(null,628)).then((function(e){return e.d}))],["de-ch",()=>i.e(167).then(i.bind(null,629)).then((function(e){return e.d}))],["el-gr",()=>i.e(169).then(i.bind(null,630)).then((function(e){return e.e}))],["en-us",()=>i.e(171).then(i.bind(null,631)).then((function(e){return e.e}))],["en-ca",()=>i.e(170).then(i.bind(null,632)).then((function(e){return e.e}))],["es-es",()=>i.e(172).then(i.bind(null,633)).then((function(e){return e.e}))],["et-ee",()=>i.e(173).then(i.bind(null,634)).then((function(e){return e.e}))],["fi-fi",()=>i.e(174).then(i.bind(null,635)).then((function(e){return e.f}))],["fr-fr",()=>i.e(175).then(i.bind(null,636)).then((function(e){return e.f}))],["he-il",()=>i.e(176).then(i.bind(null,637)).then((function(e){return e.h}))],["hr-hr",()=>i.e(177).then(i.bind(null,638)).then((function(e){return e.h}))],["hu-hu",()=>i.e(178).then(i.bind(null,639)).then((function(e){return e.h}))],["id-id",()=>i.e(179).then(i.bind(null,640)).then((function(e){return e.i}))],["it-it",()=>i.e(181).then(i.bind(null,641)).then((function(e){return e.i}))],["ja-jp",()=>i.e(182).then(i.bind(null,642)).then((function(e){return e.j}))],["ko-kr",()=>i.e(183).then(i.bind(null,643)).then((function(e){return e.k}))],["lt-lt",()=>i.e(184).then(i.bind(null,644)).then((function(e){return e.l}))],["lv-lv",()=>i.e(185).then(i.bind(null,645)).then((function(e){return e.l}))],["nb-no",()=>i.e(186).then(i.bind(null,646)).then((function(e){return e.n}))],["nl-nl",()=>i.e(187).then(i.bind(null,647)).then((function(e){return e.n}))],["pl-pl",()=>i.e(188).then(i.bind(null,648)).then((function(e){return e.p}))],["pt-br",()=>i.e(189).then(i.bind(null,649)).then((function(e){return e.p}))],["pt-pt",()=>i.e(190).then(i.bind(null,650)).then((function(e){return e.p}))],["ro-ro",()=>i.e(191).then(i.bind(null,651)).then((function(e){return e.r}))],["ru-ru",()=>i.e(192).then(i.bind(null,652)).then((function(e){return e.r}))],["sl-sl",()=>i.e(193).then(i.bind(null,653)).then((function(e){return e.s}))],["sr-rs",()=>i.e(194).then(i.bind(null,654)).then((function(e){return e.s}))],["sv-se",()=>i.e(195).then(i.bind(null,655)).then((function(e){return e.s}))],["th-th",()=>i.e(196).then(i.bind(null,656)).then((function(e){return e.t}))],["tr-tr",()=>i.e(197).then(i.bind(null,657)).then((function(e){return e.t}))],["uk-ua",()=>i.e(198).then(i.bind(null,658)).then((function(e){return e.u}))],["vi-vn",()=>i.e(199).then(i.bind(null,659)).then((function(e){return e.v}))],["zh-cn",()=>i.e(200).then(i.bind(null,660)).then((function(e){return e.z}))],["zh-hk",()=>i.e(23).then(i.bind(null,661)).then((function(e){return e.z}))],["zh-tw",()=>i.e(23).then(i.bind(null,661)).then((function(e){return e.z}))]]);let Yi,Xi;const er="esri-feature-media__button",tr="esri-feature-media__icon",ir="esri-icon-left-triangle-arrow",rr="esri-icon-right-triangle-arrow";let sr=class extends ut.a{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new $i,this.messages=null}initialize(){this._featureElementInfo=new Ii,this.own(Object(me.a)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),Object(me.a)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Object(dt.a)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Object(dt.a)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:a,altText:n,title:o,type:l}=e,{sourceURL:c,linkURL:d}=s,u=kt(d)?"_blank":"_self",p="_blank"===u?"noreferrer":"",h=a?t:null,b=h?h.timestamp:0,y=h?h.sourceURL:c,f=Object(dt.a)("img",{alt:n||o,key:`media-${l}-${i}-${r}-${b}`,src:y});return(d?Object(dt.a)("a",{title:o,href:d,rel:p,target:u},f):null)||f}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return Object(dt.a)("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel,t=e.title?Object(dt.a)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:e.title}):null,i=e.caption?Object(dt.a)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:e.caption}):null;return Object(dt.a)("div",{key:"media-container",class:"esri-feature-media__item-container"},t,i,Object(dt.a)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()))}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,r=t?this.classes(er,"esri-feature-media__previous"):this.classes(er,"esri-feature-media__next"),s=t?this.classes(tr,"esri-feature-media__previous-icon",ir):this.classes(tr,"esri-feature-media__next-icon",rr),a=t?this.classes(tr,"esri-feature-media__previous-icon--rtl",rr):this.classes(tr,"esri-feature-media__next-icon--rtl",ir),n=t?"media-previous":"media-next",o=t?this._previous:this._next;return Object(dt.a)("button",{type:"button",key:n,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:o},Object(dt.a)("span",{"aria-hidden":"true",class:s}),Object(dt.a)("span",{"aria-hidden":"true",class:a}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=Object(Ji.b)()){if(e=function(e){return e?Zi.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const e of Zi.keys())if(e.startsWith(t)){i=e;break}return i}(e)||"en-us":"en-us"}(e),Yi&&e===Xi)return Yi;Yi=i.e(180).then(i.bind(null,662)).then((function(e){return e.i})),Xi=e;try{const[t,i]=await Promise.all([Yi,Zi.get(Xi)()]);Xi===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Yi=null,Xi=null,null}return Yi}(),{activeMediaInfo:r}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:r,chartsModule:t})}_handleMediaKeyup(e){const t=Object(Be.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:i,mediaInfo:r}=e,{value:s,type:a}=r,{am4core:n}=t,o=function(e,t="default"){const i=Ki.find((e=>e.name===t));return i?i.colors.map((t=>e.color(t))):null}(n);Object(nt.d)()&&n.useTheme(t.am4themes_dark),n.useTheme(t.am4themes_animated),n.useTheme((function(e){e instanceof n.ColorSet&&o&&(e.list=o)}));const l="pie-chart"===a?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",r.altText||r.title),l.data=s.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==a||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,a=r.create(t,s.PieChart);a.rtl=Object(nt.e)();const n=a.series.push(new s.PieSeries);return n.labels.template.disabled=!0,n.ticks.template.disabled=!0,n.dataFields.value="value",n.dataFields.category="tooltip",this._customizeChartTooltip(n.tooltip,r),a}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:a,am4charts:n}=i,o=e.xAxes.push(new n.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dy=-o.tooltip.contentHeight}));const l=e.yAxes.push(new n.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new n.ColumnSeries);d.dataFields.valueY="value",d.dataFields.categoryX="tooltip",e.cursor=new n.XYCursor,s.series.length>15&&(e.scrollbarX=new a.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:a,am4charts:n}=i,o=e.yAxes.push(new n.CategoryAxis);o.dataFields.category="tooltip",o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dx=o.tooltip.contentWidth}));const l=e.xAxes.push(new n.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new n.ColumnSeries);d.dataFields.valueX="value",d.dataFields.categoryY="tooltip",e.cursor=new n.XYCursor,s.series.length>15&&(e.scrollbarY=new a.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:a,am4charts:n}=i,o=e.xAxes.push(new n.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dy=-o.tooltip.contentHeight}));const l=e.yAxes.push(new n.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new n.LineSeries);d.dataFields.categoryX="tooltip",d.dataFields.valueY="value",e.cursor=new n.XYCursor,s.series.length>15&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:a,am4charts:n}=i,o=a.create(t,n.XYChart);return o.rtl=Object(nt.e)(),"column-chart"===s&&this._createColumnChart(o,e),"bar-chart"===s&&this._createBarChart(o,e),"line-chart"===s&&this._createLineChart(o,e),o}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),r);this._refreshTimer=s}_getImageSource(e,t){const i=-1!==e.indexOf("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};Object(s.a)([Object(D.a)("viewModel.attributes")],sr.prototype,"attributes",void 0),Object(s.a)([Object(D.a)("viewModel.activeMediaInfoIndex")],sr.prototype,"activeMediaInfoIndex",void 0),Object(s.a)([Object(D.a)("viewModel.description")],sr.prototype,"description",void 0),Object(s.a)([Object(D.a)("viewModel.fieldInfoMap")],sr.prototype,"fieldInfoMap",void 0),Object(s.a)([Object(D.a)("viewModel.layer")],sr.prototype,"layer",void 0),Object(s.a)([Object(D.a)("viewModel.mediaInfos")],sr.prototype,"mediaInfos",void 0),Object(s.a)([Object(D.a)("viewModel.popupTemplate")],sr.prototype,"popupTemplate",void 0),Object(s.a)([Object(D.a)("viewModel.relatedInfos")],sr.prototype,"relatedInfos",void 0),Object(s.a)([Object(D.a)("viewModel.title")],sr.prototype,"title",void 0),Object(s.a)([Object(c.b)({type:$i})],sr.prototype,"viewModel",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/Feature/t9n/Feature")],sr.prototype,"messages",void 0),sr=Object(s.a)([Object(u.a)("esri.widgets.Feature.FeatureMedia")],sr);var ar=sr,nr=i(247),or=i(134);const lr=["$datastore","$map","$layer","$aggregatedfeatures"],cr=o.a.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function dr({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||"2d"!==(null==t?void 0:t.type))return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const a=s.createQuery();a.aggregateIds=[e.getObjectId()];const{features:n}=await s.queryFeatures(a);return n}async function ur({expressionAttributes:e,info:t,arcadeUtils:i,spatialReference:r,map:s,graphic:a,view:n}){const o="expression/"+t.name,l=i.createSyntaxTree(t.expression),c=lr.filter((e=>i.hasVariable(l,e)));await i.loadScriptDependencies(l,!0,c);const d=i.getViewInfo({spatialReference:r}),u=i.createExecContext(a,d);u.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:a,graphic:n}){i.forEach((i=>{const o=i.toLowerCase(),l={map:a,spatialReference:s.sr};if("$map"===o&&(r.vars[o]=t.convertMapToFeatureSetCollection(l)),"$layer"===o&&(r.vars[o]=t.convertFeatureLayerToFeatureSet(n.sourceLayer,s.sr)),"$datastore"===o&&(r.vars[o]=t.convertServiceUrlToWorkspace(n.sourceLayer.url,s.sr)),"$aggregatedfeatures"===o){const i=n.layer,{fields:a,objectIdField:l,geometryType:c,spatialReference:d,displayField:u}=i,p=new or.default({fields:a,objectIdField:l,geometryType:c,spatialReference:d,displayField:u,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:e});r.vars[o]=t.convertFeatureLayerToFeatureSet(p,s.sr)}}))}({aggregatedFeatures:await dr({graphic:a,view:n}),arcadeUtils:i,featureSetVars:c,context:u,viewInfo:d,map:s,graphic:a});const p=i.createFunction(l,u),h=await i.executeAsyncFunction(p,u).catch((e=>cr.error("arcade-execution-error",{error:e,graphic:a,expressionInfo:t})));e[o]="string"==typeof h?$t(Wt(h)):Array.isArray(h)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?$t(Wt(e)):e}</li>`)).join("")}</ul>`}(h):h&&"esri.arcade.Dictionary"===h.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?$t(Wt(i)):i}</td></tr>`})).join("")}</table>`}(h):h}async function pr({popupTemplate:e,spatialReference:t,graphic:r,map:s,view:a}){const n=e.expressionInfos,o=[],l={};if(!n||!n.length)return l;const c=await i.e(14).then(i.bind(null,437));for(const e of n)o.push(ur({expressionAttributes:l,info:e,arcadeUtils:c,spatialReference:t,map:s,graphic:r,view:a}));return await Object(y.j)(o),l}const hr=o.a.getLogger("esri.widgets.FeatureViewModel");let br=class extends N.a{constructor(e){super(e),this._handles=new Ee.a,this._featureAbortController=null,this.graphicChangedThrottled=at(this.graphicChanged,1,this),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add(Object(me.a)(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return Object(n.h)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach((e=>{const r=Nt(e.fieldName,t);e.fieldName=r,i.set(r.toLowerCase(),e)})),i}(Ht(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Pt(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof $i&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof $i&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof $i&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=Object(y.d)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){hr.error("error","error loading popupTemplate for graphic",{error:t,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new nr.a({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new wi({description:r,graphic:i,title:s}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new Ti({graphic:i,creator:r,destroyer:s}),e}_compileFields(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=e.clone(),a=(null==e?void 0:e.fieldInfos)||(null==i?void 0:i.fieldInfos),n=null==i?void 0:i.expressionInfos,o={...r.global,...r.content[t]},{description:l,title:c}=s,d=new Ai({attributes:o,description:l,expressionInfos:n,fieldInfos:a,title:c});return this.contentViewModels[t]=d,s.fieldInfos=d.formattedFieldInfos.slice(0),s}_compileMedia(e,t){const{graphic:i,_fieldInfoMap:r,_effectivePopupTemplate:s,relatedInfos:a,_sourceLayer:n}=this,{attributes:o}=i,l=this.formattedAttributes.global,c=e.clone(),{description:d,mediaInfos:u,title:p}=c,h=new $i({activeMediaInfoIndex:c.activeMediaInfoIndex||0,attributes:o,description:d,layer:n,fieldInfoMap:r,formattedAttributes:l,mediaInfos:u,popupTemplate:s,relatedInfos:a,title:p});return c.mediaInfos=h.formattedMediaInfos.slice(0),this.contentViewModels[t]=h,c}_compileText(e,t){const i=e.clone(),{graphic:r,_fieldInfoMap:s,_sourceLayer:a}=this;if(i&&i.text){const{attributes:e}=r,t=this.formattedAttributes.global,n=Gt(i.text,{...t,...e},a);i.text=Ut({formattedAttributes:t,template:n,fieldInfoMap:s})}return this.contentViewModels[t]=new Ti({graphic:r,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=null==t?void 0:t.editFieldsInfo;return r&&s?function(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:a}=e;if(!t)return;const n=t[a];if("number"==typeof n){const e=t[s];return{type:"edit",date:Object(jt.b)(n,Lt),user:e}}const o=t[r];if("number"==typeof o){const e=t[i];return{type:"create",date:Object(jt.b)(o,Lt),user:e}}return null}(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r}=this,{attributes:s}=r,a=this.formattedAttributes.global;return e?Ut({formattedAttributes:a,template:Gt(e,{...a,...s},i),fieldInfoMap:t}):""}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return At(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return At(null==e?void 0:e.content,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:a,map:n,view:o}=this,{content:{value:l},title:{value:c}}=await Object(y.j)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;const{expressionAttributes:{value:d}}=await Object(y.j)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:pr({popupTemplate:this._effectivePopupTemplate,spatialReference:a,graphic:r,map:n,view:o}),queryUpdatedFeature:Qt({graphic:r,popupTemplate:s,layer:i,spatialReference:a},e)});t===this._featureAbortController&&r&&(this._set("formattedAttributes",this._createFormattedAttributes(l,d)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:i,graphic:r,relatedInfos:s,_sourceLayer:a,_fieldInfoMap:n}=this,o=null==i?void 0:i.fieldInfos,l={...r.attributes,...t},c={global:Jt({fieldInfos:o,graphic:r,attributes:l,layer:a,fieldInfoMap:n,relatedInfos:s}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(c.content[t]=Jt({fieldInfos:e.fieldInfos,graphic:r,attributes:l,layer:a,fieldInfoMap:n,relatedInfos:s}))})),c}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Ht(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const a=Object(n.h)(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!a)return;const o=t.filter((e=>e&&Kt(e.fieldName)));if(!o||!o.length)return;t.forEach((e=>this._configureRelatedInfo(e,a)));const l=await function({relatedInfos:e,layer:t},i){const r={};return e.forEach(((e,s)=>{const{relation:a}=e;if(!a){const e=new h.a("relation-required","A relation is required on a layer to retrieve related records.");throw qi.error(e),e}const{relatedTableId:n}=a;if("number"!=typeof n){const e=new h.a("A related table ID is required on a layer to retrieve related records.");throw qi.error(e),e}const o=`${t.url}/${n}`,l=zi.get(o),c=l||function(e,t){return Object(m.default)(e,{query:{f:"json"},signal:t&&t.signal})}(o,i);l||zi.set(o,c),r[s]=c})),Object(y.j)(r)}({relatedInfos:r,layer:a},i);Object.keys(l).forEach((e=>{var t;const i=r.get(e.toString()),s=null==(t=l[e])?void 0:t.value;i&&s&&(i.layerInfo=s.data)}));const c=await function({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach(((t,a)=>{t.layerInfo&&(s[a]=async function(e,t,i,r){const s=i.layerId.toString(),{layerInfo:a,queryTask:n,relation:o,relatedFields:l,outStatistics:c}=t,d=function({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some((t=>(""+t.relatedTableId===i&&t.id===e.id&&(r=t),!!r))),r}({originRelationship:o,relationships:a.relationships,layerId:s});if(d.relationshipTableId&&d.keyFieldInRelationshipTable){const t=(await function(e,t,i,r){const s=new Bi.a;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}(e,d,i,r))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[a.objectIdField]));if((null==c?void 0:c.length)>0&&a.supportsStatistics){const e=new Ui.a;e.where=function(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,1e3+r)})`),r+=1e3;return s.join(" OR ")}(a.objectIdField,s),e.outFields=l,e.outStatistics=c;const i={features:Promise.resolve(t),statsFeatures:n.execute(e)};return Object(y.j)(i)}}const u=null==d?void 0:d.keyField;if(u){const i=Object(Ot.l)(Object(Ot.i)(a.fields,u)),s=function(e,t){const i=t.toLowerCase();for(const t in e)if(t.toLowerCase()===i)return e[t];return null}(e.attributes,o.keyField),l=i?`${u}=${s}`:`${u}='${s}'`,c=n.execute(new Ui.a({where:l,outFields:t.relatedFields}),r),d=t.outStatistics&&t.outStatistics.length>0&&a.supportsStatistics?n.execute(new Ui.a({where:l,outFields:t.relatedFields,outStatistics:t.outStatistics}),r):null,p={features:c};return d&&(p.statsFeatures=d),Object(y.j)(p)}return null}(e,t,i,r))})),Object(y.j)(s)}({graphic:e,relatedInfos:r,layer:a},i);Object.keys(c).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const a=r&&r.value;t.relatedStatsFeatures=a?a.features:[]}(null==(t=c[e])?void 0:t.value,r.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=Hi(e.fieldName);if(!r)return;const{layerId:s,fieldName:a}=r;if(!s)return;const n=i.get(s.toString())||function(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(!i)return;const r=`${t.url}/${i.relatedTableId}`;return{url:r,queryTask:new Gi.a({url:r,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}(s,t);n&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new Vi.a({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}({relatedInfo:n,fieldName:a,fieldInfo:e}),this.relatedInfos.set(s,n))}};Object(s.a)([Object(c.b)()],br.prototype,"_featureAbortController",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"_effectivePopupTemplate",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"_fieldInfoMap",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"_sourceLayer",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"content",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"contentViewModels",void 0),Object(s.a)([Object(c.b)({type:Boolean})],br.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"formattedAttributes",void 0),Object(s.a)([Object(c.b)({type:mt.a,value:null})],br.prototype,"graphic",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"lastEditInfo",void 0),Object(s.a)([Object(c.b)()],br.prototype,"relatedInfos",void 0),Object(s.a)([Object(c.b)()],br.prototype,"spatialReference",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"title",void 0),Object(s.a)([Object(c.b)()],br.prototype,"map",null),Object(s.a)([Object(c.b)({readOnly:!0})],br.prototype,"waitingForContent",null),Object(s.a)([Object(c.b)()],br.prototype,"view",void 0),br=Object(s.a)([Object(u.a)("esri.widgets.FeatureViewModel")],br);var yr=br;const fr="esri-feature__content-element",mr={title:!0,content:!0,lastEditedInfo:!0};let gr=class extends(ht(ut.a)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...mr},this.map=null,this.view=null,this.viewModel=new yr}initialize(){this.own(Object(me.a)(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...mr,...e}}render(){const{waitingForContent:e}=this.viewModel;return Object(dt.a)("div",{class:this.classes("esri-feature","esri-widget")},Object(dt.a)("div",{class:"esri-feature__size-container"},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return Object(dt.a)("div",{key:"loading-container",class:"esri-feature__loading-container"},Object(dt.a)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Object(dt.a)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Object(dt.a)("h4",{class:"esri-feature__title",innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Object(dt.a)("div",{key:t+"-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:Object(dt.a)("div",{key:t+"-content"},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return"loading"===i||r.length>0?Object(dt.a)("div",{key:this._buildKey("attachments-element",e),class:this.classes(fr)},t.render()):null}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Object(dt.a)("div",{key:this._buildKey("custom-element",t),class:fr},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(dt.a)("div",{key:this._buildKey("fields-element",e),class:fr},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(dt.a)("div",{key:this._buildKey("media-element",e),class:fr},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,a="edit"===i.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,n=Object(st.a)(a,{date:r,user:s});return Object(dt.a)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",fr)},n)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Object(dt.a)("div",{key:this._buildKey("text-element",t),class:this.classes(fr,"esri-feature__text")},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,i)=>{"attachments"===e.type&&(this._contentWidgets[i]=new Mi({displayType:e.displayType,viewModel:t[i]})),"fields"===e.type&&(this._contentWidgets[i]=new Ni({viewModel:t[i]})),"media"===e.type&&(this._contentWidgets[i]=new ar({viewModel:t[i]})),"text"===e.type&&(this._contentWidgets[i]=new Fi({viewModel:t[i]})),"custom"===e.type&&(this._contentWidgets[i]=new Fi({viewModel:t[i]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new Fi({viewModel:e}))}this.scheduleRender()}};Object(s.a)([Object(D.a)("viewModel.graphic")],gr.prototype,"graphic",void 0),Object(s.a)([Object(D.a)("viewModel.defaultPopupTemplateEnabled")],gr.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gr.prototype,"label",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/Feature/t9n/Feature")],gr.prototype,"messages",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/support/t9n/uriUtils")],gr.prototype,"messagesURIUtils",void 0),Object(s.a)([Object(D.a)("viewModel.spatialReference")],gr.prototype,"spatialReference",void 0),Object(s.a)([Object(D.a)("viewModel.title")],gr.prototype,"title",void 0),Object(s.a)([Object(c.b)()],gr.prototype,"visibleElements",void 0),Object(s.a)([Object($.a)("visibleElements")],gr.prototype,"castVisibleElements",null),Object(s.a)([Object(D.a)("viewModel.map")],gr.prototype,"map",void 0),Object(s.a)([Object(D.a)("viewModel.view")],gr.prototype,"view",void 0),Object(s.a)([Object(c.b)({type:yr})],gr.prototype,"viewModel",void 0),gr=Object(s.a)([Object(u.a)("esri.widgets.Feature")],gr);var vr=gr;let Or=class extends G.a.EventedAccessor{constructor(...e){super(...e),this._anchorHandles=new Ee.a,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([Object(me.d)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),Object(me.d)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",r=Object(me.c)(t,i,(()=>this._viewpointChange()));this._anchorHandles.add(r,e),this._viewpointHandle=r,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,r=this.get("view.ready"),s=i&&e&&r?t.toScreen(e):null;this._set("screenLocation",s)}};Object(s.a)([Object(c.b)()],Or.prototype,"location",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Or.prototype,"screenLocation",void 0),Object(s.a)([Object(c.b)()],Or.prototype,"screenLocationEnabled",void 0),Object(s.a)([Object(c.b)()],Or.prototype,"view",void 0),Or=Object(s.a)([Object(u.a)("esri.widgets.support.AnchorElementViewModel")],Or);var jr=Or;let wr=class extends jr{constructor(e){super(e),this.visible=!1}};Object(s.a)([Object(c.b)()],wr.prototype,"visible",void 0),wr=Object(s.a)([Object(u.a)("esri.widgets.CompassViewModel")],wr);var _r=wr;let Ir=class extends ut.a{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new _r,this.visible=!1}initialize(){this.own([Object(me.d)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0,i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r={"esri-spinner--start":e&&i,"esri-spinner--finish":!e&&i},s=this._getPositionStyles();return Object(dt.a)("div",{class:this.classes("esri-spinner",r),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=Object(y.a)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||!e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};Object(s.a)([Object(D.a)("viewModel.location")],Ir.prototype,"location",void 0),Object(s.a)([Object(D.a)("viewModel.view")],Ir.prototype,"view",void 0),Object(s.a)([Object(c.b)({type:_r})],Ir.prototype,"viewModel",void 0),Object(s.a)([Object(D.a)("viewModel.visible")],Ir.prototype,"visible",void 0),Ir=Object(s.a)([Object(u.a)("esri.widgets.Spinner")],Ir);var Sr=Ir,Mr=i(165),xr=i(71),Tr=(i(59),i(347)),Er=i(348),Fr=i(462);const Cr=new Er.a({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Lr=new Er.a({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Pr=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return Object(s.a)([Object(c.b)()],t.prototype,"goToOverride",void 0),Object(s.a)([Object(c.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(u.a)("esri.widgets.support.GoTo")],t),t},Ar=q.a.ofType({key:"type",defaultKeyValue:"button",base:Tr.a,typeMap:{button:Er.a,toggle:Fr.a}}),kr=o.a.getLogger("esri.widgets.Popup.PopupViewModel");let Rr=class extends(Pr(jr)){constructor(e){super(e),this._handles=new Ee.a,this._pendingPromises=new Set,this._zoomToLocation=null,this._fetchFeaturesController=null,this.actions=new Ar([Cr.clone()]),this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.content=null,this.featureViewModels=[],this.highlightEnabled=!0,this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4}initialize(){this._handles.add([Object(me.a)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),Object(me.d)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),Object(me.d)(this,"view.animation.state",(e=>this._animationStateChange(e))),Object(me.d)(this,"location",(e=>this._locationChange(e))),Object(me.d)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),this.on("trigger-action",(e=>function(e){const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new h.a("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new h.a("trigger-action:missing-arguments","view.popup is missing"));const{disabled:a,id:n}=r;if(!n)return Promise.reject(new h.a("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new h.a("trigger-action:invalid-action","Action is disabled"));if(n===Cr.id)return s.viewModel.zoomToLocation();if(n===Lr.id){s.close();const{selectedFeature:e}=s;if(!e)return Promise.reject(new h.a("trigger-action:"+Lr.id,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()}({event:e,view:this.view}))),Object(me.f)(this,"waitingForResult",(()=>this._waitingForResultChange())),Object(me.d)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Ar;e.removeAll();const t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),i=t&&t.actions,r=t&&t.overwriteActions?i:i?i.concat(this.actions):this.actions;return r&&r.filter(Boolean).forEach((t=>e.add(t))),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,a=r&&t.length;a&&i&&-1===s?this.selectedFeatureIndex=0:a&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Object(Mr.b)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e),e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=this._getSelectedTarget();if(!t){const i=new h.a("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return kr.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new h.a("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return kr.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}zoomToLocation(){const{location:e,selectedFeature:t,view:i,zoomFactor:r}=this,s=this._getSelectedTarget();if(!s){const e=new h.a("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});return kr.error(e),Promise.reject(e)}const a=i.scale/r,n=this.get("selectedFeature.geometry")||e,o=n&&"point"===n.type&&this._isZoomScreenSize(t);Cr.active=!0,Cr.disabled=!0;const l=this.callGoTo({target:{target:s,scale:o?a:void 0}}).catch((()=>{Cr.active=!1,Cr.disabled=!1,this._zoomToLocation=null})).then((()=>{o&&(this.location=n)}));return this._zoomToLocation=l,l}_animationStateChange(e){this._zoomToLocation||(Cr.disabled="waiting-for-target"===e)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=r.center.clone()})):this.location=Object(n.n)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,r=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[r,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{features:e,featureViewModels:t}=this;if(this._destroyFeatureVMs(),!e||!e.length)return;const i=t.slice(0),r=[];e.forEach(((e,t)=>{if(!e)return;let s=null;if(i.some(((t,r)=>(t&&t.graphic===e&&(s=t,i.splice(r,1)),!!s))),s)r[t]=s;else{var a,n;const i=new yr({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,graphic:e,spatialReference:null==(a=this.view)?void 0:a.spatialReference,map:null==(n=this.view)?void 0:n.map,view:this.view});r[t]=i}})),i.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",r)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_getSelectedTarget(){const{selectedFeature:e,location:t,view:i}=this;return i?"3d"===i.type?e||t:this.get("selectedFeature.geometry")||t:null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),Qe.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=Object(y.d)(),{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:a}=e,n=[Promise.resolve(t),...s.map((e=>e.promise))];return r.popup.open({location:a||i,promises:n}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_isZoomScreenSize(e){const{view:t}=this;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new h.a("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});kr.error(t)})),t}return!0}_getPointFromGeometry(e){return Object(n.g)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const{layer:a}=t;if(!(a&&a instanceof v.a))return;const n=this._getLayerView(r,a);this._highlightPromise=n;const o=await n;if(!(o&&function(e){return e&&"function"==typeof e.highlight}(o)&&this._highlightPromise===n&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l="objectIdField"in a&&a.objectIdField,c=t.attributes,d=c&&l&&c[l],u=o.highlight(d||t);this._handles.add(u,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};Object(s.a)([Object(c.b)({type:Ar})],Rr.prototype,"actions",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"active",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"allActions",null),Object(s.a)([Object(c.b)({type:Boolean})],Rr.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"autoCloseEnabled",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"autoOpenEnabled",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"content",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"featureCount",null),Object(s.a)([Object(c.b)()],Rr.prototype,"features",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"featureViewModels",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"highlightEnabled",void 0),Object(s.a)([Object(c.b)({type:xr.a})],Rr.prototype,"location",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"pendingPromisesCount",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"waitingForResult",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"promiseCount",null),Object(s.a)([Object(c.b)()],Rr.prototype,"promises",null),Object(s.a)([Object(c.b)({value:null,readOnly:!0})],Rr.prototype,"selectedFeature",null),Object(s.a)([Object(c.b)({value:-1})],Rr.prototype,"selectedFeatureIndex",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"selectedFeatureViewModel",null),Object(s.a)([Object(c.b)({readOnly:!0})],Rr.prototype,"state",null),Object(s.a)([Object(c.b)()],Rr.prototype,"title",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"updateLocationEnabled",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"view",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"visible",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"zoomFactor",void 0),Object(s.a)([Object(c.b)()],Rr.prototype,"centerAtLocation",null),Object(s.a)([Object(c.b)()],Rr.prototype,"zoomToLocation",null),Rr=Object(s.a)([Object(u.a)("esri.widgets.Popup.PopupViewModel")],Rr);var Nr=Rr;const Dr="esri-icon-left-triangle-arrow",Vr="esri-icon-right-triangle-arrow",Ur="esri-icon-loading-indicator",Br="esri-rotating",Gr="esri-popup--shadow",qr="esri-popup__header-container",zr="esri-popup__button",Hr="esri-popup__icon",Wr={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function $r(e,t){return void 0===t?"esri-popup__"+e:`esri-popup__${e}-${t}`}const Jr=o.a.getLogger("esri.widgets.Popup"),Qr={closeButton:!0,featureNavigation:!0};let Kr=class extends(ht(ut.a)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ee.a,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._displaySpinnerThrottled=at((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Nr,this.visible=null,this.visibleElements={...Qr},this._addSelectedFeatureIndexHandle(),this.own([Object(me.d)(this,"viewModel.screenLocation",(()=>this._positionContainer())),Object(me.d)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),Object(me.d)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),Object(me.d)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),Object(me.d)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),Object(me.d)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),Object(me.d)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),Object(me.d)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),Object(me.d)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),Object(me.d)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),Object(me.d)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),Object(me.f)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),Object(me.b)(this,"viewModel.allActions","change",(()=>this._watchActions())),Object(me.a)(this,"viewModel.allActions",(()=>this._watchActions()))])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null}get actionsMenuId(){return this.id+"-actions-menu"}get actionsMenuButtonId(){return this.id+"-actions-menu-button"}get featureMenuId(){return this.id+"-feature-menu"}get titleId(){return this.id+"-popup-title"}get contentId(){return this.id+"-popup-content"}get hasContent(){var e,t,i,r,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(r=i.viewModel)?void 0:r.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Wr}set dockOptions(e){const t={...Wr},i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...t,...e},a={...t.breakpoint,...r},{breakpoint:n}=s;!0===n?s.breakpoint=a:"object"==typeof n&&(s.breakpoint={...a,...n}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}set featureNavigationEnabled(e){Object(rt.c)(Jr,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements={...this.visibleElements,featureNavigation:e}}get selectedFeatureWidget(){const{_feature:e,visibleElements:t}=this,{selectedFeatureViewModel:i}=this.viewModel,r={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=r):this._feature=new vr({viewModel:i,visibleElements:r}),this._feature):null}castVisibleElements(e){return{...Qr,...e}}blur(){const{active:e}=this.viewModel;e||Jr.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Jr.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove("selected-index");const r=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,a={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:r};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(a.collapsed=!0),this.set(a),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,r;const{actionsMenuOpen:s,dockEnabled:a,featureMenuVisible:n,dividedActions:o,currentAlignment:l,currentDockPosition:c}=this,{active:d}=this.viewModel,{menuActions:u}=o,p=d&&u.length>1&&s,h=d&&a,b=d&&!a,y=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,f=null==(i=this.selectedFeature)||null==(r=i.layer)?void 0:r.id,m={"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":h,[Gr]:b,"esri-popup--is-docked-top-left":"top-left"===c,"esri-popup--is-docked-top-center":"top-center"===c,"esri-popup--is-docked-top-right":"top-right"===c,"esri-popup--is-docked-bottom-left":"bottom-left"===c,"esri-popup--is-docked-bottom-center":"bottom-center"===c,"esri-popup--is-docked-bottom-right":"bottom-right"===c,"esri-popup--feature-menu-open":n,"esri-popup--actions-menu-open":p};return Object(dt.a)("div",{class:this.classes("esri-popup",m),role:"presentation","data-layer-title":y,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},d?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Object(dt.a)("span",{"aria-hidden":"true",class:this.classes(Hr,Ur,Br)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Object(dt.a)("div",{key:$r("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Object(nt.e)(),t={[Vr]:e,"esri-popup__pagination-previous-icon--rtl":e,[Dr]:!e,"esri-popup__pagination-previous-icon":!e};return Object(dt.a)("span",{"aria-hidden":"true",class:this.classes(Hr,t)})}renderPreviousButton(){const{messages:e}=this;return Object(dt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(zr,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Object(nt.e)(),t={[Dr]:e,"esri-popup__pagination-next-icon--rtl":e,[Vr]:!e,"esri-popup__pagination-next-icon":!e};return Object(dt.a)("span",{"aria-hidden":"true",class:this.classes(Hr,t)})}renderNextButton(){const{messages:e}=this;return Object(dt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(zr,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return Object(dt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(zr,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={"esri-icon-minimize":e,"esri-popup__icon--dock-icon":!e,"esri-icon-dock-right":!e&&("top-right"===t||"bottom-right"===t),"esri-icon-dock-left":!e&&("top-left"===t||"bottom-left"===t),"esri-icon-maximize":!e&&"top-center"===t,"esri-icon-dock-bottom":!e&&"bottom-center"===t};return Object(dt.a)("span",{"aria-hidden":"true",class:this.classes(i,Hr)})}renderDockButton(){var e,t,i;const{dockEnabled:r,messages:s}=this,a=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,n=r?s.undock:s.dock;return"xsmall"!==a&&null!=(i=this.dockOptions)&&i.buttonEnabled?Object(dt.a)("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(zr,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,a={"esri-popup__header-container--button":i},n=Object(dt.a)("h2",{class:"esri-popup__header-title",innerHTML:e}),o=i?Object(dt.a)("button",{key:e+"--collapsible",id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(qr,a),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed},n):Object(dt.a)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(qr,a)},n);return e?o:null}renderCloseIcon(){return Object(dt.a)("span",{"aria-hidden":"true",class:this.classes(Hr,"esri-icon-close")})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Object(dt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:zr,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Object(dt.a)("header",{class:"esri-popup__header"},this.renderTitle(),Object(dt.a)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?Object(dt.a)("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,a=i?s.close:s.open,{menuActions:n}=r;return n.length?Object(dt.a)("div",{key:$r("actions-menu-button"),class:this.classes(zr,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":a,title:a},Object(dt.a)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s,inlineActions:a}=r;return s.length&&i?Object(dt.a)("ul",{id:e,role:"menu","aria-labelledby":t,key:$r("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+a.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?Object(dt.a)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Object(dt.a)("section",{key:$r("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,a={"esri-popup__footer--has-pagination":e,"esri-popup__footer--has-actions":s,"esri-popup__footer--has-actions-menu":!!r.length};return e||s?Object(dt.a)("div",{key:$r("feature-buttons"),class:this.classes("esri-popup__footer",a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t}=this.viewModel,i=Object(st.a)(e.selectedFeatures,{total:t.length});return Object(dt.a)("section",{key:$r("menu"),class:"esri-popup__feature-menu"},Object(dt.a)("h2",{class:"esri-popup__feature-menu-header"},i),Object(dt.a)("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu()))}renderPointer(){return this.dockEnabled?null:Object(dt.a)("div",{key:$r("pointer"),class:"esri-popup__pointer",role:"presentation"},Object(dt.a)("div",{class:this.classes("esri-popup__pointer-direction",Gr)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:a,hasContent:n,contentCollapsed:o,visibleElements:l}=this,{title:c}=this.viewModel,d="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,u="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,p={[Gr]:e,"esri-popup--is-collapsible":a,"esri-popup--is-collapsed":o};return Object(dt.a)("div",{class:this.classes("esri-popup__main-container","esri-widget",p),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":n&&!o?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Object(dt.a)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Object(dt.a)("span",{key:"text",class:"esri-popup__action-text"},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Ur]:e.active,[Br]:e.active,[Hr]:!!t,"esri-popup__action-image":!e.active&&!!i};return t&&(r[t]=!e.active),Object(dt.a)("span",{key:"icon","aria-hidden":"true",class:this.classes(Hr,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:r}=e,s=this._getActionTitle(t),a={"esri-popup__action":"toggle"!==t.type,"esri-popup__action-toggle":"toggle"===t.type,"esri-popup__action-toggle--on":"toggle"===t.type&&t.value,"esri-popup__button--disabled":t.disabled},n=[this.renderActionIcon(t),this.renderActionText(s)],o="menu-item"===r?Object(dt.a)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(zr,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},n):Object(dt.a)("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(zr,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:a}=this.viewModel,n=e===a,o={"esri-popup__feature-menu-item--selected":n},l=n?Object(dt.a)("span",{key:$r("feature-menu-selected-feature-"+s),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,c=Object(dt.a)("span",{innerHTML:e.title||r.untitled});return Object(dt.a)("li",{role:"menuitem",tabIndex:-1,key:$r("feature-menu-feature-"+s),class:this.classes(o,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Object(dt.a)("span",{class:"esri-popup__feature-menu-title"},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Object(dt.a)("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,a=null==i?void 0:i.attributes,n="zoom-to-feature"===s?Object(st.a)(e.title,{messages:t}):"remove-selected-feature"===s?Object(st.a)(e.title,{messages:r}):e.title;return n&&a?Object(st.a)(n,a):n}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:r,image:s}=e,a=s||r?r:"esri-icon-default-action";return a&&i?Object(st.a)(a,i):a}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:r}=e;return r&&i?Object(st.a)(r,i):r}_createFeatureUpdatedAnimation(){return Object(nt.b)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(Object(me.d)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,r=0===t;return{inlineActions:i?e.slice(0):r?new q.a:e.slice(0,t),menuActions:i?new q.a:r?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_handleFeatureMenuKeyup(e){"Escape"===Object(Be.a)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===Object(Be.a)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Object(Be.a)(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),a=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+a)%a].focus()):(e.stopPropagation(),s[(r-1+a)%a].focus())}_handleActionMenuItemKeyup(e){const t=Object(Be.a)(e),{_actionsMenuNode:i}=this,r=e.currentTarget["data-action-index"];if(!i)return;const s=i.querySelectorAll("li"),a=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+a)%a].focus()):(e.stopPropagation(),s[(r-1+a)%a].focus())}_handleMainKeyup(e){const t=Object(Be.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=Object(me.d)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,"selected-index")}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:a}=e;if(isNaN(i)||isNaN(t)||!a||!r)return!1;const n=a.padding;return"right"===s&&r.x+i/2>a.width-n.right||"left"===s&&r.x-i/2<n.left||"top"===s&&r.y-t<n.top||"bottom"===s&&r.y+t>a.height-n.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:a,view:n}=s;if(!a||!n||!i)return"top-center";if(!this._isScreenLocationWithinView(a,n))return this._get("currentAlignment")||"top-center";function o(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?o(l.getPropertyValue("max-height")):0,d=l?o(l.getPropertyValue("height")):0,{height:u,width:p}=i.getBoundingClientRect(),h=p+t,b=Math.max(u,c,d)+t,y=this._isOutsideView({popupHeight:b,popupWidth:h,screenLocation:a,side:"right",view:n}),f=this._isOutsideView({popupHeight:b,popupWidth:h,screenLocation:a,side:"left",view:n}),m=this._isOutsideView({popupHeight:b,popupWidth:h,screenLocation:a,side:"top",view:n}),g=this._isOutsideView({popupHeight:b,popupWidth:h,screenLocation:a,side:"bottom",view:n});return f?m?"bottom-right":"top-right":y?m?"bottom-left":"top-left":m?g?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Object(nt.e)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,r=Object(nt.e)()?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},a=i.width-s.left-s.right,{breakpoints:n}=i;return n&&a<=n.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:a}=this,n=r/2,o=i.height-t,l=i.width-e,{padding:c}=this.view;return"bottom-center"===s?{top:t+a-c.top,left:e-n-c.left}:"top-left"===s?{bottom:o+a-c.bottom,right:l+a-c.right}:"bottom-left"===s?{top:t+a-c.top,right:l+a-c.right}:"top-right"===s?{bottom:o+a-c.bottom,left:e+a-c.left}:"bottom-right"===s?{top:t+a-c.top,left:e+a-c.left}:"top-center"===s?{bottom:o+a-c.bottom,left:e-n-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(!e||!t)return;const s=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,r,s);return a?{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[a,n]=t,{width:o,height:l}=i;return r<=o&&a>o||r>o&&a<=o||s<=l&&n>l||s>l&&n<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,a=[],n=[];a[0]=e[0]-r,a[1]=e[1]-s,n[0]=t[0]-r,n[1]=t[1]-s;const{dockOptions:o}=this,l=o.breakpoint;this._dockingThresholdCrossed(a,n,l)&&this._setDockEnabledForViewSize(o),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportNodeUpdated(e){e&&(e.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const r=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:a,height:n}=s;if(isNaN(a)||isNaN(n))return!1;const o=r.hasOwnProperty("width")&&a<=r.width,l=r.hasOwnProperty("height")&&n<=r.height;return o||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Object(st.a)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Sr({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};function Zr(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,function(e){return e&&"focus"in e}(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function Yr(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function Xr(e){return Object(n.g)(e)?{}:"function"==typeof e?e():e}function es(e){return Object(Ae.b)(e.x,e.y)}function ts(e){return"mouse"===e}function is(e){return"mouse"!==e.pointerType||0===e.button}function rs(e){return!!e.native.shiftKey}Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"actionsMenuId",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"actionsMenuButtonId",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"featureMenuId",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"titleId",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"contentId",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"hasContent",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"featureNavigationVisible",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"collapsible",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"featureMenuVisible",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"contentCollapsed",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"dividedActions",null),Object(s.a)([Object(D.a)("viewModel.actions")],Kr.prototype,"actions",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"actionsMenuOpen",null),Object(s.a)([Object(c.b)()],Kr.prototype,"alignment",void 0),Object(s.a)([Object(D.a)("viewModel.autoCloseEnabled")],Kr.prototype,"autoCloseEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.autoOpenEnabled")],Kr.prototype,"autoOpenEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.defaultPopupTemplateEnabled")],Kr.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.content")],Kr.prototype,"content",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"collapsed",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"collapseEnabled",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"currentAlignment",null),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"currentDockPosition",null),Object(s.a)([Object(c.b)()],Kr.prototype,"dockOptions",null),Object(s.a)([Object(c.b)()],Kr.prototype,"dockEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.featureCount")],Kr.prototype,"featureCount",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"featureMenuOpen",void 0),Object(s.a)([Object(D.a)("viewModel.features")],Kr.prototype,"features",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"featureNavigationEnabled",null),Object(s.a)([Object(D.a)("viewModel.goToOverride")],Kr.prototype,"goToOverride",void 0),Object(s.a)([Object(D.a)("viewModel.highlightEnabled")],Kr.prototype,"highlightEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.location")],Kr.prototype,"location",void 0),Object(s.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Kr.prototype,"label",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"maxInlineActions",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/widgets/Popup/t9n/Popup")],Kr.prototype,"messages",void 0),Object(s.a)([Object(c.b)(),Object(lt.a)("esri/t9n/common")],Kr.prototype,"messagesCommon",void 0),Object(s.a)([Object(D.a)("viewModel.promises")],Kr.prototype,"promises",void 0),Object(s.a)([Object(D.a)("viewModel.selectedFeature")],Kr.prototype,"selectedFeature",void 0),Object(s.a)([Object(D.a)("viewModel.selectedFeatureIndex")],Kr.prototype,"selectedFeatureIndex",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Kr.prototype,"selectedFeatureWidget",null),Object(s.a)([Object(c.b)()],Kr.prototype,"spinnerEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.title")],Kr.prototype,"title",void 0),Object(s.a)([Object(D.a)("viewModel.updateLocationEnabled")],Kr.prototype,"updateLocationEnabled",void 0),Object(s.a)([Object(D.a)("viewModel.view")],Kr.prototype,"view",void 0),Object(s.a)([Object(c.b)({type:Nr}),Object(ct.a)(["triggerAction","trigger-action"])],Kr.prototype,"viewModel",void 0),Object(s.a)([Object(D.a)("viewModel.visible")],Kr.prototype,"visible",void 0),Object(s.a)([Object(c.b)()],Kr.prototype,"visibleElements",void 0),Object(s.a)([Object($.a)("visibleElements")],Kr.prototype,"castVisibleElements",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_close",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_toggleDockEnabled",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_toggleFeatureMenu",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_toggleActionsMenu",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_triggerAction",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_selectFeature",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_next",null),Object(s.a)([Object(ot.a)()],Kr.prototype,"_previous",null),Kr=Object(s.a)([Object(u.a)("esri.widgets.Popup")],Kr);const ss={manipulator:null,tool:null};const as=o.a.getLogger("esri.views.ToolViewManager");let ns=class extends N.a{constructor(e){super(e),this._handles=new Ee.a,this._creatingTool=null,this._manipulatorState=new class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":ts(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!is(e)||rs(e))break;const r=es(e),s=this._intersect(r,e.pointerType,t.forEachTool);if(Object(n.g)(s))break;const a=this._findToolAndManipulatorByKey(s,t.forEachTool,ss),o=Object(n.b)(a,(e=>e.manipulator)),l=Object(n.b)(a,(e=>e.tool));!(Object(n.h)(o)&&Object(n.h)(l)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,l,e),Object(n.h)(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:s,start:r}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",screenPoint:r}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!is(e))break;const r=this._grabbedManipulators.get(e.pointerId),s=this._draggedManipulators.get(e.pointerId),a=Object(n.b)(r||s,(({key:e})=>e)),o=this._findManipulatorByKey(a,t.forEachTool);if(Object(n.g)(o))break;const l=es(e);l.x=Object(Pe.c)(l.x,0,t.view.width),l.y=Object(Pe.c)(l.y,0,t.view.height);const c=Object(n.n)(r||s).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,s?o.events.emit("drag",{action:"update",start:c,screenPoint:l}):o.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:Object(n.n)(a),start:c}));break;case"end":o.dragging=!1,s&&o.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=es(e),s=this._intersect(r,e.pointerType,t.forEachTool),a=this._findToolAndManipulatorByKey(s,t.forEachTool,ss);if(rs(e)||t.forEachTool((e=>{if((!Object(n.h)(a)||a.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),Object(n.g)(a))break;const{manipulator:o,tool:l}=a;if(!o.interactive)break;o.selectable&&!l.selectionManagementDisabled&&(o.selected=!o.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:c,stopPropagation:i});break}case"click":{const r=es(e),s=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(s,t.forEachTool);if(Object(n.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o}),i();break}case"double-click":{const r=es(e),s=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(s,t.forEachTool);if(Object(n.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const r=es(e),s=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(s,t.forEachTool);if(Object(n.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}}this._updateCursor(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:es(i)}),this._grabbedManipulators.forEach((({key:i},r)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(r)}))}_handlePointerEnd(e,t){const i=Object(n.b)(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),r=this._findManipulatorByKey(i,t.forEachTool);if(Object(n.h)(r)&&!r.dragging){const s=Object(n.h)(t.creatingTool)&&t.creatingTool===Object(n.n)(i).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||s||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:es(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let i=null;return we(e,(({key:e})=>{const r=this._findManipulatorByKey(e,t);return!!(Object(n.h)(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(i=r.cursor,!0)})),i}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,i=!0,r){const s=t=>t.tool===e&&(Object(n.g)(r)||t.manipulatorId===r);this._grabbedManipulators.forEach((({key:e},i)=>{if(s(e)){this._grabbedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(n.h)(r)&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(s(e)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(n.h)(r)&&(r.dragging=!1,r.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(s(e)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(n.h)(r)&&(r.hovering=!1)}})),this._updateCursor(t)}_intersect(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!Yr(i))return!1;const s=i.manipulators.intersect(e,t);return!Object(n.g)(s)&&(r={manipulatorId:s.id,tool:i},!0)})),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Object(Ae.b)(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!ts(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(es(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){const s=this._intersect(e,i,r);let a=this._findManipulatorByKey(s,r);const o=Object(n.b)(this._hoveredManipulators.get(t),(({key:e})=>e)),l=this._findManipulatorByKey(o,r);Object(n.h)(a)&&!a.interactive&&(a=null),l!==a&&(Object(n.h)(l)&&(l.hovering=!1),Object(n.h)(a)?(a.hovering=!0,this._hoveredManipulators.set(t,{key:Object(n.n)(s)})):this._hoveredManipulators.delete(t),this._updateCursor(r))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,ss)?ss.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return Object(n.g)(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!Yr(t))return!1;const r=t.manipulators.findById(e.manipulatorId);return!!Object(n.h)(r)&&(i.manipulator=r,i.tool=t,!0)})),i.manipulator?i:null)}},this.tools=function(){const e=new q.a;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;Zr(t,!1),t.destroyed||t.detach()})),e}(),this.cursor=null,this._forEachTool=e=>{if(!Object(n.h)(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this._handles.add([this.view.on(Ke,(e=>{this._handleInputEvent(e)}),Qe.TOOL),this.tools.on("before-add",(e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(as.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((e=>e.destroy())),this._handles.destroy(),this._handles=null}set activeTool(e){!Object(n.h)(e)||this.view.ready?(function(e,t,i){const r=e.activeTool;t!==r&&(Object(n.h)(r)&&r.deactivate&&r.deactivate(),i(t),Object(n.h)(t)&&t.activate&&t.activate())}(this,e,(t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool((e=>{const t=Object(n.g)(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const i=Yr(e);!Object(n.g)(this.activeTool)&&i||this._manipulatorState.clearPointers(e,this._forEachTool,!i)})),this._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):as.error("#activeTool=","cannot set active tool while view is not ready")}async createTool(e,t,i){await this.view.whenReady();const r="Tool creation was interrupted by another tool being created";if(Object(y.m)(i))throw Object(y.e)(r);const s=new e({...Xr(t),view:this.view}),a=Object(y.o)(i,(()=>this.activeTool=null));return this._rejectCreatingTool(r),this._creatingTool=s,s.attach(),this._refreshToolWatchers(),Zr(s,!0),await s.when(),Object(n.h)(a)&&a.remove(),this._creatingTool=null,this.tools.add(s),s instanceof N.a&&null!=s.completed&&Object(me.i)(s,"completed").then((()=>{Zr(s,!1)})),s}attach(){this._forEachTool((e=>e.attach())),"3d"===this.view.type?this._handles.add([this.view.state.watch("camera",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this.forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))}))],"manipulators"):this._handles.add(this.view.watch("extent",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){this.activeTool=null,this._forEachTool((e=>{e.detach(),e.destroy()})),this.tools.removeAll(),this._handles.remove("manipulators")}forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};Object(n.h)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&Object(n.h)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this._handles.remove("tools"),this._forEachTool((e=>{if(e instanceof N.a){const t=Object(me.d)(e,["cursor","visible","editable"],(()=>{Yr(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this._handles.add(t,"tools")}e.manipulators&&this._handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool((t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0))),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;Object(n.g)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Object(y.e)(e)),t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter((t=>(Object(n.g)(e)||t!==e)&&null!=t.completed&&!t.completed)).forEach((e=>{this.tools.remove(e)}))}};Object(s.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],ns.prototype,"view",void 0),Object(s.a)([Object(c.b)({value:null})],ns.prototype,"activeTool",null),Object(s.a)([Object(c.b)({readOnly:!0,type:q.a})],ns.prototype,"tools",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],ns.prototype,"cursor",void 0),ns=Object(s.a)([Object(u.a)("esri.views.ToolViewManager")],ns);var os=ns;class ls{constructor(e,t,i){this.analysis=e,this.viewFactory=t,this.controllerFactory=i,this._promise=Object(y.f)(),this.analysisView=null,this.analysisController=null,this._load()}destroy(){Object(n.h)(this.analysisView)&&this.analysisView.destroy(),Object(n.h)(this.analysisController)&&this.analysisController.destroy()}get promise(){return this._promise.promise}async _load(){let e=!1;Object(n.h)(this.viewFactory)?this.analysisView=await this.viewFactory(this.analysis):e=!0,Object(n.h)(this.controllerFactory)?this.analysisController=await this.controllerFactory(this.analysis):e=!0,e?this._promise.reject("no view/controller factories available for analysis"):this._promise.resolve(Object(n.n)(this.analysisView))}}let cs=class extends N.a{constructor(e){super(e),this._items=new Map,this.analyses=new q.a}initialize(){this.analyses.on("after-add",(e=>{const t=e.item;this._items.set(t,this._createItem(t))})),this.analyses.on("after-remove",(e=>{const t=e.item,i=this._getItem(t);Object(n.h)(i)&&(i.destroy(),this._items.delete(t))}))}async whenAnalysisView(e){return this._items.has(e)?this._items.get(e).promise:Object(y.q)(new h.a("view:no-analysisview-for-analysis","No analysis view has been found for the analysis"))}getAnalysisView(e){const t=this._items.get(e);return t?t.analysisView:null}_createItem(e){return new ls(e,this.viewFactory,this.controllerFactory)}_getItem(e){return this._items.get(e)}};Object(s.a)([Object(c.b)({type:q.a})],cs.prototype,"analyses",void 0),Object(s.a)([Object(c.b)()],cs.prototype,"viewFactory",void 0),Object(s.a)([Object(c.b)()],cs.prototype,"controllerFactory",void 0),cs=Object(s.a)([Object(u.a)("esri.views.3d.interactive.graphics.AnalysisManager")],cs);let ds=class extends N.a{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":us.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return ps[this.deviceType]}};Object(s.a)([Object(c.b)({nonNullable:!0,readOnly:!0})],ds.prototype,"nativeIndex",void 0),Object(s.a)([Object(c.b)({type:String,readOnly:!0})],ds.prototype,"deviceType",null),Object(s.a)([Object(c.b)({type:Number,readOnly:!0})],ds.prototype,"axisThreshold",null),ds=Object(s.a)([Object(u.a)("esri.views.input.gamepad.GamepadInputDevice")],ds);const us=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),ps={standard:.15,spacemouse:.025,unknown:0};var hs=ds;let bs=class extends N.a{constructor(...e){super(...e),this.devices=new q.a,this.enabledFocusMode="document"}};Object(s.a)([Object(c.b)({type:q.a.ofType(hs),readOnly:!0})],bs.prototype,"devices",void 0),Object(s.a)([Object(c.b)({type:["document","view","none"]})],bs.prototype,"enabledFocusMode",void 0),bs=Object(s.a)([Object(u.a)("esri.views.input.gamepad.GamepadSettings")],bs);var ys=bs;let fs=class extends N.a{constructor(){super(...arguments),this.gamepad=new ys}};Object(s.a)([Object(c.b)({readOnly:!0})],fs.prototype,"gamepad",void 0),fs=Object(s.a)([Object(u.a)("esri.views.input.Input")],fs);var ms=fs;let gs=class extends N.a{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};Object(s.a)([Object(c.b)({type:Boolean,nonNullable:!0})],gs.prototype,"enabled",void 0),Object(s.a)([Object(c.b)({type:hs})],gs.prototype,"device",void 0),Object(s.a)([Object(c.b)({type:["pan","zoom"],nonNullable:!0})],gs.prototype,"mode",void 0),Object(s.a)([Object(c.b)({type:["forward-down","forward-up"],nonNullable:!0})],gs.prototype,"tiltDirection",void 0),Object(s.a)([Object(c.b)({type:Number,nonNullable:!0})],gs.prototype,"velocityFactor",void 0),gs=Object(s.a)([Object(u.a)("esri.views.navigation.gamepad.GamepadSettings")],gs);var vs=gs;let Os=class extends N.a{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new vs,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};Object(s.a)([Object(c.b)({type:Boolean})],Os.prototype,"browserTouchPanEnabled",void 0),Object(s.a)([Object(c.b)({type:vs,nonNullable:!0})],Os.prototype,"gamepad",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Os.prototype,"momentumEnabled",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Os.prototype,"mouseWheelZoomEnabled",void 0),Os=Object(s.a)([Object(u.a)("esri.views.navigation.Navigation")],Os);var js=Os,ws=i(24),_s=i(91);function Is(e){const t=e.url&&Object(_s.e)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&Object(n.h)(t)&&"ImageServer"===t.serverType||!Ss(e)||!e.heightModelInfo?function(e){return Ms(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):xs(e)}(e)?ge.a.deriveUnitFromSR(Ts,e.spatialReference):null:e.heightModelInfo}function Ss(e){return"heightModelInfo"in e}function Ms(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function xs(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1}return!1}const Ts=new ge.a({heightModel:"gravity-related-height"});var Es;const Fs=o.a.getLogger("esri.views.support.DefaultsFromMap");let Cs=Es=class extends N.a{constructor(){super(...arguments),this._handles=new Ee.a,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=Es.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add(Object(me.b)(this.view,"map."+t,"change",e,e,e,!0));this._handles.add(Object(me.e)(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let i;for(let r=0;r<t.length&&(i=this.get(t.slice(0,r+1).join(".")),i);r++)if(i.load&&!i.isFulfilled())return{collectionName:e,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:e,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,i=!1;const r=e.catch((()=>{})).then((()=>{t?i=!0:r===this._waitTask&&this._update()}));return t=!1,i||(this._waitTask=r),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections((e=>this._processSpatialReferenceSource(e)));if(this._debugLog(`Search ended with status '${Ps(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${Ls(e)})`)):(this.defaultSpatialReference&&t.length>1&&t.findIndex((e=>e.equals(this.defaultSpatialReference)))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog("Locking to "+Ls(e))),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((t=>this._findExtent(t,e))),this.logDebugInformation=t,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections((e=>this._processHeightModelInfoSource(e)),(e=>function(e){return null!=e.layers||xs(e)||Ms(e)||Ss(e)}(e)));this._debugLog("Search ended with status "+Ps(e)),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let i=2;return this._forAllMapCollectionSources((e=>{if(2!==i)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading)&&(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),i=0,1))}),(r=>!(2!==i||(null==t||t(r)?!r.load||r.isFulfilled()||this._updateWhen(r.load())?(!r.load||r.isResolved())&&e(r)&&(i=1,1):(this._debugLog(`Source ${r.id} is loading -> wait`),i=0,1):(this._debugLog(`Source ${r.id} is skipped due to predicate`),1))))),i}_preloadMapCollections(e){let t=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(r=>0!==t&&!(null!=e&&!e(r)||(r.load&&!r.isFulfilled()&&(this.logDebugInformation=i,this._debugLog("Pre-loading source "+r.id),this.logDebugInformation=!1,r.load().catch((()=>{})),t--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(e,t){for(const i of this.mapCollectionPaths){const r="map."+i,s=this._ensureLoadedOwnersFromCollectionName(r);if(!1===e(s))continue;const a=s.owner;if(!a||a.isRejected&&a.isRejected()){this._debugLog(`Collection ${r} owner is invalid or rejected -> skip`);continue}const n=this.view.get(r);n?this._forEachSource(n,t):this._debugLog(`Collection ${r} does not exist -> skip`)}}_forEachSource(e,t){for(const i of e.items)!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=Object(ws.e)(t,this._spatialReferenceCandidates,((e,t)=>e.equals(t))),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const i="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),r=i.find((e=>e.spatialReference.equals(t)));if(r)return this._set("extent",r),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=i.map((t=>({extent:t,layer:e}))),r=this._extentCandidates||[];this._extentCandidates=r.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=this._extentCandidates.find((t=>Object(Mr.a)(t.extent.spatialReference,e)));if(t)this._set("extent",Object(Mr.d)(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=Object(y.d)();const r=await i.e(155).then(i.bind(null,663));try{const i=await r.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",i)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const i=t.filter((t=>this.view.isSpatialReferenceSupported(t,e,(e=>this._debugLog(e)))));return 0===i.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${i.map(Ls).join(", ")}`),i}_processHeightModelInfoSource(e){const t=Is(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,i=e.get("layers.0");let r=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");r="tileInfo"in e&&e.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}r&&!r.spatialReference.equals(this.spatialReference)&&(r=null),this._debugLog("updateTileInfo: setting "+r),this._set("tileInfo",r),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&Fs.info(e)}};function Ls(e){return e?JSON.stringify(e.toJSON()):"undefined"}function Ps(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}Cs.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Object(s.a)([Object(c.b)()],Cs.prototype,"logDebugInformation",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"isSpatialReferenceDone",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"isTileInfoDone",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"isHeightModelInfoSearching",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],Cs.prototype,"view",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"spatialReference",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"extent",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"heightModelInfo",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"vcsWkid",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"latestVcsWkid",void 0),Object(s.a)([Object(c.b)()],Cs.prototype,"mapCollectionPaths",void 0),Object(s.a)([Object(c.b)()],Cs.prototype,"defaultSpatialReference",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Cs.prototype,"tileInfo",void 0),Cs=Es=Object(s.a)([Object(u.a)("esri.views.support.DefaultsFromMap")],Cs);var As,ks=Cs;const Rs=o.a.getLogger("esri.views.View");let Ns=As=class extends(Object(L.b)(G.a.EventedMixin(Object(z.b)(N.a)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new W.a({root:this,rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:e=>e.layerViews}),this.animation=null,this.basemapView=null,this.defaultsFromMap=new ks({view:this}),this.fatalError=null,this.extent=null,this.graphics=new ve.a,this.navigating=!1,this.layerViews=new q.a,this.magnifier=new Te,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new ms,this.navigation=new js,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Xe(this),this.persistableViewModels=new q.a,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(e=>{e?(this._currentSpatialReference=this.spatialReference,As.views.add(this)):(this._currentSpatialReference=null,As.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let e;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,Object(me.i)(this,"ready"))))),this.basemapView=new Oe({view:this}),this.layerViewManager=new Me({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.refreshManager=new Le({view:this}),this.toolViewManager=new os({view:this}),this.analysisManager=new cs({viewFactory:e=>this.createAnalysisView(e),controllerFactory:e=>this.createAnalysisController(e)}),this._resetInitialViewPropertiesFromContent(),Object(me.a)(this.defaultsFromMap,"isSpatialReferenceDone",(t=>{const i=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&i||!e){if(t&&!this.spatialReference&&i&&!e){const t=e=Object(y.a)(this.spatialReferenceWarningDelay);e.then((()=>{t===e&&Rs.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else e=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Rs.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!H.a.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&(Rs.warn("#map","The provided map is already destroyed",{map:e}),e=null),H.a.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return Object(n.h)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getAnalysisView(e){return this.analysisManager.getAnalysisView(e)}whenAnalysisView(e){return this.analysisManager.whenAnalysisView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new h.a("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async createAnalysisView(e){throw new h.a("createAnalysisView() not implemented")}async createAnalysisController(e){throw new h.a("createAnalysisController() not implemented")}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,i){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&Rs.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,Object(me.g)(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}createTool(e,t,i){return this.toolViewManager.createTool(e,t,i)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Object(me.d)(this,"spatialReference",((t,i)=>{Object(U.c)(t,i)||e()})),Object(me.d)(this,"initialExtentRequired",e),Object(V.b)(e)],"defaultsFromMap")}};Ns.views=new q.a,Object(s.a)([Object(D.a)("toolViewManager.activeTool")],Ns.prototype,"activeTool",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"allLayerViews",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"animation",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"basemapView",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"defaultsFromMap",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"fatalError",void 0),Object(s.a)([Object(c.b)({type:f.a})],Ns.prototype,"extent",void 0),Object(s.a)([Object(c.b)(Object(ve.b)())],Ns.prototype,"graphics",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:ge.a,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],Ns.prototype,"heightModelInfo",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"interacting",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"navigating",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],Ns.prototype,"preconditionsReady",null),Object(s.a)([Object(c.b)({type:q.a,readOnly:!0})],Ns.prototype,"layerViews",void 0),Object(s.a)([Object(c.b)({type:Te})],Ns.prototype,"magnifier",void 0),Object(s.a)([Object(c.b)({value:null,type:fe})],Ns.prototype,"map",null),Object(s.a)([Object(c.b)()],Ns.prototype,"padding",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"ready",void 0),Object(s.a)([Object(c.b)({type:B.a})],Ns.prototype,"spatialReference",null),Object(s.a)([Object(c.b)()],Ns.prototype,"spatialReferenceWarningDelay",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"stationary",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"supportsGround",void 0),Object(s.a)([Object(c.b)({type:O.a})],Ns.prototype,"timeExtent",void 0),Object(s.a)([Object(D.a)("toolViewManager.tools")],Ns.prototype,"tools",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"toolViewManager",void 0),Object(s.a)([Object(D.a)("analysisManager.analyses")],Ns.prototype,"analyses",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"analysisManager",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"type",void 0),Object(s.a)([Object(c.b)({type:Number})],Ns.prototype,"scale",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"updating",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"initialExtentRequired",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:f.a})],Ns.prototype,"initialExtent",null),Object(s.a)([Object(c.b)()],Ns.prototype,"cursor",null),Object(s.a)([Object(c.b)()],Ns.prototype,"renderContext",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"input",void 0),Object(s.a)([Object(c.b)({type:js,nonNullable:!0})],Ns.prototype,"navigation",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"layerViewManager",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"width",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"height",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"resizing",void 0),Object(s.a)([Object(c.b)({value:null,readOnly:!0})],Ns.prototype,"size",null),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"suspended",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"viewEvents",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Ns.prototype,"persistableViewModels",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"_isValid",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"_readyCycleForced",void 0),Object(s.a)([Object(c.b)()],Ns.prototype,"_currentSpatialReference",void 0),Ns=As=Object(s.a)([Object(u.a)("esri.views.View")],Ns);var Ds=Ns;const Vs={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let Us=class extends(Object(L.b)(N.a)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Object(k.a)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(Vs[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,t)=>(e[t.id]=t.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange("scale"))}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}set version(e){this._set("version",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const r=this.scale,s=0===r,a=0===t.minScale||r<=t.minScale,n=0===t.maxScale||r>=t.maxScale;t.visible&&(s||a&&n)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some(((t,i)=>e[i]!==t))?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};Object(s.a)([Object(c.b)({readOnly:!0})],Us.prototype,"dynamicLayers",null),Object(s.a)([Object(c.b)({readOnly:!0})],Us.prototype,"hasDynamicLayers",null),Object(s.a)([Object(c.b)()],Us.prototype,"layer",null),Object(s.a)([Object(c.b)({readOnly:!0})],Us.prototype,"layers",null),Object(s.a)([Object(c.b)({readOnly:!0})],Us.prototype,"layerDefs",null),Object(s.a)([Object(c.b)({type:Number})],Us.prototype,"scale",null),Object(s.a)([Object(c.b)(w.a)],Us.prototype,"timeExtent",void 0),Object(s.a)([Object(c.b)()],Us.prototype,"version",null),Object(s.a)([Object(c.b)({type:Ds})],Us.prototype,"view",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Us.prototype,"visibleSublayers",null),Us=Object(s.a)([Object(u.a)("esri.layers.mixins.ExportImageParameters")],Us);let Bs=class extends(Object(M.a)(Object(C.a)(Object(F.a)(Object(E.a)(Object(R.a)(Object(P.a)(Object(S.a)(Object(_.a)(Object(T.a)(Object(j.a)(Object(x.a)(Object(L.b)(v.a))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType="ArcGISMapServiceLayer",this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(n.h)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),Promise.resolve(this)}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.indexOf("PNG32")>-1?"png32":"png24"}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const s=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let a=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=Object(b.d)(r.origin);if(3===e){const e=this.createSublayersForOrigin("service").sublayers;a=Object(k.c)(s,e,2)}else if(e>3){const e=this.createSublayersForOrigin("portal-item");a=Object(k.c)(s,e.sublayers,Object(b.d)(e.origin))}}const n=[],o={writeSublayerStructure:a,...r};let l=a;s.forEach((e=>{const t=e.write({},o);n.push(t),l=l||"user"===e.originOf("visible")})),n.some((e=>Object.keys(e).length>1))&&(t.layers=n),l&&(t.visibleLayers=s.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,t,i,r){const s=r&&r.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const a=new Us({layer:this,scale:Object(I.a)({extent:e,width:t})*s}),n=a.toJSON();a.destroy();const o=!r||!r.rotation||this.version<10.3?{}:{rotation:-r.rotation},l=e&&e.spatialReference,c=l.wkid||JSON.stringify(l.toJSON());n.dpi*=s;const d={};if(null!=r&&r.timeExtent){const{start:e,end:t}=r.timeExtent.toJSON();d.time=e&&t&&e===t?""+e:`${null==e?"null":e},${null==t?"null":t}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:c,imageSR:c,size:t+","+i,...n,...o,...d}}async fetchImage(e,t,i,r){const s={responseType:"image"};r&&r.timestamp&&(s.query={...s.query,_ts:r.timestamp}),r&&r.signal&&(s.signal=r.signal),this.customParameters&&Object.keys(this.customParameters).length&&(s.query={...this.customParameters,...s.query});const a=this.parsedUrl.path+"/export",n={...this.parsedUrl.query,...this.createExportImageParameters(e,t,i,r),f:"image",_ts:this.alwaysRefetch?Date.now():null};return null==n.dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers?(s.query?s.query={...n,...s.query}:s.query=n,Object(m.default)(a,s).then((e=>e.data)).catch((e=>{if(Object(y.l)(e))throw e;throw new h.a("mapimagelayer:image-fetch-error","Unable to load image: "+a,{error:e})}))):Promise.reject(new h.a("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:n}))}async fetchRecomputedExtents(e={}){const t={...e,query:{returnUpdates:!0,f:"json"}},{data:i}=await Object(m.default)(this.url,t),{extent:r,fullExtent:s,timeExtent:a}=i,n=r||s;return{fullExtent:n&&f.a.fromJSON(n),timeExtent:a&&O.a.fromJSON({start:a[0],end:a[1]})}}loadAll(){return Object(g.a)(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:t,ssl:i}=await Object(m.default)(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},signal:e});i&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})}};Object(s.a)([Object(c.b)()],Bs.prototype,"alwaysRefetch",void 0),Object(s.a)([Object(c.b)()],Bs.prototype,"dpi",void 0),Object(s.a)([Object(c.b)()],Bs.prototype,"gdbVersion",void 0),Object(s.a)([Object(c.b)({json:{read:!1,write:!1}})],Bs.prototype,"popupEnabled",void 0),Object(s.a)([Object(c.b)()],Bs.prototype,"imageFormat",void 0),Object(s.a)([Object(d.a)("imageFormat",["supportedImageFormatTypes"])],Bs.prototype,"readImageFormat",null),Object(s.a)([Object(c.b)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],Bs.prototype,"imageMaxHeight",void 0),Object(s.a)([Object(c.b)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],Bs.prototype,"imageMaxWidth",void 0),Object(s.a)([Object(c.b)()],Bs.prototype,"imageTransparency",void 0),Object(s.a)([Object(c.b)({json:{read:!1,write:!1}})],Bs.prototype,"labelsVisible",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Bs.prototype,"isReference",void 0),Object(s.a)([Object(c.b)({type:["ArcGISMapServiceLayer"]})],Bs.prototype,"operationalLayerType",void 0),Object(s.a)([Object(c.b)()],Bs.prototype,"sourceJSON",void 0),Object(s.a)([Object(c.b)({json:{write:{ignoreOrigin:!0}}})],Bs.prototype,"sublayers",void 0),Object(s.a)([Object(p.a)("sublayers",{layers:{type:[A.a]},visibleLayers:{type:[l.a]}})],Bs.prototype,"writeSublayers",null),Object(s.a)([Object(c.b)({type:["show","hide","hide-children"]})],Bs.prototype,"listMode",void 0),Object(s.a)([Object(c.b)({json:{read:!1},readOnly:!0,value:"map-image"})],Bs.prototype,"type",void 0),Object(s.a)([Object(c.b)(w.k)],Bs.prototype,"url",void 0),Bs=Object(s.a)([Object(u.a)("esri.layers.MapImageLayer")],Bs);var Gs=Bs;t.default=Gs},346:function(e,t,i){"use strict";var r=i(0);t.a=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(Object(r.c)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},358:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i(4),i(0);var r=i(153),s=i(219),a=i(225),n=i(253),o=i(177);a.a.fromJSON(o.a),r.a.fromJSON(o.c),s.a.fromJSON(o.b);const l=n.a.fromJSON(o.d),c=a.a.fromJSON(o.e),d=r.a.fromJSON(o.g),u=s.a.fromJSON(o.f)},365:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(69);function s(e,t){const i=t||e.extent,s=e.width,a=Object(r.c)(i&&i.spatialReference);return i&&s?i.width/s*a*r.g*96:0}},366:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(14),s=(i(4),i(2),i(5),i(15)),a=i(54),n=i(18),o=i(25),l=(i(35),i(36),i(3)),c=i(57),d=i(60),u=i(58),p=i(70);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=null}readCapabilities(e,t){const i=t.capabilities&&t.capabilities.split(",").map((e=>e.toLowerCase().trim()));if(!i)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const r=this.type,s=-1!==i.indexOf("query"),a=-1!==i.indexOf("map"),n=!!t.exportTilesAllowed,o=-1!==i.indexOf("tilemap"),l="tile"!==r&&!!t.supportsDynamicLayers,c="tile"!==r&&(!t.tileInfo||l),d="tile"!==r&&(!t.tileInfo||l);return{operations:{supportsQuery:s,supportsExportMap:a,supportsExportTiles:n,supportsTileMap:o},exportMap:a?{supportsSublayersChanges:"tile"!==r,supportsDynamicLayers:l,supportsSublayerVisibility:c,supportsSublayerDefinitionExpression:d}:null,exportTiles:n?{maxExportTilesCount:+t.maxExportTilesCount}:null}}readVersion(e,t){let i=t.currentVersion;return i||(i=t.hasOwnProperty("capabilities")||t.hasOwnProperty("tables")?10:t.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),i}async fetchSublayerInfo(e,t){return await this.fetchAllLayersAndTables(t),this._allLayersAndTablesMap.get(e)}async fetchAllLayersAndTables(e){await this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=Object(u.default)(Object(o.I)(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const t of e.data.layers)this._allLayersAndTablesMap.set(t.id,t);return{result:e.data}}),(e=>({error:e}))));const t=await this._allLayersAndTablesPromise;if(Object(l.t)(e),"result"in t)return t.result;throw t.error}};return Object(r.a)([Object(s.b)({readOnly:!0})],t.prototype,"capabilities",void 0),Object(r.a)([Object(a.a)("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),Object(r.a)([Object(s.b)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(r.a)([Object(s.b)({type:d.a})],t.prototype,"fullExtent",void 0),Object(r.a)([Object(s.b)({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0),Object(r.a)([Object(s.b)({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),Object(r.a)([Object(s.b)(p.g)],t.prototype,"popupEnabled",void 0),Object(r.a)([Object(s.b)({type:c.a})],t.prototype,"spatialReference",void 0),Object(r.a)([Object(s.b)()],t.prototype,"version",void 0),Object(r.a)([Object(a.a)("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=Object(r.a)([Object(n.a)("esri.layers.mixins.ArcGISMapService")],t),t}},367:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(14),s=(i(4),i(2)),a=(i(5),i(7)),n=i(15),o=i(18),l=i(16),c=(i(25),i(35),i(26)),d=(i(36),i(61)),u=i(204),p=i(293),h=i(276);const b=s.a.getLogger("esri.layers.TileLayer"),y=d.a.ofType(p.a),f=e=>{let t=class extends e{constructor(...e){super(...e),this.allSublayers=new u.a({root:this,rootCollectionNames:["sublayers"],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{}},this.watch("sublayers",((e,t)=>this._handleSublayersChange(e,t)),!0)}readSublayers(e,t){if(!t||!e)return;const{sublayersSourceJSON:i}=this,r=Object(c.d)(t.origin);if(r<2)return;if(i[r]={context:t,visibleLayers:e.visibleLayers||i[r].visibleLayers,layers:e.layers||i[r].layers},r>2)return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:s,origin:n}=this.createSublayersForOrigin("web-document"),o=Object(a.a)(this);o.setDefaultOrigin(n),this._set("sublayers",new y(s)),o.setDefaultOrigin("user")}findSublayerById(e){return this.allSublayers.find((t=>t.id===e))}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(e){const t=Object(c.d)("web-document"===e?"web-map":e);let i=2,r=this.sublayersSourceJSON[2].layers,s=this.sublayersSourceJSON[2].context,a=null;const n=[3,4,5].filter((e=>e<=t));for(const e of n){const t=this.sublayersSourceJSON[e];Object(h.b)(t.layers)&&(i=e,r=t.layers,s=t.context,t.visibleLayers&&(a={visibleLayers:t.visibleLayers,context:t.context}))}const o=[3,4,5].filter((e=>e>i&&e<=t));let l=null;for(const e of o){const{layers:t,visibleLayers:i,context:r}=this.sublayersSourceJSON[e];t&&(l={layers:t,context:r}),i&&(a={visibleLayers:i,context:r})}const d=function(e,t){const i=[],r={};return e?(e.forEach((e=>{const s=new p.a;if(s.read(e,t),r[s.id]=s,null!=e.parentLayerId&&-1!==e.parentLayerId){const t=r[e.parentLayerId];t.sublayers||(t.sublayers=[]),t.sublayers.unshift(s)}else i.unshift(s)})),i):i}(r,s),u=new Map,b=new Set;if(l)for(const e of l.layers)u.set(e.id,e);if(a)for(const e of a.visibleLayers)b.add(e);return function e(t,i){t&&t.forEach((t=>{i(t),t.sublayers&&t.sublayers.length&&e(t.sublayers,i)}))}(d,(e=>{l&&e.read(u.get(e.id),l.context),a&&e.read({defaultVisibility:b.has(e.id)},a.context)})),{origin:Object(c.b)(i),sublayers:new y({items:d})}}read(e,t){super.read(e,t),this.readSublayers(e,t)}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null,e.layer=null})),this.handles.remove("sublayers-owner")),e&&(e.forEach((e=>{e.parent=this,e.layer=this})),this.handles.add([e.on("after-add",(({item:e})=>{e.parent=this,e.layer=this})),e.on("after-remove",(({item:e})=>{e.parent=null,e.layer=null}))],"sublayers-owner"),"tile"===this.type&&this.handles.add(e.on("before-changes",(e=>{b.error(new l.a("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),e.preventDefault()})),"sublayers-owner"))}};return Object(r.a)([Object(n.b)({readOnly:!0})],t.prototype,"allSublayers",void 0),Object(r.a)([Object(n.b)({readOnly:!0,type:d.a.ofType(p.a)})],t.prototype,"serviceSublayers",void 0),Object(r.a)([Object(n.b)({value:null,type:y,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),Object(r.a)([Object(n.b)({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),t=Object(r.a)([Object(o.a)("esri.layers.mixins.SublayersOwner")],t),t}},368:function(e,t,i){"use strict";i.d(t,"b",(function(){return p}));var r=i(14),s=(i(4),i(2)),a=(i(5),i(15)),n=i(18),o=(i(25),i(35),i(36),i(61)),l=i(178),c=i(65);const d=o.a.ofType(c.a);s.a.getLogger("esri.support.GraphicsCollection");let u=class extends d{constructor(e){super(e),this.on("before-add",(e=>{e.item||e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(({item:e})=>{e.layer=null}))}destroy(){this._unownAll()}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())}_createNewInstance(e){return new d(e)}_ownAll(){this.items.forEach((e=>this._own(e)))}_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_unownAll(){this.items.forEach((e=>this._unown(e)))}_unown(e){e.layer===this.owner&&(e.layer=null)}};Object(r.a)([Object(a.b)()],u.prototype,"owner",null),u=Object(r.a)([Object(n.a)("esri.support.GraphicsCollection")],u);const p=(e="graphics")=>({type:u,cast:l.a,set(t){const i=Object(l.b)(t,this._get(e),u);i.owner=this,this._set(e,i)}});var h=u;t.a=h},65:function(e,t,i){"use strict";var r,s=i(14),a=(i(4),i(6)),n=i(0),o=(i(2),i(5),i(15)),l=i(18),c=(i(25),i(35),i(36),i(52)),d=i(63),u=i(59),p=i(79),h=i(81),b=i(96);let y=r=class extends c.a{constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Object(b.a)(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){return this.popupTemplate?this.popupTemplate:this.sourceLayer?"popupTemplate"in this.sourceLayer&&this.sourceLayer.popupTemplate?this.sourceLayer.popupTemplate:e&&"defaultPopupTemplate"in this.sourceLayer&&Object(n.h)(this.sourceLayer.defaultPopupTemplate)?this.sourceLayer.defaultPopupTemplate:null:null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{geometry:Object(n.h)(this.geometry)?this.geometry.toJSON():null,symbol:Object(n.h)(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}clone(){return new r(this.cloneProperties())}cloneProperties(){return{attributes:Object(a.a)(this.attributes),geometry:Object(a.a)(this.geometry),layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:Object(a.a)(this.symbol),visible:this.visible}}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};"attributes"===e&&(s.attributeName=r),this.layer.graphicChanged(s)}};Object(s.a)([Object(o.b)({value:null})],y.prototype,"attributes",null),Object(s.a)([Object(o.b)({value:null,types:u.a,json:{read:d.a}})],y.prototype,"geometry",null),Object(s.a)([Object(o.b)({type:Boolean})],y.prototype,"isAggregate",void 0),Object(s.a)([Object(o.b)()],y.prototype,"layer",void 0),Object(s.a)([Object(o.b)({type:p.a})],y.prototype,"popupTemplate",void 0),Object(s.a)([Object(o.b)()],y.prototype,"sourceLayer",void 0),Object(s.a)([Object(o.b)({value:null,types:h.i})],y.prototype,"symbol",null),Object(s.a)([Object(o.b)({type:Boolean,value:!0})],y.prototype,"visible",null),y=r=Object(s.a)([Object(l.a)("esri.Graphic")],y),(y||(y={})).generateUID=b.a;var f=y;t.a=f},72:function(e,t,i){"use strict";i.r(t);var r=i(14),s=(i(4),i(0)),a=(i(2),i(5),i(15)),n=i(55),o=i(54),l=i(18),c=i(53),d=(i(25),i(35),i(36),i(52)),u=i(57),p=i(63),h=i(59),b=i(65),y=i(82);const f=new n.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let m=class extends d.a{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const i=u.a.fromJSON(t.spatialReference),r=[];for(let t=0;t<e.length;t++){const a=e[t],n=b.a.fromJSON(a),o=a.geometry&&a.geometry.spatialReference;Object(s.h)(n.geometry)&&!o&&(n.geometry.spatialReference=i),r.push(n)}return r}writeGeometryType(e,t,i,r){if(e)return void f.write(e,t,i,r);const{features:a}=this;if(a)for(const e of a)if(e&&Object(s.h)(e.geometry))return void f.write(e.geometry.type,t,i,r)}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Object(p.a)(e);return!i&&t.spatialReference&&(r.spatialReference=u.a.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i)for(const e of i)e&&Object(s.h)(e.geometry)&&e.geometry.spatialReference&&(t.spatialReference=e.geometry.spatialReference.toJSON())}toJSON(e){const t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const t=e&&e[i];r.geometry=t&&t.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,a]}=e,n=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((a-e)/i)));for(let e=0,t=n.length;e<t;e++)o(Object(s.n)(n[e].geometry))||(n.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,a],scale:[n,o]}=i,l=this._getHydrationFunction(e,(e=>e*n+r),(e=>a-e*o));for(const{geometry:e}of t)Object(s.h)(e)&&l(e);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const a=[];for(let n=0,o=e.length;n<o;n++){const o=e[n];if(n>0){const e=t(o[0]),n=i(o[1]);e===r&&n===s||(a.push([e-r,n-s]),r=e,s=n)}else r=t(o[0]),s=i(o[1]),a.push([r,s])}return a.length>0?a:null}_getQuantizationFunction(e,t,i){return"point"===e?e=>(e.x=t(e.x),e.y=i(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=Object(p.g)(e)?e.rings:e.paths,s=[];for(let e=0,a=r.length;e<a;e++){const a=r[e],n=this._quantizePoints(a,t,i);n&&s.push(n)}return s.length>0?(Object(p.g)(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,i);return r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,i){return"point"===e?e=>{e.x=t(e.x),e.y=i(e.y)}:"polyline"===e||"polygon"===e?e=>{const r=Object(p.g)(e)?e.rings:e.paths;let s,a;for(let e=0,n=r.length;e<n;e++){const n=r[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];e>0?(s+=r[0],a+=r[1]):(s=r[0],a=r[1]),r[0]=t(s),r[1]=i(a)}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=i(e.ymin),e.xmax=t(e.xmax),e.ymax=i(e.ymax)}:"multipoint"===e?e=>{const r=e.points;let s,a;for(let e=0,n=r.length;e<n;e++){const n=r[e];e>0?(s+=n[0],a+=n[1]):(s=n[0],a=n[1]),n[0]=t(s),n[1]=i(a)}}:void 0}};Object(r.a)([Object(a.b)({type:String,json:{write:!0}})],m.prototype,"displayFieldName",void 0),Object(r.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],m.prototype,"exceededTransferLimit",void 0),Object(r.a)([Object(a.b)({type:[b.a],json:{write:!0}})],m.prototype,"features",void 0),Object(r.a)([Object(o.a)("features")],m.prototype,"readFeatures",null),Object(r.a)([Object(a.b)({type:[y.a],json:{write:!0}})],m.prototype,"fields",void 0),Object(r.a)([Object(a.b)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:f.read}}})],m.prototype,"geometryType",void 0),Object(r.a)([Object(c.a)("geometryType")],m.prototype,"writeGeometryType",null),Object(r.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],m.prototype,"hasM",void 0),Object(r.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],m.prototype,"hasZ",void 0),Object(r.a)([Object(a.b)({types:h.a,json:{write:!0}})],m.prototype,"queryGeometry",void 0),Object(r.a)([Object(o.a)("queryGeometry")],m.prototype,"readQueryGeometry",null),Object(r.a)([Object(a.b)({type:u.a,json:{write:!0}})],m.prototype,"spatialReference",void 0),Object(r.a)([Object(c.a)("spatialReference")],m.prototype,"writeSpatialReference",null),Object(r.a)([Object(a.b)({json:{write:!0}})],m.prototype,"transform",void 0),m=Object(r.a)([Object(l.a)("esri.tasks.support.FeatureSet")],m),m.prototype.toJSON.isDefaultToJSON=!0,m||(m={});var g=m;t.default=g},77:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return b})),i(4);var r,s,a=i(2),n=i(42),o=i(465),l=function(e){r||function(e){if("WebkitTransition"in e.style)r="webkitTransitionEnd",s="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");r="transitionend",s="animationend"}}(e)},c=function(e,t){return void 0===t&&(t=e+"-active"),function(i){l(i);var a=!1,n=function(o){a||(a=!0,i.removeEventListener(r,n),i.removeEventListener(s,n),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(r,n),i.addEventListener(s,n),requestAnimationFrame((function(){i.classList.add(t)}))}},d=function(e,t){return void 0===t&&(t=e+"-active"),function(i,a){l(i);var n=!1,o=function(e){n||(n=!0,i.removeEventListener(r,o),i.removeEventListener(s,o),a())};i.classList.add(e),i.addEventListener(r,o),i.addEventListener(s,o),requestAnimationFrame((function(){i.classList.add(t)}))}};function u(e){const t=n.a.acquire();for(let e=0;e<arguments.length;e++){const i=arguments[e],r=typeof i;if("string"===r)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===r)for(const e in i)i[e]&&t.push(e)}const i=t.join(" ");return n.a.release(t),i}function p(){return"rtl"===document.dir}function h(e){this[e.getAttribute("data-node-ref")]=null}function b(e){this[e.getAttribute("data-node-ref")]=e}function y(e,t){return("enter"===e?c:d)(t)}a.a.getLogger("esri.widgets.support.widgetUtils");const f=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),m=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],g=new o.a({whiteList:f,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(m.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function v(){var e;return-1!==(null==(e=getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name"))?void 0:e.indexOf("dark"))}},86:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(123),s=i(69);const a={inches:Object(s.b)(1,"meters","inches"),feet:Object(s.b)(1,"meters","feet"),"us-feet":Object(s.b)(1,"meters","us-feet"),yards:Object(s.b)(1,"meters","yards"),miles:Object(s.b)(1,"meters","miles"),"nautical-miles":Object(s.b)(1,"meters","nautical-miles"),millimeters:Object(s.b)(1,"meters","millimeters"),centimeters:Object(s.b)(1,"meters","centimeters"),decimeters:Object(s.b)(1,"meters","decimeters"),meters:Object(s.b)(1,"meters","meters"),kilometers:Object(s.b)(1,"meters","kilometers"),"decimal-degrees":1/Object(s.h)(1,"meters",r.a.radius)}},91:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return m})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return b})),i.d(t,"g",(function(){return y})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return f}));var r=i(0),s=i(25),a=i(76);const n=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${n.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${n.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i");function c(e){return!!o.test(e)}function d(e){const t=Object(s.I)(e),i=t.path.match(o)||t.path.match(l);if(!i)return null;const[,r,a,n,c]=i,d=a.indexOf("/");return{title:u(-1!==d?a.slice(d+1):a),serverType:n,sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:r}}}function u(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function p(e,t){const i=[];if(e){const t=d(e);Object(r.h)(t)&&t.title&&i.push(t.title)}if(t){const e=u(t);i.push(e)}if(2===i.length){if(-1!==i[0].toLowerCase().indexOf(i[1].toLowerCase()))return i[0];if(-1!==i[1].toLowerCase().indexOf(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function h(e){if(!e)return!1;const t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),i=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&i}function b(e,t){return e?Object(s.G)(Object(s.F)(e,t)):e}function y(e,t,i){if(!t)return{url:t};t=Object(s.F)(t,i);const a=d(Object(s.I)(t).path);let n;return Object(r.h)(a)&&(null!=a.sublayer&&null==e.layerId&&(n=a.sublayer),t=a.url.path),{url:Object(s.G)(t),layerId:n}}function f(e,t,i,r,n){Object(a.f)(t,r,"url",n),r.url&&null!=e.layerId&&(r.url=Object(s.x)(r.url,i,e.layerId.toString()))}function m(e){if(!e)return!1;const t=e.toLowerCase(),i=-1!==t.indexOf("/services/"),r=-1!==t.indexOf("/mapserver/wmsserver"),s=-1!==t.indexOf("/imageserver/wmsserver"),a=-1!==t.indexOf("/wmsserver");return i&&(r||s||a)}},92:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n}));var r=i(3);function s(e,t,i){return Object(r.j)(e.map(((e,r)=>t.apply(i,[e,r]))))}function a(e,t,i){return Object(r.j)(e.map(((e,r)=>t.apply(i,[e,r])))).then((e=>e.map((e=>e.value))))}function n(e){return e.then((e=>({ok:!0,value:e}))).catch((e=>({ok:!1,error:e})))}},94:function(e,t,i){"use strict";var r=i(14),s=(i(4),i(2),i(5),i(15)),a=i(18),n=(i(25),i(35),i(36),i(52));let o=class extends n.a{constructor(){super(...arguments),this.type=null}};Object(r.a)([Object(s.b)({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(r.a)([Object(a.a)("esri.layers.support.FeatureReduction")],o);var l=o;t.a=l},95:function(e,t,i){"use strict";function r(e){}function s(e){return()=>e}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i(4)},96:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));let r=0;function s(){return++r}}});