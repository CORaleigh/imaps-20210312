(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2892],{7646:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var o,r=i(56140),a=(i(95830),i(36544),i(68055),i(79881)),s=i(87566),n=(i(10923),i(57002),i(86035),i(72206)),l=i(41241),c=i(61106),p=i(53817),h=i(89333),d=i(93533),u=i(98675);let y=o=class extends p.Z{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=(0,d.En)(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let r,a="geographic";if(o.isWebMercator?a="webMercator":(null!=n.Z[o.wkid]||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(a="projected"),this.geodesic){let o;switch(a){case"webMercator":o=(0,l.Sx)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=e}r=this._createGeodesicCircle(o,i,t),"webMercator"===a&&(r=(0,l.$)(r))}else{let o;"webMercator"===a||"projected"===a?o=i/this._convert2Meters(1,e.spatialReference):"geographic"===a&&(o=(0,d.ty)(i,"meters",(0,h.Iu)(e.spatialReference).radius)),r=this._createPlanarCircle(e,o,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:a}=this;return new o({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:a})}_createGeodesicCircle(e,t,i){let o=0;const r=[];for(;o<360;){const a=[0,0],s=[e.x,e.y];(0,u.directGeodeticSolver)(a,s,o,t),this.hasZ&&a.push(e.z),r.push(a),o+=360/i}return r.push(r[0]),new p.Z(r)}_createPlanarCircle(e,t,i){let o=0;const r=[];for(;o<2*Math.PI;){const a=[e.x+Math.cos(-o)*t,e.y+Math.sin(-o)*t];this.hasZ&&a.push(e.z),r.push(a),o+=Math.PI/(i/2)}return r.push(r[0]),new p.Z({spatialReference:e.spatialReference,rings:[r]})}_convert2Meters(e,t){let i;if(null!=n.Z[t.wkid])i=n.Z.values[n.Z[t.wkid]];else{const e=t.wkt,o=e.lastIndexOf(",")+1,r=e.lastIndexOf("]]");i=parseFloat(e.substring(o,r))}return e*i}};(0,r._)([(0,a.Cb)({type:c.Z})],y.prototype,"center",void 0),(0,r._)([(0,a.Cb)()],y.prototype,"geodesic",void 0),(0,r._)([(0,a.Cb)()],y.prototype,"numberOfPoints",void 0),(0,r._)([(0,a.Cb)()],y.prototype,"radius",void 0),(0,r._)([(0,a.Cb)()],y.prototype,"radiusUnit",void 0),y=o=(0,r._)([(0,s.j)("esri.geometry.Circle")],y);const v=y},12217:(e,t,i)=>{"use strict";i.d(t,{P:()=>a});i(95830);var o=i(59472),r=i(46970);function a(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if((0,o.Wi)(e.geometry))return 2;switch(e.geometry.type){case"polygon":case"point":case"polyline":break;case"multipoint":case"extent":case"mesh":default:return 3}return"on-the-ground"!==(0,r.vu)(e)&&(0,r.Lt)(e)?4:0}},91700:(e,t,i)=>{"use strict";i.d(t,{P:()=>s});i(95830);var o=i(59472),r=i(7646),a=i(46970);function s(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;const i=e.geometry;if((0,o.Wi)(i))return 2;switch(i.type){case"polygon":if(i instanceof r.Z)return 3;break;case"polyline":break;case"point":case"multipoint":case"extent":case"mesh":default:return 3}return"on-the-ground"!==(0,a.vu)(e)&&(0,a.Lt)(e)?4:0}},24591:(e,t,i)=>{"use strict";function o(e,t){if(!t||!e||!e.map)return;const{map:i}=e;i.layers.find((e=>e===t))||i.add(t)}i.d(t,{p:()=>o})},52892:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>We});var o=i(56140),r=(i(95830),i(36544)),a=i(79881),s=i(51894),n=i(60263),l=i(87566),c=(i(10923),i(57002),i(86035),i(28293)),p=i(61398),h=(i(89771),i(40450)),d=i(9200),u=i(30818),y=i(19401),v=i(90806),m=i(59472),g=(i(68055),i(32656)),_=i(61106),f=i(92232),w=(i(36348),i(35470)),G=i(96071),b=i(48142),C=i(5674),S=i(88083),T=i(54734),x=i(15988),E=i(59691),k=i(89333),O=i(50285),I=i(80621),A=i(94394),M=i(69948),P=i(83500),L=i(2887),R=i(9434),H=i(14425),D=i(70573);function U(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""}var F=i(12217),Z=i(91700),W=i(46970);let K=null;async function V(){return K||(K=await Promise.all([i.e(5798),i.e(8016)]).then(i.bind(i,48016))),K}var B=i(24591),j=i(94588);let z=class extends w.Z.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw":case"draw-3d":return null;default:(0,j.Bg)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this.reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,o._)([(0,a.Cb)()],z.prototype,"activeComponent",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"cancelled",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"history",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"tool",null),(0,o._)([(0,a.Cb)()],z.prototype,"type",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"canUndo",null),(0,o._)([(0,a.Cb)()],z.prototype,"canRedo",null),(0,o._)([(0,a.Cb)()],z.prototype,"onEnd",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"undo",null),(0,o._)([(0,a.Cb)()],z.prototype,"redo",null),(0,o._)([(0,a.Cb)()],z.prototype,"toggleTool",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"addToSelection",void 0),(0,o._)([(0,a.Cb)()],z.prototype,"removeFromSelection",void 0),z=(0,o._)([(0,l.j)("esri.widgets.Sketch.support.OperationHandle")],z);const q="esri.widgets.Sketch.SketchViewModel",N=r.Z.getLogger(q),$={redoKey:"r",undoKey:"z",centerKey:"Alt",constraintKey:"Control",snappingKey:"Control",cancelKey:"Escape",deleteKeys:["Backspace","Delete"],complete:"c",pan:" "},J={defaultZ:0},Q={enableMidpoints:!0,enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,tool:"transform",enableZ:!0,enableMoveGraphic:!0};let Y=class extends w.Z.EventedAccessor{constructor(e){super(e),this._activeFillGraphic=null,this._activeLineGraphic=null,this._centerIndicatorGraphic=null,this._centerSymbol=new S.Z({style:"cross",size:6,color:[255,255,255]}),this._defaultSegmentOffset=48,this._numUpdating=0,this._handles=new E.Z,this._internalGraphicsLayer=new A.default({listMode:"hide"}),this._lineGraphic=null,this._operationHandle=null,this._vertexGraphics=[],this._viewHandles=new E.Z,this._doUnnormalization=!1,this.activeFillSymbol=new C.default({style:"solid",color:[150,150,150,.2],outline:{color:[50,50,50],width:0}}),this.activeLineSymbol=new b.Z({color:[255,127,0,1],width:2}),this.activeVertexSymbol=new S.Z({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}}),this.layer=null,this.pointSymbol=new S.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new C.default({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new b.Z({color:[130,130,130,1],width:2}),this.updateGraphics=new c.Z,this.updateOnGraphicClick=!0,this.updatePointSymbol=new S.Z({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new C.default({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new b.Z({color:[12,207,255],width:2}),this.vertexSymbol=new S.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.snappingOptions=new R.g,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=J,this.defaultUpdateOptions=Q}initialize(){this._handles.add([(0,I.watch)(this,"layer",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=(0,m.pC)(this.layer)?this.layer.elevationInfo:null})),(0,I.on)(this,"view.map.layers","change",(e=>{e.removed.indexOf(this.layer)>=0&&this.cancel()})),(0,I.on)(this,"layer.graphics","change",(e=>{if((0,m.pC)(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,I.init)(this,"layer.elevationInfo",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=(0,m.pC)(this.layer)?this.layer.elevationInfo:null}),!0)])}destroy(){this.cancel(),this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null,this._removeDefaultLayer(),this._draw&&this._draw.destroy(),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get _draw(){return"ready"===this.state||"active"===this.state?new D.Z({view:this.view}):null}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return this.view&&"3d"===this.view.type&&(0,m.pC)(this.activeComponent)&&"draw-3d"===this.activeComponent.type?(0,m.Wg)(this.activeComponent.createGraphic):this._get("createGraphic")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...J,...e})}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Q,...e})}get state(){var e;const t=!(null==(e=this.view)||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}this._doUnnormalization=null!=e&&"3d"===e.type&&"global"===e.viewingMode;const i="view-ready";this._handles.remove(i),e&&this._handles.add((0,I.when)(e,"ready",(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))}),!0),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController&&(this._moduleLoaderAbortController.abort(),this._moduleLoaderAbortController=null),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}async create(e,t){if("disabled"===this.state)return this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),void(this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."));if(this.cancel(),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");const i=await this._setupCreateOperation(e,t);if((0,m.Wi)(i)||this.destroyed)return;(0,B.p)(this.view,this._internalGraphicsLayer);i.on("complete",(()=>{if(i===this._operationHandle){const t=this.createGraphic,o=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:o?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=i,this.view.ready&&(0,P.t)(this.view)&&this.view.focus()}async update(e,t){const{layer:i,state:o,view:r}=this;if("disabled"===o)return i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),void(r||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."));this.cancel();const a=Array.isArray(e)?e:[e];if(null==e||!a||!a.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(a.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):(0,m.Wi)(e.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===r.type&&!r.spatialReference.equals(e.geometry.spatialReference)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0))))return;const s=await this._setupUpdateOperation(a,t);this.destroyed||(0,m.Wi)(s)||oe(s)||((0,B.p)(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:a,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const r=await this.view.hitTest(e);if(r.results.length>0){const e=r.results[0];if(e.graphic){var i,o;const r=e.graphic;"vector-tile"!==(null==(i=r.layer)?void 0:i.type)&&"imagery"!==(null==(o=r.layer)?void 0:o.type)&&t.push(e)}}}break;case"3d":{const i=[this.view.map.ground];this.view.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&i.push(e)}));const o=await this.view.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];(!o.ground.mapPoint||this.view.map.ground.opacity<1||o.ground.distance-e.distance>-Math.min(3*o.ground.distance,"global"===this.view.viewingMode?(0,k.Iu)(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(e)}}}return{screenPoint:e,results:t}}_generateViewHandles(e){return[e.on("immediate-click",(t=>{const{_operationHandle:i,defaultUpdateOptions:o,layer:r,state:a,updateGraphics:s,updateOnGraphicClick:n}=this,l="active"===a&&"create"===i.type;"disabled"!==a&&!l&&n&&(this._beginAsyncOperation(),this._getFirstHit((0,L.vT)(t)).then((i=>{const o=i.results;if(o.length)for(let i=0;i<o.length;++i){const n=o[i];if(n.graphic){const i=n.graphic;if(s.indexOf(i)>-1||i.layer===r)return t.stopPropagation(),i;"2d"!==e.type||this._isComponentGraphic(i)||"active"!==a||this.cancel()}}else"active"===a&&this.cancel();return null})).then((e=>(0,m.pC)(e)&&-1===s.indexOf(e)?this.update([e],{...o}):null)).then((()=>{this._endAsyncOperation()})))}),M.f.WIDGET)]}async _setupCreateOperation(e,t){if(!e)return null;const i={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t};let o;if("2d"===this.view.type)switch(e){case"point":o=this._setupCreatePointOperation(e,i);break;case"multipoint":o=await this._setupCreateMultipointOperation(e,null);break;case"polygon":case"polyline":o=await this._setupCreatePolyOperation(e,i);break;case"rectangle":o=await this._setupCreateRectangleOperation(e,i);break;case"circle":o=await this._setupCreateCircleOperation(e,i)}else{const t=await this._setupCreate3DOperation(e,this.view,i);if((0,m.Wi)(t)||oe(t))return null;o=t}return o}async _setupCreate3DOperation(e,t,o){if("multipoint"===e)return null;const r={point:this.pointSymbol,multipoint:null,polyline:this.polylineSymbol,polygon:this.polygonSymbol,rectangle:this.polygonSymbol,circle:this.polygonSymbol}[e];this._removeCreateOperationGraphics();const a="rectangle"!==e,s="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const n={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...o,elevationInfo:this.layer.elevationInfo,geometryType:e,createGraphicSymbol:r,snapToScene:!(0,m.pC)(this.layer.elevationInfo)||"absolute-height"===this.layer.elevationInfo.mode,snappingOptions:this.snappingOptions,forceUniformSize:s,centered:a},l=await this._requireModule(Promise.all([i.e(356),i.e(6563),i.e(5798),i.e(530),i.e(6562),i.e(5991),i.e(2457),i.e(7905)]).then(i.bind(i,27905)));if(oe(l))return l;if(this.destroyed)return null;const c=new l.module.DrawGraphicTool(n);this.view.tools.add(c);let p=null;this.view.activeTool=c;const h=[],d=new z({activeComponent:c,tool:e,type:"update",onEnd:()=>{var e;h.forEach((e=>e.remove())),h.length=0,null==(e=this.view.tools)||e.remove(c),c.destroy()},undo:()=>{c.canUndo&&c.undo()},redo:()=>{c.canRedo&&c.redo()},canUndo:()=>c.canUndo,canRedo:()=>c.canRedo});return h.push(this.view.on("key-down",(t=>{t.key===$.pan?(t.stopPropagation(),t.repeat||(c.enabled=!1)):t.key===$.complete?(t.stopPropagation(),c.completeCreateOperation()):t.key===$.undoKey?(t.stopPropagation(),d.undo()):t.key===$.redoKey?(t.stopPropagation(),d.redo()):t.key!==$.snappingKey||"rectangle"===e||"circle"===e||t.repeat?t.key!==$.constraintKey||"rectangle"!==e&&"circle"!==e||t.repeat?t.key===$.centerKey&&(t.repeat||(c.centered=!a,t.stopPropagation())):(c.forceUniformSize=!s,t.stopPropagation()):(c.snappingOptions.enabledToggled=!0,t.stopPropagation())}),M.f.WIDGET),this.view.on("key-up",(t=>{t.key===$.pan?c.enabled=!0:t.key===$.snappingKey&&"rectangle"!==e&&"circle"!==e?(c.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==$.constraintKey||"rectangle"!==e&&"circle"!==e?t.key===$.centerKey&&(c.centered=a,t.stopPropagation()):(c.forceUniformSize=s,t.stopPropagation())}),M.f.WIDGET),c.on("vertex-add",(t=>{switch(p=(0,m.Wi)(p)?"start":"active",t.operation){case"apply":this.emit("create",{graphic:(0,m.Wg)(c.createGraphic),state:p,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,m.Wg)(c.createGraphic)],tool:e});break;case"redo":this._emitRedoEvent({graphics:[(0,m.Wg)(c.createGraphic)],tool:e})}})),c.on("cursor-update",(e=>{c.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:(0,m.Wg)(c.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:e.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),c.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:(0,m.Wg)(c.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,m.Wg)(c.createGraphic)],tool:e});break;case"redo":this._emitRedoEvent({graphics:[(0,m.Wg)(c.createGraphic)],tool:e})}})),c.on("complete",(e=>{this._removeCreateOperationGraphics(),this._set("createGraphic",(0,m.Wg)(e.graphic)),p="complete",e.aborted?d&&d.cancel():d&&d.complete()}))),d}_setupCreatePointOperation(e,t){const i={elevationInfo:this.layer.elevationInfo,hasZ:t.hasZ,defaultZ:t.defaultZ,interactiveUndoDisabled:!0},o=this._draw.create(e,i),r=[o.on("cursor-update",(e=>{(0,m.pC)(e.vertexIndex)?this._displayCrosshairCursor():this._displayDefaultCursor()})),o.on("draw-complete",(e=>{const t=this.createPointFromVertex(e.vertices[0]),i=new x.default(t,this.pointSymbol);this._set("createGraphic",i),s&&s.complete()}))],a=[this.view.on("key-down",(e=>{e.key===$.cancelKey&&(s&&s.cancel(),e.stopPropagation())}),M.f.WIDGET)],s=this._operationHandleForCreateAction(o,[...r,...a],e);return s}async _setupCreateMultipointOperation(e,t){const i=await V(),o={...t,undoDisabled:!0},r=this._draw.create(e,o);let a=null;const s=[],n=this._operationHandleForCreateAction(r,s,e);return s.push(r.on("vertex-add",(t=>{const{type:o,vertexIndex:r,vertices:s}=t,n=s[r];a=t,this._drawMultipointGraphic(i,s,!0),this.emit("create",{graphic:this.createGraphic,state:1===s.length?"start":"active",tool:e,toolEventInfo:{added:n,vertices:[{coordinates:n,componentIndex:0,vertexIndex:r}],type:o},type:"create"})})),r.on("vertex-remove",(t=>{const{type:o,vertexIndex:r,vertices:s}=t,n=s[r];a=t,this._drawMultipointGraphic(i,s,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:n,vertices:[{coordinates:n,componentIndex:0,vertexIndex:r}],type:o},type:"create"})})),r.on("vertex-update",(t=>{const{type:o,vertexIndex:r,vertices:s}=t,n=s[r];a=t,this._drawMultipointGraphic(i,s,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:o,updated:n,vertices:[{coordinates:n,componentIndex:0,vertexIndex:r}]},type:"create"})})),r.on("cursor-update",(e=>{a=e})),r.on("draw-complete",(e=>{const t=e.vertices.slice(0),o=i.createMultipoint(t,this.view.spatialReference);o&&this.createGraphic&&(this.createGraphic.geometry=o),n&&n.complete()})),r.on("undo",(e=>{const t=e.vertices,o=a&&"cursor-update"!==a.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,o)})),r.on("redo",(e=>{const t=e.vertices,o=a&&"cursor-update"!==a.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,o)}))),s.push(this.view.on("pointer-move",(()=>this._displayCrosshairCursor()),M.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(n,e)),M.f.WIDGET)),n}async _setupCreatePolyOperation(e,t){const i=await V(),o={...t,elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0};let r=null;("polyline"===e||"polygon"===e)&&(r=this._draw.create(e,o));let a=new _.Z,s=null,n=!1;const l=[r.on("vertex-add",(t=>{const{type:o,vertexIndex:r,vertices:a}=t,l=a[r];this._snap(e,a,n),s=t,this._drawVertexGraphics(i,e,a,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:1===a.length?"start":"active",tool:e,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:r}],type:o},type:"create"})})),r.on("vertex-remove",(t=>{const{type:o,vertexIndex:r,vertices:a}=t,l=a[r];this._snap(e,a,n),s=t,this._drawVertexGraphics(i,e,a,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:r}],type:o},type:"create"})})),r.on("vertex-update",(t=>{const{type:o,vertexIndex:r,vertices:a}=t,l=a[r];this._snap(e,a,n),s=t,this._drawVertexGraphics(i,e,a,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:o,updated:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:r}]},type:"create"})})),r.on("cursor-update",(t=>{const{type:o,vertices:r}=t;if(t.mapPoint&&(this._snap(e,r,n),s=t,a=t.mapPoint,this._drawVertexGraphics(i,e,r,{userClicked:!1}),r.length>1)){const t=r[r.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:o},type:"create"})}})),r.on("draw-complete",(t=>{const o=t.vertices.slice(0);let r=null;"polyline"===e?r=i.createPolyline([o],this.view.spatialReference,this._doUnnormalization):"polygon"===e&&(r=i.createPolygon([o],this.view.spatialReference,this._doUnnormalization,!0)),r&&(this.createGraphic.geometry=r),p&&p.complete()})),r.on("undo",(t=>{const o=t.vertices,r=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),this._snap(e,o,n),o.length&&this._drawVertexGraphics(i,e,o,{userClicked:r})})),r.on("redo",(t=>{const o=t.vertices,r=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),this._snap(e,o,n),o.length&&this._drawVertexGraphics(i,e,o,{userClicked:r})}))],c=[this.view.on("pointer-move",(e=>{(0,m.pC)(r.getCoordsFromScreenPoint((0,G.vW)(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),M.f.WIDGET),this.view.on("key-down",(t=>{const o=r.vertices.slice(0),a=s&&"cursor-update"!==s.type;t.key===$.constraintKey?"2d"===this.view.type&&(n||(n=!0,this._snap(e,o,!a),this._drawVertexGraphics(i,e,o,{userClicked:a}))):t.key===$.undoKey&&p&&p.canUndo()?(t.stopPropagation(),p.undo()):t.key===$.redoKey&&p&&p.canRedo()?(t.stopPropagation(),p.redo()):t.key===$.cancelKey&&p&&p.cancel()}),M.f.WIDGET),this.view.on("key-up",(t=>{const o=r.vertices.slice(0),l=s&&"cursor-update"!==s.type;t.key===$.constraintKey&&n&&(l||(o.pop(),o.push([a.x,a.y]),this._drawVertexGraphics(i,e,o,{userClicked:l})),n=!1)}),M.f.WIDGET)];if("polygon"===e){const e=(e,t,i)=>{if(!e||!e.layer||!e.visible)return!1;const o=this.view.toScreen(e.geometry);return this._isWithinScreenDistance(o,t,i)},t=t=>{if(!(this._vertexGraphics.length<=2))return e(this._vertexGraphics[0],t,this._getVertexIntersectDistance())};let i=!1;c.push(this.view.on("pointer-move",(()=>{i=!1}),M.f.WIDGET),this.view.on("pointer-down",(o=>{if(t(o))return i=!0,void o.stopPropagation();this._vertexGraphics.some((t=>e(t,o,this._getVertexIntersectDistance())))&&o.stopPropagation()}),M.f.WIDGET),this.view.on("pointer-up",(e=>{i&&(e.stopPropagation(),r.complete())})))}const p=this._operationHandleForCreateAction(r,[...l,...c],e);return p}async _setupCreateCircleOperation(e,t){const i=await V(),o={...t,elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0},r=this._draw.create(e,o);let a=!1,s=!0;const n=[r.on("vertex-add",(t=>{const{type:o,vertexIndex:n,vertices:l}=t,c=l[n];this._drawSegmentGraphic(i,e,l,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===l.length?"start":"active",tool:e,toolEventInfo:{added:c,vertices:[{coordinates:c,componentIndex:0,vertexIndex:n}],type:o},type:"create"})})),r.on("cursor-update",(t=>{const{type:o,vertices:n}=t;if(this._drawSegmentGraphic(i,e,n,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem),2===n.length){const t=n[n.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:o},type:"create"})}})),r.on("draw-complete",(e=>{const t=e.vertices.slice(0);let o;1===t.length?(t.push(r.viewAlignedCoordinateSystem.makeMapPoint(t[0][0]+this._defaultSegmentOffset*this.view.resolution,t[0][1])),o=i.createCircle(t,r.viewAlignedCoordinateSystem,!0,this.view.resolution)):o=a?i.createEllipse(t,r.viewAlignedCoordinateSystem,s):i.createCircle(t,r.viewAlignedCoordinateSystem,s,this.view.resolution),this.createGraphic?this.createGraphic.geometry=o:(this._removeCreateGraphic(),this._set("createGraphic",new x.default(o,this.polygonSymbol))),c&&c.complete()}))],l=[this.view.on("pointer-move",(e=>{(0,m.pC)(r.getCoordsFromScreenPoint((0,G.vW)(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),M.f.WIDGET),this.view.on("key-down",(t=>{t.key===$.constraintKey?a||(a=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.centerKey?s&&(s=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.cancelKey&&c&&c.cancel()}),M.f.WIDGET),this.view.on("key-up",(t=>{t.key===$.constraintKey?(a=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.centerKey&&(s=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem))}),M.f.WIDGET)],c=this._operationHandleForCreateAction(r,[...n,...l],e);return c}async _setupCreateRectangleOperation(e,t){const i=await V(),o={...t,elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0},r=this._draw.create(e,o);let a=!1,s=!1;const n=[r.on("vertex-add",(t=>{const{type:o,vertexIndex:n,vertices:l}=t,c=l[n];this._drawSegmentGraphic(i,e,l,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===l.length?"start":"active",tool:e,toolEventInfo:{added:c,vertices:[{coordinates:c,componentIndex:0,vertexIndex:n}],type:o},type:"create"})})),r.on("cursor-update",(t=>{const{type:o,vertices:n}=t;if(this._drawSegmentGraphic(i,e,n,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem),2===n.length){const t=n[n.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:o},type:"create"})}})),r.on("draw-complete",(e=>{const t=e.vertices.slice(0);let o=null;1===t.length&&(a=!1,s=!1),o=a?i.createSquare(t,r.viewAlignedCoordinateSystem,s):i.createRectangle(t,r.viewAlignedCoordinateSystem,s),this.createGraphic?this.createGraphic.geometry=o:(this._removeCreateGraphic(),this._set("createGraphic",new x.default(o,this.polygonSymbol))),c&&c.complete()}))],l=[this.view.on("pointer-move",(e=>{(0,m.pC)(r.getCoordsFromScreenPoint((0,G.vW)(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),M.f.WIDGET),this.view.on("key-down",(t=>{t.key===$.constraintKey?a||(a=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.centerKey?s||(s=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.cancelKey&&c&&c.cancel()}),M.f.WIDGET),this.view.on("key-up",(t=>{t.key===$.constraintKey?(a=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem)):t.key===$.centerKey&&(s=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:s,constrainToggle:a},r.viewAlignedCoordinateSystem))}),M.f.WIDGET)],c=this._operationHandleForCreateAction(r,[...n,...l],e);return c}async _setupUpdateOperation(e,t){const{_defaultUpdateTool:i,defaultUpdateOptions:o,layer:r,view:a}=this,s={...o,...t},n=s.tool||i;for(const t of e)r.remove(t),r.add(t);if("3d"===a.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,s,a,n);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,Z.P)(e[0]);return 0===t?this._setupReshape3DOperation(e[0],s,a):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${U(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,s,a)}}if("move"===n)return this._setupMoveOperation(e,s,a);if(e.length>1)return"reshape"===n?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshapeOperation(e,n,s,a);if(1===e.length){const t=e[0],i=(0,m.U2)(t.geometry,"type");if("point"===i||"multipoint"===i)return this._setupMoveOperation(e,s,a);if("transform"===n||"reshape"===n)return this._setupTransformOrReshapeOperation(e,n,s,a)}return null}async _setupMove3DOperation(e,t,o,r,a=!1){for(const t of e){const e=(0,F.P)(t);if(0!==e)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${U(e)}).`),null}const s=await this._requireModule(Promise.all([i.e(356),i.e(6563),i.e(5798),i.e(530),i.e(6562),i.e(5991),i.e(2457),i.e(7905)]).then(i.bind(i,27905)));if(oe(s))return s;const n=new s.module.GraphicMoveTool({view:o,enableZ:t.enableZ});this.view.tools.add(n),n.graphics.addMany(e),a||this.updateGraphics.addMany(e);const l=[],c=new z({activeComponent:n,tool:r,type:"update",onEnd:()=>{var e;l.forEach((e=>e.remove())),l.length=0,null==(e=this.view.tools)||e.remove(n),n.destroyed||n.destroy()},undo:()=>{X(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{ee(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e),n.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);c.history.undo.forEach((e=>e.updates.splice(t,1))),c.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics.remove(e):c.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==r)return;const e=this.updateGraphics.getItemAt(0);if(0!==(0,Z.P)(e))return;const i=await this._setupReshape3DOperation(e,t,o,!0);oe(i)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(i,t))}});return l.push(...this._getHandlesForComponent(c,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e)),M.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(c,e)),M.f.WIDGET)),c}_setupGraphicTransform3DOperation(e,t,i,o=!1){if(1===e.length&&0===function(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if((0,m.Wi)(e.geometry))return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":return 0;case"multipoint":case"extent":case"mesh":default:return 3}const i=(0,m.pC)(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return i&&i.length>0&&i.some((e=>"object"===e.type))?"on-the-ground"!==(0,W.vu)(e)&&(0,W.Lt)(e)?4:0:5}(e[0])){const r=e[0];if((0,m.pC)(r.geometry)&&"point"===r.geometry.type)return this._setupPointTransform3DOperation(r,t,i);if((0,m.pC)(r.geometry)&&("polygon"===r.geometry.type||"polyline"===r.geometry.type)&&(0,O.kL)())return this._setupPolyTransform3DOperation(r,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const r="transform",{enableRotation:a,enableScaling:s,enableZ:n}=t,l=await this._requireModule(Promise.all([i.e(356),i.e(6563),i.e(5798),i.e(530),i.e(6562),i.e(5991),i.e(2457),i.e(7905)]).then(i.bind(i,27905)));if(oe(l))return l;const c=new l.module.GraphicTransformTool({graphic:e,view:o,enableRotation:a,enableScaling:s,enableZ:n});this.view.tools.add(c),this.updateGraphics.add(e);const p=[],h=new z({activeComponent:c,tool:r,type:"update",onEnd:()=>{var e;p.forEach((e=>e.remove())),p.length=0,null==(e=this.view.tools)||e.remove(c),c.destroyed||c.destroy()},undo:()=>{X(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{ee(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e);const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);oe(i)||(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(i,t))}});return p.push(...this._getHandlesForComponent(h,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(h,e)),M.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(h,e)),M.f.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,o,r=!1){const a="transform",{enableRotation:s,enableScaling:n,enableZ:l}=t,c=await this._requireModule(Promise.all([i.e(356),i.e(6563),i.e(5798),i.e(530),i.e(6562),i.e(5991),i.e(2457),i.e(7905)]).then(i.bind(i,27905)));if(oe(c))return c;const p=new c.module.ExtentTransformTool({graphic:e,view:o,enableRotation:s,enableScaling:n,enableZ:l});this.view.tools.add(p),r||this.updateGraphics.add(e);const h=[],d=new z({activeComponent:p,tool:a,type:"update",onEnd:()=>{var e;h.forEach((e=>e.remove())),h.length=0,null==(e=this.view.tools)||e.remove(p),p.destroyed||p.destroy()},undo:()=>{X(d,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ee(d,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e);const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);oe(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if(0!==(0,Z.P)(e))return;const i=await this._setupReshape3DOperation(e,t,o,!0);oe(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t))}});return h.push(...this._getHandlesForComponent(d,t),p.on("immediate-click",(()=>d.toggleTool())),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(d,e)),M.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(d,e)),M.f.WIDGET)),d}async _setupMoveOperation(e,t,i){const o="move";this.updateGraphics.addMany(e);const r=this._getCloneInfos(e);for(const e of r)this._internalGraphicsLayer.add(e.clone);const a=await this._getGraphicMover(e,t,i);if(oe(a))return a;const s=new z({activeComponent:a,tool:o,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),l.forEach((e=>e.remove())),n.forEach((e=>e.remove())),l=[],n=[],a.destroy(),null==(e=this._internalGraphicsLayer)||e.removeMany([...this.updateGraphics.toArray(),...r.map((e=>e.clone))])},undo:()=>{X(s,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{ee(s,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray();const t=this._createClone(e);r.push({graphic:e,clone:t}),this._internalGraphicsLayer.add(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1)));const i=r.findIndex((t=>t.graphic===e)),o=r[i];this._internalGraphicsLayer.remove(o.clone),this.updateGraphics.remove(e),r.splice(i,1);const n=this.updateGraphics.toArray();this.emit("update",{graphics:n,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=n:s.complete()}});let n=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(s,e,t)),M.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==$.constraintKey||e.repeat||(a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),M.f.WIDGET),i.on("key-up",(e=>{e.key===$.constraintKey&&(a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),M.f.WIDGET)],l=this._getHandlesForComponent(s,t);return l.push(a.on("graphic-move",(e=>{r.forEach((t=>{const i=e.allGraphics.find((e=>e===t.graphic));i&&(t.clone.geometry=i.geometry)}))}))),s}_getCloneInfos(e){return(null==e?void 0:e.map((e=>({graphic:e,clone:this._createClone(e)}))))||[]}_createClone(e){const t=e.clone();return t.symbol=this._getSymbolForClone(e),t}_getSymbolForClone(e){if((0,m.Wi)(e.symbol))return null;switch(e.symbol.type){case"cim":return new S.Z({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:t,yoffset:i,height:o,width:r}=e.symbol,a=o===r?r:Math.max(o,r);return new S.Z({xoffset:t,yoffset:i,size:a,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:t,yoffset:i,size:o,style:r}=e.symbol;return new S.Z({xoffset:t,yoffset:i,style:"circle"===r?"circle":"square",size:o+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new C.default({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new b.Z({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:t,yoffset:i}=e.symbol;return new S.Z({xoffset:t,yoffset:i,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}async _setupReshape3DOperation(e,t,o,r=!1){const a="reshape",s=await this._requireModule(Promise.all([i.e(356),i.e(6563),i.e(5798),i.e(530),i.e(6562),i.e(5991),i.e(2457),i.e(7905)]).then(i.bind(i,27905)));if(oe(s))return s;this.snappingOptions.enabledToggled=!1;const n=new s.module.GraphicReshapeTool({view:o,graphic:e,enableZ:t.enableZ,enableMoveGraphic:t.enableMoveGraphic,snappingOptions:this.snappingOptions});o.tools.add(n),r||this.updateGraphics.add(e);const l=[],c=new z({activeComponent:n,tool:a,type:"update",onEnd:()=>{var e;l.forEach((e=>e.remove())),l.length=0,null==(e=this.view.tools)||e.remove(n),n.destroyed||n.destroy()},undo:()=>{n.beforeUndo(),X(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ee(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e);const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);oe(i)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(i,t))},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);oe(e)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(e,t))}});return l.push(...this._getHandlesForComponent(c,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e)),M.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===$.snappingKey&&(n.snappingOptions.enabledToggled=!0,e.stopPropagation())}),M.f.WIDGET),o.on("key-up",(e=>{e.key===$.snappingKey&&(n.snappingOptions.enabledToggled=!1,e.stopPropagation())}),M.f.WIDGET)),c}async _setupTransformOrReshapeOperation(e,t,i,o){const{multipleSelectionEnabled:r}=i;this.updateGraphics.addMany(e);const a="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(oe(a))return a;const s=new z({activeComponent:a,type:"update",onEnd:()=>{l.forEach((e=>e.remove())),n.forEach((e=>e.remove())),l=[],n=[],s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{X(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{ee(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:e=>{const t=s.activeComponent;this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),s.resetHistory(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=s.activeComponent,i=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(i,1))),s.history.redo.forEach((e=>e.updates.splice(i,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?t.graphics=o:s.complete()},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let t=null;"transform"===s.tool?t=await this._getReshape(e,i,o):"reshape"===s.tool&&(t=await this._getBox(e,i,o)),oe(t)||(s.activeComponent.destroy(),s.activeComponent=t,s.activeComponent&&(l.forEach((e=>e.remove())),l=this._getHandlesForComponent(s,i)))}});let n=[o.on("immediate-click",(e=>{this._getFirstHit((0,L.vT)(e)).then((t=>{var i;if(!s)return;if(null==(i=t.results)||!i.length)return void s.complete();const o=s.activeComponent;t.results.some((t=>{if(t.graphic){var i;const a=t.graphic;if("box"===(null==o?void 0:o.type)&&null!=(i=e.native)&&i.shiftKey&&r)return s.addToSelection(a),!0;a.layer===this.layer&&s.complete()}return!1}))&&e.stopPropagation()}))}),M.f.WIDGET),o.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key===$.constraintKey&&!e.repeat&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),M.f.WIDGET),o.on("key-up",(e=>{if(e.key===$.constraintKey&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),M.f.WIDGET)],l=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:r}=t,a=await this._requireModule(i.e(2756).then(i.bind(i,32756)));return oe(a)?a:new a.module.default({enableMoveAllGraphics:r,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:r,enableScaling:a,preserveAspectRatio:s}=t,n=await this._requireModule(i.e(7431).then(i.bind(i,77431)));return oe(n)?n:new n.module.default({graphics:e,enableRotation:r,enableScaling:a,preserveAspectRatio:s,layer:this._internalGraphicsLayer,view:o,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){const{enableMidpoints:r=!0}=t,a=await this._requireModule(i.e(5596).then(i.bind(i,45596)));return oe(a)?a:new a.module.default({enableMidpoints:r,graphic:e[0],layer:this._internalGraphicsLayer,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const o=e.map((e=>(0,f.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:o,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const o=e.map((e=>(0,f.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:o,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",(({graphic:t,viewEvent:i})=>{var o;null!=(o=i.native)&&o.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))})),i.on("graphic-move-start",(t=>e.addToHistory(te(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(te(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(te(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(te(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(te([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(te([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(te([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(te([t.oldGraphic]))))];case"move-3d":return[i.on("graphic-move-start",(t=>{e.addToHistory(te(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),i.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),i.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.on("graphic-translate-start",(t=>{e.addToHistory(te([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,dx:t.dxScreen,dy:t.dyScreen,type:"move-start"},type:"update"})})),i.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.on("graphic-rotate-start",(t=>{e.addToHistory(ie([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,angle:t.angle,type:"rotate-start"},type:"update"})})),i.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.on("graphic-scale-start",(t=>{e.addToHistory(ie([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,xScale:t.scale,yScale:t.scale,type:"scale-start"},type:"update"})})),i.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.scale,yScale:e.scale,type:"scale-stop"},type:"update"})})),i.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.scale,yScale:e.scale,type:"scale"},type:"update"})}))];case"reshape-3d":return[i.on("reshape",(t=>{"reshape-start"===t.type&&e.addToHistory(te([t.mover])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:t,type:"update"})})),i.on("move",(t=>{"move-start"===t.type&&e.addToHistory(te([t.mover])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:t,type:"update"})})),i.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("immediate-click",(()=>e.toggleTool()))];case"draw":case"draw-3d":return null;default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var o;const{graphic:r,viewEvent:a}=i;null!=(o=a.native)&&o.shiftKey?(a.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick&&((0,m.Wi)(r.geometry)||"extent"!==r.geometry.type?(a.stopPropagation(),e.toggleTool()):this._logError("sketch:reshape-extent","Reshape operation does not support graphics with geometry of type 'extent'."))}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}}))}_getCommonUpdateOperationClickHandlers(e,t,i){const o=(0,L.vT)(t);this._getFirstHit(o).then((o=>{const r=o.results;r.length&&(t.native.shiftKey&&this._toggleSelection(r.map((e=>e.graphic)),e,i)||r.some((e=>e.graphic&&this.updateGraphics.indexOf(e.graphic)>-1)))?t.stopPropagation():e.complete()}))}_toggleSelection(e,t,i){const o=!i||!!i.multipleSelectionEnabled;return e.some((e=>!(null==e||!o||e.layer!==this.layer||(-1===this.updateGraphics.indexOf(e)?t.addToSelection(e):t.removeFromSelection(e),0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===$.undoKey&&e.canUndo()?(t.stopPropagation(),e.undo()):i===$.redoKey&&e.canRedo()?(t.stopPropagation(),e.redo()):i===$.cancelKey?(t.stopPropagation(),e.cancel()):$.deleteKeys.indexOf(i)>=0&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent;if((0,m.Wi)(t)||"reshape"===t.type||"reshape-3d"===t.type)return;e.stopPropagation();const i=this.updateGraphics.toArray();this.layer.removeMany(i),this._emitDeleteEvent({graphics:i,tool:this.activeTool})}_drawMultipointGraphic(e,t,i){let o=null;if(!i&&t.length>1){const i=t.slice(0);i.pop(),o=e.createMultipoint(i,this.view.spatialReference)}else o=e.createMultipoint(t,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=o:this._set("createGraphic",new x.default(o,this.pointSymbol)),i&&1===t.length&&this._internalGraphicsLayer.add(this.createGraphic)}_drawVertexGraphics(e,t,i,o){if(!i.length)return;const{_doUnnormalization:r,activeLineSymbol:a,activeVertexSymbol:s,polygonSymbol:n,polylineSymbol:l,vertexSymbol:c,view:{spatialReference:p}}=this,h=!(!o||!o.userClicked),d="polygon"===t,u=d?n:l;if(1===i.length){this._removeLineGraphic(),this._removeActiveLineGraphic();const t=this.createPointFromVertex(i[0]),o=d?e.createPolygon([i],p,r,!0):e.createPolyline([i],p,r);this._vertexGraphics.length?this._vertexGraphics[0].geometry=t:this._vertexGraphics.push(new x.default(t,s)),this.createGraphic?this.createGraphic.geometry=o:this._set("createGraphic",new x.default(o,u)),h&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===i.length){const t=this.createPointFromVertex(i[1]),o=e.createPolyline([i],p,r),a=d?e.createPolygon([i],p,r,!0):e.createPolyline([i],p,r);if(!this._vertexGraphics.length){const e=this.createPointFromVertex(i[0]),t=new x.default(e,c);this._vertexGraphics.push(t)}if(1===this._vertexGraphics.length){const e=this._vertexGraphics[0],i=new x.default(t,c);this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(i),this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}else this._vertexGraphics[1].geometry=t;this._showActiveLineGraphic(o);const s=this._vertexGraphics[0];h&&(this._activeLineGraphic.symbol=l,s.symbol=c,this._internalGraphicsLayer.add(this._vertexGraphics[1])),this.createGraphic?this.createGraphic.geometry=a:this._set("createGraphic",new x.default(a,n)),this._internalGraphicsLayer.remove(s),this._internalGraphicsLayer.add(s)}else if(i.length>2){const o=d?e.createPolygon([i],p,r,!0):e.createPolyline([i],p,r);"polygon"===t&&this._showFillGraphic(o);const n=i.map((e=>e.slice())),y=n.pop(),v=[n[n.length-1],y],m=e.createPolyline([n],p,r),g=e.createPolyline([v],p,r);this._showLineGraphic(m),this._showActiveLineGraphic(g);for(let e=0;e<n.length;e++){const t=this._vertexGraphics[e];if(t)h||e!==this._vertexGraphics.length-1?t.symbol=c:t.symbol=s;else{const t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}}if(h){this._activeLineGraphic.symbol=l;const e=i.length-1,t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}else this._activeLineGraphic.symbol=a;this.createGraphic?this.createGraphic.geometry=o:(this._removeCreateGraphic(),this._set("createGraphic",new x.default(o,u)));for(const e of this._vertexGraphics)this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}}_drawSegmentGraphic(e,t,i,o,r){if(!i.length)return;const a=!(null==o||!o.centered),s=!(null==o||!o.constrainToggle);let n;1===i.length?this._removeCenterIndicatorGraphic():("rectangle"===t?n=s?e.createSquare(i,r,a):e.createRectangle(i,r,a):"circle"===t&&(n=s?e.createEllipse(i,r,a):e.createCircle(i,r,a,this.view.resolution)),(0,m.pC)(n)&&n.extent&&n.extent.center&&this._showCenterIndicatorGraphic(n.extent.center)),n?this.createGraphic?this.createGraphic.geometry=n:(this._removeCreateGraphic(),this._set("createGraphic",new x.default(n,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic)):this._removeCreateGraphic()}_showCenterIndicatorGraphic(e){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=e:(this._centerIndicatorGraphic=new x.default(e,this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))}_removeCenterIndicatorGraphic(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)}_showActiveLineGraphic(e){this._activeLineGraphic?(this._activeLineGraphic.geometry=e,this._internalGraphicsLayer.remove(this._activeLineGraphic)):this._activeLineGraphic=new x.default(e,this.activeLineSymbol),this._internalGraphicsLayer.add(this._activeLineGraphic)}_showFillGraphic(e){this._activeFillGraphic?(this._activeFillGraphic.geometry=e,this._internalGraphicsLayer.remove(this._activeFillGraphic)):this._activeFillGraphic=new x.default(e,this.activeFillSymbol),this._internalGraphicsLayer.add(this._activeFillGraphic)}_showLineGraphic(e){this._lineGraphic?(this._lineGraphic.geometry=e,this._internalGraphicsLayer.remove(this._lineGraphic)):this._lineGraphic=new x.default(e,this.polylineSymbol),this._internalGraphicsLayer.add(this._lineGraphic)}_showVertexGraphic(e,t){const i=t?this.activeVertexSymbol:this.vertexSymbol,o=new x.default(e,i);this._vertexGraphics.push(o),this._internalGraphicsLayer.add(o)}_resetCreateOperationGraphics(){this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeActiveLineGraphic(),this._removeVertexGraphics()}_removeCreateGraphic(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))}_removeCreateOperationGraphics(){this._removeCenterIndicatorGraphic(),this._removeActiveLineGraphic(),this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeVertexGraphics()}_removeActiveLineGraphic(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)}_removeActiveFillGraphic(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=null)}_removeLineGraphic(){this._lineGraphic&&(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)}_removeVertexGraphics(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach((e=>e.destroy())),this._vertexGraphics=[])}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=null)}_operationHandleForCreateAction(e,t,i){return new z({activeComponent:this._draw,tool:i,type:"create",onEnd:()=>{t.forEach((e=>e.remove())),t.length=0,this._removeCreateOperationGraphics(),this._internalGraphicsLayer&&this._internalGraphicsLayer.remove(this.createGraphic),this._displayDefaultCursor()},undo:()=>{e.undo(),this._emitUndoEvent({graphics:[this.createGraphic],tool:i})},redo:()=>{e.redo(),this._emitRedoEvent({graphics:[this.createGraphic],tool:i})},canUndo:()=>e&&e.canUndo(),canRedo:()=>e&&e.canRedo()})}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||(0,m.Wi)(t))&&(!(!e.attributes||!e.attributes.esriSketchTool)||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_snap(e,t,i){i&&this._snapLastVertexToAxis(t),"polygon"===e&&this._snapLastPolygonVertexToFirst(t)}_snapLastPolygonVertexToFirst(e){if(e.length<=2)return;const t=e[0],i=e[e.length-1],o=this.view.toScreen(new _.Z(t[0],t[1],this.view.spatialReference)),r=this.view.toScreen(new _.Z(i[0],i[1],this.view.spatialReference));this._isWithinScreenDistance(o,r,this._getVertexIntersectDistance())&&(i[0]=t[0],i[1]=t[1])}_getVertexIntersectDistance(){return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?(0,G.F2)(this.vertexSymbol.size)/2+3:3}_isWithinScreenDistance(e,t,i){const o=e.x-t.x,r=e.y-t.y;return Math.sqrt(o*o+r*r)<=i}_snapLastVertexToAxis(e){if(e.length<2)return;const t=e.pop(),i=e[e.length-1],o=(0,H.Gn)(this.view,i),r=o.mapToLocal(i),a=o.mapToLocal(t);if((0,m.Wi)(r)||(0,m.Wi)(a))return;const s=Math.abs(a.x-r.x),n=Math.abs(a.y-r.y),l=o.localToMap((0,H.Q8)(s>n?a.x:r.x,s>n?r.y:a.y));(0,m.pC)(l)&&e.push(l)}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayCrosshairCursor(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){N.error(new g.Z(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}createPointFromVertex(e){return e.length>2?new _.Z(e[0],e[1],e[2],this.view.spatialReference):new _.Z(e[0],e[1],this.view.spatialReference)}test(){return this._operationHandle}wait(){return(0,I.whenNotOnce)(this,"updating")}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return"3d"!==(null==(t=this.view)?void 0:t.type)||this.updateOnGraphicClick||e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,m.Wi)(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,m.pC)(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}};function X(e,t){const i=e.history.undo.pop().updates,o=[];t.forEach(((e,t)=>{const r=i[t],a={};null!=r&&((0,m.pC)(r.geometry)&&(a.geometry=e.geometry,e.geometry=r.geometry),(0,m.pC)(r.symbol)&&(a.symbol=e.symbol,e.symbol=r.symbol),o.push(a))})),e.history.redo.push({updates:o})}function ee(e,t){const i=e.history.redo.pop().updates,o=[];t.forEach(((e,t)=>{const r=i[t],a={};null!=r&&((0,m.pC)(r.geometry)&&(a.geometry=e.geometry,e.geometry=r.geometry),(0,m.pC)(r.symbol)&&(a.symbol=e.symbol,e.symbol=r.symbol),o.push(a))})),e.history.undo.push({updates:o})}function te(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function ie(e){return{updates:e.map((e=>({symbol:e.symbol})))}}function oe(e){return"requireError"in e&&"aborted"===e.requireError}(0,o._)([(0,a.Cb)({readOnly:!0})],Y.prototype,"_draw",null),(0,o._)([(0,a.Cb)()],Y.prototype,"updating",null),(0,o._)([(0,a.Cb)()],Y.prototype,"_operationHandle",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],Y.prototype,"activeTool",null),(0,o._)([(0,a.Cb)()],Y.prototype,"activeFillSymbol",void 0),(0,o._)([(0,a.Cb)()],Y.prototype,"activeLineSymbol",void 0),(0,o._)([(0,a.Cb)()],Y.prototype,"activeVertexSymbol",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],Y.prototype,"createGraphic",null),(0,o._)([(0,a.Cb)()],Y.prototype,"defaultCreateOptions",null),(0,o._)([(0,a.Cb)()],Y.prototype,"defaultUpdateOptions",null),(0,o._)([(0,a.Cb)()],Y.prototype,"layer",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"pointSymbol",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"polygonSymbol",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"polylineSymbol",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],Y.prototype,"state",null),(0,o._)([(0,a.Cb)({readOnly:!0})],Y.prototype,"updateGraphics",void 0),(0,o._)([(0,a.Cb)()],Y.prototype,"updateOnGraphicClick",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"updatePointSymbol",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"updatePolygonSymbol",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"updatePolylineSymbol",void 0),(0,o._)([(0,a.Cb)({types:T.s})],Y.prototype,"vertexSymbol",void 0),(0,o._)([(0,a.Cb)({value:null})],Y.prototype,"view",null),(0,o._)([(0,a.Cb)({type:R.g})],Y.prototype,"snappingOptions",void 0),(0,o._)([(0,a.Cb)()],Y.prototype,"cancel",null),(0,o._)([(0,a.Cb)()],Y.prototype,"complete",null),(0,o._)([(0,a.Cb)()],Y.prototype,"delete",null),(0,o._)([(0,a.Cb)()],Y.prototype,"create",null),(0,o._)([(0,a.Cb)()],Y.prototype,"update",null),(0,o._)([(0,a.Cb)()],Y.prototype,"undo",null),(0,o._)([(0,a.Cb)()],Y.prototype,"redo",null),(0,o._)([(0,a.Cb)()],Y.prototype,"canUndo",null),(0,o._)([(0,a.Cb)()],Y.prototype,"canRedo",null),(0,o._)([(0,a.Cb)()],Y.prototype,"toggleUpdateTool",null),Y=(0,o._)([(0,l.j)(q)],Y);const re=Y;var ae=i(82677),se=i(77204);async function ne(){return async function(){return Promise.all([i.e(5798),i.e(3134)]).then(i.bind(i,93134))}().then((({contains:e,intersects:t,overlaps:i,simplify:o})=>({contains:e,intersects:t,overlaps:i,simplify:o})))}async function le(e){const{selector:t,candidates:i,currentSelection:o,options:r,view:a}=e;if(!(i&&i.length&&o&&a))return{added:[],removed:[]};const{overlaps:s,intersects:n,contains:l}=r,{spatialReference:c}=a;if(!t)return{added:[],removed:o.removeAll()};const p=t,h=await ne(),d=[],u=[];return i.forEach((e=>{const t=e.geometry,i=s&&!!h.overlaps(c,p,t),r=n&&!!h.intersects(c,p,t),a=l&&!!h.contains(c,p,t),y=o.includes(e);i||r||a?!y&&d.push(e):y&&u.push(e)})),o.removeMany(u),o.addMany(d),{added:d,removed:u}}let ce=class extends w.Z.EventedAccessor{constructor(e){super(),this._activeOptions=null,this._dashedFillSymbol=new C.default({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new b.Z({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={tool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new E.Z,this._sketchViewModel=new re,this._sketchGraphicsLayer=new A.default({listMode:"hide"}),this._transparentPointSymbol=new S.Z({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new c.Z,this.view=null,this.candidates=e.candidates,this.options=e.options,this.view=e.view;const{_dashedFillSymbol:t,_dashedLineSymbol:i,_sketchViewModel:o,_sketchGraphicsLayer:r,_transparentPointSymbol:a}=this;o.set({layer:r,view:this.view,activePointSymbol:a,activeLineSymbol:i,activeVertexSymbol:a,activeFillSymbol:t,pointSymbol:a,polygonSymbol:t,polylineSymbol:i,vertexSymbol:a}),this._handles.add([o.on("create",(e=>this._onSketchEvent(e))),o.on(["undo","redo"],(e=>this._onSketchEvent(e)))])}initialize(){this._load()}destroy(){this._handles.destroy(),this._handles=null}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}cancel(){this._sketchViewModel.cancel()}async _load(){await this.view.whenReady();const{options:e}=this,{tool:t,createOptions:i}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,i)}_onSketchEvent(e){const t="create"===e.type?e.graphic:e.graphics[0],i=(null==t?void 0:t.geometry)||null,o="create"===e.type&&"cancel"===e.state,r="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(i,r,o)}_processSelectionGeometry(e,t,i){if(this._set("geometry",e),(t||i)&&(this._completed=!0),i)return void this._onComplete([],!0);const{_activeOptions:o,candidates:r,selection:a,view:s}=this;le({selector:e,candidates:r,currentSelection:a,options:o.selectionOptions,view:s}).then((({added:e,removed:i})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||i.length)&&this.emit("selection-change",{added:e,removed:i,type:"selection-change"})}))}_onComplete(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};(0,o._)([(0,a.Cb)()],ce.prototype,"_completed",void 0),(0,o._)([(0,a.Cb)()],ce.prototype,"candidates",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],ce.prototype,"geometry",void 0),(0,o._)([(0,a.Cb)()],ce.prototype,"options",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],ce.prototype,"selection",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],ce.prototype,"state",null),(0,o._)([(0,a.Cb)({value:null})],ce.prototype,"view",void 0),ce=(0,o._)([(0,l.j)("esri.widgets.support.Selector")],ce);const pe=ce;let he=class extends((0,se.p)(ae.default)){constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.candidates=null,this.options=null,this.view=null}draw(e){const{_defaultSelectionOptions:t,candidates:i,options:o,view:r}=this,a={...t,...o,...null==e?void 0:e.selectionOptions};return new pe({candidates:i,options:{...e,selectionOptions:a},view:r})}async selectionFrom(e,t){const{_defaultSelectionOptions:i,candidates:o,options:r,view:a}=this,s=new c.Z,n={...i,...r,...t};return await le({selector:e,candidates:o,currentSelection:s,options:n,view:a}),s.toArray()}};(0,o._)([(0,a.Cb)()],he.prototype,"candidates",void 0),(0,o._)([(0,a.Cb)()],he.prototype,"options",void 0),(0,o._)([(0,a.Cb)({value:null})],he.prototype,"view",void 0),he=(0,o._)([(0,l.j)("esri.widgets.support.Selector")],he);const de=he,ue="esri-sketch",ye="esri-sketch--vertical",ve="esri-sketch__panel",me="esri-sketch__info-panel",ge="esri-sketch__section",_e="esri-sketch__tool-section",fe="esri-sketch__info-section",we="esri-sketch__info-count-section",Ge="esri-sketch__feature-count-badge",be="esri-sketch__feature-count-number",Ce="esri-sketch__button",Se="esri-sketch__button--selected",Te="esri-icon-map-pin",xe="esri-icon-polygon",Ee="esri-icon-polyline",ke="esri-icon-radio-unchecked",Oe="esri-icon-checkbox-unchecked",Ie="esri-icon-cursor",Ae="esri-icon-trash",Me="esri-icon-undo",Pe="esri-icon-redo",Le="esri-icon-cursor-marquee",Re="esri-icon-lasso",He="esri-widget",De="esri-icon-edit",Ue="esri-disabled",Fe={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0};let Ze=class extends v.default{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._activeSelectionInfo=null,this._selector=new de,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.createGraphic=null,this.creationMode="continuous",this.defaultCreateOptions=null,this.defaultUpdateOptions=null,this.iconClass=De,this.label=void 0,this.layer=null,this.messages=null,this.updateGraphics=new c.Z,this.view=null,this.viewModel=new re,this.visibleElements={...Fe},this._activateCreateTool=this._activateCreateTool.bind(this)}initialize(){const{view:e}=this;this._selector.view=e,this.own([this.viewModel.on("create",(()=>this.scheduleRender())),this.viewModel.on("update",(()=>this.scheduleRender())),this.viewModel.on("create",(e=>this._onCreateOperation(e))),this.viewModel.on("delete",(e=>this.emit("delete",e))),this.viewModel.on("undo",(()=>this.scheduleRender())),this.viewModel.on("redo",(()=>this.scheduleRender())),this.viewModel.watch("view",(e=>this._selector.set({view:e}))),this.viewModel.watch("state",(()=>this.notifyChange("state")))])}get activeTool(){var e;return(null==(e=this._activeSelectionInfo)?void 0:e.tool)||this.viewModel.activeTool}set layout(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}get state(){return this._activeSelectionInfo?"active":this.viewModel.state}castVisibleElements(e){return{...Fe,...e,createTools:{...Fe.createTools,...null==e?void 0:e.createTools},selectionTools:{...Fe.selectionTools,...null==e?void 0:e.selectionTools}}}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){}cancel(){this._cancelSelectionOperation(),this.viewModel.cancel()}undo(){}redo(){}delete(){}render(){const{label:e,layout:t,viewModel:{state:i}}=this;return(0,y.j)("div",{"aria-label":e,class:this.classes(ue,He,{[Ue]:"disabled"===i,[ye]:"vertical"===t})},(0,y.j)("div",{class:ve},this.renderTopPanelContents()),(0,y.j)("div",{class:this.classes(ve,me)},this.renderInfoPanelContents()))}renderTopPanelContents(){const e=this.classes(ge,_e),{availableCreateTools:t,visibleElements:i}=this;return[(0,y.j)("div",{key:"selection-button-container",class:e},this.renderSelectionTools()),t&&t.length?(0,y.j)("div",{class:e},this.renderDrawButtons()):null,i.undoRedoMenu?(0,y.j)("div",{key:"menu-button-container",class:e},this.renderMenuButtons()):null]}renderInfoPanelContents(){if(this.updateGraphics.length)return[(0,y.j)("div",{class:this.classes(ge,fe,we),key:"feature-count-container"},this.renderFeatureCount()),(0,y.j)("div",{class:this.classes(ge,fe),key:"delete-button-container"},this.renderDeleteButton())]}renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:i}}=this,o=(0,p.n)(1===i?t.featureCount:t.featuresCount,{count:i});return(0,y.j)("div",{class:Ge,"aria-label":o},(0,y.j)("span",{class:be},"vertical"===e?i:o))}renderDeleteButton(){const e=this.messages.deleteFeature;return(0,y.j)("button",{"aria-label":e,bind:this,class:this.classes(Ce,Ae),onclick:this.delete,title:e,type:"button"})}renderSelectionTools(){return[this.renderDefaultSelectionButton(),this.renderRectangleSelectionButton(),this.renderLassoSelectionButton()]}renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return(0,y.j)("button",{"aria-label":e,bind:this,class:this.classes(Ce,Ie,{[Se]:"ready"===this.state}),onclick:this.cancel,title:e})}renderRectangleSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["rectangle-selection"])return;const i=this.messages.selectRectangle;return(0,y.j)("button",{"aria-label":i,bind:this,class:this.classes(Ce,Le,{[Se]:"rectangle-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateRectangleSelectTool,title:i})}renderLassoSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["lasso-selection"])return;const i=this.messages.selectLasso;return(0,y.j)("button",{"aria-label":i,bind:this,class:this.classes(Ce,Re,{[Se]:"lasso-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateLassoSelectTool,title:i})}renderDrawButtons(){const e=this.visibleElements.createTools;return this.availableCreateTools.map((t=>"point"===t&&e.point?this.renderPointButton():"polyline"===t&&e.polyline?this.renderPolylineButton():"polygon"===t&&e.polygon?this.renderPolygonButton():"rectangle"===t&&e.rectangle?this.renderRectangleButton():"circle"===t&&e.circle?this.renderCircleButton():void 0))}renderPointButton(){const e="point",t=this.messages.drawPoint,i=[Ce,Te];return this.activeTool===e&&i.push(Se),(0,y.j)("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon,i=[Ce,xe];return this.activeTool===e&&i.push(Se),(0,y.j)("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline,i=[Ce,Ee];return this.activeTool===e&&i.push(Se),(0,y.j)("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderCircleButton(){const e="circle",t=this.messages.drawCircle,i=[Ce,ke];return this.activeTool===e&&i.push(Se),(0,y.j)("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle,i=[Ce,Oe];return this.activeTool===e&&i.push(Se),(0,y.j)("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderMenuButtons(){return[this.renderUndoButton(),this.renderRedoButton()]}renderUndoButton(){const e=this.messages.undo,t=!this.viewModel.canUndo(),i=(0,h.dZ)()?Pe:Me;return(0,y.j)("button",{"aria-label":e,bind:this,class:this.classes(Ce,i),disabled:t,onclick:this.undo,title:e,type:"button"})}renderRedoButton(){const e=this.messages.redo,t=!this.viewModel.canRedo(),i=(0,h.dZ)()?Me:Pe;return(0,y.j)("button",{"aria-label":e,bind:this,class:this.classes(Ce,i),disabled:t,onclick:this.redo,title:e,type:"button"})}_cancelSelectionOperation(){var e,t;null==(e=this._activeSelectionInfo)||null==(t=e.operation)||t.cancel(),this._activeSelectionInfo=null,this._selector.candidates=null}_activateCreateTool(e){const t=e.target.getAttribute("data-tool-name");this.activeTool!==t?(this._activeSelectionInfo&&this._cancelSelectionOperation(),this.create(t)):this.cancel()}_onCreateOperation(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:i}=e;if("create"===i){const{tool:i,graphic:o}=e,r=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(i,r):"update"===t&&this.update([o])}}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(this._activeSelectionInfo=null,!e.aborted&&i.length){const e=t.tool,o=i.length>1&&"reshape"===e?"transform":e;this.update(i,{...t,tool:o})}this.notifyChange("state")}_activateRectangleSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"rectangle-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"rectangle"});e.once("complete",(e=>this._onSelectionOperationComplete(e))),this._activeSelectionInfo={tool:"rectangle-selection",operation:e}}_activateLassoSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"lasso-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"polygon",createOptions:{mode:"freehand"}});e.once("complete",(e=>this._onSelectionOperationComplete(e))),this._activeSelectionInfo={tool:"lasso-selection",operation:e}}_getSelectionCandidates(){var e,t;return(null==(e=this.layer)||null==(t=e.graphics)?void 0:t.toArray())||[]}};(0,o._)([(0,a.Cb)()],Ze.prototype,"_activeSelectionInfo",void 0),(0,o._)([(0,a.Cb)()],Ze.prototype,"activeTool",null),(0,o._)([(0,a.Cb)({cast:e=>{if(!e||!e.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter((e=>t.has(e)))}})],Ze.prototype,"availableCreateTools",void 0),(0,o._)([(0,s.B)("viewModel.createGraphic")],Ze.prototype,"createGraphic",void 0),(0,o._)([(0,a.Cb)()],Ze.prototype,"creationMode",void 0),(0,o._)([(0,s.B)("viewModel.defaultCreateOptions")],Ze.prototype,"defaultCreateOptions",void 0),(0,o._)([(0,s.B)("viewModel.defaultUpdateOptions")],Ze.prototype,"defaultUpdateOptions",void 0),(0,o._)([(0,a.Cb)()],Ze.prototype,"iconClass",void 0),(0,o._)([(0,a.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ze.prototype,"label",void 0),(0,o._)([(0,s.B)("viewModel.layer")],Ze.prototype,"layer",void 0),(0,o._)([(0,a.Cb)({value:"horizontal"})],Ze.prototype,"layout",null),(0,o._)([(0,a.Cb)(),(0,d.H)("esri/widgets/Sketch/t9n/Sketch")],Ze.prototype,"messages",void 0),(0,o._)([(0,a.Cb)()],Ze.prototype,"state",null),(0,o._)([(0,s.B)("viewModel.updateGraphics")],Ze.prototype,"updateGraphics",void 0),(0,o._)([(0,s.B)("viewModel.view")],Ze.prototype,"view",void 0),(0,o._)([(0,a.Cb)(),(0,u.s)(["create","update","undo","redo"])],Ze.prototype,"viewModel",void 0),(0,o._)([(0,a.Cb)()],Ze.prototype,"visibleElements",void 0),(0,o._)([(0,n.p)("visibleElements")],Ze.prototype,"castVisibleElements",null),(0,o._)([(0,s.B)("viewModel.complete")],Ze.prototype,"complete",null),(0,o._)([(0,s.B)("viewModel.undo")],Ze.prototype,"undo",null),(0,o._)([(0,s.B)("viewModel.redo")],Ze.prototype,"redo",null),(0,o._)([(0,s.B)("viewModel.delete")],Ze.prototype,"delete",null),Ze=(0,o._)([(0,l.j)("esri.widgets.Sketch")],Ze);const We=Ze}}]);
//# sourceMappingURL=2892.js.map