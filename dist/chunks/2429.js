(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2429],{41178:(e,t,i)=>{"use strict";i.d(t,{C:()=>l,b:()=>h});var s=i(85461),r=i(51219),n=i(63230),o=i(4071),a=i(88214);function h(e){const t=new r.kG;return t.extensions.add("GL_OES_standard_derivatives"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.varyings.add("vUV","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(s.H`
    void main(void) {
      vUV = uv0;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(position, 1.0)).z;":""}
      gl_Position = proj * view * vec4(position, 1.0);
    }
  `),e.multipassTerrainEnabled&&(t.fragment.include(o.S),t.include(a.l,e)),t.fragment.uniforms.add("size","vec2").add("color1","vec4").add("color2","vec4"),t.fragment.include(n.Y),t.fragment.code.add(s.H`
    void main() {
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec2 uvScaled = vUV / (2.0 * size);

      vec2 uv = fract(uvScaled - 0.25);
      vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);
      float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));
      float t = mix(abs(ab.x + ab.y), 0.5, fade);

      gl_FragColor = mix(color2, color1, t);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
  `),t}var l=Object.freeze({__proto__:null,build:h})},77293:(e,t,i)=>{"use strict";function s(e,t){for(const[i,s]of e)if(t(s,i))return!0;return!1}i.d(t,{o:()=>s})},27202:(e,t,i)=>{"use strict";function s(e,t,i){const s=t&&t.length,n=s?t[0]*i:e.length;let a=r(e,0,n,i,!0);const h=new Array;if(!a||a.next===a.prev)return h;let l,c,d,u,m;if(s&&(a=p(e,t,a,i)),e.length>80*i){l=d=e[0],c=u=e[1];for(let t=i;t<n;t+=i){const i=e[t],s=e[t+1];l=Math.min(l,i),c=Math.min(c,s),d=Math.max(d,i),u=Math.max(u,s)}m=Math.max(d-l,u-c),m=0!==m?1/m:0}return o(a,h,i,l,c,m),h}function r(e,t,i,s,r){let n;if(r===v(e,t,i,s)>0)for(let r=t;r<i;r+=s)n=l(r,e[r],e[r+1],n);else for(let r=i-s;r>=t;r-=s)n=l(r,e[r],e[r+1],n);return n&&b(n,n.next)&&(c(n),n=n.next),n}function n(e,t=e){if(!e)return e;let i,s=e;do{if(i=!1,s.steiner||!b(s,s.next)&&0!==_(s.prev,s,s.next))s=s.next;else{if(c(s),s=t=s.prev,s===s.next)break;i=!0}}while(i||s!==t);return t}function o(e,t,i,s,r,l,d=0){if(!e)return;!d&&l&&(e=m(e,s,r,l));let p=e;for(;e.prev!==e.next;){const u=e.prev,m=e.next;if(l?h(e,s,r,l):a(e))t.push(u.index/i),t.push(e.index/i),t.push(m.index/i),c(e),e=m.next,p=m.next;else if((e=m)===p){d?1===d?o(e=C(e,t,i),t,i,s,r,l,2):2===d&&S(e,t,i,s,r,l):o(n(e),t,i,s,r,l,1);break}}}function a(e){const t=e.prev,i=e,s=e.next;if(_(t,i,s)>=0)return!1;let r=e.next.next;const n=r;let o=0;for(;r!==e.prev&&(0===o||r!==n);){if(o++,y(t.x,t.y,i.x,i.y,s.x,s.y,r.x,r.y)&&_(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function h(e,t,i,s){const r=e.prev,n=e,o=e.next;if(_(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,h=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,l=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,c=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,d=w(a,h,t,i,s),p=w(l,c,t,i,s);let u=e.prevZ,m=e.nextZ;for(;u&&u.z>=d&&m&&m.z<=p;){if(u!==e.prev&&u!==e.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,u.x,u.y)&&_(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,m!==e.prev&&m!==e.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;u&&u.z>=d;){if(u!==e.prev&&u!==e.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,u.x,u.y)&&_(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(e,t,i,s){const r=new R(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function c(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function d(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function p(e,t,i,s){const o=new Array;for(let i=0,n=t.length;i<n;i++){const a=r(e,t[i]*s,i<n-1?t[i+1]*s:e.length,s,!1);a===a.next&&(a.steiner=!0),o.push(d(a))}o.sort(L);for(const e of o)u(e,i),i=n(i,i.next);return i}function u(e,t){if(t=function(e,t){let i=t;const s=e.x,r=e.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>o){if(o=e,e===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(s===o)return n.prev;const a=n,h=n.x,l=n.y;let c,d=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=h&&s!==i.x&&y(r<l?s:o,r,h,l,r<l?o:s,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(s-i.x),(c<d||c===d&&i.x>n.x)&&x(i,e)&&(n=i,d=c)),i=i.next;return n}(e,t)){const i=M(t,e);n(i,i.next)}}function m(e,t,i,s){for(let r;r!==e;r=r.next){if(r=r||e,null===r.z&&(r.z=w(r.x,r.y,t,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,m(e,t,i,s);r.prevZ=r.prev,r.nextZ=r.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,i=1;for(;;){let s,r=e;e=null,t=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}r=s}if(t.nextZ=null,i*=2,n<2)return e}}(e)}function g(e,t,i,s){const r=t&&t.length,n=r?t[0]*i:e.length;let o=Math.abs(v(e,0,n,i));if(r)for(let s=0,r=t.length;s<r;s++){const n=t[s]*i,a=s<r-1?t[s+1]*i:e.length;o-=Math.abs(v(e,n,a,i))}let a=0;for(let t=0;t<s.length;t+=3){const r=s[t]*i,n=s[t+1]*i,o=s[t+2]*i;a+=Math.abs((e[r]-e[o])*(e[n+1]-e[r+1])-(e[r]-e[n])*(e[o+1]-e[r+1]))}return 0===o&&0===a?0:Math.abs((a-o)/o)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function f(e,t,i,s){return!!(b(e,t)&&b(i,s)||b(e,s)&&b(i,t))||_(e,t,i)>0!=_(e,t,s)>0&&_(i,s,e)>0!=_(i,s,t)>0}function v(e,t,i,s){let r=0;for(let n=t,o=i-s;n<i;n+=s)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}function y(e,t,i,s,r,n,o,a){return(r-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(i-o)*(t-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function x(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function w(e,t,i,s,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e,t){return e.x===t.x&&e.y===t.y}function L(e,t){return e.x-t.x}function C(e,t,i){let s=e;do{const r=s.prev,n=s.next.next;!b(r,n)&&f(r,s,s.next,n)&&x(r,n)&&x(n,r)&&(t.push(r.index/i),t.push(s.index/i),t.push(n.index/i),c(s),c(s.next),s=e=n),s=s.next}while(s!==e);return s}function S(e,t,i,s,r,a){let h=e;do{let e=h.next.next;for(;e!==h.prev;){if(h.index!==e.index&&P(h,e)){let l=M(h,e);return h=n(h,h.next),l=n(l,l.next),o(h,t,i,s,r,a),void o(l,t,i,s,r,a)}e=e.next}h=h.next}while(h!==e)}function P(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&f(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&x(e,t)&&x(t,e)&&function(e,t){let i=e,s=!1;const r=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)}function M(e,t){const i=new R(e.index,e.x,e.y),s=new R(t.index,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}i.d(t,{P:()=>g,O:()=>s});class R{constructor(e,t,i){this.index=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},98675:(e,t,i)=>{"use strict";i.r(t),i.d(t,{directGeodeticSolver:()=>f,geodesicAreas:()=>m,geodesicDensify:()=>_,geodesicDistance:()=>y,geodesicLengths:()=>g,inverseGeodeticSolver:()=>v,isSupported:()=>u,pointFromDistance:()=>x});var s=i(32656),r=i(73032),n=i(61106),o=i(53817),a=i(93833),h=(i(36348),i(93533)),l=i(64249);function c(e){if(!e)return null;if(e.isGeographic&&e.wkid){const t=l.Dg[e.wkid];if(t)return t}if(e.wkt){const t=l.yB.exec(e.wkt);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const s=parseFloat(i[1]),r=parseFloat(i[2]);return isNaN(s)||isNaN(r)?null:{a:s,f:0===r?0:1/r}}return null}function d(e){const t=c(e||r.Z.WGS84);if(function(e){return"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function p(e,t,i){const{a:s,eSq:r}=d(i),n=Math.sqrt(r),o=Math.sin(t[1]*l.Yr),a=s*t[0]*l.Yr;let h;return h=r>0?s*((1-r)*(o/(1-r*(o*o))-1/(2*n)*Math.log((1-n*o)/(1+n*o))))*.5:s*o,e[0]=a,e[1]=h,e}function u(e){return null!==c(e)}function m(e,t="square-meters"){if(e.some((e=>!u(e.spatialReference))))throw new s.Z("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let t=0;t<e.length;t++){const s=e[t],r=s.spatialReference,{radius:n,densificationRatio:o}=d(r),a=n*o;i.push(_(s,a))}const r=[],n=[0,0],o=[0,0];for(let e=0;e<i.length;e++){const{rings:s,spatialReference:a}=i[e];let l=0;for(let e=0;e<s.length;e++){const t=s[e];p(n,t[0],a),p(o,t[t.length-1],a);let i=o[0]*n[1]-n[0]*o[1];for(let e=0;e<t.length-1;e++)p(n,t[e+1],a),p(o,t[e],a),i+=o[0]*n[1]-n[0]*o[1];l+=i}l=(0,h.En)(l,"square-meters",t),r.push(l/-2)}return r}function g(e,t="meters"){const i=e,r=e;if(!i&&!r)throw new s.Z("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(i?i.some((e=>!u(e.spatialReference))):r.some((e=>!u(e.spatialReference))))throw new s.Z("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let i=0;i<e.length;i++){const s=e[i],{spatialReference:r}=s,o="polyline"===s.type?s.paths:s.rings;let a=0;for(let e=0;e<o.length;e++){const t=o[e];let i=0;for(let e=1;e<t.length;e++){const s=t[e-1][0],n=t[e][0],o=t[e-1][1],a=t[e][1];if(o!==a||s!==n){const e={distance:null};v(e,[s,o],[n,a],r),i+=e.distance}}a+=i}a=(0,h.En)(a,"meters",t),n.push(a)}return n}function _(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new s.Z("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!u(i))throw new s.Z("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r="polyline"===e.type?e.paths:e.rings,n=[],h=[0,0],l={distance:null};for(const e of r){const s=[];n.push(s),s.push([e[0][0],e[0][1]]);let r,o,a=e[0][0],c=e[0][1];for(let n=0;n<e.length-1;n++){if(r=e[n+1][0],o=e[n+1][1],a===r&&c===o)continue;const d=[a,c];v(l,[a,c],[r,o],i);const{azimuth:p,distance:u}=l,m=u/t;if(m>1){for(let e=1;e<=m-1;e++)f(h,d,p,e*t,i),s.push(h.slice(0));f(h,d,p,(u+Math.floor(m-1)*t)/2,i),s.push(h.slice(0))}f(h,d,p,u,i),s.push(h.slice(0)),a=h[0],c=h[1]}}return"polyline"===e.type?new a.Z({paths:n,spatialReference:i}):new o.Z({rings:n,spatialReference:i})}function f(e,t,i,s,r){const n=t[0],o=t[1],a=n*l.Yr,h=o*l.Yr,c=i*l.Yr,{a:p,b:u,f:m}=d(r),g=Math.sin(c),_=Math.cos(c),f=(1-m)*Math.tan(h),v=1/Math.sqrt(1+f*f),y=f*v,x=Math.atan2(f,_),w=v*g,b=w*w,L=1-b,C=L*(p*p-u*u)/(u*u),S=1+C/16384*(4096+C*(C*(320-175*C)-768)),P=C/1024*(256+C*(C*(74-47*C)-128));let M,R,A,z,V=s/(u*S),T=2*Math.PI;for(;Math.abs(V-T)>1e-12;)A=Math.cos(2*x+V),M=Math.sin(V),R=Math.cos(V),z=P*M*(A+P/4*(R*(2*A*A-1)-P/6*A*(4*M*M-3)*(4*A*A-3))),T=V,V=s/(u*S)+z;const D=y*M-v*R*_,G=Math.atan2(y*R+v*M*_,(1-m)*Math.sqrt(b+D*D)),k=Math.atan2(M*g,v*R-y*M*_),O=m/16*L*(4+m*(4-3*L)),E=G/l.Yr,I=(a+(k-(1-O)*m*w*(V+O*M*(A+O*R*(2*A*A-1)))))/l.Yr;return e.splice(0,e.length),e.push(I,E),e}function v(e,t,i,s){const r=t[0]*l.Yr,n=t[1]*l.Yr,o=i[0]*l.Yr,a=i[1]*l.Yr,{a:h,b:c,f:p,radius:u}=d(s),m=o-r,g=Math.atan((1-p)*Math.tan(n)),_=Math.atan((1-p)*Math.tan(a)),f=Math.sin(g),v=Math.cos(g),y=Math.sin(_),x=Math.cos(_);let w,b,L,C,S,P,M,R,A,z,V=1e3,T=m;do{if(M=Math.sin(T),R=Math.cos(T),L=Math.sqrt(x*M*(x*M)+(v*y-f*x*R)*(v*y-f*x*R)),0===L)return{distance:0};S=f*y+v*x*R,P=Math.atan2(L,S),A=v*x*M/L,b=1-A*A,C=S-2*f*y/b,isNaN(C)&&(C=0),z=p/16*b*(4+p*(4-3*b)),w=T,T=m+(1-z)*p*A*(P+z*L*(C+z*S*(2*C*C-1)))}while(Math.abs(T-w)>1e-12&&--V>0);if(0===V){const e=u,t=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(o-r))*e,i=o-r,s=Math.sin(i)*Math.cos(a),h=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(i);return{azimuth:Math.atan2(s,h)/l.Yr,distance:t}}const D=b*(h*h-c*c)/(c*c),G=D/1024*(256+D*(D*(74-47*D)-128)),k=c*(1+D/16384*(4096+D*(D*(320-175*D)-768)))*(P-G*L*(C+G/4*(S*(2*C*C-1)-G/6*C*(4*L*L-3)*(4*C*C-3)))),O=Math.atan2(x*Math.sin(T),v*y-f*x*Math.cos(T)),E=Math.atan2(v*Math.sin(T),v*y*Math.cos(T)-f*x);return e.azimuth=O/l.Yr,e.distance=k,e.reverseAzimuth=E/l.Yr,e}function y(e,t,i="meters"){if(!e||!t)throw new s.Z("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!t.spatialReference)throw new s.Z("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!e.spatialReference.equals(t.spatialReference))throw new s.Z("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const{spatialReference:r}=e;if(!u(r))throw new s.Z("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.equals(t))return{distance:0,azimuth:0,reverseAzimuth:0};const n={distance:null};return v(n,[e.x,e.y],[t.x,t.y],r),n.distance=(0,h.En)(n.distance,"meters",i),n}function x(e,t,i){if(!e||null==t||null==i)throw new s.Z("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(i<0||i>360)throw new s.Z("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0° to 360° degrees");if(!e.spatialReference)throw new s.Z("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const{spatialReference:r}=e;if(!u(r))throw new s.Z("geodesic-distance:not-supported","input geometry spatial reference is not supported");const o=[0,0];return f(o,[e.x,e.y],i,t,r),new n.Z({x:o[0],y:o[1],spatialReference:r})}},42039:(e,t,i)=>{"use strict";i.d(t,{Y6:()=>g});var s=i(27780),r=i(61106),n=(i(36348),i(77625)),o=i(17387),a=i(55735),h=i(38256),l=i(8344),c=i(34353),d=i(14286);class p{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this._unnormalizationInfo=f(e,t)}tag(e){return e}createNew(){return this.tag((0,a.c)())}fromPoint(e){return this.tag((0,a.f)(e.x,e.y))}fromArray(e){return this.tag((0,a.f)(e[0],e[1]))}toArray(e){return[e[0],e[1]]}clone(e){return this.tag((0,a.d)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}createPoint(e){return new r.Z({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new r.Z({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,s){return(0,d.m)(s,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}scale(e,t,i,s){const r=l.qW.get(),n=(0,d.e)(r,e,t),o=(0,d.a)(r,i,(0,d.h)(i,n));(0,d.p)(e,e,o,s-1)}rotate(e,t,i){(0,d.r)(e,e,t,i)}pointToArray(e){return[e.x,e.y]}getZ(e,t){return t}hasZ(){return!1}unnormalize(e){_(e,this._unnormalizationInfo)}fromXYZ(e){return this.tag((0,a.f)(e[0],e[1]))}toXYZ(e,t=0){return(0,n.f)(e[0],e[1],t)}}class u{constructor(e,t,i){this.valueType=e,this.spatialReference=t,this._unnormalizationInfo=f(t,i)}tag(e){return e}createNew(){return this.tag((0,n.c)())}fromPoint(e){return this.tag((0,n.f)(e.x,e.y,0===this.valueType?e.z:e.m))}fromArray(e){return this.tag((0,n.f)(e[0],e[1],e[2]||0))}toArray(e){return[e[0],e[1],e[2]]}clone(e){return this.tag((0,n.d)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}createPoint(e){return new r.Z({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new r.Z({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){const t=0===this.valueType,i=1===this.valueType;return{x:e[0],y:e[1],z:t?e[2]:void 0,m:i?e[2]:void 0,hasZ:t,hasM:i,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,s){return(0,o.e)(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,0===this.valueType&&(e[2]+=s)}scale(e,t,i,s){const r=l.qW.get(),n=(0,d.e)(r,e,t),o=(0,d.a)(r,i,(0,d.h)(i,n));(0,d.p)(e,e,o,s-1)}rotate(e,t,i){(0,d.r)(e,e,t,i)}pointToArray(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}getZ(e,t){return 0===this.valueType?e[2]:t}hasZ(){return 0===this.valueType}unnormalize(e){_(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag((0,n.f)(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:i))}toXYZ(e,t=0){return this.tag((0,n.f)(e[0],e[1],0===this.valueType?e[2]:t))}}class m{constructor(e,t){this.spatialReference=e,this._unnormalizationInfo=f(e,t)}tag(e){return e}createNew(){return this.tag((0,h.c)())}fromPoint(e){return this.tag((0,h.f)(e.x,e.y,e.z,e.m))}fromArray(e){return this.tag((0,h.f)(e[0],e[1],e[2]||0,e[3]||0))}toArray(e){return[e[0],e[1],e[2],e[3]]}clone(e){return this.tag((0,h.b)(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}createPoint(e){return new r.Z({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createPointFromArray(e){return new r.Z({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,s){return(0,c.l)(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,e[2]+=s}scale(e,t,i,s){const r=l.qW.get(),n=(0,d.e)(r,e,t),o=(0,d.a)(r,i,(0,d.h)(i,n));(0,d.p)(e,e,o,s-1)}rotate(e,t,i){(0,d.r)(e,e,t,i)}pointToArray(e){return[e.x,e.y,e.z,e.m]}getZ(e){return e[2]}hasZ(){return!0}unnormalize(e){_(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag((0,h.f)(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e){return(0,n.f)(e[0],e[1],e[2])}}function g(e,t,i,s){return e&&t?new m(i,s):t?new u(1,i,s):e?new u(0,i,s):new p(i,s)}function _(e,t){if(!t.supported)return;let i=1/0,s=-1/0;const r=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let n=e.pos[0];for(;n<t.lowerBoundX;)n+=r;for(;n>t.upperBoundX;)n-=r;i=Math.min(i,n),s=Math.max(s,n),e.pos[0]=n}));const n=s-i;r-n<n&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=r)}))}function f(e,t){const i=(0,s.C5)(e);return"global"===t&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}},97450:(e,t,i)=>{"use strict";i.d(t,{wA:()=>c,kS:()=>l,XE:()=>d,Xz:()=>h});var s=i(59472),r=i(53817),n=i(93833),o=(i(36348),i(35470)),a=i(42039);class h{constructor(e){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=e}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class l{constructor(e,t,i){this.type="edge",this.component=e,this.left=t,this.right=i,t.right=this,i.left=this}}class c{constructor(e){this.vertices=[],this.edges=[],this.data=e}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let s=null,r=e,n=t;do{s=r,s.index=n++,r=s.right?s.right.right:null}while(null!=r&&r!==i);s.left&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let i=t;do{e(i,i.index),i=(0,s.pC)(i.right)?i.right.right:null}while(i!==t&&null!=i)}}class d extends o.Z{constructor(e){super(),this.coordinateHelper=e,this.undoStack=[],this.redoStack=[],this.components=[]}apply(e,t=1){0!==t&&!(0,s.Wi)(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[])}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();e.undo(),this.redoStack.push(e)}}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();e.apply(),this.undoStack.push(e)}}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,s)=>{const r=[];let n=i.vertices.find((e=>null==e.left));const o=n;do{r.push(t(n.pos)),n=n.right?n.right.right:null}while(n&&n!==o);e.push(r)})),new n.Z({paths:e,spatialReference:this.coordinateHelper.spatialReference})}toPolygon(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,r)=>{const n=[],o=i.vertices[0];let a=o;const h=a;do{n.push(t(a.pos)),a=(0,s.pC)(a.right)?a.right.right:null}while(a&&a!==h);n.push(t(o.pos)),e.push(n)})),new r.Z({rings:e,spatialReference:this.coordinateHelper.spatialReference})}static fromGeometry(e,t){const i=(0,a.Y6)(e.hasZ,e.hasM,e.spatialReference,t),s=new d(i);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const r=t[e],n=new c(s),o=r.length-1;for(let e=0;e<o;++e){const t=i.fromArray(r[e]),s=new h(n);n.vertices.push(s),s.pos=t,s.index=e}const a=n.vertices.length-1;for(let e=0;e<a;++e){const t=n.vertices[e],i=n.vertices[e+1],s=new l(n,t,i);n.edges.push(s)}const d=new l(n,n.vertices[n.vertices.length-1],n.vertices[0]);n.edges.push(d),s.components.push(n)}}break;case"polyline":for(const t of e.paths){const e=new c(s),r=t.length;for(let s=0;s<r;++s){const r=i.fromArray(t[s]),n=new h(e);e.vertices.push(n),n.pos=r,n.index=s}const n=e.vertices.length-1;for(let t=0;t<n;++t){const i=e.vertices[t],s=e.vertices[t+1],r=new l(e,i,s);e.edges.push(r)}s.components.push(e)}}return s}}},66497:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});var s=i(59472),r=i(97450);class n{constructor(e,t,i){this.editGeometry=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}apply(){let e="redo";if((0,s.Wi)(this.addedVertex)&&(e="apply",this.addedVertex=new r.Xz(this.component)),0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{const e=(0,s.Wg)(this.component.getLastVertex());let t=null;e.right&&(this.originalEdge=e.right,t=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,(0,s.Wi)(this.left)&&(this.left=new r.kS(this.component,e,this.addedVertex)),this.component.edges.push(this.left),e.right=this.left,(0,s.pC)(this.originalEdge)&&(0,s.pC)(t)&&((0,s.Wi)(this.right)&&(this.right=new r.kS(this.component,this.addedVertex,t)),this.component.edges.push(this.right),t.left=this.right),this.component.updateVertexIndex(this.addedVertex,e.index+1)}const t={addedVertices:[this.addedVertex],operation:e};this.editGeometry.emit("change",t)}undo(){if((0,s.Wi)(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),(0,s.pC)(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),(0,s.pC)(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),(0,s.pC)(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),(0,s.pC)(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const e={removedVertices:[this.addedVertex],operation:"undo"};this.editGeometry.emit("change",e)}accumulate(e){return!1}}},62216:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ci});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),o=i(51894),a=i(87566),h=(i(10923),i(57002),i(86035),i(39105)),l=i(93533),c=(i(40450),i(24258)),d=i(9200),p=i(19401),u=i(90806),m=i(59691),g=i(80621),_=i(65867),f=i(19539),v=i(76916),y=i(59472),x=i(96071),w=i(77625),b=i(17387),L=i(67128),C=i(12811),S=i(67134),P=i(39746),M=i(48430),R=i(73103),A=i(34937),z=i(50777),V=i(39160),T=i(14286),D=i(74808),G=i(82677);i(38836);let k=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),O=(e,t,i)=>{for(let s=0,r=t.length;s<r;s++){let r=t[s];Array.isArray(r)?O(e,r,i):null!=r&&!1!==r&&("string"==typeof r&&(r=k(r)),i.push(r))}};function E(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let s,r;return i&&1===i.length&&"string"==typeof i[0]?s=i[0]:i&&(r=[],O(e,i,r),0===r.length&&(r=void 0)),{vnodeSelector:e,properties:t,children:r,text:""===s?void 0:s,domNode:null}}i(79618);let I=class extends G.default{constructor(e){super(e),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(e){this._set("startX",e[0]),this._set("startY",e[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(e){this._set("endX",e[0]),this._set("endY",e[1])}get strokeStyle(){const e=this.color;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get lineCap(){return"round"}render(){const{height:e,left:t,top:i,width:s,x1:r,x2:n,y1:o,y2:a}=this.calculateCoordinates(Z),h=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return E("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:i+"px",width:s+"px",height:e+"px",visibility:this.visible?"visible":"hidden"}},[E("svg",{width:s,height:e},[E("line",{x1:r,y1:o,x2:n,y2:a,style:h})])])}renderCanvas(e){if(!this.visible)return;e.strokeStyle=this.strokeStyle,e.lineWidth=this.width,e.lineCap=this.lineCap;const t=this.calculateCoordinates(Z);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}calculateCoordinates(e){const t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),s=Math.min(this.startY,this.endY),r=Math.max(this.startY,this.endY),n=this.width;return e.left=t-n,e.top=s-n,e.width=i-t+2*n,e.height=Math.max(20,r-s+2*n),e.x1=this.startX-t+n,e.y1=this.startY-s+n,e.x2=this.endX-t+n,e.y2=this.endY-s+n,e}};(0,s._)([(0,n.Cb)()],I.prototype,"startX",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"startY",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"endX",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"endY",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"startPosition",null),(0,s._)([(0,n.Cb)()],I.prototype,"endPosition",null),(0,s._)([(0,n.Cb)()],I.prototype,"width",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"color",void 0),(0,s._)([(0,n.Cb)()],I.prototype,"visible",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],I.prototype,"strokeStyle",null),I=(0,s._)([(0,a.j)("esri.views.overlay.LineOverlayItem")],I);const Z={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};const U=I,j={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let W=class extends G.default{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor="rgba(0, 0, 0, 0.6)",this.textColor="white",this.textShadowColor=[0,0,0],this.textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get padding(){return.5*this.fontSize}render(){return E("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:`0 0 ${this.textShadowSize}px rgb(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]})`}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this.padding,s=this.padding,r=e.measureText(this.text).width,n=this.fontSize,o=q[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=r+2*i,h=n+2*i,l=this.x+o.x*a,c=this.y+o.y*h;this.roundedRect(e,l,c,a,h,s),e.fillStyle=this.backgroundColor,e.fill();const d=this.x+(o.x+.5)*a,p=this.y+(o.y+.5)*h;this._renderTextShadow(e,this.text,d,p),e.fillStyle=this.textColor,e.fillText(this.text,d,p)}_renderTextShadow(e,t,i,s){e.lineJoin="miter",e.fillStyle=`rgba(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]}, ${1/B.length})`;const r=this.textShadowSize;for(const[n,o]of B)e.fillText(t,i+r*n,s+r*o)}roundedRect(e,t,i,s,r,n){e.beginPath(),e.moveTo(t,i+n),e.arcTo(t,i,t+n,i,n),e.lineTo(t+s-n,i),e.arcTo(t+s,i,t+s,i+n,n),e.lineTo(t+s,i+r-n),e.arcTo(t+s,i+r,t+s-n,i+r,n),e.lineTo(t+n,i+r),e.arcTo(t,i+r,t,i+r-n,n),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in j)e[j[t]]=this.anchor===t;return e}};(0,s._)([(0,n.Cb)()],W.prototype,"x",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"y",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"position",null),(0,s._)([(0,n.Cb)()],W.prototype,"text",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"fontSize",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"anchor",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"visible",void 0),(0,s._)([(0,n.Cb)()],W.prototype,"padding",null),W=(0,s._)([(0,a.j)("esri.views.overlay.TextOverlayItem")],W);const q={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},B=[];{const e=16;for(let t=0;t<360;t+=360/e)B.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const F=W;class H extends D.l{constructor(e){super(e.view),this._handles=new m.Z,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text=null,this._fontSize=14,this._distance=25,this._anchor="right",this.applyProps(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(e){this._text=e,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(e){this._distance!==e&&(this._distance=e,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(e){this._anchor!==e&&(this._anchor=e,this._updateLabelPosition())}overlaps(e){return this.textItem.visible&&e.textItem.visible&&this.view.overlay.overlaps(this._textItem,e.textItem)}_updateLabelPosition(){if(this.attached){if(this._showText=!1,this._showCallout=!1,(0,y.pC)(this.geometry)&&this.view._stage)switch(this.geometry.type){case"point":this._computeLabelPositionFromPoint(this.geometry,ie)&&(this._textItem.position=[ie[0],ie[1]],this._textItem.anchor="center",this._showText=!0);break;case"corner":this._computeLabelPositionFromCorner(this.geometry,this._distance,ie,se)&&(this._showCallout=this._updatePosition(ie,se),this._showText=!0);break;case"segment":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,ie,se)&&(this._showText=!0,this._showCallout=this._updatePosition(ie,se))}this.updateVisibility(this.visible)}}_computeLabelPositionFromPoint(e,t){this.view.renderCoordsHelper.toRenderCoords(e,ee);const i=this.view._stage.camera;return i.projectToRenderScreen(ee,te),!(te[2]<0||te[2]>1||(i.renderToScreen(te,t),0))}_computeLabelPositionFromCorner(e,t,i,s){if(!e)return!1;const r=this.view._stage.camera;return Y(e.left,1,r,K),(0,T.n)(K,K),Y(e.right,0,r,J),(0,T.i)(Q,K,J),(0,T.n)(Q,Q),(0,T.f)(Q,Q),r.projectToRenderScreen(e.left.endRenderSpace,te),!(te[2]<0||te[2]>1||(r.renderToScreen(te,i),(0,T.a)(Q,Q,t*r.pixelRatio),(0,T.i)(Q,Q,te),r.renderToScreen(Q,s),0))}_computeLabelPositionFromSegment(e,t,i,s,r){if(!e)return!1;const n=e.segment,o=this.view._stage.camera;(0,V.cT)(n.startRenderSpace,n.endRenderSpace,K,o),(0,T.s)(Q,-K[1],K[0]);let a=!1;switch(i){case"top":a=Q[1]<0;break;case"bottom":a=Q[1]>0;break;case"left":a=Q[0]>0;break;case"right":a=Q[0]<0}if(a&&(0,T.n)(Q,Q),0===(0,T.l)(Q))switch(i){case"top":Q[1]=1;break;case"bottom":Q[1]=-1;break;case"left":Q[0]=-1;break;case"right":Q[0]=1}return n.eval(he[e.sampleLocation],ee),o.projectToRenderScreen(ee,te),!(te[2]<0||te[2]>1||(o.renderToScreen(te,s),(0,T.a)(Q,Q,t*o.pixelRatio),(0,T.i)(Q,Q,te),o.renderToScreen(Q,r),0))}_updatePosition(e,t){if(t){const i=t[0]-e[0],s=t[1]-e[1];return this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(s)?i>0?"left":"right":s>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],!0}return this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new F({visible:!0}),this._textItem.text=(0,y.Wg)(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new U({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch("camera",(()=>{this._updateLabelPosition()})))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}}function Y(e,t,i,s){e.eval(t,X,N),(0,b.b)($,X,N),i.projectToRenderScreen(X,re),i.projectToRenderScreen($,oe),(0,T.e)(s,ae,ne),(0,T.f)(s,s)}const X=(0,w.c)(),$=(0,w.c)(),N=(0,w.c)(),K=(0,x.gX)(),J=(0,x.gX)(),Q=(0,x.gX)(),ee=(0,w.c)(),te=(0,x.J$)(),ie=(0,x.s1)(),se=(0,x.s1)(),re=(0,x.J$)(),ne=re,oe=(0,x.J$)(),ae=oe,he={start:0,center:.5,end:1};var le=i(51635),ce=i(20241),de=i(68500),pe=i(71702),ue=i(26701),me=i(30090),ge=i(10762),_e=i(6048),fe=i(23240),ve=i(97853),ye=i(44801),xe=i(11379),we=i(51007),be=i(36904),Le=i(89553),Ce=i(66704),Se=i(88214),Pe=i(41178);class Me extends ve.A{initializeProgram(e){const t=Me.shader.get(),i=this.configuration,s=t.build({OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new we.Z(e.rctx,s.generateSource("vertex"),s.generateSource("fragment"),xe.i)}bindPass(e,t,i){Le.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform2fv("size",t.size),this.program.setUniform4fv("color1",t.color1),this.program.setUniform4fv("color2",t.color2),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("viewportDim",[e.getViewport().width,e.getViewport().height]),(0,Se.C)(this.program,e,i))}bindDraw(e){Le.G.bindView(this.program,e)}setPipelineState(e){const t=this.configuration,i=3===e,s=2===e;return(0,be.sm)({blending:t.transparent?i?Ae:(0,Ce.$L)(e):null,depthTest:{func:(0,Ce.$x)(e)},depthWrite:i?t.writeDepth&&be.LZ:(0,Ce.Vc)(e),colorWrite:be.BK,polygonOffset:i||s?t.polygonOffset&&Re:{factor:-1,units:-25}})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Me.shader=new fe.J(Pe.C,(()=>i.e(6606).then(i.bind(i,76606))));const Re={factor:0,units:-25},Ae=(0,be.wK)(770,1,771,771);class ze extends ye.m{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}(0,s._)([(0,ye.o)()],ze.prototype,"transparent",void 0),(0,s._)([(0,ye.o)()],ze.prototype,"writeDepth",void 0),(0,s._)([(0,ye.o)()],ze.prototype,"polygonOffset",void 0),(0,s._)([(0,ye.o)({count:4})],ze.prototype,"transparencyPassType",void 0),(0,s._)([(0,ye.o)()],ze.prototype,"multipassTerrainEnabled",void 0),(0,s._)([(0,ye.o)()],ze.prototype,"cullAboveGround",void 0);class Ve extends ge.F5{constructor(e){super(e,De),this.techniqueConfig=new ze}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e){return this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!e&&e.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!e||e.cullAboveGround,this.techniqueConfig}intersect(e,t,i,s,r,n,o){return(0,me.Bw)(e,t,s,r,n,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output?new Te(e):void 0}createBufferWriter(){return new _e.G_(_e.W1)}}class Te extends ue.Z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(Me,this.material.getTechniqueConfig(e),this.technique)}beginSlot(e){let t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const De={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,writeDepth:!0,polygonOffset:!1,...ge.zh};class Ge extends pe._{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=4,this._geometry=null,this._size=[1,1],this._color1=[1,.5,0,.5],this._color2=[1,1,1,.5],this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get size(){return this._size}set size(e){this._size=e,this.updateMaterial()}get color1(){return this._color1}set color1(e){this._color1=e,this.updateMaterial()}get color2(){return this._color2}set color2(e){this._color2=e,this.updateMaterial()}updateMaterial(){(0,y.pC)(this._checkerBoardMaterial)&&this._checkerBoardMaterial.setParameterValues({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded})}createExternalResources(){this._checkerBoardMaterial=new Ve({size:this._size,color1:this._color1,color2:this._color2,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:4})}destroyExternalResources(){this._checkerBoardMaterial=null}forEachExternalMaterial(e){(0,y.pC)(this._checkerBoardMaterial)&&e(this._checkerBoardMaterial)}createGeometries(e){if((0,y.Wi)(this._geometry)||(0,y.Wi)(this._checkerBoardMaterial))return;const t=ke;(0,L.n)(t,this.transform);const i=this._geometry,s=[],r=(0,w.c)();i.position.forEach((e=>{(0,b.f)(r,e,t),s.push(r[0],r[1],r[2])}));const n=[];i.uv.forEach((e=>{n.push(e[0],e[1])}));const o=new de.Z([["position",{size:3,data:s,exclusive:!0}],["uv0",{size:2,data:n,exclusive:!0}]],[["position",i.triangleIndices],["uv0",i.triangleIndices]]);e.addGeometry(o,this._checkerBoardMaterial)}geometryChanged(){this.recreateGeometry()}}const ke=(0,w.c)();var Oe=i(17154),Ee=i(89333),Ie=i(17333),Ze=i(8344);class Ue{constructor(e=(0,w.c)(),t=(0,w.c)()){this.startRenderSpace=e,this.endRenderSpace=t,this.type="euclidean"}eval(e,t,i){return(0,b.e)(t,this.startRenderSpace,this.endRenderSpace,e),i&&((0,b.f)(i,this.endRenderSpace,this.startRenderSpace),(0,b.n)(i,i)),t}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const n=qe;(0,b.f)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([r[0],r[1],r[2]])},n=t.worldUpAtPosition(this.eval(.5,We),Ze.WM.get());return r(this.startRenderSpace,n),r(this.endRenderSpace,n),{points:i,normals:s}}}class je{constructor(e,t,i){this.startRenderSpace=e,this.endRenderSpace=t,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,w.c)(),this._end=(0,w.c)(),this._pcpf=(0,Ee.rS)(i),this._project=(0,Ie.Up)(i,this._pcpf),this._projectIn(e,this._start),this._projectIn(t,this._end)}_projectIn(e,t){this._project?(0,Ie.SH)(e,this.renderSpatialReference,t,this._pcpf):(0,b.g)(t,e)}eval(e,t,i){if(this._project)if(i){const s=qe;(0,Oe.ek)(this._start,this._end,e,t,s),(0,b.b)(Be,t,s),(0,Ie.SH)(t,this._pcpf,t,this.renderSpatialReference),(0,Ie.SH)(Be,this._pcpf,Be,this.renderSpatialReference),(0,b.f)(i,Be,t),(0,b.n)(i,i)}else(0,Oe.ZA)(this._start,this._end,e,t),(0,Ie.SH)(t,this._pcpf,t,this.renderSpatialReference);else(0,b.e)(t,this._start,this._end,e),i&&((0,b.f)(i,this._end,this._start),(0,b.n)(i,i));return t}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const n=Be;(0,b.f)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([r[0],r[1],r[2]])};for(let e=0;e<128;++e){const i=e/127,s=We,n=qe;this.eval(i,s),t.worldUpAtPosition(s,n),r(s,n)}return{points:i,normals:s}}}const We=(0,w.c)(),qe=(0,w.c)(),Be=(0,w.c)(),Fe={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};class He{constructor(e,t=new R.D,i={}){this._model=e,this._manipulators=t,this.vertexManipulators=[],this._visible=!1,this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._laserLine=null,this._measurementArea=null,this._areaLabel=null,this._pathLengthLabel=null,this._cursorSegmentLengthLabel=null,this._perimeterLengthLabel=null,this._cursorManipulator=null,this._pathSegments=[],this._perimeterSegments=[],this._cursorSegment=null,this._listenerHandles=null,this._origin=(0,w.c)(),this._originTransform=(0,C.c)(),this._tempHandlePosition=(0,w.c)(),this._cursorPositionRenderSpace=(0,w.c)(),this._pathVersion=-1,this._view=this._model.sceneView,this._params=(0,V.gh)(Fe,i),this._intersector=new S.r(this._view.state.mode),this._intersector.options.store=0;const s=(0,z.aD)(this._view,this._params.handleColor,this._params.handleOpacity);s.available=!1,s.radius=this._params.handleRadius,s.interactive=!1,this._manipulators.add(s),this._cursorManipulator=s,this._path=new ce.r({view:this._view,attached:!0,width:this._params.pathLineWidth,color:this._params.pathLineColor,polygonOffset:!0,renderOccluded:4}),this._intersectedPath=new ce.r({view:this._view,attached:!0,width:this._params.pathLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4}),this._perimeter=new ce.r({view:this._view,attached:!0,width:this._params.perimeterLineWidth,color:this._params.perimeterLineColor,polygonOffset:!0,renderOccluded:4}),this._intersectedPerimeter=new ce.r({view:this._view,attached:!0,width:this._params.perimeterLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4}),this._projectionLines=new ce.r({view:this._view,attached:!0,width:this._params.projectionLineWidth,color:this._params.projectionLineColor,stipplePattern:(0,M.z5)(this._params.projectionLineStippleSize),stippleIntegerRepeats:!1,polygonOffset:!0,renderOccluded:4}),this._laserLine=new le.W({view:this._view,attached:!0,style:{glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,globalAlpha:this._params.laserLineGlobalAlpha}}),this._measurementArea=new Ge({view:this._view,attached:!0,color1:this._params.areaColor1,color2:this._params.areaColor2}),this._areaLabel=new H({view:this._view,attached:!0,fontSize:16}),this._pathLengthLabel=new H({view:this._view,attached:!0,fontSize:12}),this._cursorSegmentLengthLabel=new H({view:this._view,attached:!0,fontSize:12}),this._perimeterLengthLabel=new H({view:this._view,attached:!0,fontSize:12})}destroy(){this.hide(),this._laserLine.destroy(),this._laserLine=null,this._measurementArea.destroy(),this._measurementArea=null,this._path.destroy(),this._path=null,this._intersectedPath.destroy(),this._intersectedPath=null,this._perimeter.destroy(),this._perimeter=null,this._intersectedPerimeter.destroy(),this._intersectedPerimeter=null,this._areaLabel.destroy(),this._areaLabel=null,this._pathLengthLabel.destroy(),this._pathLengthLabel=null,this._cursorSegmentLengthLabel.destroy(),this._cursorSegmentLengthLabel=null,this._perimeterLengthLabel.destroy(),this._perimeterLengthLabel=null}get requiresCursorPoint(){return("initial"===this._model.state||"drawing"===this._model.state)&&this._model.active}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){const e=this._laserLine.testData;return{labels:{area:this._areaLabel,pathLength:this._pathLengthLabel,cursorSegmentLength:this._cursorSegmentLengthLabel,perimeterLength:this._perimeterLengthLabel},laserLineRenderer:(0,y.pC)(e)?{heightManifoldEnabled:e.heightManifoldEnabled,heightManifoldTarget:e.heightManifoldTarget,pointDistanceEnabled:e.pointDistanceEnabled,pointDistanceOrigin:e.pointDistanceOrigin,pointDistanceTarget:e.pointDistanceTarget,lineVerticalPlaneEnabled:e.lineVerticalPlaneEnabled}:{heightManifoldEnabled:!1,heightManifoldTarget:null,pointDistanceEnabled:!1,pointDistanceOrigin:null,pointDistanceTarget:null,lineVerticalPlaneEnabled:!1}}}show(){this._visible||(this._visible=!0,this._path.visible=!0,this._intersectedPath.visible=!0,this._perimeter.visible=!0,this._intersectedPerimeter.visible=!0,this._projectionLines.visible=!0,this._laserLine.visible=!0,this._measurementArea.visible=!0,this._areaLabel.visible=!0,this._pathLengthLabel.visible=!0,this._cursorSegmentLengthLabel.visible=!0,this._perimeterLengthLabel.visible=!0,this._initializeListeners(),this._updateAll(this._model.viewData))}hide(){this._visible&&(this._visible=!1,this._path.visible=!1,this._intersectedPath.visible=!1,this._perimeter.visible=!1,this._projectionLines.visible=!1,this._intersectedPerimeter.visible=!1,this._laserLine.visible=!1,this._measurementArea.visible=!1,this._areaLabel.visible=!1,this._pathLengthLabel.visible=!1,this._cursorSegmentLengthLabel.visible=!1,this._perimeterLengthLabel.visible=!1,this._destroyListeners(),this.vertexManipulators.forEach((e=>{this._removeVertexManipulator(e.manipulator)})),this.vertexManipulators=[],this._view.cursor=null)}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return(0,y.pC)(i)?i.manipulator.metadata:null}manipulatorToVertex(e){return e.metadata}pick(e){const t=this._view.spatialReference,i=(0,x.md)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,r=(0,w.c)();if(!s.getIntersectionPoint(r))return new He.PickResult;const n=this._view.renderCoordsHelper.fromRenderCoords(r,t);if((0,y.Wi)(n))return new He.PickResult;const o="TerrainRenderer"===s.intersector?"surface":"feature";return new He.PickResult(o,r,n)}overlappingHandles(e,t){return(0,V.Vl)(e,t,this._view)<=this._params.handleRadius}screenToMap3D(){return(0,A.gv)(this._view)}_updateOrigin(e){(0,V.H2)(e.positionsRenderCoords,this._origin),(0,L.i)(this._originTransform),(0,L.t)(this._originTransform,this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform}_updateAll(e){this._visible&&(this._updateOrigin(e),this._updatePathSegments(e),this._updatePerimeterSegments(e),this._updateVertexManipulators(e),this._updateArea(e),this._updateProjectionLines(e),this._updateLabels(e),this._updateLaserLine(),this._pathVersion=e.path.version)}_createSegments(e,t){const i=e.path,s=this._view.renderCoordsHelper.spatialReference,r=this._model.measurementMode,n=[],o=[],a=[],h=e.validMeasurement?i.numVertices:i.numVertices-1;for(let l=0;l<h;++l){const h=e[t][l],c=e[t][(l+1)%i.numVertices];let d=null;switch(r){case"euclidean":d=new Ue(h,c);break;case"geodesic":d=new je(h,c,s)}e.intersectingSegments.has(l)?a.push(d):o.push(d),n.push(d)}return{all:n,nonIntersecting:o,intersecting:a}}_updatePathSegments(e){const t=this._createSegments(e,"positionsRenderCoords"),i=e.path,s=this._view.renderCoordsHelper,r=s.spatialReference,n=this._model.measurementMode;if(this._cursorSegment=null,i.numVertices>0&&"drawing"===this._model.state&&(0,y.pC)(this._model.cursorPoint)&&s.toRenderCoords(this._model.cursorPoint,this._cursorPositionRenderSpace)){const s=e.positionsRenderCoords[i.numVertices-1],o=this._cursorPositionRenderSpace;let a=null;switch(n){case"euclidean":a=new Ue(s,o);break;case"geodesic":a=new je(s,o,r)}t.nonIntersecting.push(a),this._cursorSegment=a}this._path.setGeometryFromSegments(t.nonIntersecting,this._origin),this._intersectedPath.setGeometryFromSegments(t.intersecting,this._origin),this._pathSegments=t.all}_updatePerimeterSegments(e){const t=this._createSegments(e,"positionsFittedRenderCoords");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._perimeterSegments=t.all}_createVertexManipulator(){const e=(0,z.aD)(this._view,this._params.handleColor,this._params.handleOpacity);return e.radius=this._params.handleRadius,{id:this._manipulators.add(e),manipulator:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(e){const t=this._model.path.vertices,i=this.vertexManipulators;(0,V.B$)(i,t.length,(()=>this._createVertexManipulator()),(e=>this._removeVertexManipulator(e.manipulator))),i.forEach(((i,s)=>{i.manipulator.metadata=t[s],i.manipulator.renderLocation=e.positionsRenderCoords[s]})),"drawing"===this._model.state&&(0,y.pC)(this._model.cursorPoint)?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._model.cursorPoint):this._cursorManipulator.available=!1}_updateArea(e){switch(this._model.measurementMode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsProjected,position:e.positionsFittedRenderCoords,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=!0):this._measurementArea.visible=!1}_updateAreaGeodesic(){}_updateProjectionLines(e){const t=e.path;if(t.numVertices>0&&e.validMeasurement&&"euclidean"===this._model.measurementMode){const e=[];for(let i=0;i<t.numVertices;++i){const t=(0,w.c)();(0,b.f)(t,this._model.viewData.positionsRenderCoords[i],this._origin);const s=(0,w.c)();(0,b.f)(s,this._model.viewData.positionsFittedRenderCoords[i],this._origin),e.push([t,s])}this._projectionLines.geometry=e}else this._projectionLines.geometry=null}_updateLabels(e){if(!this._visible)return;const t=this._model,i=this._view,s="drawing"===t.state;if(this._areaLabel.geometry=i.renderCoordsHelper.fromRenderCoords(e.areaCentroid,i.spatialReference),this._areaLabel.text=t.areaLabel,this._areaLabel.visible=e.validMeasurement&&0===e.intersectingSegments.size&&null!=t.areaLabel,e.pathLengthLabelSegmentIndex>=0&&e.pathLengthLabelSegmentIndex<this._pathSegments.length){const i=this._pathSegments[e.pathLengthLabelSegmentIndex],r=(0,y.pC)(this._cursorSegment)?this._cursorSegment:Ye;this._pathLengthLabel.distance=this._params.labelDistance,this._pathLengthLabel.geometry={type:"corner",left:i,right:r},this._pathLengthLabel.text=t.pathLengthLabel,this._pathLengthLabel.visible=s&&t.path.numVertices>0}else this._pathLengthLabel.visible=!1;this._cursorSegmentLengthLabel.distance=this._params.labelDistance,this._cursorSegmentLengthLabel.geometry=(0,y.pC)(this._cursorSegment)?{type:"segment",segment:this._cursorSegment,sampleLocation:"end"}:null,this._cursorSegmentLengthLabel.anchor="bottom",this._cursorSegmentLengthLabel.text=t.cursorSegmentLengthLabel,this._cursorSegmentLengthLabel.visible=s&&!!t.cursorSegmentLength&&0!==t.cursorSegmentLength.value,this._cursorSegmentLengthLabel.overlaps(this._pathLengthLabel)&&(this._cursorSegmentLengthLabel.visible=!1),this._pathLengthLabel.overlaps(this._areaLabel)&&(this._pathLengthLabel.visible=!1),this._updatePerimeterLabel(this._model.viewData)}_updatePerimeterLabel(e){const t=this._model,i="geodesic"===t.measurementMode;if(t.validMeasurement&&0===e.intersectingSegments.size){this._perimeterLengthLabel.distance=this._params.labelDistance,this._perimeterLengthLabel.anchor="top",this._perimeterLengthLabel.text=t.perimeterLengthLabel,this._perimeterLengthLabel.visible=!0;let s=!0;for(let t=0;t<e.path.numVertices;++t){const r=(e.perimeterLengthLabelSegmentIndex+t)%e.path.numVertices,n=i?this._pathSegments[r]:this._perimeterSegments[r];if(s=!0,this._perimeterLengthLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},!this._perimeterLengthLabel.overlaps(this._areaLabel))break;s=!1}this._perimeterLengthLabel.visible=s}else this._perimeterLengthLabel.visible=!1}_getFocusPoint(){const e=this._model,t=this._model.lastDraggedVertex;switch(e.state){case"drawing":return(0,y.pC)(e.cursorPoint)?e.cursorPoint:(0,y.pC)(t)?e.path.getVertexPositionAsPoint(t):(0,y.Wg)(e.path.lastPoint);case"editing":return(0,y.pC)(t)?e.path.getVertexPositionAsPoint(t):null;default:return e.cursorPoint}}_updateLaserLine(){const e=this._model,t=this._params.laserLineEnabled&&"measured"!==e.state&&e.active,i=this._getFocusPoint();if(t&&(0,y.pC)(i)){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(i,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new m.Z,this._listenerHandles.add([this._model.watch(["state","lastDraggedVertex"],(()=>this._updateLaserLine())),this._model.watch(["cursorPoint","unit","measurementMode","active","viewData"],(()=>this._updateAll(this._model.viewData))),this._model.watch(["areaLabel","cursorSegmentLengthLabel","pathLengthLabel","perimeterLengthLabel"],(()=>{this._model.viewData.path.version===this._pathVersion?this._updateLabels(this._model.viewData):this._updateAll(this._model.viewData)})),this._view.state.watch("camera",(()=>this._updatePerimeterLabel(this._model.viewData)))])}_destroyListeners(){this._listenerHandles.destroy(),this._listenerHandles=null}}He._handleGeometry=P.Z.createSphereGeometry(1,32,32),function(e){e.PickRequest=class{};e.PickResult=class{constructor(e=null,t=null,i=null){this.type=e,this.scenePoint=t,this.mapPoint=i}}}(He||(He={}));const Ye=new Ue((0,w.c)(),(0,w.c)());const Xe=He;var $e=i(2887),Ne=i(58722),Ke=i(53640);function Je(e){return"mouse"!==e.pointerType||0===e.button}const Qe=class{constructor(e,t,i){this._manipulators=i,this._handles=new m.Z,this._tempPickRequest=new Xe.PickRequest,this.model=e,this.view=t,this.model.reset(),this._setupManipulators()}destroy(){this._handles.destroy(),this._handles=null}handleInputEvent(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>`manipulator-${e}`;let t=0;const i=e=>i=>("start"===i.action&&(t++,this.model.lastDraggedVertex=(0,y.Wg)(this.view.manipulatorToVertex(e)),"measured"===this.model.state&&(this.model.state="editing")),i),s=()=>e=>"end"===e.action?(t--,0===t&&"editing"===this.model.state&&(this.model.state="measured"),null):e,r=(t,r)=>{this._handles.add([(0,Ke.Xd)(r,((e,t,r)=>{const n=(0,A.J4)(e),o=(0,y.Wg)(this.view.manipulatorToVertex(e));t.next(i(e)).next(n).next(s()).next(this.view.screenToMap3D()).next((t=>{e.location=t.mapEnd,this.model.path.setVertexPosition(o,(0,Ne.WG)(t.mapEnd))}));const a=(0,Ne.WG)(this.model.path.getVertexPositionAsPoint(o));r.next(n).next((()=>{this.model.path.setVertexPosition(o,a),e.location=a}))})),r.events.on("double-click",(e=>{Je(e)&&("drawing"===this.model.state&&this.model.finishMeasurement(),e.stopPropagation())}))],e(t))},n=t=>{this._handles.remove(e(t))};this._manipulators.forEach((({id:e,manipulator:t})=>{r(e,t)})),this._handles.add([this._manipulators.on("after-add",(({item:{id:e,manipulator:t}})=>{r(e,t)})),this._manipulators.on("after-remove",(({item:{id:e}})=>{n(e)}))])}_handleDrag(e){"editing"===this.model.state&&e.stopPropagation()}_handleImmediateClick(e){if(!Je(e))return;const t=(0,$e.vT)(e);if(this.model.active)switch(this.model.state){case"initial":this._addVertexAt(t)&&(this.model.state="drawing",e.stopPropagation());break;case"drawing":{const i=this.view.vertexHandleAt(t,e.pointerType);if((0,y.Wi)(i)){if(this._addVertexAt(t))return}else 0===i.index&&(this.model.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,$e.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){"Enter"===e.key&&"drawing"===this.model.state&&(this.model.finishMeasurement(),e.stopPropagation())}_hoverAt(e){if(this.view.requiresCursorPoint){const t=this._pick(e);t.mapPoint&&(this.model.cursorPoint=t.mapPoint)}else this.model.cursorPoint=null}_addVertexAt(e){const t=this._pick(e);return!!t.mapPoint&&(this.model.path.add(t.mapPoint),!0)}_pick(e){const t=this._tempPickRequest;return t.screenPoint=e,this.view.pick(t)}};var et=i(3766),tt=i(33655),it=i(14071);i(89771);class st{constructor(e,t){this.measure=(0,l.j3)(t),this.value=e,this.unit=t}get isBaseUnit(){return(0,l.YH)(this.unit)}toUnit(e){return new st((0,l.En)(this.value,this.unit,e),e)}toBaseUnit(){return this.toUnit((0,l.WB)(this.unit))}}const rt=st;var nt=i(56888);function ot(e,t,i,s=2,r="abbr"){return(0,nt.VG)(e,t.toUnit(i).value,i,s,r)}let at=class extends G.default{constructor(){super(...arguments),this.result=null}destroy(){this.result=null}set geometry(e){this.result=null,this._set("geometry",(0,y.pC)(e)?e.clone():null)}};(0,s._)([(0,n.Cb)({value:null})],at.prototype,"geometry",null),(0,s._)([(0,n.Cb)()],at.prototype,"result",void 0),at=(0,s._)([(0,a.j)("esri.views.3d.interactive.graphics.AreaMeasurement3D")],at);var ht=i(61106),lt=(i(36348),i(35470)),ct=i(42039),dt=i(97450),pt=i(66497);class ut{constructor(e,t,i){this.editGeometry=e,this.vertex=t,this.pos=i}apply(){let e="redo";(0,y.Wi)(this.originalPosition)&&(e="apply",this.originalPosition=this.vertex.pos),this._apply(e)}undo(){this.vertex.pos=(0,y.Wg)(this.originalPosition);const e={updatedVertices:[this.vertex],operation:"undo"};this.editGeometry.emit("change",e)}accumulate(e){return e instanceof ut&&e.vertex===this.vertex&&(this.pos=e.pos,this._apply("apply"),!0)}_apply(e){this.vertex.pos=this.pos,this.editGeometry.components.forEach((e=>e.unnormalizeVertexPositions()));const t={updatedVertices:[this.vertex],operation:e};this.editGeometry.emit("change",t)}}class mt extends lt.Z{constructor(){super(),this._handles=new m.Z,this._dirty=!0,this._model=null,this._view=null,this._version=0,this._internalGeometryChange=!1}set model(e){this._model=e,(0,y.pC)(this._model)&&(0,y.pC)(this._view)&&this._initialize(this._model,this._view)}get model(){return this._model}get view(){return this._view}set view(e){this._view=e,(0,y.pC)(this._model)&&(0,y.pC)(this._view)&&this._initialize(this._model,this._view)}get initialized(){return(0,y.pC)(this._model)&&(0,y.pC)(this._view)}get version(){return this._version}_initialize(e,t){this._handles.removeAll(),this._handles.add((0,g.init)(e,"geometry",(()=>this._updateEditGeometryFromModelGeometry(e,t)),!0))}_updateEditGeometryFromModelGeometry(e,t){this._version++,this._internalGeometryChange||(this._handles.remove("EditGeometry"),this._editGeometry=(0,y.pC)(e.geometry)?dt.XE.fromGeometry(e.geometry,t.viewingMode):new dt.XE((0,ct.Y6)(!0,!1,t.spatialReference,t.viewingMode)),this.emit("clear",{type:"clear"}),this._handles.add(this._editGeometry.on("change",(t=>{this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.toPolygon():null,this._internalGeometryChange=!1})),"EditGeometry"))}get vertices(){const e=[];return this.forEachVertex((t=>{e.push(t)})),e}get numVertices(){return this.initialized&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}get lastPoint(){if(this.initialized&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getLastVertex();if((0,y.pC)(e))return this._editGeometry.coordinateHelper.createPoint(e.pos)}return null}getVertex(e){if(!this.initialized||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.right.right}while(i!==t&&null!=i);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.createPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.createPoint(this.getVertex(e).pos)}forEachVertex(e){this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex(((i,s)=>{t.toPoint(i.pos,gt),e(gt,s)}))}clear(){(0,y.pC)(this.model)&&(this.model.geometry=null)}add(e){if(!this.initialized)return null;0===this._editGeometry.components.length&&this._editGeometry.components.push(new dt.wA(this._editGeometry));const t=new pt.g(this._editGeometry,this._editGeometry.components[0],this._editGeometry.coordinateHelper.fromPoint(e));return this._editGeometry.apply(t),this.emit("vertex-update",{type:"vertex-update"}),t}ensureContains(e,t=""){let i=!1;if(this._editGeometry.components.forEach((t=>{t.iterateVertices((t=>{t===e&&(i=!0)}))})),!i)throw new Error(`vertex doesnt exist ${t}`);return i}setVertexPosition(e,t){if(!this.initialized)return null;const i=new ut(this._editGeometry,e,this._editGeometry.coordinateHelper.fromPoint(t));return this._editGeometry.apply(i),this.emit("vertex-update",{type:"vertex-update"}),i}}const gt=new ht.Z;var _t,ft=i(73032),vt=i(53817),yt=i(98675),xt=i(70642);!function(e){e.boundingSphere=function(e,t){const i=t.center;(0,b.s)(i,0,0,0);for(let t=0;t<e.length;++t)(0,b.b)(i,i,e[t]);(0,b.a)(i,i,1/e.length);let s=0;for(let t=0;t<e.length;++t)s=Math.max(s,(0,b.h)(i,e[t]));t.radius=Math.sqrt(s)},e.bestFitPlane=function(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,Oe.pG)(e[0],e[1],e[2],t)},e.planePointDistance=function(e,t){return(0,b.d)(e,t)+e[3]},e.segmentLengthEuclidean=function(e,t,i){return(0,Ie.KC)(e,wt,i)&&(0,Ie.KC)(t,bt,i)?(0,b.i)(wt,bt):0},e.segmentLengthGeodesic=function(e,t){if(!(0,Ie.UY)(e,wt)||!(0,Ie.UY)(t,bt))return 0;const i={distance:null};return(0,yt.inverseGeodeticSolver)(i,[wt[0],wt[1]],[bt[0],bt[1]]),i.distance},e.segmentLengthGeodesicVector=function(e,t,i){const s={distance:null};return(0,yt.inverseGeodeticSolver)(s,[e[0],e[1]],[t[0],t[1]],i),s.distance},e.triangleAreaEuclidean=function(e,t,i){const s=t[0]-e[0],r=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return.5*Math.abs(s*o-r*n)},e.triangleAreaGeodesic=function(e,t,i,s){const r=Ct;return(0,Ie.ke)(e,s,wt)&&(0,Ie.ke)(t,s,bt)&&(0,Ie.ke)(i,s,Lt)?(r.setPoint(0,0,wt),r.setPoint(0,1,bt),r.setPoint(0,2,Lt),Math.abs((0,xt.geodesicArea)(r,"square-meters"))):0},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,b.s)(t,0,1,0):(0,b.s)(t,1,0,0),(0,b.c)(i,e,t),(0,b.n)(t,t),(0,b.c)(t,i,e),(0,b.n)(i,i)},e.fitHemisphere=function(e,t=null,i=!0){const s=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,b.d)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,b.g)(t,e[0]),!0;(0,b.s)(St,0,0,0);for(let t=0;t<e.length;++t)(0,b.b)(St,St,e[t]);if((0,b.n)(St,St),s(e,St))return t&&(0,b.g)(t,St),!0;if(!i)return!1;for(let i=0;i<e.length;++i)for(let r=0;r<e.length;++r)if(i!==r&&((0,b.c)(St,e[i],e[r]),(0,b.n)(St,St),s(e,St)))return t&&(0,b.g)(t,St),!0;return!1},e.compareSets=function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(let i=0;i<e.size;++i)if(!t.has(e[i]))return!1;return!0}}(_t||(_t={}));const wt=(0,w.c)(),bt=(0,w.c)(),Lt=(0,w.c)(),Ct=new vt.Z({rings:[[wt,bt,Lt]],spatialReference:ft.Z.WGS84}),St=(0,w.c)();const Pt=_t;var Mt=i(80685),Rt=i(55735),At=i(38256),zt=i(27202);function Vt(e,t){const i=new Float64Array(e.length*t);for(let s=0;s<e.length;++s){const r=e[s];for(let e=0;e<t;++e)i[s*t+e]=r[e]}return i}const Tt=class{constructor(){this.positionsWorldCoords=[],this.positionsRenderCoords=[],this.positionsProjectedWorldCoords=[],this.positionsFittedRenderCoords=[],this.positionsGeographic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.areaCentroidWorldCoords=(0,w.c)(),this.areaCentroidRenderCoords=(0,w.c)(),this.geodesicAreaCentroidRenderCoords=(0,w.c)(),this._length=0,this._centroidRenderCoords=(0,w.c)(),this._planeWorldCoords=(0,At.c)(),this._worldUp=(0,w.c)(),this._worldTangent=(0,w.c)(),this._frame=[(0,w.c)(),(0,w.c)(),(0,w.c)()],this._pathVersion=-1,this._validMeasurement=!1,this._tempU=(0,w.c)(),this._tempV=(0,w.c)(),this._tempVec3=(0,w.c)(),this._tempSphere={center:(0,w.c)(),radius:0}}update(e,t,i,s,r,n,o){if(this._pathVersion===e.version&&this._validMeasurement===s)return;this._pathVersion=e.version,this._validMeasurement=s;const a=e.numVertices;this._resize(a);const h=(0,Ee.rS)(t.spatialReference),l=(0,Ie.Up)(t.spatialReference,h)&&(0,Ie.jF)(t.spatialReference),c=this.positionsGeographic,d=this.positionsWorldCoords,p=this.positionsRenderCoords,u=this.positionsSpherical;e.forEachVertexPosition(((e,t)=>{(0,Ie.KC)(e,d[t],n),(0,Ie.KC)(e,p[t],r),l&&((0,Ie.UY)(e,c[t]),(0,Ie.KC)(e,u[t],h),(0,b.n)(u[t],u[t]))}));const m=this._updatePathLengths(s);if(this.pathLength=this._length>0?new rt(i.normalizeDistance(m),"meters"):null,l){const e=this._updateGeodesicPathLengths(s,n);this.geodesicPathLength=this._length>0?new rt(e,"meters"):null}else this.geodesicPathLength=null;if(!s)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),void this.geodesicIntersectingSegments.clear();this._updateArea(t,i,r,n,o),l&&this._updateGeodesicArea(t)}_resize(e){for(e<this._length&&(this.positionsWorldCoords.length=e,this.positionsRenderCoords.length=e,this.positionsProjectedWorldCoords.length=e,this.positionsFittedRenderCoords.length=e,this.positionsGeographic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorldCoords.push((0,w.c)()),this.positionsRenderCoords.push((0,w.c)()),this.positionsProjectedWorldCoords.push((0,Rt.c)()),this.positionsFittedRenderCoords.push((0,w.c)()),this.positionsGeographic.push((0,w.c)()),this.positionsSpherical.push((0,w.c)()),this.positionsStereographic.push((0,Rt.c)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorldCoords,i=this.pathSegmentLengths;let s=0;for(let r=0;r<this._length;++r){const n=i[r]=(0,b.i)(t[r],t[(r+1)%this._length]);(r<this._length-1||e)&&(s+=n)}return s}_updateGeodesicPathLengths(e,t){const i=this.positionsGeographic,s=this.geodesicPathSegmentLengths;let r=0;for(let n=0;n<this._length;++n){const o=s[n]=Pt.segmentLengthGeodesicVector(i[n],i[(n+1)%this._length],t);(n<this._length-1||e)&&(r+=o)}return r}_updateArea(e,t,i,s,r){const n=e.renderCoordsHelper,o=this.positionsWorldCoords,a=this.positionsRenderCoords,h=this.positionsProjectedWorldCoords,l=this.positionsFittedRenderCoords,c=this._planeWorldCoords,d=this._centroidRenderCoords;(0,V.H2)(a,d),n.worldUpAtPosition(d,this._worldUp),n.worldBasisAtPosition(d,0,this._worldTangent),(0,Ie.Qr)(d,this._worldUp,i,this._worldUp,s),(0,Ie.Qr)(d,this._worldTangent,i,this._worldTangent,s),o.length>2&&Pt.bestFitPlane(o,c),this.fittingMode=this._selectFittingMode(c,o,this._worldUp,r);let p=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach(((t,i)=>{const s=n.getAltitude(a[i]);s>e&&(e=s,p=i)}))}const u=o[p];let m=c,g=this._worldTangent;"horizontal"===this.fittingMode?m=this._worldUp:"vertical"===this.fittingMode&&(m=this._tempVec3,g=this._worldUp,(0,Oe.T)(c,this._worldUp,m)),(0,b.g)(this._frame[2],m),(0,Oe.T)(g,m,this._frame[0]),(0,b.c)(this._frame[1],this._frame[0],this._frame[2]),(0,b.m)(this._frame[1],this._frame[1]);const _=this._tempVec3,f=this._tempU,v=this._tempV;for(let e=0;e<this._length;++e){const t=h[e],r=l[e];(0,b.f)(_,o[e],u),(0,T.s)(t,(0,b.d)(this._frame[0],_),(0,b.d)(this._frame[1],_)),(0,b.a)(f,this._frame[0],t[0]),(0,b.a)(v,this._frame[1],t[1]),(0,b.b)(_,f,v),(0,b.b)(_,_,u),(0,Ie.SH)(_,s,r,i)}this.perimeterLength=this._length>0?new rt(t.normalizeDistance(this._updatePerimeterLengths()),"meters"):null,(0,V.H2)(l,this.areaCentroidRenderCoords),(0,Ie.SH)(this.areaCentroidRenderCoords,i,this.areaCentroidWorldCoords,s),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?new rt(t.normalizeArea(this._computeArea()),"square-meters"):null}_updateGeodesicArea(e){const t=e.renderCoordsHelper,i=this.positionsSpherical,s=this.positionsStereographic,r=this._tempVec3,n=Pt.fitHemisphere(i,r);if(!n)return void(this.geodesicArea=null);const o=this._tempU,a=this._tempV;(0,Oe._F)(r,o,a);for(let e=0;e<this._length;++e){const t=(0,b.d)(i[e],o),n=(0,b.d)(i[e],a),h=(0,b.d)(i[e],r);(0,T.s)(s[e],t/h,n/h)}(0,b.a)(r,r,(0,Ee.Iu)(e.spatialReference).radius),t.toRenderCoords(r,(0,Ee.rS)(e.spatialReference),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=n&&0===this.geodesicIntersectingSegments.size?new rt(this._computeGeodesicArea(),"square-meters"):null}_updatePerimeterLengths(){const e=this.positionsProjectedWorldCoords,t=this.perimeterSegmentLengths;let i=0;for(let s=0;s<this._length;++s)i+=t[s]=(0,T.d)(e[s],e[(s+1)%this._length]);return i}_updateIntersectingSegments(){const e=this.positionsProjectedWorldCoords,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const r=e[i],n=e[(i+1)%this._length],o=e[s],a=e[(s+1)%this._length];(0,Mt.UT)(r,n,o,a)&&(t.add(i),t.add(s))}}_computeArea(){const e=this.positionsProjectedWorldCoords,t=Vt(e,2),i=this.triangleIndices=new Uint32Array((0,zt.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Pt.triangleAreaEuclidean(e[i[t]],e[i[t+1]],e[i[t+2]]);return s}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const r=e[i],n=e[(i+1)%this._length],o=e[s],a=e[(s+1)%this._length];(0,Mt.UT)(r,n,o,a)&&(t.add(i),t.add(s))}}_computeGeodesicArea(){const e=this.positionsGeographic,t=Vt(this.positionsStereographic,2),i=this.geodesicTriangleIndices=new Uint32Array((0,zt.O)(t,[],2));let s=0;for(let t=0;t<i.length;t+=3)s+=Pt.triangleAreaGeodesic(e[i[t]],e[i[t+1]],e[i[t+2]],ft.Z.WGS84);return s}_selectFittingMode(e,t,i,s){const r=t.map((t=>Math.abs(Pt.planePointDistance(e,t)))).reduce(((e,t)=>Math.max(e,t)),0);Pt.boundingSphere(t,this._tempSphere);const n=r/(2*this._tempSphere.radius),o=n<s.maxRelativeErrorCoplanar,a=n<s.maxRelativeErrorAlmostCoplanar;let h="horizontal";return o?h="oblique":a&&(h=Math.abs((0,b.d)(i,e))>Math.cos((0,tt.Vl)(s.verticalAngleThreshold))?"horizontal":"vertical"),h}};const Dt=class{constructor(e=null){this.spatialReference=e}get spatialReference(){return this._spatialReference}set spatialReference(e){e!==this._spatialReference&&(this._spatialReference=e,this._updateNormalizationFactors())}normalizeDistance(e){return e*this._metersPerDistanceUnit}normalizeElevation(e){return e*this._metersPerElevationUnit}normalizeArea(e){return e*this._squareMetersPerAreaUnit}_updateNormalizationFactors(){this._metersPerDistanceUnit=(0,l.c9)(this._spatialReference,1),this._metersPerElevationUnit=(0,l.c9)(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}};let Gt=class extends G.default{constructor(){super(...arguments),this._unitNormalizer=new Dt,this._measurementData=new Tt,this._handles=new m.Z,this.dataObject=new at,this.path=new mt,this.cursorPoint=null,this.state="initial",this.lastDraggedVertex=null,this.mode="auto",this.unit="metric",this.active=!1,this.fittingSettings={maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80},this.geodesicMeasurementDistanceThreshold=1e5}initialize(){this.path.model=this.dataObject,(0,it.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})),this._handles.add((0,et.qe)((async()=>{this.messages=await(0,it.ME)("esri/core/t9n/Units")}))),this._handles.add((0,g.whenTrue)(this.sceneView,"ready",(()=>{const{spatialReference:e}=this.sceneView,t=(0,Ee.rS)(e),i=t===Ee.GG?Ee.wY:t,s=!e||(0,Ie.Up)(e,i)?i:e;this._worldSpatialReference=s,this._unitNormalizer.spatialReference=s,this.path.view=this.sceneView})),"scene-view"),this.reset(),this._handles.add(this.path.on("clear",(()=>{this.notifyChange("numVertices"),this._updateMeasurementData()}))),this._handles.add(this.path.on("vertex-update",(()=>{this.notifyChange("numVertices"),this._updateMeasurementData()}))),this._handles.add(this.watch("state",(()=>this._updateMeasurementData()),!0)),this._handles.add(this.watch("fittingSettings",(()=>this._updateMeasurementData())))}destroy(){this._handles.destroy(),this._handles=null}get validMeasurement(){return this.numVertices>=3&&"measured"===this.state||"editing"===this.state}get numVertices(){return this.path.numVertices}get measurementData(){return this._measurementData}_updateMeasurementData(){const e=this._measurementData;e.update(this.path,this.sceneView,this._unitNormalizer,this.validMeasurement,this.sceneView.renderSpatialReference,this._worldSpatialReference,this.fittingSettings),this.dataObject.result={area:e.area,geodesicArea:e.geodesicArea,pathLength:e.pathLength,geodesicPathLength:e.geodesicPathLength,perimeterLength:e.perimeterLength},this.notifyChange("measurementData")}get area(){return this.measurementData.area}get geodesicArea(){return this.measurementData.geodesicArea}get areaLabel(){return this._formatAreaLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicArea:this.measurementData.area,this.unit)}get pathLength(){return this.measurementData.pathLength}get geodesicPathLength(){return this.measurementData.geodesicPathLength}get pathLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.pathLength,this.unit)}get perimeterLength(){return this.measurementData.perimeterLength}get geodesicPerimeterLength(){return this.measurementData.geodesicPathLength}get perimeterLengthLabel(){return this.measurementData.perimeterLength&&this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.perimeterLength,this.unit)}get cursorSegmentLength(){const e=this.path.lastPoint;return(0,y.pC)(e)&&(0,y.pC)(this.cursorPoint)?new rt(this._unitNormalizer.normalizeDistance(Pt.segmentLengthEuclidean(e,this.cursorPoint,this._worldSpatialReference)),"meters"):null}get geodesicCursorSegmentLength(){const e=this.path.lastPoint;return(0,y.pC)(e)&&(0,y.pC)(this.cursorPoint)?new rt(Pt.segmentLengthGeodesic(e,this.cursorPoint),"meters"):null}get cursorSegmentLengthLabel(){return this._formatLengthLabel(this.messages,"geodesic"===this.measurementMode?this.geodesicCursorSegmentLength:this.cursorSegmentLength,this.unit)}get viewData(){const e=this.measurementData,t="geodesic"===this.measurementMode,i=t?this.geodesicArea:this.area;let s=1;if(i){const e=this._toPreferredAreaUnit(i,this.unit);s=(0,tt.sk)(Math.sqrt(e.value)/Math.sqrt(300)),s*=Math.sqrt((0,l.En)(1,e.unit,"square-meters")),s/=this._unitNormalizer.normalizeDistance(1)}return{validMeasurement:this.validMeasurement,path:this.path,positionsGeographic:e.positionsGeographic,positionsRenderCoords:e.positionsRenderCoords,positionsProjected:e.positionsProjectedWorldCoords,positionsFittedRenderCoords:e.positionsFittedRenderCoords,intersectingSegments:t?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:t?e.geodesicTriangleIndices:e.triangleIndices,fittingMode:e.fittingMode,areaCentroid:t?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,pathLengthLabelSegmentIndex:this.validMeasurement?0:this.path.numVertices-2,perimeterLengthLabelSegmentIndex:0,checkerSize:s}}get measurementMode(){let e=this.mode;return"auto"===e&&(e="euclidean",(this.geodesicPathLength?this.geodesicPathLength.value:0)+(!this.validMeasurement&&this.geodesicCursorSegmentLength?this.geodesicCursorSegmentLength.value:0)>this.geodesicMeasurementDistanceThreshold&&(e="geodesic")),null==this.geodesicPathLength&&(e="euclidean"),e}reset(){this.clearMeasurement(),this._updateMeasurementData()}clearMeasurement(){this.path.clear(),this.state="initial",this.cursorPoint=null}finishMeasurement(){this.path.numVertices<3?this.clearMeasurement():this.state="measured"}_preferredAreaUnit(e,t){switch(t){case"metric":return(0,l.tQ)(e.value,e.unit);case"imperial":return(0,l.Yl)(e.value,e.unit);default:return t}}_preferredLengthUnit(e,t){const i=this._deriveLengthUnitFromAreaUnit(t);switch(i){case"metric":return(0,l.KU)(e.value,e.unit);case"imperial":return(0,l.FN)(e.value,e.unit);default:return i}}_toPreferredAreaUnit(e,t){return e.toUnit(this._preferredAreaUnit(e,t))}_toPreferredLengthUnit(e,t){return e.toUnit(this._preferredLengthUnit(e,t))}_formatAreaLabel(e,t,i){return e&&t&&ot(e,t,this._preferredAreaUnit(t,i))}_formatLengthLabel(e,t,i){return e&&t&&ot(e,t,this._preferredLengthUnit(t,i))}_deriveLengthUnitFromAreaUnit(e){switch(e){case"metric":return"metric";case"imperial":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"acres":return"imperial";case"ares":case"hectares":return"metric"}throw new Error("unhandled area unit")}};(0,s._)([(0,n.Cb)()],Gt.prototype,"messages",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"dataObject",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],Gt.prototype,"sceneView",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"path",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"cursorPoint",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"state",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"lastDraggedVertex",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"mode",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"unit",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"active",void 0),(0,s._)([(0,n.Cb)()],Gt.prototype,"fittingSettings",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"validMeasurement",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"numVertices",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"measurementData",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"area",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"geodesicArea",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"areaLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"pathLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"geodesicPathLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"pathLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"perimeterLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"geodesicPerimeterLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"perimeterLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"cursorSegmentLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"geodesicCursorSegmentLength",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"cursorSegmentLengthLabel",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"viewData",null),(0,s._)([(0,n.Cb)()],Gt.prototype,"geodesicMeasurementDistanceThreshold",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],Gt.prototype,"measurementMode",null),Gt=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DModel")],Gt);const kt=Gt;let Ot=class extends v.m{constructor(e){super(e),this._handles=new m.Z,this.deferCreation=!0,this.model=new kt({sceneView:e.view})}initialize(){this._view=new Xe(this.model,this.manipulators),this._controller=new Qe(this.model,this._view,this.manipulators),this._handles.add((0,g.init)(this,"state",(e=>{switch(e){case"measured":return this.complete();case"ready":break;default:return this.create()}}),!0))}destroy(){this.detach(),this._view.destroy(),this._view=null,this._controller.destroy(),this._controller=null,this._handles.destroy(),this._handles=null}get state(){switch(this.model.state){case"initial":return this.model.numVertices>=1?"measuring":"ready";case"drawing":case"editing":return"measuring";case"measured":return"measured"}}get isSupported(){return"3d"===this.get("view.type")}get cursor(){return!this.model.active||"initial"!==this.model.state&&"drawing"!==this.model.state?null:"crosshair"}activate(){this.model.active=!0}deactivate(){this.model.active=!1}onShow(){this._view.show()}onHide(){this._view.hide()}onDetach(){this.model.reset()}onInputEvent(e){this._controller.handleInputEvent(e)}};(0,s._)([(0,n.Cb)({readOnly:!0})],Ot.prototype,"state",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Ot.prototype,"isSupported",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Ot.prototype,"cursor",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],Ot.prototype,"model",void 0),(0,s._)([(0,o.B)("model.mode")],Ot.prototype,"mode",void 0),(0,s._)([(0,o.B)("model.unit")],Ot.prototype,"unit",void 0),(0,s._)([(0,o.B)("model.areaLabel")],Ot.prototype,"areaLabel",void 0),(0,s._)([(0,o.B)("model.area")],Ot.prototype,"area",void 0),(0,s._)([(0,o.B)("model.geodesicArea")],Ot.prototype,"geodesicArea",void 0),(0,s._)([(0,o.B)("model.pathLengthLabel")],Ot.prototype,"pathLengthLabel",void 0),(0,s._)([(0,o.B)("model.pathLength")],Ot.prototype,"pathLength",void 0),(0,s._)([(0,o.B)("model.geodesicPathLength")],Ot.prototype,"geodesicPathLength",void 0),(0,s._)([(0,o.B)("model.perimeterLengthLabel")],Ot.prototype,"perimeterLengthLabel",void 0),(0,s._)([(0,o.B)("model.perimeterLength")],Ot.prototype,"perimeterLength",void 0),(0,s._)([(0,o.B)("model.geodesicPerimeterLength")],Ot.prototype,"geodesicPerimeterLength",void 0),(0,s._)([(0,o.B)("model.validMeasurement")],Ot.prototype,"validMeasurement",void 0),(0,s._)([(0,o.B)("model.viewData")],Ot.prototype,"viewData",void 0),Ot=(0,s._)([(0,a.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],Ot);const Et=Ot,It=r.Z.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let Zt=class extends f.V{constructor(e){super(e),this.supportedViewType="3d",this._handles=new m.Z,this._userUnitOptions=null,this._userUnit=null,this.tool=null}initialize(){this._handles.add([(0,g.init)(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool||this.isDisabled)return null;const e=this.tool.model,t=e.measurementMode,i=e.measurementData,s=e.validMeasurement,r=0===("euclidean"===t?i.intersectingSegments:i.geodesicIntersectingSegments).size,n=r?s?"available":"unavailable":"invalid";return{mode:t,area:{text:r&&s?e.areaLabel:null,state:n},perimeterLength:{text:r&&s?e.perimeterLengthLabel:null,state:n}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}createToolParams(){return{toolConstructor:Et,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){It.error("AreaMeasurement3D widget is not implemented for MapView")}logError(...e){It.error(...e)}_findSelectableUnit(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if(!e)return l.fN.slice();const t=e.filter((e=>-1!==l.fN.indexOf(e)));return 0===t.length?l.fN.slice():t}};(0,s._)([(0,n.Cb)({readOnly:!0})],Zt.prototype,"state",null),(0,s._)([(0,n.Cb)({readOnly:!0})],Zt.prototype,"measurement",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],Zt.prototype,"tool",void 0),(0,s._)([(0,n.Cb)(_.Y)],Zt.prototype,"defaultUnit",void 0),(0,s._)([(0,n.Cb)()],Zt.prototype,"unitOptions",null),(0,s._)([(0,n.Cb)()],Zt.prototype,"unit",null),Zt=(0,s._)([(0,a.j)("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],Zt);const Ut=Zt,jt="esri-button esri-button--secondary",Wt="esri-button--disabled",qt="esri-area-measurement-3d",Bt="esri-widget",Ft="esri-widget--panel",Ht="esri-area-measurement-3d__container",Yt="esri-area-measurement-3d__hint",Xt="esri-area-measurement-3d__hint-text",$t="esri-area-measurement-3d__panel--error",Nt="esri-area-measurement-3d__measurement",Kt="esri-area-measurement-3d__measurement-item",Jt="esri-area-measurement-3d__measurement-item--disabled",Qt="esri-area-measurement-3d__measurement-item-title",ei="esri-area-measurement-3d__measurement-item-value",ti="esri-area-measurement-3d__settings",ii="esri-area-measurement-3d__units",si="esri-area-measurement-3d__units-label",ri="esri-area-measurement-3d__units-select esri-select",ni="esri-area-measurement-3d__units-select-wrapper",oi="esri-area-measurement-3d__actions",ai="esri-area-measurement-3d__clear-button",hi="esri-icon-measure-area";let li=class extends u.default{constructor(e,t){super(e,t),this.view=null,this.visible=null,this.iconClass=hi,this.label=void 0,this.messages=null,this.messagesUnits=null,this.viewModel=new Ut,this.unitOptions=null,this.unit=null}render(){const{isSupported:e,active:t,measurement:i,state:s,unit:r}=this.viewModel,n="disabled"===s,o="ready"===s,a="measuring"===s||"measured"===s,{messages:h,messagesUnits:c}=this,d=t&&o?(0,p.j)("section",{key:"esri-area-measurement-3d__hint",class:Yt},(0,p.j)("p",{class:Xt},h.hint)):null,u=e?null:(0,p.j)("section",{key:"esri-area-measurement-3d__unsupported",class:$t},(0,p.j)("p",null,h.unsupported)),m=(e,t,i)=>{switch(t.state){case"available":return(0,p.j)("div",{key:`${i}-enabled`,class:Kt},(0,p.j)("span",{class:Qt},e),(0,p.j)("span",{class:ei},t.text));case"unavailable":return(0,p.j)("div",{key:`${i}-disabled`,class:this.classes(Kt,Jt)},(0,p.j)("span",{class:Qt},e));case"invalid":return(0,p.j)("div",{key:`${i}-enabled`,class:Kt},(0,p.j)("span",{class:Qt},e),(0,p.j)("span",{class:ei},h.notApplicable))}},g=a?(0,p.j)("section",{key:"esri-area-measurement-3d__measurement",class:Nt},m(h.area,i.area,"area"),m(h.perimeterLength,i.perimeterLength,"perimeter-length")):null,_=`${this.id}__units`,f=(0,p.j)("label",{class:si,for:_},h.unit),v=(0,p.j)("div",{class:ni},(0,p.j)("select",{class:ri,id:_,onchange:this._changeUnit,bind:this,value:r},this.viewModel.unitOptions.map((e=>{var t;return(0,p.j)("option",{key:e,value:e},(0,l.ZO)(e)?c.systems[e]:null==(t=c.units[e])?void 0:t.pluralCapitalized)})))),y=a?(0,p.j)("section",{key:"esri-area-measurement-3d__units",class:ii},f,v):null,x=a?(0,p.j)("div",{key:"settings",class:ti},y):null,w=!e||t&&!a?null:(0,p.j)("div",{class:oi},(0,p.j)("button",{disabled:n,class:this.classes(jt,ai,n&&Wt),bind:this,onclick:this._newMeasurement,type:"button"},h.newMeasurement)),b=this.visible?(0,p.j)("div",{class:Ht},u,d,x,g,w):null;return(0,p.j)("div",{key:"",class:this.classes(qt,Bt,Ft),role:"presentation"},b)}_newMeasurement(){(0,h.ignoreAbortErrors)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,o.B)("viewModel.view")],li.prototype,"view",void 0),(0,s._)([(0,o.B)("viewModel.visible")],li.prototype,"visible",void 0),(0,s._)([(0,o.B)("viewModel.active")],li.prototype,"active",void 0),(0,s._)([(0,n.Cb)()],li.prototype,"iconClass",void 0),(0,s._)([(0,n.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],li.prototype,"label",void 0),(0,s._)([(0,n.Cb)(),(0,d.H)("esri/widgets/AreaMeasurement3D/t9n/AreaMeasurement3D")],li.prototype,"messages",void 0),(0,s._)([(0,n.Cb)(),(0,d.H)("esri/core/t9n/Units")],li.prototype,"messagesUnits",void 0),(0,s._)([(0,n.Cb)({type:Ut})],li.prototype,"viewModel",void 0),(0,s._)([(0,o.B)("viewModel.unitOptions")],li.prototype,"unitOptions",void 0),(0,s._)([(0,o.B)("viewModel.unit")],li.prototype,"unit",void 0),(0,s._)([(0,c.h)()],li.prototype,"_newMeasurement",null),(0,s._)([(0,c.h)()],li.prototype,"_changeUnit",null),li=(0,s._)([(0,a.j)("esri.widgets.AreaMeasurement3D")],li);const ci=li}}]);
//# sourceMappingURL=2429.js.map