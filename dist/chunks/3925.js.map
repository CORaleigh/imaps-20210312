{"version":3,"sources":["webpack://imaps/./node_modules/@arcgis/core/renderers/DictionaryRenderer.js"],"names":["j","_","w","type","lineSymbol","symbolLayers","width","color","S","e","super","this","_ongoingRequests","Map","_symbolCache","config","fieldMap","scaleExpression","scaleExpressionTitle","url","s","scalingExpressionInfo","expression","returnType","t","r","origin","writeVisualVariables","visualVariables","i","_dictionaryPromise","fetchResources","d","o","_symbolFields","attributes","n","l","toString","a","get","catch","pop","p","split","m","u","length","indexOf","_itemNames","has","push","substr","map","Number","toRgba","primitiveName","propertyName","value","f","geometry","hasZ","y","_cimPartsToCIMSymbol","put","collectVVRequiredFields","name","add","error","abortOptions","responseType","query","data","Promise","all","authoringInfo","_refSymbolUrlTemplate","cimRefTemplateUrl","Set","itemsNames","symbol","configuration","hasOwnProperty","c","fields","filter","spatialReference","then","scale","repurposeFeature","evaluate","$feature","$view","reduce","getAttributeHash","JSON","stringify","replace","set","delete","reject","unshift","callout","primitiveOverrides","Array","_getSymbolPart","_combineSymbolParts","Object","json","read","source","write","target","prototype","String","enabled"],"mappings":"iIAIsjCA,E,wPAAE,MAAMC,EAAE,cAAY,qCAAqCC,EAAE,CAACC,KAAK,uBAAuBC,WAAW,CAACD,KAAK,gBAAgBE,aAAa,CAAC,CAACF,KAAK,iBAAiBG,MAAM,GAAGC,MAAM,CAAC,EAAE,EAAE,EAAE,SAAS,IAAIC,EAAER,EAAE,eAAc,OAAE,MAAI,YAAYS,GAAGC,MAAMD,GAAGE,KAAKC,iBAAiB,IAAIC,IAAIF,KAAKG,aAAa,IAAI,IAAE,KAAKH,KAAKI,OAAO,KAAKJ,KAAKK,SAAS,KAAKL,KAAKM,gBAAgB,KAAKN,KAAKO,qBAAqB,KAAKP,KAAKQ,IAAI,KAAKR,KAAKR,KAAK,aAAa,UAAUM,EAAEW,GAAGX,IAAIW,EAAEC,sBAAsB,CAACC,WAAWb,EAAEc,WAAW,WAAW,qBAAqBd,EAAEW,EAAEI,EAAEC,GAAG,MAAMA,GAAGA,EAAEC,QAAQhB,MAAMiB,qBAAqBlB,EAAEW,EAAEI,EAAEC,GAAG,QAAQ,OAAO,IAAIzB,EAAE,CAACe,QAAO,QAAEJ,KAAKI,QAAQE,gBAAgBN,KAAKM,gBAAgBC,qBAAqBP,KAAKO,qBAAqBF,UAAS,QAAEL,KAAKK,UAAUG,KAAI,QAAER,KAAKQ,KAAKS,iBAAgB,QAAEjB,KAAKiB,mBAAmB,qBAAqBnB,EAAEW,GAAG,IAAIS,EAAElB,KAAKmB,qBAAqBnB,KAAKmB,mBAAmBnB,KAAKoB,eAAeX,IAAI,IAAIS,QAAQlB,KAAKmB,mBAAmB,MAAME,GAAG,IAAG,kBAAEA,GAAG,OAAOrB,KAAKmB,mBAAmB,KAAK,KAAK,MAAMG,EAAE,GAAG,GAAGtB,KAAKK,SAAS,IAAI,MAAMQ,KAAKb,KAAKuB,cAAc,CAAC,MAAMd,EAAET,KAAKK,SAASQ,GAAG,GAAGJ,GAAG,OAAOX,EAAE0B,WAAWf,SAAI,IAASX,EAAE0B,WAAWf,GAAG,CAAC,MAAMK,EAAE,GAAGhB,EAAE0B,WAAWf,GAAGa,EAAET,GAAGC,OAAOQ,EAAET,GAAG,GAAG,MAAMY,EAAEP,EAAEI,EAAEb,GAAG,IAAIgB,GAAG,iBAAiBA,EAAE,OAAO,KAAK,MAAMC,GAAE,QAAED,GAAGE,WAAWC,EAAE5B,KAAKG,aAAa0B,IAAIH,GAAG,GAAGE,EAAE,OAAOA,EAAEE,OAAM,KAAM9B,KAAKG,aAAa4B,IAAIL,MAAME,EAAE,MAAMI,EAAEP,EAAEQ,MAAM,KAAKC,EAAE,GAAGC,EAAE,GAAG,IAAI,MAAMtB,KAAKmB,EAAE,GAAGnB,GAAG,IAAIA,EAAEuB,OAAO,IAAI,IAAIvB,EAAEwB,QAAQ,OAAO,IAAI,IAAIxB,EAAEwB,QAAQ,KAAK,IAAI,MAAMvC,KAAKe,EAAEoB,MAAM,KAAKjC,KAAKsC,WAAWC,IAAIzC,IAAIoC,EAAEM,KAAK1C,QAAQE,KAAKsC,WAAWC,IAAI1B,IAAIqB,EAAEM,KAAK3B,OAAO,CAAC,MAAMf,EAAEe,EAAE4B,OAAO,GAAGR,MAAM,KAAK,GAAG,IAAInC,EAAEsC,OAAO,CAAC,MAAM3B,EAAEX,EAAE,GAAGe,EAAEf,EAAE,GAAG,IAAIgB,EAAEhB,EAAE,GAAG,GAAG,iBAAiBe,EAAEC,EAAEA,EAAEmB,MAAM,KAAKS,KAAK5C,GAAG6C,OAAO7C,UAAU,GAAG,UAAUe,EAAE,CAAC,MAAMf,EAAE,IAAI,UAAEgB,GAAG8B,SAAS9B,EAAE,CAAChB,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAG,IAAIA,EAAE,SAASgB,EAAE6B,OAAO7B,GAAGqB,EAAEK,KAAK,CAACK,cAAcpC,EAAEqC,aAAajC,EAAEkC,MAAMjC,KAAK,MAAMkC,IAAG,QAAElD,EAAEmD,YAAYnD,EAAEmD,SAASC,MAAM,UAAUpD,EAAEmD,SAASzD,KAAK2D,EAAEnD,KAAKoD,qBAAqBlB,EAAEC,EAAEa,EAAEvC,GAAG,OAAOT,KAAKG,aAAakD,IAAI3B,EAAEyB,EAAE,GAAGA,EAAE,4BAA4BrD,EAAEW,SAAST,KAAKsD,wBAAwBxD,EAAEW,GAAGT,KAAKM,uBAAuB,QAAER,EAAEW,EAAET,KAAKM,iBAAiB,MAAMO,EAAEJ,EAAEiC,KAAK5C,GAAGA,EAAEyD,OAAO,IAAI,MAAMzC,KAAKd,KAAKK,SAASQ,EAAEwB,QAAQrC,KAAKK,SAASS,IAAI,GAAGhB,EAAE0D,IAAIxD,KAAKK,SAASS,IAAI,qBAAqB,OAAM,EAAG,qBAAqBhB,GAAG,GAAGE,KAAKmB,mBAAmB,OAAOnB,KAAKmB,mBAAmB,IAAInB,KAAKQ,IAAI,YAAYlB,EAAEmE,MAAM,iBAAiB,MAAMhD,GAAE,QAAEX,GAAGA,EAAE4D,aAAa,KAAK5C,GAAE,aAAEd,KAAKQ,IAAI,yCAAyC,CAACmD,aAAa,OAAOC,MAAM,CAACZ,EAAE,WAAWvC,MAAMoD,KAAK3C,UAAU4C,QAAQC,IAAI,CAACjD,GAAE,YAAM,IAAII,EAAE,MAAMlB,KAAKmB,mBAAmB,KAAK,IAAI,IAAE,oCAAoC,wBAAwB,MAAMG,EAAEJ,EAAEP,WAAWc,EAAEP,EAAE8C,cAAchE,KAAKiE,sBAAsBjE,KAAKQ,IAAI,IAAIU,EAAEgD,kBAAkBlE,KAAKsC,WAAW,IAAI6B,IAAIjD,EAAEkD,YAAYpE,KAAKuB,cAAcE,EAAE4C,OAAO,MAAM3C,EAAE,GAAG,GAAG1B,KAAKI,OAAO,CAAC,MAAMN,EAAEE,KAAKI,OAAO,IAAI,MAAMK,KAAKX,EAAE4B,EAAEjB,GAAGX,EAAEW,GAAG,IAAI,MAAMI,KAAKY,EAAE6C,cAAc5C,EAAE6C,eAAe1D,EAAE0C,QAAQ7B,EAAEb,EAAE0C,MAAM1C,EAAEkC,OAAO,MAAMyB,EAAE,GAAG,IAAG,QAAE1E,IAAIA,EAAE2E,QAAQzE,KAAKK,SAAS,IAAI,MAAMQ,KAAKb,KAAKuB,cAAc,CAAC,MAAMd,EAAET,KAAKK,SAASQ,GAAGC,EAAEhB,EAAE2E,OAAOC,QAAQ5E,GAAGA,EAAEyD,OAAO9C,IAAIK,EAAEsB,OAAO,GAAGoC,EAAEhC,KAAK,IAAI1B,EAAE,GAAGyC,KAAK1C,IAAI,OAAOb,KAAKmB,oBAAmB,QAAEG,GAAE,QAAExB,GAAGA,EAAE6E,iBAAiB,KAAKH,EAAE9C,GAAGkD,MAAM9E,IAAI,MAAMW,EAAE,CAACoE,MAAM,GAAG,MAAM,CAAC/D,EAAEI,KAAK,MAAMI,EAAExB,EAAEgF,iBAAiB,CAAC7B,SAAS,KAAKzB,WAAWV,IAAI,OAAOL,EAAEoE,OAAM,QAAE3D,GAAGA,EAAE2D,WAAM,EAAO/E,EAAEiF,SAAS,CAACC,SAAS1D,EAAE2D,MAAMxE,QAAQqB,OAAOhC,IAAIR,EAAEmE,MAAM,yCAAyC3D,GAAG,QAAQE,KAAKmB,mBAAmB,YAAY,OAAO,KAAK,aAAa,MAAM,GAAG,mBAAmB,OAAOnB,KAAKiB,iBAAiBjB,KAAKiB,gBAAgBiE,QAAO,CAAEpF,EAAEW,IAAIX,EAAEW,EAAE0E,oBAAoB,IAAI,cAAc,MAAM,GAAGnF,KAAKQ,OAAO4E,KAAKC,UAAUrF,KAAKK,YAAY,kBAAkB,OAAOL,KAAKuB,cAAc,qBAAqBzB,EAAEW,GAAG,GAAGT,KAAKC,iBAAiBsC,IAAIzC,GAAG,OAAOE,KAAKC,iBAAiB4B,IAAI/B,GAAG8E,MAAM9E,GAAGA,EAAE+D,OAAO,MAAMhD,EAAEb,KAAKiE,sBAAsBqB,QAAQ,iBAAiBxF,GAAGgB,GAAE,aAAED,EAAE,CAAC8C,aAAa,OAAOC,MAAM,CAACZ,EAAE,WAAWvC,IAAIT,KAAKC,iBAAiBsF,IAAIzF,EAAEgB,GAAG,IAAI,aAAaA,GAAG+C,KAAK,MAAM3C,GAAG,OAAOlB,KAAKC,iBAAiBuF,OAAO1F,GAAGgE,QAAQ2B,OAAOvE,IAAI,oBAAoBpB,EAAEW,EAAEI,GAAG,IAAIf,GAAG,IAAIA,EAAEsC,OAAO,OAAO,KAAK,MAAMtB,EAAE,IAAIhB,EAAE,IAAI,GAAGA,EAAEsC,OAAO,EAAE,CAACtB,EAAEpB,aAAa,GAAG,IAAI,MAAMe,KAAKX,EAAE,CAAC,MAAMA,EAAEW,EAAEK,EAAEpB,aAAagG,WAAW5F,EAAEJ,eAAe,OAAOmB,IAAIC,EAAE6E,QAAQpG,GAAG,CAACC,KAAK,qBAAqB6E,OAAOvD,EAAE8E,mBAAmBnF,GAAG,2BAA2BX,EAAEW,EAAEI,EAAEC,GAAG,MAAMI,EAAE,IAAI2E,MAAM/F,EAAEsC,QAAQ,IAAI,IAAIX,EAAE,EAAEA,EAAE3B,EAAEsC,OAAOX,IAAIP,EAAEO,GAAGzB,KAAK8F,eAAehG,EAAE2B,GAAGX,GAAG,MAAMQ,QAAQwC,QAAQC,IAAI7C,GAAG,OAAO,IAAI,IAAE,CAAC2C,KAAK7D,KAAK+F,oBAAoBzE,EAAEb,EAAEI,QAAO,OAAE,EAAC,QAAE,CAACrB,KAAKwG,OAAOC,KAAK,CAACC,KAAK,CAACC,OAAO,iBAAiBC,MAAM,CAACC,OAAO,qBAAqBxG,EAAEyG,UAAU,cAAS,IAAQ,OAAE,EAAC,QAAE,CAAC9G,KAAKwG,OAAOC,KAAK,CAACG,OAAM,MAAOvG,EAAEyG,UAAU,gBAAW,IAAQ,OAAE,EAAC,QAAE,CAAC9G,KAAK+G,OAAON,KAAK,CAACC,KAAK,CAACC,OAAO,oCAAoCC,OAAM,MAAOvG,EAAEyG,UAAU,uBAAkB,IAAQ,OAAE,EAAC,OAAE,oBAAoBzG,EAAEyG,UAAU,YAAY,OAAM,OAAE,EAAC,QAAE,CAAC9G,KAAK+G,OAAON,KAAK,CAACC,KAAK,CAACC,OAAO,+BAA+BC,MAAM,CAACC,OAAO,8BAA8B,eAAevG,GAAG,MAAM,CAAC0G,UAAU1G,KAAKE,KAAKM,uBAAuBT,EAAEyG,UAAU,4BAAuB,IAAQ,OAAE,EAAC,QAAE,CAAC9G,KAAK+G,OAAON,KAAK,CAACG,OAAM,MAAOvG,EAAEyG,UAAU,WAAM,IAAQ,OAAE,EAAC,OAAE,oBAAoBzG,EAAEyG,UAAU,uBAAuB,MAAMzG,EAAER,GAAE,OAAE,EAAC,OAAE,sCAAsCQ,GAAW,QAAFA","file":"chunks/3925.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{clone as s}from\"../core/lang.js\";import{isSome as t}from\"../core/maybe.js\";import{numericHash as r}from\"../core/string.js\";import i from\"../core/Logger.js\";import\"../core/accessorSupport/ensureType.js\";import{property as o}from\"../core/accessorSupport/decorators/property.js\";import{subclass as n}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as l}from\"../core/accessorSupport/decorators/writer.js\";import a from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import\"../portal/support/resourceExtension.js\";import{isAbortError as c}from\"../core/promiseUtils.js\";import{loadArcade as p,createDictionaryExpression as m}from\"../support/arcadeOnDemand.js\";import{collectArcadeFieldNames as u}from\"../layers/support/fieldUtils.js\";import h from\"../Color.js\";import f from\"../symbols/CIMSymbol.js\";import y from\"../request.js\";import d from\"./Renderer.js\";import{VisualVariablesMixin as g}from\"./mixins/VisualVariablesMixin.js\";import b from\"../core/LRUCache.js\";var j;const _=i.getLogger(\"esri.renderers.DictionaryRenderer\"),w={type:\"CIMSimpleLineCallout\",lineSymbol:{type:\"CIMLineSymbol\",symbolLayers:[{type:\"CIMSolidStroke\",width:.5,color:[0,0,0,255]}]}};let S=j=class extends(g(d)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new b(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type=\"dictionary\"}writeData(e,s){e&&(s.scalingExpressionInfo={expression:e,returnType:\"number\"})}writeVisualVariables(e,s,t,r){null!=r&&r.origin||super.writeVisualVariables(e,s,t,r)}clone(){return new j({config:s(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:s(this.fieldMap),url:s(this.url),visualVariables:s(this.visualVariables)})}async getSymbolAsync(e,s){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{i=await this._dictionaryPromise}catch(d){if(c(d))return this._dictionaryPromise=null,null}const o={};if(this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t];if(s&&null!==e.attributes[s]&&void 0!==e.attributes[s]){const r=\"\"+e.attributes[s];o[t]=r}else o[t]=\"\"}const n=i(o,s);if(!n||\"string\"!=typeof n)return null;const l=r(n).toString(),a=this._symbolCache.get(l);if(a)return a.catch((()=>{this._symbolCache.pop(l)})),a;const p=n.split(\";\"),m=[],u=[];for(const t of p)if(t&&0!==t.length)if(-1===t.indexOf(\"po:\"))if(-1!==t.indexOf(\"|\"))for(const e of t.split(\"|\"))this._itemNames.has(e)&&m.push(e);else this._itemNames.has(t)&&m.push(t);else{const e=t.substr(3).split(\"|\");if(3===e.length){const s=e[0],t=e[1];let r=e[2];if(\"DashTemplate\"===t)r=r.split(\" \").map((e=>Number(e)));else if(\"Color\"===t){const e=new h(r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);u.push({primitiveName:s,propertyName:t,value:r})}}const f=!t(e.geometry)||!e.geometry.hasZ&&\"point\"===e.geometry.type,y=this._cimPartsToCIMSymbol(m,u,f,s);return this._symbolCache.put(l,y,1),y}async collectRequiredFields(e,s){await this.collectVVRequiredFields(e,s),this.scaleExpression&&await u(e,s,this.scaleExpression);const t=s.map((e=>e.name));for(const r in this.fieldMap)t.indexOf(this.fieldMap[r])<0||e.add(this.fieldMap[r])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void _.error(\"no valid URL!\");const s=t(e)?e.abortOptions:null,r=y(this.url+\"/resources/styles/dictionary-info.json\",{responseType:\"json\",query:{f:\"json\"},...s}),[{data:i}]=await Promise.all([r,p()]);if(!i)throw this._dictionaryPromise=null,new a(\"esri.renderers.DictionaryRenderer\",\"Bad dictionary data!\");const o=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+\"/\"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const l={};if(this.config){const e=this.config;for(const s in e)l[s]=e[s]}for(const t of n.configuration)l.hasOwnProperty(t.name)||(l[t.name]=t.value);const c=[];if(t(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t],r=e.fields.filter((e=>e.name===s));r.length>0&&c.push({...r[0],name:t})}return this._dictionaryPromise=m(o,t(e)?e.spatialReference:null,c,l).then((e=>{const s={scale:0};return(r,i)=>{const o=e.repurposeFeature({geometry:null,attributes:r});return s.scale=t(i)?i.scale:void 0,e.evaluate({$feature:o,$view:s})}})).catch((e=>(_.error(\"Creating dictinoary expression failed:\",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,s)=>e+s.getAttributeHash()),\"\")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const t=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),r=y(t,{responseType:\"json\",query:{f:\"json\"},...s});this._ongoingRequests.set(e,r);try{return(await r).data}catch(i){return this._ongoingRequests.delete(e),Promise.reject(i)}}_combineSymbolParts(e,s,t){if(!e||0===e.length)return null;const r={...e[0]};if(e.length>1){r.symbolLayers=[];for(const s of e){const e=s;r.symbolLayers.unshift(...e.symbolLayers)}}return t&&(r.callout=w),{type:\"CIMSymbolReference\",symbol:r,primitiveOverrides:s}}async _cimPartsToCIMSymbol(e,s,t,r){const i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=this._getSymbolPart(e[n],r);const o=await Promise.all(i);return new f({data:this._combineSymbolParts(o,s,t)})}};e([o({type:Object,json:{read:{source:\"configuration\"},write:{target:\"configuration\"}}})],S.prototype,\"config\",void 0),e([o({type:Object,json:{write:!0}})],S.prototype,\"fieldMap\",void 0),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.expression\"},write:!0}})],S.prototype,\"scaleExpression\",void 0),e([l(\"scaleExpression\")],S.prototype,\"writeData\",null),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.title\"},write:{target:\"scalingExpressionInfo.title\",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],S.prototype,\"scaleExpressionTitle\",void 0),e([o({type:String,json:{write:!0}})],S.prototype,\"url\",void 0),e([l(\"visualVariables\")],S.prototype,\"writeVisualVariables\",null),S=j=e([n(\"esri.renderers.DictionaryRenderer\")],S);var x=S;export default x;\n"],"sourceRoot":""}