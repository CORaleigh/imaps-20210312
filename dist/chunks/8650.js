(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[8650],{58807:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),a=(i(10923),i(57002),i(86035),i(82677)),o=i(59691),l=i(18152),h=i(48609);const u={visible:"visibleSublayers"},d=[102100,3857,102113,900913],p=[3395,54004];let c=class extends a.default{constructor(){super(...arguments),this._layerHandles=new o.Z,this.extent=null,this._scale=null,this.view=null}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this._layerHandles&&(this._layerHandles.removeAll(),this._layerHandles=null),e&&(this._layerHandles||(this._layerHandles=new o.Z),this._layerHandles.add([e.sublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("wms-sublayer-update",(e=>this.notifyChange(u[e.propertyName])))])))}get layers(){const{visibleSublayers:e}=this;return e.filter((e=>e.name)).map((e=>e.name)).join(",")}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange("scale"))}get version(){this.commitProperty("layers"),this.commitProperty("timeExtent");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:t}=this,i=null==e?void 0:e.sublayers,s=[],r=e=>{const{minScale:i,maxScale:n,sublayers:a,visible:o}=e;o&&(0===t||(0===i||t<=i)&&(0===n||t>=n))&&(a?a.forEach(r):s.unshift(e))};return null==i||i.forEach(r),s}get wkid(){const{extent:e,layer:t}=this,i=t.spatialReferences;let s=e.spatialReference&&e.spatialReference.wkid;i&&-1===i.indexOf(s)&&e.spatialReference.latestWkid&&(s=e.spatialReference.latestWkid);const r=d.some((e=>e===s));if(!i)return s;if(r){const e=[];i.forEach((t=>{d.indexOf(t)>-1&&e.push(t)})),e.length||i.forEach((t=>{p.indexOf(t)>-1&&e.push(t)})),s=e.length>0?e[0]:d[0]}return s}toJSON(){const{extent:e,layer:t,layers:i}=this,{imageFormat:s,imageTransparency:r,spatialReferences:n,version:a}=t;let{wkid:o}=this;n&&-1===n.indexOf(o)&&e.spatialReference.latestWkid&&(o=e.spatialReference.latestWkid);const{xmin:l,ymin:u,xmax:d,ymax:p}=e,c={bbox:"1.3.0"===t.version&&(0,h.QZ)(o)?`${u},${l},${p},${d}`:`${l},${u},${d},${p}`,format:s,request:"GetMap",service:"WMS",styles:"",transparent:r,version:a};return isNaN(o)||("1.3.0"===a?c.crs="EPSG:"+o:c.srs="EPSG:"+o),{...c,layers:i}}};(0,s._)([(0,r.Cb)()],c.prototype,"extent",void 0),(0,s._)([(0,r.Cb)()],c.prototype,"layer",null),(0,s._)([(0,r.Cb)({readOnly:!0})],c.prototype,"layers",null),(0,s._)([(0,r.Cb)({type:Number})],c.prototype,"scale",null),(0,s._)([(0,r.Cb)(l.qG)],c.prototype,"timeExtent",void 0),(0,s._)([(0,r.Cb)({type:Number,readOnly:!0})],c.prototype,"version",null),(0,s._)([(0,r.Cb)()],c.prototype,"view",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],c.prototype,"visibleSublayers",null),(0,s._)([(0,r.Cb)({dependsOn:[]})],c.prototype,"wkid",null),c=(0,s._)([(0,n.j)("esri.layers.support.ExportWMSImageParameters")],c);const m=c},48609:(e,t,i)=>{"use strict";i.d(t,{QZ:()=>u,xX:()=>d,V4:()=>h,Y6:()=>I});var s=i(32656),r=i(10923),n=i(73032),a=i(52937);const o=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],l={84:4326,83:4269,27:4267};function h(e){if(!e)return null;const t={idCounter:-1};"string"==typeof e&&(e=(new DOMParser).parseFromString(e,"text/xml"));const i=e.documentElement;if("ServiceExceptionReport"===i.nodeName){const e=Array.prototype.slice.call(i.childNodes).map((e=>e.textContent)).join("\r\n");throw new s.Z("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",e)}const r=m("Capability",i),n=m("Service",i),o=m("Request",r);if(!r||!n||!o)return null;const l=m("Layer",r);if(!l)return null;const h="WMS_Capabilities"===i.nodeName||"WMT_MS_Capabilities"===i.nodeName?i.getAttribute("version"):"1.3.0",u=g("Title",n,"")||g("Name",n,""),d=g("AccessConstraints",n,""),c=g("Abstract",n,""),y=parseInt(g("MaxWidth",n,"5000"),10),f=parseInt(g("MaxHeight",n,"5000"),10),v=b(o,"GetMap"),w=x(o,"GetMap"),N=_(l,h,t);let R,S,M,E,I=0;if(Array.prototype.slice.call(r.childNodes).forEach((e=>{"Layer"===e.nodeName&&(0===I?R=e:1===I?(N.name&&(N.name="",N.sublayers.push(_(R,h,t))),N.sublayers.push(_(e,h,t))):N.sublayers.push(_(e,h,t)),I++)})),!N)return null;const P=N.fullExtents;if(S=N.sublayers,S||(S=[]),0===S.length&&S.push(N),M=N.extent,!M){const e=new a.Z(S[0].extent);N.extent=e.toJSON(),M=N.extent}if(E=N.spatialReferences,!E.length&&S.length>0){const e=t=>{let i=[];return t.sublayers.forEach((t=>{!i.length&&t.spatialReferences.length&&(i=t.spatialReferences||e(t))})),i};S.forEach((t=>{E.length||(E=t.spatialReferences||e(t))}))}const A=x(o,"GetFeatureInfo");let O;if(A){const e=b(o,"GetFeatureInfo");e.indexOf("text/html")>-1?O="text/html":e.indexOf("text/plain")>-1&&(O="text/plain")}if(!O){const e=function(t){t&&(t.queryable=!1,t.sublayers&&t.sublayers.forEach((t=>{e(t)})))};e(N)}const q=p(S),T=N.minScale||0,Z=N.maxScale||0,F=N.dimensions,L=q.reduce(((e,t)=>e.concat(t.dimensions)),[]),k=F.concat(L).filter(C);let W=null;if(k.length>0){let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;k.forEach((i=>{const{extent:s}=i;!function(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}(s)?s.forEach((i=>{e=Math.min(e,i.min.getTime()),t=Math.max(t,i.max.getTime())})):s.forEach((i=>{e=Math.min(e,i.getTime()),t=Math.max(t,i.getTime())}))})),W={startTimeField:null,endTimeField:null,trackIdField:null,timeExtent:[e,t]}}return{copyright:d,description:c,dimensions:F,extent:M,fullExtents:P,featureInfoFormat:O,featureInfoUrl:A,mapUrl:w,maxWidth:y,maxHeight:f,maxScale:Z,minScale:T,layers:q,spatialReferences:E,supportedImageFormatTypes:v,timeInfo:W,title:u,version:h}}function u(e){return o.some((t=>{const i=t[0],s=t[1];return e>=i&&e<=s}))}function d(e){return e.length?e.filter((e=>e.popupEnabled&&e.name&&e.queryable)).map((e=>e.name)).join(","):""}function p(e){let t=[];return e.forEach((e=>{t.push(e),e.sublayers&&e.sublayers.length&&(t=t.concat(p(e.sublayers)),delete e.sublayers)})),t}function c(e,t,i){var s;return null!=(s=t.getAttribute(e))?s:i}function m(e,t){for(let i=0;i<t.childNodes.length;i++){const s=t.childNodes[i];if(w(s)&&s.nodeName===e)return s}return null}function y(e,t){const i=[];for(let s=0;s<t.childNodes.length;s++){const r=t.childNodes[s];w(r)&&r.nodeName===e&&i.push(r)}return i}function g(e,t,i){const s=m(e,t);return s?s.textContent:i}function f(e,t,i){if(!e)return null;const s=parseFloat(e.getAttribute("minx")),r=parseFloat(e.getAttribute("miny")),o=parseFloat(e.getAttribute("maxx")),l=parseFloat(e.getAttribute("maxy"));let h,u,d,p;i?(h=isNaN(r)?-Number.MAX_VALUE:r,u=isNaN(s)?-Number.MAX_VALUE:s,d=isNaN(l)?Number.MAX_VALUE:l,p=isNaN(o)?Number.MAX_VALUE:o):(h=isNaN(s)?-Number.MAX_VALUE:s,u=isNaN(r)?-Number.MAX_VALUE:r,d=isNaN(o)?Number.MAX_VALUE:o,p=isNaN(l)?Number.MAX_VALUE:l);const c=new n.Z({wkid:t});return new a.Z({xmin:h,ymin:u,xmax:d,ymax:p,spatialReference:c})}function x(e,t){const i=m(t,e);if(i){const e=m("DCPType",i);if(e){const t=m("HTTP",e);if(t){const e=m("Get",t);if(e){let t=function(e,t,i,s){const r=m(e,i);return r?c(t,r,s):s}("OnlineResource","xlink:href",e,null);if(t)return t.indexOf("&")===t.length-1&&(t=t.substring(0,t.length-1)),function(e,t){const i=[],s=(0,r.mN)(e);for(const e in s.query)s.query.hasOwnProperty(e)&&-1===t.indexOf(e.toLowerCase())&&i.push(e+"="+s.query[e]);return s.path+(i.length?"?"+i.join("&"):"")}(t,["service","request"])}}}}return null}function b(e,t){const i=y("Operation",e);if(0===i.length)return y("Format",m(t,e)).map((e=>e.textContent));const s=[];return i.forEach((e=>{e.getAttribute("name")===t&&y("Format",e).forEach((e=>{s.push(e.textContent)}))})),s}function v(e,t,i){const s=m(t,e);if(!s)return i;const{textContent:r}=s;if(null==r||""===r)return i;const n=Number(r);return isNaN(n)?i:n}function _(e,t,i){var s;if(!e)return null;const r={id:i.idCounter++,fullExtents:[],parentLayerId:null,queryable:"1"===e.getAttribute("queryable"),spatialReferences:[],sublayers:null},o=m("LatLonBoundingBox",e),h=m("EX_GeographicBoundingBox",e);let d=null;o&&(d=f(o,4326)),h&&(d=new a.Z(0,0,0,0,new n.Z({wkid:4326})),d.xmin=parseFloat(g("westBoundLongitude",h,"0")),d.ymin=parseFloat(g("southBoundLatitude",h,"0")),d.xmax=parseFloat(g("eastBoundLongitude",h,"0")),d.ymax=parseFloat(g("northBoundLatitude",h,"0"))),o||h||(d=new a.Z(-180,-90,180,90,new n.Z({wkid:4326}))),r.minScale=v(e,"MaxScaleDenominator",0),r.maxScale=v(e,"MinScaleDenominator",0);const p=["1.0.0","1.1.0","1.1.1"].indexOf(t)>-1?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach((e=>{if("Name"===e.nodeName)r.name=e.textContent||"";else if("Title"===e.nodeName)r.title=e.textContent||"";else if("Abstract"===e.nodeName)r.description=e.textContent||"";else if("BoundingBox"===e.nodeName){const i=e.getAttribute(p);if(i&&0===i.indexOf("EPSG:")){const s=parseInt(i.substring(5),10);0===s||isNaN(s)||d||(d="1.3.0"===t?f(e,s,u(s)):f(e,s))}const s=i&&i.indexOf(":");if(s&&s>-1){let n=parseInt(i.substring(s+1,i.length),10);0===n||isNaN(n)||(n=l[n]?l[n]:n);const a="1.3.0"===t?f(e,n,u(n)):f(e,n);r.fullExtents.push(a)}}else if(e.nodeName===p)e.textContent.split(" ").forEach((e=>{0===(e=e.indexOf(":")>-1?parseInt(e.split(":")[1],10):parseInt(e,10))||isNaN(e)||(l[e]&&(e=l[e]),-1===r.spatialReferences.indexOf(e)&&r.spatialReferences.push(e))}));else if("Style"!==e.nodeName||r.legendURL){if("Layer"===e.nodeName){const s=_(e,t,i);s&&(s.parentLayerId=r.id,r.sublayers||(r.sublayers=[]),r.sublayers.push(s))}}else{const t=m("LegendURL",e);if(t){const e=m("OnlineResource",t);e&&(r.legendURL=e.getAttribute("xlink:href"))}}})),r.extent=null==(s=d)?void 0:s.toJSON(),r.dimensions=y("Dimension",e).filter((e=>e.getAttribute("name")&&e.getAttribute("units")&&e.textContent)).map((e=>{const t=e.getAttribute("name"),i=e.getAttribute("units"),s=e.textContent,r=e.getAttribute("unitSymbol"),n=e.getAttribute("default"),a="0"!==c("default",e,"0"),o="0"!==c("nearestValue",e,"0"),l="0"!==c("current",e,"0");return/^time$/i.test(t)&&/^ISO8601$/i.test(i)?{name:"time",units:"ISO8601",extent:S(s),default:S(n),multipleValues:a,nearestValue:o,current:l}:/^elevation$/i.test(t)?{name:"elevation",units:i,extent:N(s),unitSymbol:r,default:N(n),multipleValues:a,nearestValue:o}:{name:t,units:i,extent:R(s),unitSymbol:r,default:R(n),multipleValues:a,nearestValue:o}})),r}function w(e){return e.nodeType===Node.ELEMENT_NODE}function C(e){return"time"===e.name}function N(e){if(!e)return null;const t=-1!==e.indexOf("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:parseFloat(t[0]),max:parseFloat(t[1]),resolution:t.length>=3&&"0"!==t[2]?parseFloat(t[2]):void 0}})).filter((e=>e)):i.map((e=>parseFloat(e)))}function R(e){if(!e)return null;const t=-1!==e.indexOf("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:t[0],max:t[1],resolution:t.length>=3&&"0"!==t[2]?t[2]:void 0}})).filter((e=>e)):i}function S(e){if(!e)return null;const t=-1!==e.indexOf("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:new Date(t[0]),max:new Date(t[1]),resolution:t.length>=3&&"0"!==t[2]?M(t[2]):void 0}})).filter((e=>e)):i.map((e=>new Date(e)))}function M(e){const t=e.match(/(?:p(\d+y|\d+(?:.|,)\d+y)?(\d+m|\d+(?:.|,)\d+m)?(\d+d|\d+(?:.|,)\d+d)?)?(?:t(\d+h|\d+(?:.|,)\d+h)?(\d+m|\d+(?:.|,)\d+m)?(\d+s|\d+(?:.|,)\d+s)?)?/i);return t?{years:E(t[1]),months:E(t[2]),days:E(t[3]),hours:E(t[4]),minutes:E(t[5]),seconds:E(t[6])}:null}function E(e){if(!e)return 0;const t=e.match(/(?:\d+(?:.|,)\d+|\d+)/);if(!t)return 0;const i=t[0].replace(",",".");return Number(i)}function I(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}},29720:(e,t,i)=>{"use strict";i.d(t,{e:()=>u});i(95830);var s=i(98501),r=i(55955),n=i(27851),a=(i(5627),i(8634)),o=(i(84570),i(56291)),l=i(64796);function h(e,t,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&i&&(s.width=t,s.height=i),new a.Z(e,s)}class u extends o.s{constructor(e=null,t=!0){super(),this.requestRenderOnSourceChangedEnabled=t,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:(0,r.c)()},this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){this._source=e,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(e){const t=(0,s.i)(this.transforms.dvs),[i,r]=e.toScreenNoRotation([0,0],this.x,this.y),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,h=Math.PI*this.rotation/180;(0,s.b)(t,t,(0,n.f)(i,r)),(0,s.b)(t,t,(0,n.f)(o/2,l/2)),(0,s.r)(t,t,-h),(0,s.b)(t,t,(0,n.f)(-o/2,-l/2)),(0,s.j)(t,t,(0,n.f)(o,l)),(0,s.m)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind({context:e},t){this._texture&&e.bindTexture(this._texture,t)}updateTexture({context:e}){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=h(e,this.sourceWidth,this.sourceHeight):this._texture=h(e));const i=this.source;if(i){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function(e){return e&&"render"in e}(i))if(i instanceof l.Z){const e=i.getRenderedRasterPixels();this._texture.setData(e.renderedRasterPixels)}else this._texture.setData(function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(i));else(function(e){return e&&!("render"in e)})(i)&&this._texture.setData(i);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},28511:(e,t,i)=>{"use strict";i.d(t,{c:()=>a});var s=i(31514),r=i(32825),n=i(23956);class a extends n.Z{prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[r.U.bitmap],target:()=>this.children,drawPhase:s.jx.MAP});return[...super.prepareRenderPasses(e),t]}}},64796:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s=class{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(!t)return;const i=this.filter({pixelBlock:t}),s=i.pixelBlock.getAsRGBA(),r=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);r.data.set(s),e.putImageData(r,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},81558:(e,t,i)=>{"use strict";i.d(t,{y:()=>M});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),a=(i(10923),i(57002),i(86035),i(28293)),o=i(32105),l=i(80621),h=i(58385);let u=class extends h.wq{};u=(0,s._)([(0,n.j)("esri.views.layers.support.ClipArea")],u);const d=u;var p;let c=p=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new p({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,s._)([(0,r.Cb)({type:[Number,String],json:{write:!0}})],c.prototype,"left",void 0),(0,s._)([(0,r.Cb)({type:[Number,String],json:{write:!0}})],c.prototype,"right",void 0),(0,s._)([(0,r.Cb)({type:[Number,String],json:{write:!0}})],c.prototype,"top",void 0),(0,s._)([(0,r.Cb)({type:[Number,String],json:{write:!0}})],c.prototype,"bottom",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],c.prototype,"version",null),c=p=(0,s._)([(0,n.j)("esri.views.layers.support.ClipRect")],c);const m=c;var y,g=i(17149),f=i(39718),x=i(52937),b=i(53817),v=i(56885);i(36348);const _={base:f.Z,key:"type",typeMap:{extent:x.Z,polygon:b.Z}};let w=y=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new y({geometry:this.geometry.clone()})}};(0,s._)([(0,r.Cb)({types:_,json:{read:v.im,write:!0}})],w.prototype,"geometry",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],w.prototype,"version",null),w=y=(0,s._)([(0,n.j)("esri.views.layers.support.Geometry")],w);const C=w;let N=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,s._)([(0,r.Cb)({type:[[[Number]]],json:{write:!0}})],N.prototype,"path",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],N.prototype,"version",null),N=(0,s._)([(0,n.j)("esri.views.layers.support.Path")],N);const R=N,S=a.Z.ofType({key:"type",base:d,typeMap:{rect:m,path:R,geometry:C}}),M=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new S,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new g.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,l.init)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),(0,l.init)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),(0,l.init)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),(0,l.init)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,s=i.minScale,r=i.maxScale;if(null!=s&&null!=r){let i=!s,n=!r;!i&&e<=s&&(i=!0),!n&&e>=r&&(n=!0),t=i&&n}return t}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,s._)([(0,r.Cb)({type:S,set(e){const t=(0,o.Z)(e,this._get("clips"),S);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"moving",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"attached",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"container",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"updateRequested",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"updating",null),(0,s._)([(0,r.Cb)()],t.prototype,"view",void 0),t=(0,s._)([(0,n.j)("esri.views.2d.layers.LayerView2D")],t),t}},18650:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),a=i(87566),o=i(32656),l=(i(10923),i(57002),i(86035),i(39105)),h=i(52937),u=i(12421),d=i(58807),p=i(48164);const c=e=>{let t=class extends e{fetchPopupFeatures(e){const{layer:t}=this;if(!e)return Promise.reject(new o.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));const{popupEnabled:i}=t;if(!i)return Promise.reject(new o.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:i}));const s=this.createFetchPopupFeaturesQuery(e),{extent:r,width:n,height:a,x:l,y:h}=s;if(!(r&&n&&a))throw new o.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:r,width:n,height:a});const u=t.fetchFeatureInfo(r,n,a,l,h);return Promise.resolve(u?[u]:[])}};return(0,s._)([(0,n.Cb)()],t.prototype,"layer",void 0),t=(0,s._)([(0,a.j)("esri.layers.mixins.WMSLayerView")],t),t};var m=i(28511),y=i(81558),g=i(81186);const f=r.Z.getLogger("esri.views.2d.layers.WMSLayerView2D");let x=class extends(c((0,u.yc)((0,y.y)(p.Z)))){initialize(){const{layer:e,view:t}=this;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new o.Z("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{(0,l.isAbortError)(e)||f.error(e)}))}attach(){const{layer:e,view:t}=this,{imageMaxHeight:i,imageMaxWidth:s}=e;this._bitmapContainer=new m.c,this.container.addChild(this._bitmapContainer),this.strategy=new g.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:i,imageMaxWidth:s,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this._exportWMSImageParameters=new d.Z({layer:e,view:t}),this.handles.add(this._exportWMSImageParameters.watch("version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),"wms")}detach(){this.handles.remove("wms"),this.strategy.destroy(),this._exportWMSImageParameters.layer=null,this._exportWMSImageParameters.destroy(),this._exportWMSImageParameters=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,i=this._bitmapContainer,{x:s,y:r}=e,{spatialReference:n}=t;let a=null,o=0,l=0;i.children.some((e=>{const{width:t,height:i,resolution:u,x:d,y:p}=e,c=d+u*t,m=p-u*i;return s>=d&&s<=c&&r<=p&&r>=m&&(a=new h.Z({xmin:d,ymin:m,xmax:c,ymax:p,spatialReference:n}),o=t,l=i,!0)}));const u=a.width/o,d=Math.round((s-a.xmin)/u),p=Math.round((a.ymax-r)/u);return{extent:a,width:o,height:l,x:d,y:p}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,i,s){return this.layer.fetchImage(e,t,i,{timeExtent:this._exportWMSImageParameters.timeExtent,timestamp:this.refreshTimestamp,...s})}};(0,s._)([(0,n.Cb)()],x.prototype,"strategy",void 0),(0,s._)([(0,n.Cb)()],x.prototype,"updating",void 0),x=(0,s._)([(0,a.j)("esri.views.2d.layers.WMSLayerView2D")],x);const b=x},81186:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var s=i(56140),r=(i(95830),i(36544),i(68055),i(79881)),n=i(87566),a=(i(10923),i(57002),i(86035),i(39105)),o=i(82677),l=i(27780),h=i(52937),u=i(50897),d=i(40920),p=i(5201),c=i(46666);const m=Math.PI/180;function y(e){return e*m}function g(e,t){const i=y(t.rotation),s=Math.abs(Math.cos(i)),r=Math.abs(Math.sin(i)),[n,a]=t.size;return e[0]=Math.round(a*r+n*s),e[1]=Math.round(a*s+n*r),e}var f=i(29720);const x=(0,u.Ue)(),b=[0,0],v=new p.Z(0,0,0,0),_=2048,w=2048,C=!1,N=!1,R=!1;let S=class extends o.default{constructor(e){super(e),this._imagePromise=null,this.hidpi=R,this.imageMaxWidth=_,this.imageMaxHeight=w,this.imageRotationSupported=C,this.imageNormalizationSupported=N,this.update=(0,a.debounce)((async(e,t)=>{const i=e.state,s=(0,l.C5)(i.spatialReference),r=this.hidpi?e.pixelRatio:1;if(!e.stationary||this.destroyed)return;this.imageRotationSupported?(b[0]=i.size[0],b[1]=i.size[1]):g(b,i);const n=Math.floor(b[0]*r)>this.imageMaxWidth||Math.floor(b[1]*r)>this.imageMaxHeight,a=s&&(i.extent.xmin<s.valid[0]||i.extent.xmax>s.valid[1]),o=!this.imageNormalizationSupported&&a,h=!n&&!o,u=this.imageRotationSupported?i.rotation:0;if(h)this._imagePromise=this._singleExport(i,b,u,r,t);else{let e=Math.min(this.imageMaxWidth,this.imageMaxHeight);o&&(e=Math.min(i.worldScreenWidth,e)),this._imagePromise=this._tiledExport(i,e,u,r,t)}return this._imagePromise.then((async e=>{this._imagePromise=null,await Promise.all(e.map((e=>(this.container.addChild(e),e.fadeIn()))));for(const t of this.container.children)e.includes(t)||t.fadeOut().then((()=>{this.container.removeChild(t)}))})).catch((e=>{throw this._imagePromise=null,e}))}),5e3)}destroy(){}get updating(){return null!==this._imagePromise}updateExports(e){for(const t of this.container.children){if(!t.visible||!t.stage)return;e(t)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(t.invalidateTexture(),t.requestRender())}}_export(e,t,i,s,r,n){return Promise.resolve().then((()=>this.fetchSource(e,Math.floor(t*r),Math.floor(i*r),{rotation:s,pixelRatio:r,signal:n}))).then((i=>{const n=new f.e(i);return n.x=e.xmin,n.y=e.ymax,n.resolution=e.width/t,n.rotation=s,n.pixelRatio=r,n}))}_singleExport(e,t,i,s,r){!function(e,t,i,s){const[r,n]=t,[a,o]=s,l=.5*i;e[0]=r-l*a,e[1]=n-l*o,e[2]=r+l*a,e[3]=n+l*o}(x,e.center,e.resolution,t);const n=new h.Z(x[0],x[1],x[2],x[3],e.spatialReference);return this._export(n,t[0],t[1],i,s,r).then((e=>[e]))}_tiledExport(e,t,i,s,r){const n=d.Z.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),a=new c.Z(n),o=a.getTileCoverage(e);if(!o)return null;const l=[];return o.forEach(((n,o,u,d)=>{v.set(n,o,u,d),a.getTileBounds(x,v);const p=new h.Z(x[0],x[1],x[2],x[3],e.spatialReference);l.push(this._export(p,t,t,i,s,r))})),Promise.all(l)}};(0,s._)([(0,r.Cb)()],S.prototype,"_imagePromise",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"container",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"fetchSource",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"hidpi",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"imageMaxWidth",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"imageMaxHeight",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"imageRotationSupported",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"imageNormalizationSupported",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"requestUpdate",void 0),(0,s._)([(0,r.Cb)()],S.prototype,"updating",null),S=(0,s._)([(0,n.j)("esri.views.2d.layers.support.ExportStrategy")],S);const M=S},48164:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(82677)),l=i(35470),h=i(35326),u=i(75044),d=i(77204);let p=class extends((0,d.p)((0,h.I)((0,u.v)(l.Z.EventedMixin(o.default))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw r.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}}))}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,n.Cb)()],p.prototype,"fullOpacity",null),(0,s._)([(0,n.Cb)()],p.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],p.prototype,"parent",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],p.prototype,"suspended",null),(0,s._)([(0,n.Cb)({readOnly:!0})],p.prototype,"suspendInfo",null),(0,s._)([(0,n.Cb)({readOnly:!0})],p.prototype,"legendEnabled",null),(0,s._)([(0,n.Cb)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),(0,s._)([(0,n.Cb)()],p.prototype,"visible",null),p=(0,s._)([(0,a.j)("esri.views.layers.LayerView")],p);const c=p}}]);
//# sourceMappingURL=8650.js.map