(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[5991],{93352:(e,t,i)=>{"use strict";i.d(t,{C:()=>g,b:()=>p});var n=i(85461),r=i(62213),s=i(51219),a=i(63230),o=i(61514),l=i(4071),c=i(72023),h=i(34658),d=i(88214),u=i(83488),f=i(11823);function p(e){const t=new s.kG,i=1===e.output;return t.include(r.w,{linearDepth:i}),t.include(f.c,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(u.F,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(n.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?n.H`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:n.H`transformPosition(proj, view, vpos);`}
    }
  `),t.include(o.p,e),t.fragment.include(a.Y),e.multipassTerrainEnabled&&(t.fragment.include(l.S),t.include(d.l,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(c.bA),t.fragment.code.add(n.H`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${n.H.float(h.bf)}) {
      discard;
    }

    ${7===e.output?n.H`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?n.H`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?n.H`outputHighlight();`:""};
    ${1===e.output?n.H`outputDepth(linearDepth);`:""};
  }
  `),t}var g=Object.freeze({__proto__:null,build:p})},57086:(e,t,i)=>{"use strict";i.d(t,{L:()=>o,b:()=>a});var n=i(85461),r=i(51219),s=i(62692);function a(e){const t=new r.kG;return t.include(s.j,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(n.H`
  void main() {
    vec3 pos = mix(start, end, extrude.x);

    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
    vec4 projPos = uProjectionMatrix * viewPos;
    vec2 ndcPos = projPos.xy / projPos.w;

    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);

    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
    ndcPos += length(lxy) * projExtrudeDir;

    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;

    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));

    // Add enough padding in the X screen space direction for glow
    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
    ndcPos.x += xPaddingPixels * pixelToNDC.x;

    uv = ndcPos * 0.5 + 0.5;
    gl_Position = vec4(ndcPos, 0, 1);
  }
  `),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(n.H`
  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
    vec3 origin = mix(start, end, 0.5);
    vec3 basis = end - origin;
    vec3 posAtOrigin = pos - origin;

    float x = dot(normalize(basis), posAtOrigin);
    float y = dot(plane.xyz, posAtOrigin);

    float dx = max(abs(x) - length(basis), 0.0);
    float dy = y;

    float dist = length(vec2(dx, dy));

    float width = fwidth(y);
    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
    float pixelDist = dist / min(width, maxPixelDistance);
    return abs(pixelDist);
  }

  void main() {
    vec3 pos;
    vec3 normal;
    float depthDiscontinuityAlpha;

    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
      discard;
    }

    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);

    vec4 color = laserlineProfile(distance);
    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));

    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
  }
  `),t}var o=Object.freeze({__proto__:null,build:a})},56396:(e,t,i)=>{"use strict";i.d(t,{L:()=>h,b:()=>c,d:()=>l});var n=i(33655),r=i(85461),s=i(51219),a=i(84444),o=i(62692);const l=(0,n.Vl)(6);function c(e){const t=new s.kG;return t.extensions.add("GL_OES_standard_derivatives"),t.include(a.k),t.include(o.j,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(r.H`
      float planeDistancePixels(vec4 plane, vec3 pos) {
        float dist = dot(plane.xyz, pos) + plane.w;
        float width = fwidth(dist);
        dist /= min(width, maxPixelDistance);
        return abs(dist);
      }`),e.pointDistanceEnabled&&t.fragment.code.add(r.H`
    float sphereDistancePixels(vec4 sphere, vec3 pos) {
      float dist = distance(sphere.xyz, pos) - sphere.w;
      float width = fwidth(dist);
      dist /= min(width, maxPixelDistance);
      return abs(dist);
    }
    `),e.intersectsLineEnabled&&t.fragment.code.add(r.H`
    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
      return abs(dist) - radius;
    }
    `),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(r.H`
    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
      vec3 dir = end - start;
      float t2 = dot(dir, pos - start);
      float l2 = dot(dir, dir);
      return t2 >= 0.0 && t2 <= l2;
    }
    `),t.fragment.code.add(r.H`
  void main() {
    vec3 pos;
    vec3 normal;
    float depthDiscontinuityAlpha;

    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
      discard;
    }

    vec4 color = vec4(0, 0, 0, 0);
  `),e.heightManifoldEnabled&&t.fragment.code.add(r.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `),e.pointDistanceEnabled&&t.fragment.code.add(r.H`
    {
      // distance to sphere
      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));

      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
    }
    `),e.lineVerticalPlaneEnabled&&t.fragment.code.add(r.H`
    {
      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);

        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));

        color = max(color, lineVerticalColor * lineVerticalAlpha);
      }
    }
    `),e.intersectsLineEnabled&&t.fragment.code.add(r.H`
    {
      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));

        color = max(color, intersectsLineColor * intersectsLineAlpha);
      }
    }
    `),t.fragment.code.add(r.H`
    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
  }
  `),t}var h=Object.freeze({__proto__:null,defaultAngleCutoff:l,build:c})},12587:(e,t,i)=>{"use strict";i.d(t,{S:()=>f,b:()=>u});var n=i(85461),r=i(62213),s=i(51219),a=i(63230),o=i(61514),l=i(4071),c=i(34658),h=i(88214),d=i(20147);function u(e){const t=new s.kG;return t.include(r.w,{linearDepth:!1}),t.include(d.A.builder,{}),t.include(o.p,e),t.fragment.include(a.Y),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(n.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(n.H`
      vec3 worldNormal = normal;
      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;
    `),t.vertex.code.add(n.H`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(l.S),t.include(h.l,e)),t.fragment.code.add(n.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(n.H`
      vec3 viewNormalNorm = normalize(vViewNormal);
      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
      vec4 finalColor = mix(color, shadedColor, shadingFactor);
    `):t.fragment.code.add(n.H`
      vec4 finalColor = color;
    `),t.fragment.code.add(n.H`
      if (finalColor.a < ${n.H.float(c.bf)}) {
        discard;
      }
      ${7===e.output?n.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?n.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}var f=Object.freeze({__proto__:null,build:u})},58722:(e,t,i)=>{"use strict";i.d(t,{WG:()=>f,kB:()=>c,Ou:()=>o});i(95830);var n=i(6962),r=(i(82550),i(59472)),s=i(56885),a=(i(15988),i(45201));function o(e){return"declaredClass"in e}function l(e){return"declaredClass"in e}function c(e){return(0,r.Wi)(e)?null:o(e)?e:(0,s.im)(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:n,z:r,m:s}=e;return{x:i,y:n,z:r,m:s,spatialReference:t}}case"polygon":{const{rings:i,hasZ:n,hasM:r}=e;return{rings:h(i),hasZ:n,hasM:r,spatialReference:t}}case"polyline":{const{paths:i,hasZ:n,hasM:r}=e;return{paths:h(i),hasZ:n,hasM:r,spatialReference:t}}case"extent":{const{xmin:i,xmax:n,ymin:r,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:h,hasM:d}=e;return{xmin:i,xmax:n,ymin:r,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:h,hasM:d,spatialReference:t}}case"multipoint":{const{points:i,hasZ:n,hasM:r}=e;return{points:u(i)?d(i):i,hasZ:n,hasM:r,spatialReference:t}}default:return}}(e))}function h(e){return function(e){for(const t of e)if(0!==t.length)return u(t);return!1}(e)?e.map((e=>d(e))):e}function d(e){return e.map((e=>(0,n.qo)(e)))}function u(e){return e.length&&((0,n.xZ)(e[0])||(0,n.fS)(e[0]))}function f(e,t){if(!e)return null;let i;if(l(e)){if(null==t)return e.clone();if(l(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=(0,a.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},59492:(e,t,i)=>{"use strict";i.d(t,{Z:()=>C});var n=i(94588),r=i(59472),s=i(65575),a=i(61106),o=(i(36348),i(35470)),l=i(33655),c=i(96071),h=i(77625),d=i(17387),u=i(89333),f=i(67128),p=i(50897),g=i(17333),_=i(98501),m=i(30663),v=i(12811),b=i(8344),y=i(14286),w=i(88),x=i(88909),P=i(19132),D=i(90168),S=i(58722),E=i(81667);class C{constructor(e){this.camera=new D.Z,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,v.c)(),this._worldFrame=null,this._renderLocation=(0,h.c)(),this._renderLocationDirty=!0,this._location=new a.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new a.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new o.Z.EventEmitter,this._screenLocation={screenPointArray:(0,c.s1)(),renderScreenPointArray:(0,c.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayerId=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,s.IH)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){M(e)&&(this._screenLocationDirty=!0),(0,f.e)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,v.c)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,f.i)(i),!0;case"global":{const n=(0,u.Iu)(e.renderCoordsHelper.spatialReference);(0,g.PR)(t,0,z,0,n.radius),(0,g.tw)((0,l.Vl)(z[1]),(0,l.Vl)(z[0]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,S.WG)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,S.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=(0,r.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,M(this._modelTransform)){const t=this._calculateModelTransformOffset(W);e=(0,d.b)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=(0,c.md)(e,A),s=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,y.j)(this.screenLocation.screenPointArray,i)<s*s)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,T),o=s*this.screenLocation.pixelSize,l=w.kx.fromScreen(this.camera,i,R);if((0,r.Wi)(l))return null;for(const t of e){if(0===t.length)continue;const e=(0,d.k)(z,t[0],n);for(let i=1;i<t.length;i++){const r=(0,d.k)(F,t[i],n),s=w.KD.closestRayDistance2(w.KD.fromPoints(e,r,L),l);if(null!=s&&s<o*o){const t=(0,d.b)(b.WM.get(),e,r);(0,d.a)(t,t,.5);const i=(0,c.So)(b.WM.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}(0,d.g)(e,r)}}break}case"disc":{var o;const e=this.collisionType.direction,t=null!=(o=this.collisionType.offset)?o:h.Z,n=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(n,T),c=s*this.screenLocation.pixelSize,u=w.kx.fromScreen(this.camera,i,R);if((0,r.Wi)(u))return null;const f=(0,_.f)(V,l),p=(0,d.t)(q,e,f),g=(0,d.k)(I,t,l);w.yC.fromPositionAndNormal(g,p,O);const m=U;if(w.yC.intersectRay(O,u,m)&&(0,d.h)(m,g)<c*c)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,n=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(n,T),l=s*this.camera.computeScreenPixelSizeAt(this.renderLocation),h=w.kx.fromScreen(this.camera,i,R);if((0,r.Wi)(h))return null;const u=(0,_.f)(V,o),f=(0,d.t)(q,t,u),p=this._calculateModelTransformPosition(I);w.yC.fromPositionAndNormal(p,f,O);const g=U;if(!w.yC.intersectRay(O,h,g))break;for(const t of e){if(0===t.length)continue;const e=(0,d.k)(z,t[0],o);for(let i=1;i<t.length;i++){const n=(0,d.k)(F,t[i],o),r=w.KD.distance2(w.KD.fromPoints(e,n,L),g);if(null!=r&&r<l*l){const t=(0,d.b)(b.WM.get(),e,n);(0,d.a)(t,t,.5);const i=(0,c.So)(b.WM.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}(0,d.g)(e,n)}}break}default:(0,n.Bg)(this.collisionType)}return null}attach(e={manipulator3D:{}}){if(!this.view._stage)return;const t=e.manipulator3D;if(this._engineLayerId=t.engineLayerId,(0,r.Wi)(this._engineLayerId)){const e=new E.F({isPickable:!1});this.view._stage.add(e),this._engineLayerId=e.id,t.engineLayerId=e.id}t.engineLayerReferences=(t.engineLayerReferences||0)+1,this._materialIdReferences=t.materialIdReferences,(0,r.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,t.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,g.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new a.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayerId=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,g.nF)(this.location,H,e.spatialReference),(0,p.Qn)(e.extent,H)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if((0,r.Wi)(this.elevationInfo))return!1;let t=null,i=0;const n=(0,r.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=(0,r.Pt)((0,P.KO)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=(0,r.Pt)((0,P.KO)(this.view.elevationProvider,e,"ground"),0)+n;break;case"relative-to-scene":i=(0,r.Pt)((0,P.KO)(this.view.elevationProvider,e,"scene"),0)+n;break;case"absolute-height":i=n}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=T;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?2:1)|(this.selected?8:4),r=this._noDisplayCount>0;for(const{stateMask:e,objects:s}of i){if(r){for(const e of s)e.setVisible(!1);continue}const i=!(0!=(15&e))||(n&e)==(15&e),a=!(0!=(65520&e))||(this.state&e)==(65520&e);if(i&&a)for(const e of s)e.setVisible(!0),e.transformation=t;else for(const e of s)e.setVisible(!1)}}_ensureEngineResources(){if((0,r.Wi)(this._engineResources)){const e=this.view._stage.getObject((0,r.Wg)(this._engineLayerId)),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const n=(e,t)=>{const{geometry:i,material:n,transform:r}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,n,r))):e.addGeometry(i,n,r)},s=new Map;this._renderObjects.forEach((e=>{const t=new x.T({castShadow:!1});n(t,e);const i=e.stateMask||0,r=s.get(i)||[];r.push(t),s.set(i,r)}));const a=[];s.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||(0,r.Wi)(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=(0,r.Wg)(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>e.forEach((e=>{t.add(e),this.view._stage.add(e)})))),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||(0,r.Wi)(this._engineResources))return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),n.forEach((e=>{const t=(0,r.Wg)(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,j);return(0,d.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,d.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,f.f)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,f.m)(t,t,this._worldFrame),(0,f.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,(0,r.pC)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if((0,r.pC)(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function M(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const A=(0,c.s1)(),L=w.KD.create(),R=w.kx.create(),V=(0,m.c)(),j=(0,v.c)(),T=(0,v.c)(),O=w.yC.create(),z=(0,h.c)(),F=(0,h.c)(),U=(0,h.c)(),q=(0,h.c)(),I=(0,h.c)(),W=(0,h.c)(),H=new a.Z({x:0,y:0,z:0,spatialReference:null})},34937:(e,t,i)=>{"use strict";i.d(t,{J4:()=>y,gv:()=>w,G:()=>_,_y:()=>v,VG:()=>m,_N:()=>g,Sp:()=>b});var n=i(59472),r=i(33655),s=i(96071),a=i(77625),o=i(17387),l=i(17333),c=i(8344),h=i(88),d=i(81495),u=i(67134),f=i(46970),p=i(53640);function g(e,t){const i=(0,a.c)(),r=(0,a.c)();let o=!1;return a=>{if("start"===a.action){const r=(0,s.md)(a.screenStart,(0,s.c$)(c.qW.get())),l=h.kx.fromScreen(e.state.camera,r,D);(0,n.pC)(l)&&(o=h.yC.intersectRay(t,l,i))}if(!o)return null;const l=(0,s.md)(a.screenEnd,(0,s.c$)(c.qW.get())),d=h.kx.fromScreen(e.state.camera,l,D);return(0,n.Wi)(d)?null:h.yC.intersectRay(t,d,r)?{...a,renderStart:i,renderEnd:r,plane:t,ray:d}:null}}function _(e,t,i,r=null){return function(e,t,i,r=null){let a=null;return o=>{if("start"===o.action&&(a=e.sceneIntersectionHelper.intersectElevationFromScreen((0,s.s1)(o.screenStart.x,o.screenStart.y),t,i),(0,n.pC)(a)&&(0,n.pC)(r)&&!(0,l.nF)(a,a,r)))return null;if((0,n.Wi)(a))return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen((0,s.s1)(o.screenEnd.x,o.screenEnd.y),t,i);return(0,n.pC)(c)?(0,n.pC)(r)&&!(0,l.nF)(c,c,r)?null:{...o,mapStart:a,mapEnd:c}:null}}(e,i,(0,f.Ou)(t,e,i),r)}function m(e,t,i,n=null){return _(e,i,(0,f.RL)(t),n)}function v(e,t,i,r){const s=t.toMap(e.screenStart,{include:[i]});return(0,n.pC)(s)?m(t,i,s,r):null}function b(e,t,i){let s=null;const l=new p.hM;return l.next(g(e,function(e,t){const i=x,n=P,r=h.yC.create();e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,o.c)(r,i,(0,o.f)(n,t,e.state.camera.eye));return(0,o.c)(s,s,i),h.yC.fromPositionAndNormal(t,s,r)}(e,t))).next(function(e,t){const i=(0,a.c)(),n=(0,o.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,a.c)(),l=(0,a.c)(),c=s=>((0,o.f)(s,s,t),h.xr.projectPoint(i,s,s),"global"===e.viewingMode&&(0,o.l)(s)*(0,r.Xx)((0,o.d)(i,s))<.001-n&&(0,o.f)(s,(0,o.a)(s,i,.001),t),(0,o.b)(s,s,t),s);return e=>(e.renderStart=c((0,o.g)(s,e.renderStart)),e.renderEnd=c((0,o.g)(l,e.renderEnd)),e)}(e,t)).next(function(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),s=i.fromRenderCoords(e.renderEnd,t);return(0,n.pC)(r)&&(0,n.pC)(s)?{...e,mapStart:r,mapEnd:s}:null}}(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,s=e})),e=>(s=null,l.execute(e),s)}function y(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,n.pC)(t)&&(t.remove(),t=null)}return i}}function w(e,t=null){const i=new u.r(e.state.mode);i.options.selectionMode=!0,i.options.store=0;const r=(0,s.s1)(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,a.c)(),c=(0,n.Pt)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?o.exclude.add(d.cy):o.exclude.delete(d.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.md)(t,r),i,o);const n=i.results.min;let a;if(n.getIntersectionPoint(l))a="TerrainRenderer"===n.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(l))return null;a=0}return{location:e.renderCoordsHelper.fromRenderCoords(l,c),surfaceType:a}};let f;return e=>{if("start"===e.action){const t=h(e.screenStart);f=(0,n.pC)(t)?t.location:null}if((0,n.Wi)(f))return null;const t=h(e.screenEnd);return(0,n.pC)(t)&&(0,n.pC)(t.location)?{...e,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}const x=(0,a.c)(),P=(0,a.c)(),D=h.kx.create()},50777:(e,t,i)=>{"use strict";i.d(t,{Gd:()=>m,Aq:()=>v,EA:()=>p,qJ:()=>g,aD:()=>_,du:()=>b,u2:()=>y});var n=i(59472),r=i(17387),s=i(67128),a=i(38256),o=i(8344),l=i(39746),c=i(58722),h=i(74218),d=i(94589),u=i(59492),f=i(71279);function p(e,t=4){const i=(0,a.f)(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return new f.Q({color:i,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function g(e,t=4){const i=(0,a.f)(e[0],e[1],e[2],4===e.length?e[3]:1);return new d.E({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function _(e,t,i){return new u.Z({view:e,renderObjects:[{geometry:l.Z.createSphereGeometry(1,32,32),material:p((0,a.f)(t[0],t[1],t[2],null!=i?i:1))}]})}function m(e,t,i,n){const a=(0,r.f)(o.WM.get(),e,i),l=v(a,(0,r.c)(o.WM.get(),n,a),i,o.MP.get());(0,s.c)(l,l);const c=(0,r.k)(o.WM.get(),t,l);return Math.atan2(c[1],c[0])}function v(e,t,i,n){const s=(0,r.n)(o.WM.get(),e),a=(0,r.n)(o.WM.get(),t),l=(0,r.c)(o.WM.get(),s,a);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=0,n[4]=a[0],n[5]=a[1],n[6]=a[2],n[7]=0,n[8]=l[0],n[9]=l[1],n[10]=l[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function b(e,t){const i=e.getViewForGraphic(t);return(0,n.pC)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function y(e,t,i){const r=b(e,i);(0,n.pC)(r)?t.elevationAlignedLocation=r:function(e,t){if((0,n.Wi)(t))return;const i=(0,h.zE)(t);(0,n.Wi)(i)||(e.location=(0,c.kB)(i))}(t,i.geometry)}},51635:(e,t,i)=>{"use strict";i.d(t,{W:()=>Z});var n=i(59472),r=i(77625),s=i(17387),a=i(88),o=i(74808),l=i(56396),c=i(33655),h=i(55735),d=i(38256),u=i(34353),f=i(56469),p=i(10346),g=i(30090),_=i(56140),m=i(67128),v=i(12811),b=i(23240),y=i(97853),w=i(44801),x=i(51007),P=i(36904),D=i(57086);class S extends y.A{initializeProgram(e){const t=S.shader.get(),i=this.configuration,n=t.build(i);return new x.Z(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),S.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),(0,m.t)(C,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",C),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return(0,P.sm)({blending:(0,P.if)(1,771),colorWrite:P.BK})}bindPipelineState(e){e.setPipelineState(this.pipeline)}}S.shader=new b.J(D.L,(()=>i.e(5277).then(i.bind(i,45277)))),S.attributeLocations={start:0,end:1,up:2,extrude:3};class E extends w.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,_._)([(0,w.o)()],E.prototype,"contrastControlEnabled",void 0);const C=(0,v.c)();i(95830),i(5627);var M=i(1227),A=i(80905),L=i(69595),R=i(74038);i(84570);class V{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,r.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,s.s)(this._origin,e[t+0],e[t+1],e[t+2])}else(0,s.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this.ensureVAO(e);(0,n.pC)(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}dispose(){(0,n.pC)(this._vao)&&this._vao.dispose()}ensureVAO(e){return(0,n.Wi)(this._buffers)?null:((0,n.Wi)(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const i=this.createDataBuffer(t);return this._dirty=!1,new R.Z(e,S.attributeLocations,{data:(0,M.K)(O)},{data:L.Z.createVertex(e,35044,i)})}ensureVertexData(e,t){if(!this._dirty)return;const i=this.createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}numberOfRenderVertices(e){return 2*(e.length/3-1)*3}createDataBuffer(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const i=O.createBuffer(t),n=this._origin;let r=0,a=0;for(const t of e){for(let e=0;e<t.length;e+=3){const o=(0,s.s)(T,t[e+0],t[e+1],t[e+2]);0===e?a=this._renderCoordsHelper.getAltitude(o):this._renderCoordsHelper.setAltitude(a,o);const l=this._renderCoordsHelper.worldUpAtPosition(o,j),c=r+2*e,h=(0,s.f)(T,o,n);if(e<t.length-3){i.up.setVec(c,l),i.up.setVec(c+3,l),i.up.setVec(c+5,l);for(let e=0;e<6;e++)i.start.setVec(c+e,h);i.extrude.setValues(c+0,0,-1),i.extrude.setValues(c+1,1,-1),i.extrude.setValues(c+2,1,1),i.extrude.setValues(c+3,0,-1),i.extrude.setValues(c+4,1,1),i.extrude.setValues(c+5,0,1)}if(e>0){i.up.setVec(c-2,l),i.up.setVec(c-4,l),i.up.setVec(c-5,l);for(let e=-6;e<0;e++)i.end.setVec(c+e,h)}}r+=this.numberOfRenderVertices(t)}return i.buffer}}const j=(0,r.c)(),T=(0,r.c)(),O=(0,A.U$)().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");var z=i(11379);class F extends y.A{initializeProgram(e){const t=F.shader.get(),i=this.configuration,n=t.build(i);return new x.Z(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),z.i)}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:l.d;this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-(0,c.Vl)(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return(0,P.sm)({blending:(0,P.if)(1,771),colorWrite:P.BK})}}F.shader=new b.J(l.L,(()=>i.e(1070).then(i.bind(i,1070))));class U extends w.m{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}(0,_._)([(0,w.o)()],U.prototype,"heightManifoldEnabled",void 0),(0,_._)([(0,w.o)()],U.prototype,"pointDistanceEnabled",void 0),(0,_._)([(0,w.o)()],U.prototype,"lineVerticalPlaneEnabled",void 0),(0,_._)([(0,w.o)()],U.prototype,"intersectsLineEnabled",void 0),(0,_._)([(0,w.o)()],U.prototype,"contrastControlEnabled",void 0);const q=(0,r.c)(),I=(0,d.c)(),W={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:(0,c.Vl)(6),globalAlphaContrastBoost:2};function H(e,t,i,n){const r=q,o=I;(0,s.k)(r,t,n),(0,s.g)(o,i),o[3]=0,(0,u.t)(o,o,n),a.yC.fromPositionAndNormal(r,o,e)}class k{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=(0,d.c)(),this._zScale=(0,h.c)(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=(0,r.c)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=(0,r.c)(),this._pointDistanceTarget=(0,r.c)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=a.KD.create(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=a.KD.create(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=(0,r.c)(),this._tempDir=(0,r.c)(),this._tempUp=(0,r.c)(),this._tempVec3A=(0,r.c)(),this._tempVec3B=(0,r.c)(),this._tempVec4=(0,d.c)(),this._tempPlane=a.yC.create(),this._tempSphere=a.Dv.create(),this._params=(0,g.Uf)(t,W)}get renderSlots(){return[this._config.contrastControlEnabled?17:16]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){(0,s.g)(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){(0,s.g)(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){(0,s.g)(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){a.KD.copy(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){a.KD.copy(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,(0,n.pC)(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){(0,n.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new V(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){(0,n.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new V(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameterValues(e){(0,g.LO)(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=(0,p.ow)(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new U,this._pathTechniqueConfig=new E}uninitializeRenderContext(){this._quadVAO=(0,n.O3)(this._quadVAO),this._techniqueRepository.release(this._technique),this._technique=null,this._pathVerticalPlaneData=(0,n.O3)(this._pathVerticalPlaneData),this._techniqueRepository.release(this._pathTechnique),this._pathTechnique=null}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return!0;const n=e.camera;return(0,f.Xv)(n.projectionMatrix,n.fullWidth,n.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),n=i.program;t.bindProgram(n),i.bindPipelineState(t),this.bindGlobalUniforms(e,n),this.bindHeightManifoldUniforms(e,n),this.bindPointDistanceUniforms(e,n),this.bindLineVerticalPlaneUniforms(e,n),this.bindIntersectsLineUniforms(e,n),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}renderPath(e){if((0,n.Wi)(this._pathVerticalPlaneData))return;this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquireAndReleaseExisting(S,this._pathTechniqueConfig,this._pathTechnique);const t=e.rctx,i=this._pathTechnique,r=i.program;t.bindProgram(r),i.bindPipelineState(t),this.bindGlobalUniforms(e,r),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,n=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),H(n,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",n)}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,n=this._tempSphere;(0,s.g)(n,this._pointDistanceOrigin),(0,s.k)(n,n,i.viewMatrix),n[3]=(0,s.i)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",n[0],n[1],n[2],n[3])}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,n=e.camera,r=this._tempPlane,o=this._tempVec3A,l=this._tempUp,c=this._tempDir,h=this._tempNormal;a.KD.pointAt(this._lineVerticalPlaneSegment,.5,o),i.worldUpAtPosition(o,l),(0,s.n)(c,this._lineVerticalPlaneSegment.vector),(0,s.c)(h,l,c),(0,s.n)(h,h),H(r,this._lineVerticalPlaneSegment.origin,h,n.viewMatrix),t.setUniform4fv("lineVerticalPlane",r);const d=this._tempVec3A;(0,s.g)(d,this._lineVerticalPlaneSegment.origin),i.setAltitude(0,d),(0,s.k)(d,d,n.viewMatrix),t.setUniform3fv("lineVerticalStart",d);const u=this._tempVec3B;(0,s.b)(u,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(0,u),(0,s.k)(u,u,n.viewMatrix),t.setUniform3fv("lineVerticalEnd",u)}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=N,n=B;if(this._intersectsLineInfinite){const t=e.camera;if(a.bW.fromRay(a.kx.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),G),G.c0=-Number.MAX_VALUE,!a.oy.intersectClipRay(t.frustum,G))return;a.bW.getStart(G,i),a.bW.getEnd(G,n)}else(0,s.g)(i,this._intersectsLineSegment.origin),(0,s.b)(n,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const r=this._tempVec3A;(0,s.k)(r,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",r);const o=this._tempVec4;(0,s.g)(o,this._intersectsLineSegment.vector),this._tempVec4[3]=0,(0,u.t)(this._tempVec4,this._tempVec4,e.camera.viewMatrix),(0,s.k)(n,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",n),(0,s.n)(o,o),t.setUniform3f("intersectsLineDirection",o[0],o[1],o[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.setUniform1i("depthMap",0),e.rctx.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,0),t.setUniform1i("frameColor",1),e.rctx.bindTexture(e.offscreenRenderingHelper.mainColorTexture,1)}_requestRender(){this._context&&this._context.requestRender()}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.acquireAndReleaseExisting(F,this._techniqueConfig,this._technique),this._technique}}const G=a.bW.create(),N=(0,r.c)(),B=(0,r.c)();class Z extends o.l{constructor(e){super(e.view),this._angleCutoff=l.d,this._style={},this._heightManifoldTarget=(0,r.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=a.KD.create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){(0,n.pC)(e)?((0,s.g)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if((0,n.Wi)(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,$);this.intersectsLine=a.KD.fromValues(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){(0,n.pC)(e)?(a.KD.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=(0,n.pC)(e)?a.KD.copy(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=(0,n.pC)(e)?{origin:(0,r.a)(e.origin),target:(0,r.a)(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,n.pC)(this._pointDistanceLine)||(0,n.pC)(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){(0,n.pC)(this.renderer)||(this.renderer=new k(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){(0,n.Wi)(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){(0,n.Wi)(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}syncHeightManifold(){(0,n.Wi)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){(0,n.Wi)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){(0,n.Wi)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){(0,n.Wi)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=(0,n.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,n.pC)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){(0,n.Wi)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=(0,n.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,n.pC)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){(0,n.Wi)(this.renderer)||(this.renderer.pointDistanceEnabled=(0,n.pC)(this._pointDistanceLine)&&this.visible,(0,n.pC)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){(0,n.pC)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const $=(0,r.c)()},74808:(e,t,i)=>{"use strict";i.d(t,{l:()=>n});class n{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},74218:(e,t,i)=>{"use strict";i.d(t,{zE:()=>h});var n=i(92232),r=i(88998),s=i(33655),a=(i(77625),i(67128),i(50897),i(17333)),o=(i(12811),i(69996),i(55735)),l=(i(38256),i(34353),i(45201)),c=i(58722);function h(e,t){if("point"===e.type)return u(e,t,!1);if((0,c.Ou)(e))switch(e.type){case"extent":return u(e.center,t,!1);case"polygon":return u(e.centroid,t,!1);case"polyline":return u(d(e),t,!0);case"mesh":return u(e.extent.center,t,!1)}else switch(e.type){case"extent":return u(function(e){const t=(0,s.xV)(e.zmin);return(0,l.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return u(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=(0,r.a)(e.rings,e.hasZ);return(0,l.Tx)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return u(d(e),t,!0)}}function d(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,n.n8)(t,(0,n.ok)(t)/2);return(0,l.Tx)(i[0],i[1],i[2],e.spatialReference)}function u(e,t,i){const n=i?e:(0,c.WG)(e);return t&&e?(0,a.nF)(e,n,t)?n:null:n}(0,o.f)(0,0),(0,o.f)(.5,0),(0,o.f)(1,0),(0,o.f)(0,.5),(0,o.f)(.5,.5),(0,o.f)(1,.5),(0,o.f)(0,1),(0,o.f)(.5,1),(0,o.f)(1,1)},19132:(e,t,i)=>{"use strict";i.d(t,{KO:()=>a,Fb:()=>s});var n=i(59472),r=i(45201);function s(e){return"array"in e}function a(e,t,i="ground"){if((0,r.Vs)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,(0,n.Pt)(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},1227:(e,t,i)=>{"use strict";i.d(t,{K:()=>r});const n={divisor:0};function r(e,t={}){t={...n,...t};const i=e.stride;return e.fieldNames.filter((t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)})).map((n=>{const r=e.fields.get(n),a=r.constructor.ElementCount,o=s(r.constructor.ElementType),l=r.offset,c=!(!r.optional||!r.optional.glNormalized);return{name:n,stride:i,count:a,type:o,offset:l,normalized:c,divisor:t.divisor}}))}function s(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},62692:(e,t,i)=>{"use strict";i.d(t,{j:()=>a});var n=i(85461),r=i(4071);function s(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n.H`
    vec3 reconstructPosition(vec2 fragCoord, float depth) {
      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
    }
  `)}function a(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(r.S),e.include(s),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(n.H`
  vec4 blendPremultiplied(vec4 source, vec4 dest) {
    float oneMinusSourceAlpha = 1.0 - source.a;

    return vec4(
      source.rgb + dest.rgb * oneMinusSourceAlpha,
      source.a + dest.a * oneMinusSourceAlpha
    );
  }
  `),e.fragment.code.add(n.H`
  vec4 premultipliedColor(vec3 rgb, float alpha) {
    return vec4(rgb * alpha, alpha);
  }
  `),e.fragment.code.add(n.H`
  vec4 laserlineProfile(float dist) {
    if (dist > glowWidth) {
      return vec4(0.0);
    }

    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);

    return blendPremultiplied(
      premultipliedColor(innerColor, innerAlpha),
      premultipliedColor(glowColor, glowAlpha)
    );
  }
  `),e.fragment.code.add(n.H`
  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
    float depth = linearDepthFromTexture(depthMap, uv, nearFar);

    if (-depth == nearFar[0]) {
      return false;
    }

    pos = reconstructPosition(gl_FragCoord.xy, depth);
    normal = normalize(cross(dFdx(pos), dFdy(pos)));

    float ddepth = fwidth(depth);
    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);

    return true;
  }
  `),t.contrastControlEnabled?e.fragment.code.add(n.H`
    float rgbToLuminance(vec3 color) {
      return dot(vec3(0.2126, 0.7152, 0.0722), color);
    }

    vec4 laserlineOutput(vec4 color) {
      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);

      return color * alpha;
    }
    `):e.fragment.code.add(n.H`
    vec4 laserlineOutput(vec4 color) {
      return color * globalAlpha;
    }
    `)}},20147:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var n,r=i(85461);!function(e){e.builder=function(e,t){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(r.H`
    float computeRenderPixelSizeAt( vec3 pWorld ){
      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
      return viewDirectionDistance*perScreenPixelRatio;
    }

    vec3 screenSizeScaling(vec3 position, vec3 anchor){
      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
    }
  `)},e.bindPassUniforms=function(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}}(n||(n={}))},84444:(e,t,i)=>{"use strict";i.d(t,{k:()=>r});var n=i(85461);function r(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(n.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},90168:(e,t,i)=>{"use strict";i.d(t,{Z:()=>D});var n=i(59472),r=i(33655),s=i(96071),a=i(77625),o=i(17387),l=i(17154),c=i(67128),h=i(12811),d=i(55735),u=i(38256),f=i(69987),p=i(34353),g=i(14286),_=i(88),m=i(56469);class v{constructor(e=null,t=null,i=null){this._viewUp=(0,a.c)(),this._viewForward=(0,a.c)(),this._viewRight=(0,a.c)(),this._ray=_.kx.createWrapper(),this._viewport=(0,u.f)(0,0,1,1),this._padding=(0,u.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,d.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,h.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.c)(),this._frustumDirty=!0,this._frustum=_.oy.create(),this._fullViewport=(0,u.c)(),this.pixelRatio=1,this.relativeElevation=0,this._eye=(0,n.pC)(e)?(0,a.a)(e):(0,a.c)(),this._center=(0,n.pC)(t)?(0,a.a)(t):(0,a.c)(),this._up=(0,n.pC)(i)?(0,a.a)(i):(0,a.f)(0,0,1)}get eye(){return this._eye}set eye(e){this._compareAndSetView(e,this._eye)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=(0,a.c)()),(0,o.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,c.e)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),(0,p.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,c.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;(0,c.h)(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){(0,c.e)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,m.tM)(this._fov,this.width,this.height)}set fovX(e){this._fov=(0,m.Kj)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,m.RQ)(this._fov,this.width,this.height)}set fovY(e){this._fov=(0,m.zF)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,o.i)(this._center,this._eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,c.c)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,c.d)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){const t=e;return(0,o.g)(this._eye,t._eye),(0,o.g)(this._center,t._center),(0,o.g)(this._up,t._up),(0,p.c)(this._viewport,t._viewport),(0,p.c)(this._padding,t._padding),(0,g.c)(this._nearFar,t._nearFar),this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||((0,c.e)(this._viewMatrix,t._viewMatrix),(0,o.g)(this._viewRight,t._viewRight),(0,o.g)(this._viewUp,t._viewUp),(0,o.g)(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:((0,c.e)(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(_.oy.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,c.e)(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,p.c)(this._fullViewport,t._fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new v).copyFrom(this)}equals(e){return(0,o.o)(this._eye,e._eye)&&(0,o.o)(this._center,e._center)&&(0,o.o)(this._up,e._up)&&(0,p.g)(this._viewport,e._viewport)&&(0,p.g)(this._padding,e._padding)&&(0,g.k)(this._nearFar,e._nearFar)&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4;(0,o.u)(w,e.eye,e.center),(0,o.u)(x,this._eye,this._center);const i=(0,o.d)(w,x),n=(0,o.v)(w),r=(0,o.v)(x);return i*i>=(1-1e-10)*n*r&&(0,o.w)(e.eye,this._eye)<Math.max(n,r)*t*t&&(0,p.i)(e.padding,this._padding)<.5&&(0,p.i)(e.viewport,this._viewport)<.5}markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs((0,f.p)(this.viewForward,(0,o.f)(w,e,this._eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,s.s1)()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e||(e=(0,s.J$)()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e.length>2&&(e[2]=.5),e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==b&&(0,o.g)(b,e),b[3]=1,i&&(t[2]=-b[2]),(0,p.t)(b,b,this.projectionMatrix),(0,o.a)(b,b,1/Math.abs(b[3]));const n=this.fullViewport;return t[0]=(0,r.t7)(0,n[0]+n[2],.5+.5*b[0]),t[1]=(0,r.t7)(0,n[1]+n[3],.5+.5*b[1]),i||(t[2]=.5*(b[2]+1)),t}projectToScreen(e,t){return this.projectToRenderScreen(e,P),this.renderToScreen(P,t)}projectToRenderScreen(e,t){if(b[0]=e[0],b[1]=e[1],b[2]=e[2],b[3]=1,(0,p.t)(b,b,this.viewProjectionMatrix),0===b[3])return null;(0,o.a)(b,b,1/Math.abs(b[3]));const i=this.fullViewport;return"x"in t?(t.x=(0,r.t7)(0,i[0]+i[2],.5+.5*b[0]),t.y=(0,r.t7)(0,i[1]+i[3],.5+.5*b[1])):(t[0]=(0,r.t7)(0,i[0]+i[2],.5+.5*b[0]),t[1]=(0,r.t7)(0,i[1]+i[3],.5+.5*b[1]),t.length>2&&(t[2]=.5*(b[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,P),t)}unprojectFromRenderScreen(e,t){if((0,c.m)(y,this.projectionMatrix,this.viewMatrix),!(0,c.c)(y,y))return null;const i=this.fullViewport;return b[0]=2*(e[0]-i[0])/i[2]-1,b[1]=2*(e[1]-i[1])/i[3]-1,b[2]=2*e[2]-1,b[3]=1,(0,p.t)(b,b,y),0===b[3]?null:(t[0]=b[0]/b[3],t[1]=b[1]/b[3],t[2]=b[2]/b[3],t)}constrainWindowSize(e,t,i,n=1){const r=e*this.pixelRatio,s=t*this.pixelRatio,a=Math.max(r-i*n/2,0),o=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(r-i*n/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[a,o,i*n-l- -Math.min(this.fullWidth-r-i*n/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=n,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=i,t[1]=n,t}computeUpGlobal(){(0,o.f)(w,this.center,this.eye);const e=(0,o.l)(this.center);e<1?((0,o.s)(this.up,0,0,1),this.markViewDirty()):Math.abs((0,o.d)(w,this.center))>.9999*(0,o.l)(w)*e||((0,o.c)(this.up,w,this.center),(0,o.c)(this.up,this.up,w),(0,o.n)(this.up,this.up),this.markViewDirty())}computeUpLocal(){(0,l.tB)(w,this.eye,this.center),Math.abs(w[2])<=.9999&&((0,o.a)(w,w,w[2]),(0,o.s)(this.up,-w[0],-w[1],1-w[2]),(0,o.n)(this.up,this.up),this.markViewDirty())}_compareAndSetView(e,t){(0,o.o)(e,t)||((0,o.g)(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}_recomputeFrustum(){this._frustumDirty&&(_.oy.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,c.l)(this._viewMatrix,this._eye,this._center,this._up),(0,o.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,o.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,o.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const b=(0,u.c)(),y=(0,h.c)(),w=(0,a.c)(),x=(0,a.c)(),P=(0,s.J$)(),D=v},39746:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var n,r=i(77625),s=i(17387),a=i(88),o=i(69236),l=i(56469);!function(e){e.length=function(e,t){const i=e[t],n=e[t+1],r=e[t+2];return Math.sqrt(i*i+n*n+r*r)},e.normalize=function(e,t){const i=e[t],n=e[t+1],r=e[t+2],s=1/Math.sqrt(i*i+n*n+r*r);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,n,r,s=t){(r=r||e)[s]=e[t]+i[n],r[s+1]=e[t+1]+i[n+1],r[s+2]=e[t+2]+i[n+2]},e.subtract=function(e,t,i,n,r,s=t){(r=r||e)[s]=e[t]-i[n],r[s+1]=e[t+1]-i[n+1],r[s+2]=e[t+2]-i[n+2]}}(n||(n={}));var c=i(27898),h=i(68500);const d=n;var u,f,p,g;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],r=[0,0,1,0,1,1,0,1],s=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),a=new Uint16Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)a[6*e+t]=e;const o=new Uint16Array(36);for(let e=0;e<6;e++)o[6*e+0]=0,o[6*e+1]=1,o[6*e+2]=2,o[6*e+3]=2,o[6*e+4]=3,o[6*e+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let n=0;n<8;n++)t[3*n]=i[n][0]*e[0],t[3*n+1]=i[n][1]*e[1],t[3*n+2]=i[n][2]*e[2];return new h.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:n}],["uv0",{size:2,data:r}]],[["position",s],["normal",a],["uv0",o]])}}(u||(u={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],r=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),s=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let n=0;n<6;n++)t[3*n]=i[n][0]*e[0],t[3*n+1]=i[n][1]*e[1],t[3*n+2]=i[n][2]*e[2];return new h.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:n}]],[["position",r],["normal",s]])}}(f||(f={})),function(e){const t=.5,i=(0,o.f)(-t,0,-t),n=(0,o.f)(t,0,-t),r=(0,o.f)(0,0,t),a=(0,o.f)(0,.5,0),l=(0,o.c)(),c=(0,o.c)(),d=(0,o.c)(),u=(0,o.c)(),f=(0,o.c)();(0,s.f)(l,i,a),(0,s.f)(c,i,n),(0,s.c)(d,l,c),(0,s.n)(d,d),(0,s.f)(l,n,a),(0,s.f)(c,n,r),(0,s.c)(u,l,c),(0,s.n)(u,u),(0,s.f)(l,r,a),(0,s.f)(c,r,i),(0,s.c)(f,l,c),(0,s.n)(f,f);const p=[i,n,r,a],g=[0,-1,0,d[0],d[1],d[2],u[0],u[1],u[2],f[0],f[1],f[2]],_=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=p[i][0]*e[0],t[3*i+1]=p[i][1]*e[1],t[3*i+2]=p[i][2]*e[2];return new h.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:g}]],[["position",new Uint16Array(_)],["normal",new Uint16Array(m)]])}}(p||(p={})),function(e){e.createBoxGeometry=u.createGeometry,e.createDiamondGeometry=f.createGeometry,e.createTetrahedronGeometry=p.createGeometry,e.createSphereGeometry=function(e,t,i,n={uv:!0}){const r=-Math.PI,s=2*Math.PI,a=-Math.PI/2,o=Math.PI,l=Math.max(3,Math.floor(t)),c=Math.max(2,Math.floor(i)),d=(l+1)*(c+1),u=new Float32Array(3*d),f=new Float32Array(3*d),p=new Float32Array(2*d),g=[];let _=0;for(let t=0;t<=c;t++){const i=[],n=t/c,h=a+n*o,d=Math.cos(h);for(let t=0;t<=l;t++){const a=t/l,o=r+a*s,c=Math.cos(o)*d,g=Math.sin(h),m=-Math.sin(o)*d;u[3*_]=c*e,u[3*_+1]=g*e,u[3*_+2]=m*e,f[3*_]=c,f[3*_+1]=g,f[3*_+2]=m,p[2*_]=a,p[2*_+1]=n,i.push(_),++_}g.push(i)}const m=new Uint32Array(2*l*(c-1)*3);_=0;for(let e=0;e<c;e++)for(let t=0;t<l;t++){const i=g[e][t],n=g[e][t+1],r=g[e+1][t+1],s=g[e+1][t];0===e?(m[_++]=i,m[_++]=r,m[_++]=s):e===c-1?(m[_++]=i,m[_++]=n,m[_++]=r):(m[_++]=i,m[_++]=n,m[_++]=r,m[_++]=r,m[_++]=s,m[_++]=i)}const v=[["position",m],["normal",m]],b=[["position",{size:3,data:u,exclusive:!0}],["normal",{size:3,data:f,exclusive:!0}]];return n.uv&&(b.push(["uv0",{size:2,data:p,exclusive:!0}]),v.push(["uv0",m])),n.offset&&(v[0][0]="offset",b[0][0]="offset",v.push(["position",new Uint32Array(m.length)]),b.push(["position",{size:3,data:Float64Array.from(n.offset),exclusive:!0}])),new h.Z(b,v)},e.createPolySphereGeometry=function(e,t,i){const n=e;let r,s;if(i)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=n*(1+Math.sqrt(5))/2;r=[-n,e,0,n,e,0,-n,-e,0,n,-e,0,0,-n,e,0,n,e,0,-n,-e,0,n,-e,e,0,-n,e,0,n,-e,0,-n,-e,0,n],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let t=0;t<r.length;t+=3)d.scale(r,t,e/d.length(r,t));let a={};function o(t,i){t>i&&([t,i]=[i,t]);const n=t.toString()+"."+i.toString();if(a[n])return a[n];let s=r.length;return r.length+=3,d.add(r,3*t,r,3*i,r,s),d.scale(r,s,e/d.length(r,s)),s/=3,a[n]=s,s}for(let e=0;e<t;e++){const e=s.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=s[i],n=s[i+1],r=s[i+2],a=o(e,n),l=o(n,r),c=o(r,e),h=4*i;t[h]=e,t[h+1]=a,t[h+2]=c,t[h+3]=n,t[h+4]=l,t[h+5]=a,t[h+6]=r,t[h+7]=c,t[h+8]=l,t[h+9]=a,t[h+10]=l,t[h+11]=c}s=t,a={}}const l=new Float32Array(r);for(let e=0;e<l.length;e+=3)d.normalize(l,e);const c=[["position",s],["normal",s]],u=[["position",{size:3,data:new Float32Array(r),exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}]];return new h.Z(u,c)},e.createPointGeometry=function(e,t,i,n,r,s,a){const o=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];s=s||[0,0];const c=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],d=null!=n&&2===n.length?n:[1,1],u=[["position",{size:3,data:o,exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}],["uv0",{size:s.length,data:s}],["color",{size:4,data:c,exclusive:!0}],["size",{size:2,data:d}]];if(null!=r){const e=new Float32Array([r[0],r[1],r[2],r[3]]);u.push(["auxpos1",{size:4,data:e}])}if(null!=a){const e=new Float32Array([a[0],a[1],a[2],a[3]]);u.push(["auxpos2",{size:4,data:e}])}return new h.Z(u,null,1)},e.updatePointGeometry=function(e,t,i,n,r,s,a,o){if(null!=e){const{data:t}=o.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute("color");e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=n){const{data:e}=o.getMutableAttribute("size");e[0]=n[0],e[1]=n[1]}if(null!=r){const{data:e}=o.getMutableAttribute("auxpos1");e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]}if(null!=s){const{data:e}=o.getMutableAttribute("uv0");e[0]=s[0],e[1]=s[1]}if(null!=a){const{data:e}=o.getMutableAttribute("auxpos2");e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3]}},e.createPointArrayGeometry=function(e,t){const i=new Float32Array(3*e.length),n=new Float32Array(t?3*e.length:3),r=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let a=0;a<e.length;a++)i[3*a]=e[a][0],i[3*a+1]=e[a][1],i[3*a+2]=e[a][2],t&&(n[3*a]=t[a][0],n[3*a+1]=t[a][1],n[3*a+2]=t[a][2]),r[a]=a,s[a]=0;return t||(n[0]=0,n[1]=1,n[2]=0),new h.Z([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:n,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",r],["normal",t?r:s],["uv0",s]],1)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]);return new h.Z([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",i]])};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(e,t,i,n,r){return!(Math.abs((0,s.d)(t,e))>r||((0,s.c)(i,e,t),(0,s.n)(i,i),(0,s.c)(n,i,e),(0,s.n)(n,n),0))}function n(e,t,n,r,s,a,o){return i(e,t,s,a,o)||i(e,n,s,a,o)||i(e,r,s,a,o)}e.createSquareGeometry=function(e=t){const i=new Array(12);for(let t=0;t<4;t++)for(let n=0;n<3;n++)i[3*t+n]=e[t][n];const n=new Uint32Array([0,1,2,2,3,0]),r=new Uint32Array([0,0,0,0,0,0]);return new h.Z([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",n],["normal",r],["uv0",n],["color",r]])},e.createConeGeometry=function(e,t,i,n,r=!0,s=!0){let a=0;const l=t,c=e;let d=(0,o.f)(0,a,0),u=(0,o.f)(0,a+c,0),f=(0,o.f)(0,-1,0),p=(0,o.f)(0,1,0);n&&(a=c,u=(0,o.f)(0,0,0),d=(0,o.f)(0,a,0),f=(0,o.f)(0,1,0),p=(0,o.f)(0,-1,0));const g=[u,d],_=[f,p],m=i+2,v=Math.sqrt(c*c+l*l);if(n)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),n=(0,o.f)(Math.cos(t)*l,a,Math.sin(t)*l);g.push(n);const r=(0,o.f)(c*Math.cos(t)/v,-l/v,c*Math.sin(t)/v);_.push(r)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),n=(0,o.f)(Math.cos(t)*l,a,Math.sin(t)*l);g.push(n);const r=(0,o.f)(c*Math.cos(t)/v,l/v,c*Math.sin(t)/v);_.push(r)}const b=new Uint32Array(2*(i+2)*3),y=new Uint32Array(2*(i+2)*3);let w=0,x=0;if(r){for(let e=3;e<g.length;e++)b[w++]=1,b[w++]=e-1,b[w++]=e,y[x++]=0,y[x++]=0,y[x++]=0;b[w++]=g.length-1,b[w++]=2,b[w++]=1,y[x++]=0,y[x++]=0,y[x++]=0}if(s){for(let e=3;e<g.length;e++)b[w++]=e,b[w++]=e-1,b[w++]=0,y[x++]=e,y[x++]=e-1,y[x++]=1;b[w++]=0,b[w++]=2,b[w++]=g.length-1,y[x++]=1,y[x++]=2,y[x++]=_.length-1}const P=new Float32Array(3*m);for(let e=0;e<m;e++)P[3*e]=g[e][0],P[3*e+1]=g[e][1],P[3*e+2]=g[e][2];const D=new Float32Array(3*m);for(let e=0;e<m;e++)D[3*e]=_[e][0],D[3*e+1]=_[e][1],D[3*e+2]=_[e][2];return new h.Z([["position",{size:3,data:P,exclusive:!0}],["normal",{size:3,data:D,exclusive:!0}]],[["position",b],["normal",y]])},e.createCylinderGeometry=function(e,t,i,n,r,a){const l=n?(0,o.a)(n):(0,o.f)(1,0,0),c=r?(0,o.a)(r):(0,o.f)(0,0,0);a=null==a||a;const d=(0,o.c)();(0,s.n)(d,l);const u=(0,o.c)();(0,s.a)(u,d,Math.abs(e));const f=(0,o.c)();(0,s.a)(f,u,-.5),(0,s.b)(f,f,c);const p=(0,o.f)(0,1,0);Math.abs(1-(0,s.d)(d,p))<.2&&(0,s.s)(p,0,0,1);const g=(0,o.c)();(0,s.c)(g,d,p),(0,s.n)(g,g),(0,s.c)(p,g,d);const _=2*i+(a?2:0),m=i+(a?2:0),v=new Float32Array(3*_),b=new Float32Array(3*m),y=new Float32Array(2*_),w=new Uint32Array(3*i*(a?4:2)),x=new Uint32Array(3*i*(a?4:2));a&&(v[3*(_-2)+0]=f[0],v[3*(_-2)+1]=f[1],v[3*(_-2)+2]=f[2],y[2*(_-2)]=0,y[2*(_-2)+1]=0,v[3*(_-1)+0]=v[3*(_-2)+0]+u[0],v[3*(_-1)+1]=v[3*(_-2)+1]+u[1],v[3*(_-1)+2]=v[3*(_-2)+2]+u[2],y[2*(_-1)]=1,y[2*(_-1)+1]=1,b[3*(m-2)+0]=-d[0],b[3*(m-2)+1]=-d[1],b[3*(m-2)+2]=-d[2],b[3*(m-1)+0]=d[0],b[3*(m-1)+1]=d[1],b[3*(m-1)+2]=d[2]);const P=function(e,t,i){w[e]=t,x[e]=i};let D=0;const S=(0,o.c)(),E=(0,o.c)();for(let e=0;e<i;e++){const n=e*(2*Math.PI/i);(0,s.a)(S,p,Math.sin(n)),(0,s.a)(E,g,Math.cos(n)),(0,s.b)(S,S,E),b[3*e+0]=S[0],b[3*e+1]=S[1],b[3*e+2]=S[2],(0,s.a)(S,S,t),(0,s.b)(S,S,f),v[3*e+0]=S[0],v[3*e+1]=S[1],v[3*e+2]=S[2],y[2*e+0]=e/i,y[2*e+1]=0,v[3*(e+i)+0]=v[3*e+0]+u[0],v[3*(e+i)+1]=v[3*e+1]+u[1],v[3*(e+i)+2]=v[3*e+2]+u[2],y[2*(e+i)+0]=e/i,y[2*e+1]=1;const r=(e+1)%i;P(D++,e,e),P(D++,e+i,e),P(D++,r,r),P(D++,r,r),P(D++,e+i,e),P(D++,r+i,r)}if(a){for(let e=0;e<i;e++){const t=(e+1)%i;P(D++,_-2,m-2),P(D++,e,m-2),P(D++,t,m-2)}for(let e=0;e<i;e++){const t=(e+1)%i;P(D++,e+i,m-1),P(D++,_-1,m-1),P(D++,t+i,m-1)}}return new h.Z([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:b,exclusive:!0}],["uv0",{size:2,data:y,exclusive:!0}]],[["position",w],["normal",x],["uv0",w]])},e.createTubeGeometry=function(t,i,n,r,s){n=n||10,r=null==r||r,(0,l.hu)(t.length>1);const a=[],o=[];for(let e=0;e<n;e++){a.push([0,-e-1,-(e+1)%n-1]);const t=e/n*2*Math.PI;o.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(o,t,[[0,0,0]],a,r,s)},e.createPathExtrusionGeometry=function(e,t,i,l,c,d=(0,o.f)(0,0,0)){const u=e.length,f=new Float32Array(t.length*u*3+(6*i.length||0)),p=new Float32Array(t.length*u*3+(i?6:0)),g=(t.length-1)*u*6+3*l.length*2,m=new Uint32Array(g),v=new Uint32Array(g);let b=0,y=0,w=0,x=0;const P=(0,o.c)(),D=(0,o.c)(),S=(0,o.c)(),E=(0,o.c)(),C=(0,o.c)(),M=(0,o.c)(),A=(0,o.c)(),L=(0,r.c)(),R=(0,o.c)(),V=(0,o.c)(),j=(0,o.c)(),T=(0,o.c)(),O=(0,o.c)(),z=a.yC.create();(0,s.s)(R,0,1,0),(0,s.f)(D,t[1],t[0]),(0,s.n)(D,D),c?((0,s.b)(L,t[0],d),(0,s.n)(S,L)):(0,s.s)(S,0,0,1),n(D,S,R,R,C,S,_),(0,s.g)(E,S),(0,s.g)(T,C);for(let e=0;e<i.length;e++)(0,s.a)(M,C,i[e][0]),(0,s.a)(L,S,i[e][2]),(0,s.b)(M,M,L),(0,s.b)(M,M,t[0]),f[b++]=M[0],f[b++]=M[1],f[b++]=M[2];p[y++]=-D[0],p[y++]=-D[1],p[y++]=-D[2];for(let e=0;e<l.length;e++)m[w++]=l[e][0]>0?l[e][0]:-l[e][0]-1+i.length,m[w++]=l[e][1]>0?l[e][1]:-l[e][1]-1+i.length,m[w++]=l[e][2]>0?l[e][2]:-l[e][2]-1+i.length,v[x++]=0,v[x++]=0,v[x++]=0;let F=i.length;const U=i.length-1;for(let i=0;i<t.length;i++){let r=!1;i>0&&((0,s.g)(P,D),i<t.length-1?((0,s.f)(D,t[i+1],t[i]),(0,s.n)(D,D)):r=!0,(0,s.b)(V,P,D),(0,s.n)(V,V),(0,s.b)(j,t[i-1],E),a.yC.fromPositionAndNormal(t[i],V,z),a.yC.intersectRay(z,a.kx.wrap(j,P),L)?((0,s.f)(L,L,t[i]),(0,s.n)(S,L),(0,s.c)(C,V,S),(0,s.n)(C,C)):n(V,E,T,R,C,S,_),(0,s.g)(E,S),(0,s.g)(T,C)),c&&((0,s.b)(L,t[i],d),(0,s.n)(O,L));for(let n=0;n<u;n++)if((0,s.a)(M,C,e[n][0]),(0,s.a)(L,S,e[n][1]),(0,s.b)(M,M,L),(0,s.n)(A,M),p[y++]=A[0],p[y++]=A[1],p[y++]=A[2],(0,s.b)(M,M,t[i]),f[b++]=M[0],f[b++]=M[1],f[b++]=M[2],!r){const e=(n+1)%u;m[w++]=F+n,m[w++]=F+u+n,m[w++]=F+e,m[w++]=F+e,m[w++]=F+u+n,m[w++]=F+u+e;for(let e=0;e<6;e++)v[x++]=m[w-6+e]-U}F+=u}const q=t[t.length-1];for(let e=0;e<i.length;e++)(0,s.a)(M,C,i[e][0]),(0,s.a)(L,S,i[e][1]),(0,s.b)(M,M,L),(0,s.b)(M,M,q),f[b++]=M[0],f[b++]=M[1],f[b++]=M[2];const I=y/3;p[y++]=D[0],p[y++]=D[1],p[y++]=D[2];const W=F-u;for(let e=0;e<l.length;e++)m[w++]=l[e][0]>=0?F+l[e][0]:-l[e][0]-1+W,m[w++]=l[e][2]>=0?F+l[e][2]:-l[e][2]-1+W,m[w++]=l[e][1]>=0?F+l[e][1]:-l[e][1]-1+W,v[x++]=I,v[x++]=I,v[x++]=I;return new h.Z([["position",{size:3,data:f,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]],[["position",m],["normal",v]])},e.createPolylineGeometry=function(e,t,i){(0,l.hu)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,l.hu)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),(0,l.hu)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),(0,l.hu)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const n=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1));let s=0,a=0;for(let t=0;t<e.length;t++){for(let i=0;i<3;i++)n[s++]=e[t][i];t>0&&(r[a++]=t-1,r[a++]=t)}const o=[],d=[];if(o.push(["position",r]),d.push(["position",{size:3,data:n,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let n=0;for(let r=0;r<e.length;r++)for(let e=0;e<3;e++)i[n++]=t[r][e];o.push(["normal",r]),d.push(["normal",{size:3,data:i,exclusive:!0}])}return i&&(d.push(["color",{size:4,data:i}]),o.push(["color",(0,c.p)(i.length/4)])),new h.Z(d,o,2)},e.createExtrudedTriangle=function(e,t,i,n){const r=new Array(18),s=[[-t,0,n/2],[i,0,n/2],[0,e,n/2],[-t,0,-n/2],[i,0,-n/2],[0,e,-n/2]],a=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let e=0;e<6;e++)r[3*e]=s[e][0],r[3*e+1]=s[e][1],r[3*e+2]=s[e][2];return new h.Z([["position",{size:3,data:r,exclusive:!0}]],[["position",a]])},e.transformInPlace=function(e,t){const i=e.getMutableAttribute("position").data;for(let e=0;e<i.length;e+=3){const n=i[e],r=i[e+1],a=i[e+2];(0,s.s)(m,n,r,a),(0,s.k)(m,m,t),i[e]=m[0],i[e+1]=m[1],i[e+2]=m[2]}},e.cgToGIS=function(e,t=e){const i=e.vertexAttributes,n=i.get("position").data,r=i.get("normal").data;if(r){const e=t.getMutableAttribute("normal").data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}if(n){const e=t.getMutableAttribute("position").data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}return t},e.makeOrthoBasisDirUp=i,e.makeOrthoBasisDirUpFallback=n}(g||(g={}));const _=.99619469809,m=(0,o.c)();const v=g},67134:(e,t,i)=>{"use strict";i.d(t,{r:()=>d});i(95830);var n=i(59472),r=i(77625),s=i(17387),a=i(12811),o=i(88),l=i(49366),c=i(81495);const h=1e-5;class d{constructor(e){this.options=new c.om,this.results=new c.LV,this.transform=new c.yn,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=h,this.verticalOffset=null,this._ray={origin:(0,r.c)(),direction:(0,r.c)()},this._rayEndPoint=(0,r.c)(),this._rayStartPointTransformed=(0,r.c)(),this._rayEndPointTransformed=(0,r.c)(),this.viewingMode=null==e?1:e}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(e,t){this.resetWithRay(o.kx.fromPoints(e,t,this._ray))}resetWithRay(e){e!==this._ray&&o.kx.copy(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.b)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(e,t,i,r,s,a){this.point=t,this.camera=i,this.filterPredicate=s,this.tolerance=null==r?h:r;const o=(0,c.W9)(this.verticalOffset),l=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};if(e&&e.length>0)for(const t of e){const e=t.getSpatialQueryAccelerator&&t.getSpatialQueryAccelerator();(0,n.pC)(e)?((0,n.pC)(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(l)):t.getObjects().forAll((e=>l(e)))}this.sortResults()}intersectObject(e){this._numObjectsTested++;const t=e.geometryRecords;if(!t)return;const i=e.id,r=e.transformation;let o;const h=(0,c.W9)(this.verticalOffset);for(const d of t){const{geometry:t,material:u,instanceParameters:f}=d;if((0,l.PD)(f))continue;o=t.id,this.transform.setAndInvalidateLazyTransforms(r,d.getShaderTransformation()),(0,s.k)(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),(0,s.k)(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const p=this.transform.transform;(0,n.pC)(h)&&(h.objectTransform=this.transform),u.intersect(t,f,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,((t,r,s,l,h,d)=>{if(t>=0){if((0,n.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,t))return;const u=`Object3D ${i}`;if(h)return void((null==this.results.hud.dist||t<this.results.hud.dist)&&this.results.hud.set(e,u,t,r,a.I,l,d,o,s));const f=i=>i.set(e,u,t,r,p,l,null,o,s);if((null==this.results.min.drapedLayerOrder||l>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||t<this.results.min.dist)&&f(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||l<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||t>this.results.max.dist)&&f(this.results.max),2===this.options.store){const e=new c.xM(this._ray);f(e),this.results.all.push(e)}}}),d.shaderTransformation)}}sortResults(){this.results.all.sort(((e,t)=>e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}d.DEFAULT_TOLERANCE=h},81667:(e,t,i)=>{"use strict";i.d(t,{F:()=>I});var n=i(59472),r=i(62698),s=i(35470),a=i(77625),o=i(59691),l=i(49326);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var h=i(38035),d=i(17387),u=i(88),f=i(56469);class p{constructor(){this.bounds=u.Dv.create(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=(0,n.pC)(e)?e:p.createEmptyNode(),(0,n.pC)(t)&&u.Dv.copy(t,this.bounds),this.halfSize=i,this.depth=r,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=P[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);t&&t(this,n),this.advance(n)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new r.Z({shrink:!0}),residents:new r.Z({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function g(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function _(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function m(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function v(e,t){return!u.oy.intersectsSphere(t,e)}function b(e,t,i,n){if(1===t){const t=i(e[0]);u.Dv.copy(t,n)}else{A[0]=1/0,A[1]=1/0,A[2]=1/0,L[0]=-1/0,L[1]=-1/0,L[2]=-1/0;for(let n=0;n<t;n++){const t=i(e[n]);x(t[3])&&(g(A,t),_(L,t))}(0,d.e)(n,A,L,.5),n[3]=Math.max(L[0]-A[0],L[1]-A[1],L[2]-A[2])/2}}function y(e,t){let i=1/0,n=null;for(let r=0;r<8;++r){const s=w(e,t,D[r]);s<i&&(i=s,n=D[r])}return n}function w(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function x(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new h.Z(p);const P=[(0,a.f)(-1,-1,-1),(0,a.f)(1,-1,-1),(0,a.f)(-1,1,-1),(0,a.f)(1,1,-1),(0,a.f)(-1,-1,1),(0,a.f)(1,-1,1),(0,a.f)(-1,1,1),(0,a.f)(1,1,1)],D=[(0,a.f)(-1,-1,-1),(0,a.f)(-1,-1,1),(0,a.f)(-1,1,-1),(0,a.f)(-1,1,1),(0,a.f)(1,-1,-1),(0,a.f)(1,-1,1),(0,a.f)(1,1,-1),(0,a.f)(1,1,1)],S=Math.sqrt(3),E=[null];const C=u.Dv.create(),M=(0,a.c)(),A=(0,a.c)(),L=(0,a.c)(),R=new r.Z,V=u.Dv.create(),j=u.Dv.create(),T=u.Dv.create(),O=u.Dv.create(),z=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new r.Z,U=[0,0,0,0,0,0,0,0],q=class{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),E[0]=null,R.prune(),F.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=p.acquire();for(let n=0;n<t;n++){const t=e[n];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}p.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=p.acquire();for(const r of e){const e=(0,n.pC)(t)?t:u.Dv.copy(this._objectToBoundingSphere(r),V);x(e[3])?(i.init(this._root),this._remove(r,e,i)):this._degenerateObjects.delete(r)}p.release(i),this._shrink()}update(e,t){if(!x(t[3])&&this._isDegenerate(e))return;const i=function(e){return E[0]=e,E}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const n=u.kx.wrap(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(n,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(n,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(n,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,n){const r=u.kx.wrap(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(r,e,n))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(r,e,n)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(r,e,n)&&i(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,n,r){return this._findClosest(e,"front-to-back"===t?1:-1,i,n,r)}forEachInDepthRange(e,t,i,n,r,s,a,o){this._forEachInDepthRange(e,t,"front-to-back"===i?1:-1,n,r,s,a,o)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}_intersectsNode(e,t){return m(t.bounds,2*-t.halfSize,A),m(t.bounds,2*t.halfSize,L),(0,f.yK)(e.origin,e.direction,A,L)}_intersectsNodeWithOffset(e,t,i){return m(t.bounds,2*-t.halfSize,A),m(t.bounds,2*t.halfSize,L),i.applyToMinMax(A,L),(0,f.yK)(e.origin,e.direction,A,L)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||u.Dv.intersectsRay(i,e)}_intersectsObjectWithOffset(e,t,i){const n=this._objectToBoundingSphere(t);return!(n[3]>0)||u.Dv.intersectsRay(i.applyToBoundingSphere(n),e)}_forEachNode(e,t){let i=p.acquire().init(e);const n=[i];for(;0!==n.length;){if(i=n.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&n.push(p.acquire().init(i).advance(e));p.release(i)}}_forEachNodeDepthOrdered(e,t,i,n=1){let r=p.acquire().init(e);const s=[r];for(function(e,t,i){if(!F.length)for(let e=0;e<8;++e)F.push({index:0,distance:0});for(let i=0;i<8;++i){const n=P[i];F.data[i].index=i,F.data[i].distance=w(e,t,n)}F.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)i[e]=F.data[e].index}(i,n,U);0!==s.length;){if(r=s.pop(),t(r)&&!r.isLeaf())for(let e=7;e>=0;--e){const t=U[e];t>=r.node.children.length||r.node.children[t]&&s.push(p.acquire().init(r).advance(t))}p.release(r)}}_findClosest(e,t,i,n,r){let s=1/0,a=1/0,o=null;const l=y(e,t);let c=0;const h=r=>{if(++c,n&&!n(r))return;const l=this._objectToBoundingSphere(r);if(i&&v(l,i))return;const h=w(e,t,u.Dv.getCenter(l)),d=h-l[3],f=h+l[3];d<s&&(s=d,a=f,o=r)};return this._forEachNodeDepthOrdered(this._root,(n=>{if(null!=r&&c>=r)return!1;if(i&&v(n.bounds,i))return!1;if((0,d.a)(M,l,n.halfSize),(0,d.b)(M,M,n.bounds),w(e,t,M)>a)return!1;const s=n.node;return s.terminals.forAll((e=>{h(e)})),null!==s.residents&&s.residents.forAll((e=>{h(e)})),!0}),e,t),o}_forEachInDepthRange(e,t,i,n,r,s,a,o){let l=-1/0,c=1/0;const h={setRange:e=>{1===i?(l=Math.max(l,e.near),c=Math.min(c,e.far)):(l=Math.max(l,-e.far),c=Math.min(c,-e.near))}};h.setRange(n);const f=w(t,i,e),p=y(t,i),g=y(t,-1*i);let _=0;const m=e=>{if(++_,a&&!a(e))return;const n=this._objectToBoundingSphere(e),o=u.Dv.getCenter(n),d=w(t,i,o)-f,p=d-n[3],g=d+n[3];p>c||g<l||s&&v(n,s)||r(e,h)};this._forEachNodeDepthOrdered(this._root,(e=>{if(null!=o&&_>=o)return!1;if(s&&v(e.bounds,s))return!1;if((0,d.a)(M,p,e.halfSize),(0,d.b)(M,M,e.bounds),w(t,i,M)-f>c)return!1;if((0,d.a)(M,g,e.halfSize),(0,d.b)(M,M,e.bounds),w(t,i,M)-f<l)return!1;const n=e.node;return n.terminals.forAll((e=>{m(e)})),null!==n.residents&&n.residents.forAll((e=>{m(e)})),!0}),t,i)}_remove(e,t,i){R.clear();const n=i.advanceTo(t,((e,t)=>{R.push(e.node),R.push(t)}))?i.node.terminals:i.node.residents;if(n.removeUnordered(e),0===n.length)for(let e=R.length-2;e>=0;e-=2){const t=R.data[e],i=R.data[e+1];if(!this._purge(t,i))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r.Z({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const n=p.acquire().init(e);this._add(t.getItemAt(i),n),p.release(n)}}_grow(e,t){if(0!==t&&(b(e,t,(e=>this._objectToBoundingSphere(e)),j),x(j[3])&&!this._fitsInsideTree(j)))if(this._nodeIsEmpty(this._root.node))u.Dv.copy(j,this._root.bounds),this._root.halfSize=1.25*j[3];else{const e=this._rootBoundsForRootAsSubNode(j);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(j,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){(0,d.g)(T,t.bounds),T[3]=t.halfSize,b([e,T],2,(e=>e),O);const i=p.acquire().init(this._root);this._root.initFrom(null,O,1.25*O[3]),this._forEachNode(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),p.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let n=-1/0;const r=this._root.bounds,s=this._root.halfSize;for(let e=0;e<3;e++){const a=r[e]-s-(i[e]-t),o=i[e]+t-(r[e]+s),l=Math.max(0,Math.ceil(a/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,h=2**Math.ceil(Math.log(l+c)*Math.LOG2E);n=Math.max(n,h),z[e].min=l,z[e].max=c}for(let e=0;e<3;e++){let t=z[e].min,i=z[e].max;const a=(n-(t+i))/2;t+=Math.ceil(a),i+=Math.floor(a);const o=r[e]-s-t*s*2;C[e]=o+(i+t)*s}return C[3]=n*s*S,p.acquire().initFrom(null,C,n*s,0)}_growRootAsSubNode(e){const t=this._root.node;(0,d.g)(j,this._root.bounds),j[3]=this._root.halfSize,this._root.init(e),e.advanceTo(j,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,n=0;for(;n<t.length&&null==e;)i=n++,e=t[i];for(;n<t.length;)if(t[n++])return-1;return i}_isDegenerate(e){return!x(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}};class I extends l.c{constructor(e,t=""){super(),this.apiLayerUid=t,this.type=0,this.events=new s.Z,this.isSliceable=!1,this._objects=new r.Z,this._stageHandles=new o.Z,this.apiLayerUid=t,e=e||{},this.group=e.group||"",this.isVisible=null==e.isVisible||e.isVisible,this.isPickable=null==e.isPickable||e.isPickable,this.translation=e.translation?(0,a.a)(e.translation):(0,a.c)()}destroy(){this.detachStage()}attachStage(e){this.detachStage();for(const t of c)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}getObjectIds(){return this._objects.map((e=>e.id))}getObjects(){return this._objects}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,n.pC)(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,n.pC)(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,n.pC)(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,n.pC)(this._octree)&&this._octree.remove(t)}}notifyObjectBBChanged(e,t){(0,n.pC)(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return(0,n.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,n.SC)(this._octree)}_createOctree(){this._octree=new q((e=>e.getBounds())),this._octree.add(this._objects.data,this._objects.length)}}},94589:(e,t,i)=>{"use strict";i.d(t,{E:()=>D});var n=i(26701),r=i(30090),s=i(10762),a=i(66704),o=i(6048),l=i(56140),c=i(23240),h=i(97853),d=i(44801),u=i(11379),f=i(51007),p=i(36904),g=i(89553),_=i(61514),m=i(72023),v=i(88214),b=i(38391),y=i(93352);class w extends h.A{initializeProgram(e){const t=w.shader.get(),i=this.configuration,n=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new f.Z(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),u.i)}bindPass(e,t,i){g.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("eColor",t.color),4===this.configuration.output&&m.bA.bindOutputHighlight(e,this.program,i),(1===this.configuration.output||i.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),i.multipassTerrainEnabled&&(this.program.setUniform2fv("viewportDim",[e.getViewport().width,e.getViewport().height]),(0,v.C)(this.program,e,i))}bindDraw(e){g.G.bindView(this.program,e),_.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,n=3===e,r=2===e;return(0,p.sm)({blending:0!==i.output&&7!==i.output||!i.transparent?null:n?a.wu:(0,a.$L)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(i.cullFace),depthTest:{func:(0,a.$x)(e)},depthWrite:n||r?i.writeDepth&&p.LZ:null,colorWrite:p.BK,stencilWrite:i.sceneHasOcludees?b.s3:null,stencilTest:i.sceneHasOcludees?t?b.eD:b.RY:null,polygonOffset:n||r?i.polygonOffset&&x:(0,a.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}w.shader=new c.J(y.C,(()=>i.e(3870).then(i.bind(i,13870))));const x={factor:1,units:1};class P extends d.m{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}(0,l._)([(0,d.o)({count:8})],P.prototype,"output",void 0),(0,l._)([(0,d.o)({count:3})],P.prototype,"cullFace",void 0),(0,l._)([(0,d.o)()],P.prototype,"slicePlaneEnabled",void 0),(0,l._)([(0,d.o)()],P.prototype,"sliceHighlightDisabled",void 0),(0,l._)([(0,d.o)()],P.prototype,"vertexColors",void 0),(0,l._)([(0,d.o)()],P.prototype,"transparent",void 0),(0,l._)([(0,d.o)()],P.prototype,"polygonOffset",void 0),(0,l._)([(0,d.o)()],P.prototype,"enableOffset",void 0),(0,l._)([(0,d.o)()],P.prototype,"writeDepth",void 0),(0,l._)([(0,d.o)()],P.prototype,"sceneHasOcludees",void 0),(0,l._)([(0,d.o)({count:4})],P.prototype,"transparencyPassType",void 0),(0,l._)([(0,d.o)()],P.prototype,"multipassTerrainEnabled",void 0),(0,l._)([(0,d.o)()],P.prototype,"cullAboveGround",void 0);class D extends s.F5{constructor(e){super(e,E),this.supportsEdges=!0,this.techniqueConfig=new P}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<a.ve,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,n,s,a,o){(0,r.Bw)(e,t,n,s,a,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new S(e):void 0}createBufferWriter(){return new o.G_(o.IM)}}class S extends n.Z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(w,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const E={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...s.zh}},71279:(e,t,i)=>{"use strict";i.d(t,{Q:()=>L});var n=i(77625),r=i(17387),s=i(69996),a=i(56469),o=i(12608),l=i(80905),c=i(26701),h=i(30090),d=i(10762),u=i(13405),f=i(56140),p=i(38256),g=i(23240),_=i(97853),m=i(44801),v=i(51007),b=i(36904),y=i(89553),w=i(61514),x=i(66704),P=i(88214),D=i(20147),S=i(12587);class E extends _.A{initializeProgram(e){const t=E.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new v.Z(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),M)}bindPass(e,t,i){const{screenSizeEnabled:n,shadingEnabled:r}=this.configuration,{color:s,shadingTint:a,shadingDirection:o}=t;y.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",s),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("viewportDim",[e.getViewport().width,e.getViewport().height]),(0,P.C)(this.program,e,i)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(A,a,s)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),n&&D.A.bindPassUniforms(this.program,t,i)}blendColor(e,t,i){const n=1-t[3],r=t[3]+i[3]*n;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*n)/r,e[1]=(t[1]*t[3]+i[1]*i[3]*n)/r,e[2]=(t[2]*t[3]+i[2]*i[3]*n)/r,e[3]=i[3],e)}bindDraw(e){y.G.bindView(this.program,e),y.G.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),w.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,n=2===e;return(0,b.sm)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?x.wu:(0,x.$L)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(t.cullFace),depthTest:{func:n?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&b.LZ:(0,x.Vc)(e),colorWrite:b.BK,polygonOffset:i||n?null:x.E0})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}E.shader=new g.J(S.S,(()=>i.e(5316).then(i.bind(i,35316))));class C extends m.m{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}(0,f._)([(0,m.o)({count:8})],C.prototype,"output",void 0),(0,f._)([(0,m.o)({count:3})],C.prototype,"cullFace",void 0),(0,f._)([(0,m.o)()],C.prototype,"slicePlaneEnabled",void 0),(0,f._)([(0,m.o)()],C.prototype,"sliceHighlightDisabled",void 0),(0,f._)([(0,m.o)()],C.prototype,"transparent",void 0),(0,f._)([(0,m.o)()],C.prototype,"writeDepth",void 0),(0,f._)([(0,m.o)()],C.prototype,"screenSizeEnabled",void 0),(0,f._)([(0,m.o)()],C.prototype,"shadingEnabled",void 0),(0,f._)([(0,m.o)({count:4})],C.prototype,"transparencyPassType",void 0),(0,f._)([(0,m.o)()],C.prototype,"multipassTerrainEnabled",void 0),(0,f._)([(0,m.o)()],C.prototype,"cullAboveGround",void 0);const M={position:0,normal:1,offset:2},A=(0,p.c)();class L extends d.F5{constructor(e){super(e,V),this.supportsEdges=!0,this.techniqueConfig=new C,this._vertexAttributeLocations=M}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,n,a,o,l){if(this.params.screenSizeEnabled){const i=e.vertexAttributes.get("offset"),c={applyToVertex:(e,t,s,a)=>{const o=(0,r.s)(T,i.data[3*a+0],i.data[3*a+1],i.data[3*a+2]),l=(0,r.s)(O,e,t,s);return(0,r.a)(o,o,this.params.screenSize*n.camera.computeRenderPixelSizeAt(o)),(0,r.b)(l,l,o),[l[0],l[1],l[2]]},applyToAabb:e=>{const t=(0,s.be)(e,T);return(0,s.bA)(e,this.params.screenSize*n.camera.computeRenderPixelSizeAt(t))}};(0,h.Bw)(e,t,n,a,o,c,l)}else(0,h.Bw)(e,t,n,a,o,void 0,l)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new R(e):void 0}createBufferWriter(){return new j(this.params.screenSizeEnabled)}}class R extends c.Z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(E,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;let t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const V={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:(0,r.n)((0,n.c)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...d.zh};class j{constructor(e){this.screenSizeEnabled=e;const t=(0,l.U$)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,n){if((0,u.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const r=t.vertexAttributes.get("offset"),s=t.indices.get("offset");(0,a.hu)(3===r.size);const l=i.getField("offset",o.ct);if(!l)throw new Error("unable to acquire view for offset");(0,u.ho)(s,r.data,e.invTranspTransformation,l,n)}}}}const T=(0,n.c)(),O=(0,n.c)()},6048:(e,t,i)=>{"use strict";i.d(t,{G_:()=>l,IM:()=>o,wp:()=>s,W1:()=>a});var n=i(80905),r=i(13405);const s=(0,n.U$)().vec3f("position"),a=(0,n.U$)().vec3f("position").vec2f("uv0"),o=(0,n.U$)().vec3f("position").vec4u8("color");class l{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,n){(0,r.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)}}}}]);
//# sourceMappingURL=5991.js.map