(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[1278],{41278:(e,a,t)=>{"use strict";t.r(a),t.d(a,{previewSymbol2D:()=>p});var l=t(32656),n=t(96071),s=t(26252),i=t(59126),o=t(87881);const c="picture-fill",u=120,m=document.createElement("canvas");function r(e,a){const t=m.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}function h(e){if(0===e.length)return 0;if(e.length>2){const a=(0,n.Wz)(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}function p(e,a){const t=null!=(null==a?void 0:a.size)?(0,n.F2)(a.size):null,m=null!=(null==a?void 0:a.maxSize)?(0,n.F2)(a.maxSize):null,p=null!=(null==a?void 0:a.opacity)?a.opacity:null,d=null!=(null==a?void 0:a.rotation)?a.rotation:null,f=(0,s.mx)(e),v={shape:null,fill:null,stroke:f,offset:[0,0]};null!=f&&f.width&&(f.width=Math.min(f.width,80));const y=(null==f?void 0:f.width)||0;let w=null!=t&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale)),M=0,b=0;switch(e.type){case"simple-marker":{const a=e.style,l=Math.min(null!=t?t:(0,n.F2)(e.size),m||u);switch(M=l,b=l,a){case"circle":v.shape={type:"circle",cx:0,cy:0,r:.5*l},w||(M+=y,b+=y);break;case"cross":v.shape={type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[M,.5*b]},{command:"M",values:[.5*M,0]},{command:"L",values:[.5*M,b]}]};break;case"diamond":v.shape={type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*M,0]},{command:"L",values:[M,.5*b]},{command:"L",values:[.5*M,b]},{command:"Z",values:[]}]},w||(M+=y,b+=y);break;case"square":v.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[M,0]},{command:"L",values:[M,b]},{command:"L",values:[0,b]},{command:"Z",values:[]}]},w||(M+=y,b+=y);break;case"triangle":v.shape={type:"path",path:[{command:"M",values:[.5*M,0]},{command:"L",values:[M,b]},{command:"L",values:[0,b]},{command:"Z",values:[]}]},w||(M+=y,b+=y);break;case"x":v.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[M,b]},{command:"M",values:[M,0]},{command:"L",values:[0,b]}]};break;case"path":v.shape={type:"path",path:e.path||""},w||(M+=y,b+=y),w=!0}break}case"simple-line":{const e=Math.min(null!=t?t:y,m||80),a=e>22?2*e:40;f.width=e,M=a,b=e,v.shape={type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[M,b]}]};break}case c:case"simple-fill":M=Math.min(null!=t?t:22,m||u)+y,b=M,w=!0,v.shape="object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?i.JZ.squareFill[0]:i.JZ.fill[0];break;case"picture-marker":{let a=(0,n.F2)(e.width),l=(0,n.F2)(e.height);const s=Math.max(a,l),i=a/l;a=i<=1?Math.ceil(s*i):s,l=i<=1?s:Math.ceil(s/i),M=Math.min(null!=t?t:a,m||u),b=Math.min(null!=t?t:l,m||u),v.shape={type:"image",x:-Math.round(M/2),y:-Math.round(b/2),width:M,height:b,src:e.url||""};break}case"text":{const a=e,l=a.text||"Aa",s=a.font,i=Math.min(null!=t?t:(0,n.F2)(s.size),m||u),o=r(l,{weight:s.weight,size:i,family:s.family}),c=/[\uE600-\uE6FF]/.test(l);M=c?i:o,b=i;let p=.25*h((s?i:0).toString());c&&(p+=5),v.shape={type:"text",text:l,x:0,y:p,align:"middle",decoration:s&&s.decoration,rotated:a.rotated,kerning:a.kerning},v.font=s&&{size:i,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}if(!v.shape)return Promise.reject(new l.Z("symbolPreview: renderPreviewHTML2D","symbol not supported."));const g=(0,s._M)(e),k=g,x=e.color;let L=null;return k&&"pattern"===k.type&&x&&e.type!==c?L=(0,s.Od)(k.src,x.toCss(!0)).then((e=>(k.src=e,v.fill=k,v))):(v.fill=g,L=Promise.resolve(v)),L.then((e=>{const t=[[e]];if("object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const a=.6*M;t.unshift([{...e,offset:[-a,0],fill:(0,i.dc)(g,-.3)}]),t.push([{...e,offset:[a,0],fill:(0,i.dc)(g,.3)}]),M+=2*a}return(0,o.w)(t,[M,b],{node:a&&a.node,scale:w,opacity:p,rotation:d})}))}}}]);
//# sourceMappingURL=1278.js.map