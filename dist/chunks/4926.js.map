{"version":3,"sources":["webpack://imaps/./node_modules/@arcgis/core/layers/graphics/sources/support/MemorySourceWorker.js"],"names":["E","x","xmin","ymin","xmax","ymax","spatialReference","T","hasAttachments","capabilities","useStandardizedQueries","supportsCoordinatesQuantization","supportsReturningQueryGeometry","advancedQueryCapabilities","supportsQueryAttachments","supportsStatistics","supportsPercentileStatistics","supportsReturningGeometryCentroid","supportsQueryWithDistance","supportsDistinct","supportsReturningQueryExtent","supportsReturningGeometryProperties","supportsHavingClause","supportsOrderBy","supportsPagination","supportsQueryWithResultType","supportsSqlExpression","supportsDisjointSpatialRel","q","e","z","hasZ","R","m","hasM","this","_queryEngine","_nextObjectId","destroy","_requiredFields","_fieldsIndex","_createDefaultAttributes","t","i","features","s","a","_inferLayerProperties","fields","l","o","g","I","b","F","geometryType","_","objectIdField","timeInfo","push","name","message","some","type","editable","nullable","unshift","alias","r","field","D","startTimeField","get","endTimeField","trackIdField","details","O","warnings","featureErrors","layerDefinition","drawingInfo","templates","extent","assignedObjectIds","featureStore","length","w","reduce","attributes","isNaN","isFinite","Math","max","_loadInitialFeatures","Promise","all","adds","updates","_applyEdits","executeQuery","signal","executeQueryForCount","executeQueryForIds","executeQueryForExtent","n","geometry","toLowerCase","d","u","uid","_assignObjectId","addMany","fullExtent","start","end","timeExtent","deletes","addResults","deleteResults","updateResults","uidToObjectId","_applyAddEdits","_applyUpdateEdits","removeManyById","featureEditResults","p","f","y","has","c","getFeature","add"],"mappings":"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","file":"chunks/4926.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import{WGS84 as t}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getJsonType as i,isPoint as s}from\"../../../../geometry/support/jsonUtils.js\";import{getFieldDefaultValue as r}from\"../../../support/fieldUtils.js\";import{kebabDict as n}from\"../../../support/fieldType.js\";import{convertFromFeatures as a,convertToFeature as l,convertFromFeature as o}from\"../../featureConversionUtils.js\";import d from\"../../../support/FieldsIndex.js\";import{createDefaultAttributesFunction as u,createDrawingInfo as p,createDefaultTemplate as f}from\"./clientSideDefaults.js\";import y from\"../../data/FeatureStore.js\";import{checkProjectionSupport as c,project as m}from\"../../data/projectionSupport.js\";import h from\"../../data/QueryEngine.js\";import{loadGeometryEngineForSimplify as g,createFeatureEditErrorResult as I,mixAttributes as b,createFeatureEditSuccessResult as F,simplify as _}from\"./sourceUtils.js\";const j=1,E=t,x={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:t},T={hasAttachments:!1,capabilities:\"query, editing, create, delete, update\",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};function q(e){return s(e)?null!=e.z:!!e.hasZ}function R(e){return s(e)?null!=e.m:!!e.hasM}class D{constructor(){this._queryEngine=null,this._nextObjectId=null}destroy(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null}async load(t){const i=[],{features:s}=t,a=this._inferLayerProperties(s,t.fields),l=t.fields||[],o=null!=t.hasM?t.hasM:a.hasM,m=null!=t.hasZ?t.hasZ:a.hasZ,g=!t.spatialReference&&!a.spatialReference,I=g?E:t.spatialReference||a.spatialReference,b=g?x:null,F=t.geometryType||a.geometryType,_=!F;let q=t.objectIdField||a.objectIdField,R=t.timeInfo;if(!_&&(g&&i.push({name:\"feature-layer:spatial-reference-not-found\",message:\"Spatial reference not provided or found in features. Defaults to WGS84\"}),!F))throw new e(\"feature-layer:missing-property\",\"geometryType not set and couldn't be inferred from the provided features\");if(!q)throw new e(\"feature-layer:missing-property\",\"objectIdField not set and couldn't be found in the provided fields\");if(a.objectIdField&&q!==a.objectIdField&&(i.push({name:\"feature-layer:duplicated-oid-field\",message:`Provided objectIdField \"${q}\" doesn't match the field name \"${a.objectIdField}\", found in the provided fields`}),q=a.objectIdField),q&&!a.objectIdField){let e=null;l.some((t=>t.name===q&&(e=t,!0)))?(e.type=\"esriFieldTypeOID\",e.editable=!1,e.nullable=!1):l.unshift({alias:q,name:q,type:\"esriFieldTypeOID\",editable:!1,nullable:!1})}for(const r of l){if(null==r.name&&(r.name=r.alias),null==r.alias&&(r.alias=r.name),!r.name)throw new e(\"feature-layer:invalid-field-name\",\"field name is missing\",{field:r});if(r.name===q&&(r.type=\"esriFieldTypeOID\"),-1===n.jsonValues.indexOf(r.type))throw new e(\"feature-layer:invalid-field-type\",`invalid type for field \"${r.name}\"`,{field:r})}const D={};this._requiredFields=[];for(const e of l)if(\"esriFieldTypeOID\"!==e.type&&\"esriFieldTypeGlobalID\"!==e.type){e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable;const t=r(e);e.nullable||void 0!==t?D[e.name]=t:this._requiredFields.push(e)}if(this._fieldsIndex=new d(l),this._createDefaultAttributes=u(D,q),R){if(R.startTimeField){const e=this._fieldsIndex.get(R.startTimeField);e?(R.startTimeField=e.name,e.type=\"esriFieldTypeDate\"):R.startTimeField=null}if(R.endTimeField){const e=this._fieldsIndex.get(R.endTimeField);e?(R.endTimeField=e.name,e.type=\"esriFieldTypeDate\"):R.endTimeField=null}if(R.trackIdField){const e=this._fieldsIndex.get(R.trackIdField);e?R.trackIdField=e.name:(R.trackIdField=null,i.push({name:\"feature-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:R}}))}R.startTimeField||R.endTimeField||(i.push({name:\"feature-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing or invalid\",details:{timeInfo:R}}),R=null)}const O={warnings:i,featureErrors:[],layerDefinition:{...T,drawingInfo:p(F),templates:f(D),extent:b,geometryType:F,objectIdField:q,fields:l,hasZ:!!m,hasM:!!o,timeInfo:R},assignedObjectIds:{}};if(this._queryEngine=new h({fields:l,geometryType:F,hasM:o,hasZ:m,objectIdField:q,spatialReference:I,featureStore:new y({geometryType:F,hasM:o,hasZ:m}),timeInfo:R}),!s||!s.length)return this._nextObjectId=j,O;const w=s.reduce(((e,t)=>{const i=t.attributes&&t.attributes[q];return null==i||isNaN(i)||!isFinite(i)?e:Math.max(e,i)}),0);return this._nextObjectId=j+w,await c(s,I),this._loadInitialFeatures(O,s)}async applyEdits(e){const{spatialReference:t,geometryType:i}=this._queryEngine;return await Promise.all([g(t,i),c(e.adds,t),c(e.updates,t)]),this._applyEdits(e)}async queryFeatures(e,t={}){return this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e,t={}){return this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e,t={}){return this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e,t={}){return this._queryEngine.executeQueryForExtent(e,t.signal)}_inferLayerProperties(e,t){let s,r,n=null,a=null,l=null;for(const o of e){const e=o.geometry;if(e&&(n||(n=i(e)),a||(a=e.spatialReference),null==s&&(s=q(e)),null==r&&(r=R(e)),n&&a&&null!=s&&null!=r))break}if(t&&t.length){let e=null;t.some((t=>{const i=\"esriFieldTypeOID\"===t.type,s=!t.type&&t.name&&\"objectid\"===t.name.toLowerCase();return e=t,i||s}))&&(l=e.name)}return{geometryType:n,spatialReference:a,objectIdField:l,hasM:r,hasZ:s}}_loadInitialFeatures(e,t){const{geometryType:s,hasM:r,hasZ:n,objectIdField:l,spatialReference:o,featureStore:d}=this._queryEngine,u=[];for(const a of t){if(null!=a.uid&&(e.assignedObjectIds[a.uid]=-1),a.geometry&&s!==i(a.geometry)){e.featureErrors.push(I(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),r=b(this._fieldsIndex,this._requiredFields,t,a.attributes,!0,e.warnings);r?e.featureErrors.push(r):(this._assignObjectId(t,a.attributes,!0),a.attributes=t,null!=a.uid&&(e.assignedObjectIds[a.uid]=a.attributes[l]),a.geometry&&(a.geometry=m(a.geometry,a.geometry.spatialReference,o)),u.push(a))}if(d.addMany(a([],u,s,n,r,l)),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){const{start:t,end:i}=this._queryEngine.timeExtent;e.layerDefinition.timeInfo.timeExtent=[t,i]}return e}_applyEdits(e){const{adds:t,updates:i,deletes:s}=e,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),i&&i.length&&this._applyUpdateEdits(r,i),s&&s.length){for(const e of s)r.deleteResults.push(F(e));this._queryEngine.featureStore.removeManyById(s)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:r}}_applyAddEdits(e,t){const{addResults:s}=e,{geometryType:r,hasM:n,hasZ:l,objectIdField:o,spatialReference:d,featureStore:u}=this._queryEngine,p=[];for(const a of t){if(a.geometry&&r!==i(a.geometry)){s.push(I(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),n=b(this._fieldsIndex,this._requiredFields,t,a.attributes);if(n)s.push(n);else{if(this._assignObjectId(t,a.attributes),a.attributes=t,null!=a.uid){const t=a.attributes[o];e.uidToObjectId[a.uid]=t}a.geometry&&(a.geometry=m(_(a.geometry,d),a.geometry.spatialReference,d)),p.push(a),s.push(F(a.attributes[o]))}}u.addMany(a([],p,r,l,n,o))}_applyUpdateEdits({updateResults:e},t){const{geometryType:s,hasM:r,hasZ:n,objectIdField:a,spatialReference:d,featureStore:u}=this._queryEngine;for(const p of t){const{attributes:t,geometry:f}=p,y=t&&t[a];if(null==y){e.push(I(`Identifier field ${a} missing`));continue}if(!u.has(y)){e.push(I(`Feature with object id ${y} missing`));continue}const c=l(u.getFeature(y),s,n,r);if(f){if(s!==i(f)){e.push(I(\"Incorrect geometry type.\"));continue}c.geometry=m(_(f,d),f.spatialReference,d)}if(t){const i=b(this._fieldsIndex,this._requiredFields,c.attributes,t);if(i){e.push(i);continue}}u.add(o(c,s,n,r,a)),e.push(F(y))}}_assignObjectId(e,t,i=!1){const s=this._queryEngine.objectIdField;i&&t&&isFinite(t[s])?e[s]=t[s]:e[s]=this._nextObjectId++}}export default D;\n"],"sourceRoot":""}