(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[5490],{40365:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var s=i(92823);const r=class{constructor(e,t){this._storage=new s.WJ,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},18152:(e,t,i)=>{"use strict";i.d(t,{qG:()=>g,PV:()=>y,iR:()=>d,rn:()=>c,Oh:()=>v,bT:()=>w,C_:()=>u,Lx:()=>m,YI:()=>p,HQ:()=>h});var s=i(65575),r=i(37704),n=i(65131),a=i(3277),o=i(87864),l=i(79710);const p={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;(0,s.vw)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer(e,t,i,s){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||(0,n.df)(this,"screenSizePerspectiveEnabled",{},s))&&(t[i]=e)}}}}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},d={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},h={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:r.w}}},c={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},y={value:null,type:l.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function m(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const v={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},w={...v,json:{...v.json,origins:{"web-document":{...v.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,a.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,a.b)(t.drawingInfo.transparency)}}},g={type:o.Z,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get(){var e,t;if(null==(e=this.layer)||!e.timeInfo)return null;const i=null==(t=this.view)?void 0:t.timeExtent,s=this.layer.timeExtent,r=this.layer.useViewTime?i&&s?i.intersection(s):i||s:s;if(!r||r.isEmpty)return r;const n=this.layer.timeOffset,a=n?r.offset(-n.value,n.unit):r,o=this._get("timeExtent");return a.equals(o)?o:a}}},50560:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var s,r=i(56140),n=(i(95830),i(36544),i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(58385));let l=s=class extends o.wq{constructor(){super(...arguments),this.title=null}clone(){return new s({title:this.title})}};(0,r._)([(0,n.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=s=(0,r._)([(0,a.j)("esri.renderers.support.LegendOptions")],l);const p=l},90260:(e,t,i)=>{"use strict";i.d(t,{Z:()=>E});var s,r=i(56140),n=(i(95830),i(36544)),a=i(79881),o=i(60263),l=i(56274),p=i(30590),u=i(87566),d=i(60538),h=i(32656),c=(i(10923),i(57002),i(86035),i(96071)),y=i(19571),m=i(24158),v=i(94268),w=i(95005),g=i(5328);const x=n.Z.getLogger("esri.renderers.visualVariables.SizeVariable"),f=new l.Xn({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),b=new l.Xn({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function _(e){if(null!=e)return"string"==typeof e||"number"==typeof e?(0,c.t_)(e):"size"===e.type?(0,w.iY)(e)?e:(delete(e={...e}).type,new V(e)):void 0}function S(e,t,i){if("object"!=typeof e)return e;const s=new V;return s.read(e,i),s}let V=s=class extends y.Z{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:g.viewScaleRE.test(this.valueExpression)}}set expression(e){x.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){(0,w.iY)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,w.iY)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,w.PS)(this)}set maxDataValue(e){e&&this.stops&&(x.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(x.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return _(e)}readMaxSize(e,t,i){return S(e,0,i)}set minDataValue(e){e&&this.stops&&(x.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(x.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return _(e)}readMinSize(e,t,i){return S(e,0,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(x.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,w.QW)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,s){if("$view.scale"===e){if(s&&s.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;s.messages.push(new h.Z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:s}))}}else t[i]=e}readValueUnit(e){return e?b.read(e):null}clone(){return new s({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,w.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,w.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if("clamped-linear"===this.transformationType){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){const e=this.stops,t=e.map((e=>e.size)).reverse(),i=e.length;for(let s=0;s<i;s++)e[s].size=t[s];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,r._)([(0,a.Cb)({readOnly:!0,dependsOn:["valueExpression","stops"]})],V.prototype,"cache",null),(0,r._)([(0,a.Cb)({type:f.apiValues,json:{type:f.jsonValues,origins:{"web-map":{read:!1}},read:f.read,write:f.write}})],V.prototype,"axis",void 0),(0,r._)([(0,a.Cb)({type:String,value:null,json:{read:!1}})],V.prototype,"expression",null),(0,r._)([(0,a.Cb)()],V.prototype,"index",null),(0,r._)([(0,a.Cb)({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],V.prototype,"inputValueType",null),(0,r._)([(0,a.Cb)({type:v.Z,json:{write:!0}})],V.prototype,"legendOptions",void 0),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],V.prototype,"maxDataValue",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],V.prototype,"maxSize",null),(0,r._)([(0,o.p)("maxSize")],V.prototype,"castMaxSize",null),(0,r._)([(0,p.r)("maxSize")],V.prototype,"readMaxSize",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],V.prototype,"minDataValue",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],V.prototype,"minSize",null),(0,r._)([(0,o.p)("minSize")],V.prototype,"castMinSize",null),(0,r._)([(0,p.r)("minSize")],V.prototype,"readMinSize",null),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],V.prototype,"normalizationField",void 0),(0,r._)([(0,a.Cb)({readOnly:!0,dependsOn:["valueExpression","minSize.arcadeRequired","maxSize.arcadeRequired"]})],V.prototype,"arcadeRequired",null),(0,r._)([(0,a.Cb)({type:String})],V.prototype,"scaleBy",void 0),(0,r._)([(0,a.Cb)({type:[m.Z],value:null,json:{write:!0}})],V.prototype,"stops",null),(0,r._)([(0,a.Cb)({type:["outline"],json:{write:!0}})],V.prototype,"target",void 0),(0,r._)([(0,a.Cb)({type:String,readOnly:!0,dependsOn:["minDataValue","maxDataValue","minSize","maxSize","valueUnit","inputValueType","stops"]})],V.prototype,"transformationType",null),(0,r._)([(0,a.Cb)({type:["size"],json:{type:["sizeInfo"]}})],V.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],V.prototype,"useSymbolValue",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],V.prototype,"valueExpression",void 0),(0,r._)([(0,p.r)("valueExpression",["valueExpression","expression"])],V.prototype,"readValueExpression",null),(0,r._)([(0,d.c)("web-scene","valueExpression")],V.prototype,"writeValueExpressionWebScene",null),(0,r._)([(0,a.Cb)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],V.prototype,"valueRepresentation",void 0),(0,r._)([(0,a.Cb)({type:b.apiValues,json:{write:b.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],V.prototype,"valueUnit",void 0),(0,r._)([(0,p.r)("valueUnit")],V.prototype,"readValueUnit",null),V=s=(0,r._)([(0,u.j)("esri.renderers.visualVariables.SizeVariable")],V);const E=V},19571:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var s=i(56140),r=(i(95830),i(36544)),n=i(68055),a=i(79881),o=i(60263),l=i(56274),p=i(87566),u=(i(10923),i(57002),i(86035),i(58385)),d=i(68266);const h=r.Z.getLogger("esri.renderers.visualVariables.VisualVariable"),c=new l.Xn({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let y=class extends u.wq{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(h.error(".field: field must be a string value"),null):(0,n.Zs)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,s._)([(0,a.Cb)()],y.prototype,"index",void 0),(0,s._)([(0,a.Cb)({type:c.apiValues,readOnly:!0,json:{read:c.read,write:c.write}})],y.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],y.prototype,"field",void 0),(0,s._)([(0,o.p)("field")],y.prototype,"castField",null),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],y.prototype,"valueExpression",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],y.prototype,"valueExpressionTitle",void 0),(0,s._)([(0,a.Cb)({readOnly:!0,dependsOn:["valueExpression"]})],y.prototype,"arcadeRequired",null),(0,s._)([(0,a.Cb)({type:d.Z,json:{write:!0}})],y.prototype,"legendOptions",void 0),y=(0,s._)([(0,p.j)("esri.renderers.visualVariables.VisualVariable")],y);const m=y},24158:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var s,r=i(56140),n=(i(95830),i(36544),i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(58385)),l=i(96071);let p=s=class extends o.wq{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new s({label:this.label,size:this.size,value:this.value})}};(0,r._)([(0,n.Cb)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,r._)([(0,n.Cb)({type:Number,cast:l.t_,json:{write:!0}})],p.prototype,"size",void 0),(0,r._)([(0,n.Cb)({type:Number,json:{write:!0}})],p.prototype,"value",void 0),p=s=(0,r._)([(0,a.j)("esri.renderers.visualVariables.support.SizeStop")],p);const u=p},94268:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var s,r=i(56140),n=(i(95830),i(36544),i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(68266));let l=s=class extends o.Z{constructor(){super(...arguments),this.customValues=null}clone(){return new s({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};(0,r._)([(0,n.Cb)({type:[Number],json:{write:!0}})],l.prototype,"customValues",void 0),l=s=(0,r._)([(0,a.j)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],l);const p=l},68266:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var s,r=i(56140),n=(i(95830),i(36544),i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(50560));let l=s=class extends o.Z{constructor(){super(...arguments),this.showLegend=null}clone(){return new s({title:this.title,showLegend:this.showLegend})}};(0,r._)([(0,n.Cb)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=s=(0,r._)([(0,a.j)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const p=l},79710:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var s,r=i(56140),n=(i(95830),i(59472)),a=(i(36544),i(68055),i(79881)),o=i(56274),l=i(30590),p=i(87566),u=i(60538),d=(i(10923),i(57002),i(86035),i(58385)),h=i(4665);let c=s=class extends d.wq{async collectRequiredFields(e,t){return(0,h.io)(e,t,this.expression)}clone(){return new s({expression:this.expression,title:this.title})}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],c.prototype,"expression",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],c.prototype,"title",void 0),c=s=(0,r._)([(0,p.j)("esri.layers.support.FeatureExpressionInfo")],c);const y=c;var m,v=i(98160);const w=(0,o.wY)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),g=new o.Xn({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let x=m=class extends d.wq{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,s){t[i]=e.write(null,s),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){return this._isOverridden("mode")?this._get("mode"):(0,n.pC)(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};(0,r._)([(0,a.Cb)({type:y,json:{write:!0}})],x.prototype,"featureExpressionInfo",void 0),(0,r._)([(0,l.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],x.prototype,"readFeatureExpressionInfo",null),(0,r._)([(0,u.c)("featureExpressionInfo",{featureExpressionInfo:{type:y},"featureExpression.value":{type:[0]}})],x.prototype,"writeFeatureExpressionInfo",null),(0,r._)([(0,a.Cb)({type:w.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:w.jsonValues,read:w.read,write:{writer:w.write,isRequired:!0}}})],x.prototype,"mode",null),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0}})],x.prototype,"offset",void 0),(0,r._)([(0,a.Cb)({type:v.f9,json:{type:String,read:g.read,write:g.write}})],x.prototype,"unit",null),x=m=(0,r._)([(0,p.j)("esri.layers.support.ElevationInfo")],x);const f=x},98160:(e,t,i)=>{"use strict";i.d(t,{Z7:()=>n,f9:()=>a,lt:()=>r});var s=i(2961);function r(e){return null!=s.a[e]}function n(e){return 1/(s.a[e]||1)}const a=function(){const e=Object.keys(s.a);return e.sort(),e}()},76685:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>P});var s=i(56140),r=(i(95830),i(36544)),n=(i(68055),i(79881)),a=i(87566),o=(i(10923),i(57002),i(86035),i(39105)),l=i(80621),p=i(12421),u=i(48164),d=i(59472),h=i(32656),c=i(61106),y=i(18152),m=i(31518),v=i(21707);const w=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return(0,o.reject)(new h.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:s}=i,r=(0,v.V)(i,t);if(!s||!(0,d.pC)(r))throw new h.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:s,popupTemplate:r});const n=await r.getRequiredFields(),a=new m.Z;a.geometry=e,a.outFields=n,a.outSpatialReference=e.spatialReference;const l=this.view.resolution,p="2d"===this.view.type?new c.Z(l,l,this.view.spatialReference):new c.Z(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:u,showNoDataRecords:y}=r.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:u,pixelSize:p,showNoDataRecords:y};return i.queryVisibleRasters(a,w).then((e=>e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}};return(0,s._)([(0,n.Cb)()],t.prototype,"layer",void 0),(0,s._)([(0,n.Cb)({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),(0,s._)([(0,n.Cb)(y.qG)],t.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)()],t.prototype,"view",void 0),t=(0,s._)([(0,a.j)("esri.views.layers.ImageryLayerView")],t),t};var g=i(81558),x=i(9870),f=i(52937),b=i(96071),_=i(15988),S=i(99322),V=i(17149),E=i(79334);const z=r.Z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let C=class extends((0,g.y)(u.Z)){constructor(){super(...arguments),this.container=new V.W,this._graphicsView=null,this.type="Graphics",this._graphics=new S.ZP,this._updateGraphics=(0,o.debounce)((async(e,t)=>{if(!e.stationary)return;const i=e.state,s=new f.Z({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:i.spatialReference}),r=e.state.size[0],n=e.state.size[1],a={};a.timeExtent=this.timeExtent,a.requestAsImageElement=!1,a.signal=t;const l=this._getVectorFieldExportParams({extent:s,width:r,height:n}),p=await this.layer.fetchImage(l.extent,l.width,l.height,a),u=this.layer.renderer;if("vector-field"===u.type){this._pixelData={extent:l.extent,pixelBlock:p.pixelData.pixelBlock};const t=await u.getGraphicsFromPixelData(p.pixelData,"vector-uv"===this.layer.rasterInfo.dataType);this._graphicsView.update(e),await(0,o.after)(0).then((()=>{this._graphics.set("items",t)}))}}))}get updating(){var e;return null==(e=this._graphicsView)?void 0:e.updating}update(e){this._updateGraphics(e).catch((e=>{(0,o.isAbortError)(e)||z.error(e)}))}hitTest(e,t){if(this.suspended)return(0,o.resolve)(null);const i=this.view.toMap((0,b.vW)(e,t));return(0,o.resolve)(new _.default({attributes:{},geometry:i,layer:this.layer}))}attach(){this._graphicsView=new E.Z({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate()})}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}_getVectorFieldExportParams(e){var t,i;let{extent:s,width:r,height:n}=e;const a=this.layer,o=null==(t=a.fullExtent)?void 0:t.xmin,l=null==(i=a.fullExtent)?void 0:i.ymax;let p;"vector-field"===a.renderer.type&&(p=a.renderer.symbolTileSize),p=Math.max(p||0,30),r=Math.ceil(r*(1/p)),n=Math.ceil(n*(1/p));const u=(s.xmax-s.xmin)/r,d=(s.ymax-s.ymin)/n;return s.xmin=o+Math.floor((s.xmin-o)/u)*u,s.xmax=o+Math.ceil((s.xmax-o)/u)*u,s.ymin=l+Math.floor((s.ymin-l)/d)*d,s.ymax=l+Math.ceil((s.ymax-l)/d)*d,{extent:s,width:r,height:n}}};(0,s._)([(0,n.Cb)()],C.prototype,"container",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)({dependsOn:["_graphicsView.updating"]})],C.prototype,"updating",null),(0,s._)([(0,n.Cb)()],C.prototype,"_graphicsView",void 0),(0,s._)([(0,x.J)({graphics:"Graphics"})],C.prototype,"type",void 0),C=(0,s._)([(0,a.j)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],C);const j=C;var I=i(44464),D=i(64796),O=i(28511),R=i(81186);const T=r.Z.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let q=class extends((0,g.y)(u.Z)){constructor(){super(...arguments),this.container=new V.W,this.type="Imagery",this._bitmapView=null}get updating(){var e;return null==(e=this.strategy)?void 0:e.updating}update(e){this.strategy.update(e).catch((e=>{(0,o.isAbortError)(e)||T.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){if(this.suspended)return(0,o.resolve)(null);const i=this.view.toMap((0,b.vW)(e,t));return(0,o.resolve)(new _.default({attributes:{},geometry:i,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new O.c,this.strategy=new R.Z({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const i=e.source;i.pixelBlock=t.pixelBlock,i.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.container.children;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),s=(0,I.Kh)(i,t);return s?{extent:s.extent,pixelBlock:s.pixelBlock}:null}return null}_fetchImage(e,t,i,s){return(s=s||{}).timeExtent=this.timeExtent,s.requestAsImageElement=!0,this.layer.fetchImage(e,t,i,s).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:s.signal}).then((t=>{const i=new D.Z(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return i.filter=e=>this.layer.applyFilter(e),i}))))}};(0,s._)([(0,n.Cb)()],q.prototype,"container",void 0),(0,s._)([(0,n.Cb)()],q.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],q.prototype,"strategy",void 0),(0,s._)([(0,n.Cb)()],q.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)({dependsOn:["strategy.updating"]})],q.prototype,"updating",null),(0,s._)([(0,x.J)({imagery:"Imagery"})],q.prototype,"type",void 0),q=(0,s._)([(0,a.j)("esri.views.2d.layers.imagery.ImageryView2D")],q);const Z=q;let F=class extends(w((0,p.y)((0,g.y)(u.Z)))){constructor(){super(...arguments),this._exportImageVersion=-1}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?(0,o.resolve)(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([(0,l.init)(this,"layer.exportImageServiceParameters.version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch("timeExtent",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on("redraw",(()=>this.subview.redraw())),(0,l.watch)(this.layer,"renderer",(()=>this._setSubView()))],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||this.subview.isUpdating()}_setSubView(){var e;let t="Imagery";var i,s;"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(t="Graphics"),this.subview&&this.subview.type===t||(null==(i=this.subview)||i.uninstall(this.container),null==(s=this.subview)||s.destroy(),this.subview="Imagery"===t?new Z({layer:this.layer,view:this.view}):new j({layer:this.layer,view:this.view}),this.subview.attach(),this.subview.install(this.container)),this.requestUpdate()}};(0,s._)([(0,n.Cb)({dependsOn:["updating"]})],F.prototype,"pixelData",null),(0,s._)([(0,n.Cb)({readOnly:!0,dependsOn:["subview.updating"]})],F.prototype,"updating",null),(0,s._)([(0,n.Cb)()],F.prototype,"subview",void 0),F=(0,s._)([(0,a.j)("esri.views.2d.layers.ImageryLayerView2D")],F);const P=F},21707:(e,t,i)=>{"use strict";i.d(t,{V:()=>a,e:()=>n});var s=i(59472),r=i(4665);async function n(e,t=e.popupTemplate){if(!(0,s.pC)(t))return[];const i=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:n}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:p}=e;if(i.includes("*"))return["*"];const u=n?await(0,r.CH)(e):[],d=(0,r.Q0)(e.fields,[...i,...u]);return o&&d.push(o),d&&a&&(0,r.cT)(e.fields,a)&&-1===d.indexOf(a)&&d.push(a),d&&l&&(0,r.cT)(e.fields,l)&&-1===d.indexOf(l)&&d.push(l),p&&p.forEach((t=>{const{keyField:i}=t;d&&i&&(0,r.cT)(e.fields,i)&&-1===d.indexOf(i)&&d.push(i)})),d}function a(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=5490.js.map