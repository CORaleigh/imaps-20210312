(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2573],{85987:(e,t,r)=>{"use strict";r.d(t,{QM:()=>i,hy:()=>a,uI:()=>o});var n=r(7584),s=r(33655);const o=(()=>{if(!("document"in n.Z))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,r=>{t.clearRect(0,0,1,e.height);const n=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of r.colorStops)n.addColorStop(Math.max(e,.001),`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`);return t.fillStyle=n,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function i(e,t,r,n){const{blurRadius:s,fieldOffset:o,field:i}=t,a=new Float64Array(r*n),c=l(s),d=Math.round(3*s);let u,h=Number.NEGATIVE_INFINITY;const f=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(i,o),p=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(p.has(t))continue;p.add(t);const s=e.readLegacyPointGeometry(),o=+f(e),i=s.x-d,l=s.y-d,y=Math.max(0,i),m=Math.max(0,l),w=Math.min(n,s.y+d),g=Math.min(r,s.x+d);for(let e=m;e<w;e++){const t=c[e-l];for(let n=y;n<g;n++){const s=c[n-i];u=a[e*r+n]+=t*s*o,u>h&&(h=u)}}}}return{matrix:a.buffer,max:h}}function a(e,t,r,n,o,i){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const a=e.getImageData(0,0,t,t);r&&n&&a.data.set(new Uint8ClampedArray(function(e,t,r,n,o){const i=new Uint32Array(e*e),a="buffer"in t?t:new Float64Array(t),l="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),c=l.length/(o-n);for(let e=0;e<a.length;e++){const t=a[e],r=Math.floor((t-n)*c);i[e]=l[(0,s.uZ)(r,0,l.length-1)]}return i.buffer}(t,r,n,o,i))),e.putImageData(a,0,0)}function l(e){const t=Math.round(3*e),r=2*e*e,n=new Float64Array(2*t+1);for(let s=0;s<=n.length;s++)n[s]=Math.exp(-((s-t)**2)/r)/Math.sqrt(2*Math.PI)*(e/2);return n}},31887:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r(56140),s=(r(95830),r(36544),r(68055),r(79881)),o=r(87566),i=(r(10923),r(57002),r(86035),r(77204));let a=class extends i.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,n._)([(0,s.Cb)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),(0,n._)([(0,s.Cb)({constructOnly:!0})],a.prototype,"remoteClient",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],a.prototype,"service",void 0),(0,n._)([(0,s.Cb)()],a.prototype,"spatialReference",null),(0,n._)([(0,s.Cb)({constructOnly:!0})],a.prototype,"tileInfo",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=(0,n._)([(0,o.j)("esri.views.2d.layers.features.processors.BaseProcessor")],a);const l=a},2573:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(56140),s=(r(95830),r(59472)),o=(r(36544),r(68055),r(79881),r(87566)),i=(r(10923),r(57002),r(86035),r(39105)),a=r(23229),l=r(71286),c=r(85987),d=r(80964),u=r(31887);class h{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends u.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&(0,a.Hg)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const n=this._tileKeyToFeatureSets.get(e.key.id);if((0,s.pC)(t.addOrUpdate)&&n.set(t.addOrUpdate.instance,t),t.end){const e=this.tileStore.tiles.map((e=>{const t=[],n=function(e){const t=new Map,r=256,n=l.I_;return t.set((0,d.M)(e,-1,-1).id,new h([-n,-n],[n-r,n-r,n,n])),t.set((0,d.M)(e,0,-1).id,new h([0,-n],[0,n-r,n,n])),t.set((0,d.M)(e,1,-1).id,new h([n,-n],[0,n-r,r,n])),t.set((0,d.M)(e,-1,0).id,new h([-n,0],[n-r,0,n,n])),t.set((0,d.M)(e,1,0).id,new h([n,0],[0,0,r,n])),t.set((0,d.M)(e,-1,1).id,new h([-n,n],[n-r,0,n,r])),t.set((0,d.M)(e,0,1).id,new h([0,n],[0,0,n,r])),t.set((0,d.M)(e,1,1).id,new h([n,n],[0,0,r,r])),t}(e.key);this._tileKeyToFeatureSets.forEach(((r,o)=>{if(o===e.key.id)r.forEach((e=>(0,s.Po)(e.addOrUpdate,(e=>t.push(e)))));else if(n.has(o)){const e=n.get(o),[i,a]=e.offset,[l,c,d,u]=e.extent;r.forEach((e=>(0,s.Po)(e.addOrUpdate,(e=>{const r=e.transform(i,a).extent(l,c,d,u);t.push(r)}))))}}));const o=(0,c.QM)(t,this._schema.mesh,512,512),i={tileKey:e.key.id,intensityInfo:o},a=[o.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",i,{...r,transferList:a})}));await(0,i.all)(e)}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};f=(0,n._)([(0,o.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const p=f},80964:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});r(75191);function n(e,t,r){const n=e.clone(),s=1<<n.level,o=n.col+t,i=n.row+r;return o<0&&o!==n.col?(n.col=o+s,n.world-=1):o>=s?(n.col=o-s,n.world+=1):n.col=o,n.row=i,n}}}]);
//# sourceMappingURL=2573.js.map