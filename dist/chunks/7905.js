(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[7905],{12528:(e,t,i)=>{"use strict";i.d(t,{H:()=>a,a:()=>M,b:()=>_,c:()=>b});var a,r=i(55735),s=i(38256),n=i(14286),o=i(85461),l=i(51219),c=i(63230),h=i(73192),u=i(61514),p=i(91930),d=i(2489),g=i(61017),m=i(79431),f=i(72023),v=i(8681),y=i(34658);function _(e){const t=new l.kG,i=e.signedDistanceFieldEnabled;if(t.include(h.H),t.include(d.R,e),t.include(u.p,e),6===e.output)return t.include(m.R,e),t;t.include(p.c),t.fragment.include(g.n),t.fragment.include(c.Y),t.include(v.k,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(o.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?o.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:o.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const a=o.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `,r=e.pixelSnappingEnabled?i?o.H`
  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:o.H`
  posProj += quadOffset;
  if (inputSize.x == size.x) {
    posProj = alignToPixelOrigin(posProj, viewport.zw);
  }`:o.H`posProj += quadOffset;`;t.vertex.code.add(o.H`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${a}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${o.H.float(y.bf)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${o.H.float(y.bf)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${r}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?o.H`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const s=e.debugDrawBorder?o.H`(isBorder > 0.0 ? 0.0 : ${o.H.float(y.F)})`:o.H.float(y.F),n=o.H`
    ${e.debugDrawBorder?o.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?o.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${s} ||
          fillPixelColor.a + outlinePixelColor.a < ${o.H.float(y.bf)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${s}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:o.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${s}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?o.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(o.H`
      void main() {
        ${n}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(o.H`
    void main() {
      ${n}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(f.bA),t.fragment.code.add(o.H`
    void main() {
      ${n}
      ${e.binaryHighlightOcclusionEnabled?o.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function b(e,t=x){return e.textureIsSignedDistanceField?function(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):(0,n.c)(t,e.anchorPos),t}!function(e){e.bindUniforms=function(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",s.Z),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",b(t))}}(a||(a={}));const x=(0,r.c)();var M=Object.freeze({__proto__:null,build:_,get HUDMaterial(){return a},calculateAnchorPosForRendering:b})},37450:(e,t,i)=>{"use strict";i.d(t,{I:()=>p,b:()=>u});var a=i(85461),r=i(62213),s=i(51219),n=i(63230),o=i(61514),l=i(4071),c=i(34658),h=i(88214);function u(e){const t=new s.kG;return t.include(r.w,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(a.H`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(o.p,e),e.multipassTerrainEnabled&&(t.fragment.include(l.S),t.include(h.l,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(a.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${a.H.float(c.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(n.Y),t.fragment.code.add(a.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${a.H.float(c.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}var p=Object.freeze({__proto__:null,build:u})},31343:(e,t,i)=>{"use strict";i.d(t,{N:()=>p,b:()=>u});var a=i(85461),r=i(62213),s=i(51219),n=i(61514),o=i(72023),l=i(34658),c=i(93077),h=i(11823);function u(e){const t=new s.kG;return t.include(r.w,{linearDepth:!1}),t.include(h.c,e),t.include(c.q,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(a.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = transformPosition(proj, view, vpos);
  `),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(a.H`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `)),t.vertex.code.add(a.H`
  }
  `),4===e.output&&t.include(o.bA),t.include(n.p,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(a.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${a.H.float(l.bf)}) {
      discard;
    }

    ${0===e.output?a.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?a.H`outputHighlight();`:""}
  }
  `),t}var p=Object.freeze({__proto__:null,build:u})},17126:(e,t,i)=>{"use strict";i.d(t,{S:()=>n,b:()=>s});var a=i(85461),r=i(51219);function s(){const e=new r.kG;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(a.H`
    void main(void) {
      vUV = uv0;
      gl_Position = proj * view * vec4(position, 1.0);
    }
  `),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(a.H`
    void main() {
      const float LINE_WIDTH = 1.0;

      vec2 uvScaled = vUV * gridWidth;
      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);

      // mask aliasing along edges
      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);

      float gridFade = max(grid.x, grid.y);

      float gridAlpha = gridColor.a * gridFade;

      // premultiply alpha in output
      gl_FragColor =
        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
        vec4(gridColor.rgb, 1.0) * gridAlpha;
    }
  `),e}var n=Object.freeze({__proto__:null,build:s})},43019:(e,t,i)=>{"use strict";function a(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}function n(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,{_j:()=>M,_Y:()=>_,Y3:()=>b,sJ:()=>x,xr:()=>y});const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function c(e,t){const i=[];let a,r;if(e[0].length!==t.length)throw"dimensions do not match";const s=e.length,n=e[0].length;let o=0;for(a=0;a<s;a++){for(o=0,r=0;r<n;r++)o+=e[a][r]*t[r];i.push(o)}return i}function h(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=c(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){const t=c(l,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function g(e){return p(h(e))}function m(e){return u(d(e))}function f(e){return function(e){const t=e.l,i=e.a,a=e.b,r=Math.sqrt(i*i+a*a);let s=Math.atan2(a,i);return s=s>0?s:s+2*Math.PI,{l:t,c:r,h:s}}(p(h(e)))}function v(e){return u(d(function(e){const t=e.l,i=e.c,a=e.h;return{l:t,a:i*Math.cos(a),b:i*Math.sin(a)}}(e)))}function y(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:s(e)?v(e):r(e)?m(e):n(e)?u(e):a(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,r=a*i,s=r*(1-Math.abs(t%2-1));let n;switch(Math.floor(t)){case 0:n={r,g:s,b:0};break;case 1:n={r:s,g:r,b:0};break;case 2:n={r:0,g:r,b:s};break;case 3:n={r:0,g:s,b:r};break;case 4:n={r:s,g:0,b:r};break;case 5:case 6:n={r,g:0,b:s};break;default:n={r:0,g:0,b:0}}return n.r=Math.round(n.r+a-r),n.g=Math.round(n.g+a-r),n.b=Math.round(n.b+a-r),n}(e):e}function _(e){return a(e)?e:function(e){const t=e.r,i=e.g,a=e.b,r=Math.max(t,i,a),s=r-Math.min(t,i,a);let n=r,o=0===s?0:r===t?(i-a)/s%6:r===i?(a-t)/s+2:(t-i)/s+4,l=0===s?0:s/n;return o<0&&(o+=6),o*=60,l*=100,n*=100/255,{h:o,s:l,v:n}}(y(e))}function b(e){return r(e)?e:g(y(e))}function x(e){return s(e)?e:f(y(e))}function M(e,t){const i=g(e);return i.l*=1-t,m(i)}},83873:(e,t,i)=>{"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const r=e[a].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2}));let a=0;const s=i.length;if(0===s)return e;for(let e=0;e<s;e++)a+=i[e];const n=Math.floor(a/s);return Math.max(n,e)}function n(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const r="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return a(r,t.symbol);if("unique-value"===t.type){let e=r;return t.uniqueValueInfos.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return t.type,r}i.d(t,{k:()=>n})},41419:(e,t,i)=>{"use strict";i.d(t,{t:()=>r});var a=i(36654);async function r(e,t){const{data:i}=await(0,a.default)(e,{responseType:"image",...t});return i}},27905:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DrawGraphicTool:()=>xi,DrawOperation:()=>a.w,ExtentTransformTool:()=>Jr,GraphicMoveTool:()=>wa,GraphicReshapeTool:()=>Ua,GraphicTransformTool:()=>ja});var a=i(88958),r=i(56140),s=i(95830),n=i(59472),o=i(36544),l=i(68055),c=i(79881),h=i(87566),u=(i(10923),i(57002),i(86035),i(35470)),p=i(15988),d=i(94394),g=i(46970),m=i(9434),f=i(84678),v=i(76916),y=i(14425),_=i(5632),b=i(78745),x=i(17387),M=i(74239),w=i(7344),S=i(29895),C=i(2826),P=i(31046),A=i(54352),O=i(16332);var E=i(77625),D=i(59691),T=i(34353),R=i(46304),z=i(88),G=i(39746),I=i(56769),H=i(70189),V=i(51635),U=i(71702);class F extends U._{constructor(e){super(e),this._ray=z.kx.create(),this._externalResources=null,this._handles=new D.Z,this._isWorldDown=!1,this._start=(0,E.c)(),this._end=(0,E.f)(1,0,0),this._width=1,this._color=(0,H.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,H.f)(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=Z,this.applyProps(e)}createExternalResources(){const e=new I.U(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()})));const t=new V.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,n.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,n.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,E.c)(),(0,E.c)()],i=3===this.extensionType;i&&t.push((0,E.c)(),(0,E.c)());const a=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=G.Z.createPolylineGeometry(t,null,a);e.addGeometry(r,(0,n.Wg)(this._externalResources).material),this.updateVertices(r)}updateVisibility(e){super.updateVisibility(e),(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,x.g)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,x.f)(this._end,e,this._end),z.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,x.o)(this._start,e)||((0,x.g)(this._start,e),z.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,x.o)(this._end,e)||((0,x.g)(this._end,e),z.kx.fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){(0,T.g)(e,this._color)||((0,T.c)(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,T.g)(e,this._innerColor)||((0,T.c)(this._innerColor,e),this.updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,n.pC)(e)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,n.Wi)(e)||(0,n.Wi)(this._stippleOffColor)||!(0,T.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,n.pC)(e)?(0,H.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,n.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,n.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,n.Pt)(e,Z),this.recreateGeometry()}updateMaterial(){(0,n.Wi)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){(0,n.pC)(this.object)&&this.updateVertices(this.object.geometries[0])}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(B):this.updateLineSegmentInfinite(this._extensionType,B);this.updateVertexAttributes(e,t),(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return z.KD.fromPoints(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,R.f)(this._ray,W),e){case 0:W.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=(0,n.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,x.m)(W.ray.direction,W.ray.direction),2===this._extensionType&&null!=t&&(W.c1=Math.abs(i-t));break}}if(!z.oy.intersectClipRay(i.frustum,W))return z.KD.fromPoints(this._start,this._end,t);const a=(0,R.g)(W,L),r=(0,R.d)(W,k);return z.KD.fromPoints(a,r,t)}updateVertexAttributes(e,t){const i=e.getMutableAttribute("position").data;if(3===this.extensionType){const e=z.KD.pointAt(t,-this.fadedExtensions.start,L);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=z.KD.pointAt(t,0,L);i[3]=a[0],i[4]=a[1],i[5]=a[2];const r=z.KD.pointAt(t,1,L);i[6]=r[0],i[7]=r[1],i[8]=r[2];const s=z.KD.pointAt(t,1+this.fadedExtensions.end,L);i[9]=s[0],i[10]=s[1],i[11]=s[2]}else{const e=z.KD.pointAt(t,0,L);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=z.KD.pointAt(t,1,L);i[3]=a[0],i[4]=a[1],i[5]=a[2]}(0,n.pC)(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}const W=(0,R.b)(),L=(0,E.c)(),k=(0,E.c)(),B=z.KD.create(),q=1/3,Z={start:q,end:q};var j=i(96071),N=i(12811),X=i(14286);class Q extends U._{constructor(e){super(e),this._handles=new D.Z,this._location=(0,E.c)(),this._direction=(0,E.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,H.f)(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){(0,x.o)(this._location,e)||((0,x.g)(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){(0,x.o)(this._direction,e)||((0,x.g)(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){(0,x.n)(this._direction,(0,x.f)(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){(0,T.g)(e,this._color)||((0,T.c)(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new I.U(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=G.Z.createPolylineGeometry([(0,E.c)(),(0,E.c)()]),i=G.Z.createPolylineGeometry([(0,E.c)(),(0,E.c)()]),a=(0,n.Wg)(this._externalResources).material;e.addGeometry(t,a,N.I),e.addGeometry(i,a,N.I),this.updateVertices(e)}forEachExternalMaterial(e){(0,n.pC)(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){(0,n.Wi)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;(0,n.Wi)(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,$),(0,x.b)(Y,this.location,this.direction),t.projectToScreen(Y,K),(0,X.f)(K,(0,X.e)(K,K,$)),this.updateVertexAttributes(t,e,0,$,K,1),this.updateVertexAttributes(t,e,1,$,K,-1)}updateVertexAttributes(e,t,i,a,r,s){const n=t.geometryRecords[i].geometry.getMutableAttribute("position").data,o=(0,X.a)(J,(0,X.s)(J,r[1]*s,r[0]*-s),this.offset+this.width/2),l=(0,X.i)(ee,(0,X.i)(ee,(0,X.i)(ee,a,(0,X.a)(ee,r,this.length/2)),o),o),c=(0,X.i)(te,l,(0,X.a)(te,r,-this.length));e.unprojectFromScreen(l,Y),n[0]=Y[0],n[1]=Y[1],n[2]=Y[2],e.unprojectFromScreen(c,Y),n[3]=Y[0],n[4]=Y[1],n[5]=Y[2],t.geometryVertexAttrsUpdated(i)}}const Y=(0,E.c)(),$=(0,j.s1)(),K=(0,j.s1)(),J=(0,j.s1)(),ee=(0,j.s1)(),te=(0,j.s1)();var ie=i(33655),ae=i(17333),re=i(69996),se=i(38256),ne=i(8344),oe=i(67128),le=i(50897),ce=i(98501),he=i(30663),ue=i(55735),pe=i(56469),de=i(49366),ge=i(80905),me=i(27898),fe=i(24379);function ve(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var ye=i(82976),_e=i(30090),be=i(10762),xe=i(13405),Me=i(12528),we=i(23240),Se=i(97853),Ce=i(44801),Pe=i(11379),Ae=i(51007),Oe=i(36904),Ee=i(89553),De=i(61514),Te=i(91930),Re=i(2489),ze=i(86894),Ge=i(79431),Ie=i(72023),He=i(8681),Ve=i(76789),Ue=i(66704);class Fe extends Se.A{initializeProgram(e){const t=Fe.shader.get(),i=this.configuration,a=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled});return new Ae.Z(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Pe.i)}bindPass(e,t,i){Ee.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),Ve.L.bindUniforms(this.program,t,i),Te.c.bindUniforms(this.program,t),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio||1),Ee.G.bindViewport(this.program,i),6===this.configuration.output?(Ge.A.bindUniforms(this.program),this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("viewportDim",[e.getViewport().width,e.getViewport().height]),(0,ze.d)(this.program,e,i)):(Re.R.bindUniforms(this.program,i),Me.H.bindUniforms(this.program,t,i.camera.pixelRatio||1),He.k.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&Re.R.bindVisibilityTexture(e,this.program,i)),4===this.configuration.output&&Ie.bA.bindOutputHighlight(e,this.program,i)}bindDraw(e){Ee.G.bindView(this.program,e),Ee.G.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),De.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,a=2===e,r=this.configuration.polygonOffsetEnabled&&We,s=(i||a)&&4!==t.output?(t.depthEnabled||6===t.output)&&Oe.LZ:null;return(0,Oe.sm)({blending:0===t.output||7===t.output||4===t.output?i?Le:(0,Ue.$L)(e):null,depthTest:{func:515},depthWrite:s,colorWrite:Oe.BK,polygonOffset:r})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}Fe.shader=new we.J(Me.a,(()=>i.e(3362).then(i.bind(i,13362))));const We={factor:0,units:-4},Le=(0,Oe.if)(1,771);class ke extends Ce.m{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1}}(0,r._)([(0,Ce.o)({count:8})],ke.prototype,"output",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"occlusionTestEnabled",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"sdf",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"vvSize",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"vvColor",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"verticalOffset",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"screenSizePerspective",void 0),(0,r._)([(0,Ce.o)({count:2})],ke.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"debugDrawBorder",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"binaryHighlightOcclusion",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"polygonOffsetEnabled",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"depthEnabled",void 0),(0,r._)([(0,Ce.o)({count:4})],ke.prototype,"transparencyPassType",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"pixelSnappingEnabled",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"isDraped",void 0),(0,r._)([(0,Ce.o)()],ke.prototype,"multipassGeometryEnabled",void 0);class Be extends be.F5{constructor(e){super(e,ut),this.techniqueConfig=new ke}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}intersect(e,t,i,a,r,s,n,o,l){l?this.intersectDrapedHudGeometry(e,s,n,o):this.intersectHudGeometry(e,t,i,a,n,o)}intersectDrapedHudGeometry(e,t,i,a){const r=e.vertexAttributes.get("position"),s=e.vertexAttributes.get("size"),o=this.params,l=(0,Me.c)(o);let c=1,h=1;if((0,n.pC)(a)){const e=a(nt);c=e[0],h=e[5]}c*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=lt*e.screenToWorldRatio;for(let a=0;a<r.data.length/r.size;a++){const n=a*r.size,p=r.data[n],d=r.data[n+1],g=a*s.size;let m;ct[0]=s.data[g]*c,ct[1]=s.data[g+1]*h,o.textureIsSignedDistanceField&&(m=o.outlineSize*e.screenToWorldRatio/2),Ne(t,p,d,ct,u,m,o,l)&&i()}}intersectHudGeometry(e,t,i,a,r,s){if(!a.options.selectionMode||!a.options.hud)return;if((0,de.PD)(t))return;const o=this.params;let l=1,c=1;if((0,ce.f)(tt,i),(0,n.pC)(s)){const e=s(nt);l=e[0],c=e[5],function(e){const t=e[0],i=e[1],a=e[2],r=e[3],s=e[4],n=e[5],o=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+a*a),u=1/Math.sqrt(r*r+s*s+n*n),p=1/Math.sqrt(o*o+l*l+c*c);e[0]=t*h,e[1]=i*h,e[2]=a*h,e[3]=r*u,e[4]=s*u,e[5]=n*u,e[6]=o*p,e[7]=l*p,e[8]=c*p}(tt)}const h=e.vertexAttributes.get("position"),u=e.vertexAttributes.get("size"),p=e.vertexAttributes.get("normal"),d=e.vertexAttributes.get("auxpos1");(0,pe.hu)(h.size>=3);const g=a.point,m=a.camera,f=(0,Me.c)(o);l*=m.pixelRatio,c*=m.pixelRatio;const v="screen"===this.params.centerOffsetUnits;for(let e=0;e<h.data.length/h.size;e++){const t=e*h.size;(0,x.s)(Ye,h.data[t],h.data[t+1],h.data[t+2]),(0,x.k)(Ye,Ye,i);const s=e*u.size;ct[0]=u.data[s]*l,ct[1]=u.data[s+1]*c,(0,x.k)(Ye,Ye,m.viewMatrix);const n=e*d.size;if((0,x.s)(rt,d.data[n+0],d.data[n+1],d.data[n+2]),!v&&(Ye[0]+=rt[0],Ye[1]+=rt[1],0!==rt[2])){const e=rt[2];(0,x.n)(rt,Ye),(0,x.f)(Ye,Ye,(0,x.a)(rt,rt,e))}const y=e*p.size;if((0,x.s)($e,p.data[y],p.data[y+1],p.data[y+2]),this.normalAndViewAngle($e,tt,m,st),this.applyVerticalOffsetTransformationView(Ye,st,m,Xe),m.applyProjection(Ye,Ke),Ke[0]>-1){let e=Math.floor(Ke[0])+this.params.screenOffset[0],t=Math.floor(Ke[1])+this.params.screenOffset[1];v&&(e+=rt[0],0!==rt[1]&&(t+=(0,fe.sX)(rt[1],Xe.factorAlignment))),(0,fe.TU)(ct,Xe.factor,ct);const i=ot*m.pixelRatio;let s;if(o.textureIsSignedDistanceField&&(s=o.outlineSize*m.pixelRatio/2),Ne(g,e,t,ct,i,s,o,f)){const e=a.ray;if((0,x.k)(et,Ye,(0,oe.c)(at,m.viewMatrix)),Ke[0]=g[0],Ke[1]=g[1],m.unprojectFromRenderScreen(Ke,Ye)){const t=(0,E.c)();(0,x.g)(t,e.direction);const i=1/(0,x.l)(t);(0,x.a)(t,t,i),r((0,x.i)(e.origin,Ye)*i,t,-1,1,!0,et)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const a=i.get("position"),r=e.indices.get("position");return(0,me.NO)(a,r,t)}createBufferWriter(){return new dt(this)}normalAndViewAngle(e,t,i,a){return ve(t)&&(t=(0,ce.f)(it,t)),(0,x.t)(a.normal,e,t),(0,x.k)(a.normal,a.normal,i.viewInverseTransposeMatrix),a.cosAngle=(0,x.d)(Je,ht),a}updateScaleInfo(e,t,i){const a=this.params;a.screenSizePerspective?(0,fe.PV)(i,t,a.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),a.screenSizePerspectiveAlignment?(0,fe.PV)(i,t,a.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,a,r,s,n){const o=this.normalAndViewAngle(t,i,r,st);return this.applyVerticalGroundOffsetView(e,o,r,n),this.applyVerticalOffsetTransformationView(n,o,r,s),this.applyPolygonOffsetView(n,o,a[3],r,n),this.applyCenterOffsetView(n,a,n),n}applyShaderOffsetsNDC(e,t,i,a,r){return this.applyCenterOffsetNDC(e,t,i,a),(0,n.pC)(r)&&(0,x.g)(r,a),this.applyPolygonOffsetNDC(a,t,i,a),a}applyPolygonOffsetView(e,t,i,a,r){const s=a.aboveGround?1:-1;let n=(0,ie.Xx)(i);0===n&&(n=s);const o=s*n;if(this.params.shaderPolygonOffset<=0)return(0,x.g)(r,e);const l=(0,ie.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-l*l)/l/a.viewport[2];return(0,x.a)(r,e,o>0?c:1/c),r}applyVerticalGroundOffsetView(e,t,i,a){const r=(0,x.l)(e),s=i.aboveGround?1:-1,n=.5*i.computeRenderPixelSizeAtDist(r),o=(0,x.a)(Ye,t.normal,s*n);return(0,x.b)(a,e,o),a}applyVerticalOffsetTransformationView(e,t,i,a){const r=this.params;if(!r.verticalOffset||!r.verticalOffset.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){const i=(0,x.l)(e);this.updateScaleInfo(a,i,t.cosAngle)}else a.factor.scale=1,a.factorAlignment.scale=1;return e}const s=(0,x.l)(e),n=r.screenSizePerspectiveAlignment||r.screenSizePerspective,o=(0,_e.Hx)(i,s,r.verticalOffset,t.cosAngle,n);return this.updateScaleInfo(a,s,t.cosAngle),(0,x.a)(t.normal,t.normal,o),(0,x.b)(e,e,t.normal)}applyCenterOffsetView(e,t,i){const a="screen"!==this.params.centerOffsetUnits;return i!==e&&(0,x.g)(i,e),a&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,x.n)($e,i),(0,x.b)(i,i,(0,x.a)($e,$e,t[2])))),i}applyCenterOffsetNDC(e,t,i,a){const r="screen"!==this.params.centerOffsetUnits;return a!==e&&(0,x.g)(a,e),r||(a[0]+=t[0]/i.fullWidth*2,a[1]+=t[1]/i.fullHeight*2),a}applyPolygonOffsetNDC(e,t,i,a){const r=this.params.shaderPolygonOffset;if(e!==a&&(0,x.g)(a,e),r){const e=i.aboveGround?1:-1,s=e*(0,ie.Xx)(t[3]);a[2]-=(s||e)*r}return a}getGLMaterial(e){return 0===e.output||7===e.output?new Ze(e):4===e.output?new je(e):void 0}calculateRelativeScreenBounds(e,t,i=(0,le.Ue)()){return function(e,t,i,a=Qe){(0,X.c)(a,e.anchorPos),a[0]*=-t[0],a[1]*=-t[1],a[0]+=e.screenOffset[0]*i,a[1]+=e.screenOffset[1]*i}(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class qe extends ye.Z{constructor(e){super({...e,...e.material.params}),this.updateParameters()}beginSlot(e){return e===(this.material.params.drawInSecondSlot?19:18)}updateParameters(e){this.updateTexture(this.material.params.textureId),this.selectProgram(e)}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(Fe,this.material.getTechniqueConfig(this.output,e),this.technique)}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}}class Ze extends qe{constructor(e){super(e),this.isOcclusionSlot=!1}beginSlot(e){const t=this.material.params.drawInSecondSlot?19:18;return this.material.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)}getTechnique(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(Fe,this.material.getTechniqueConfig(this.output,e),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(Fe,this.material.getTechniqueConfig(6,e),this.occlusionTechnique)}bind(e,t){const i=this.getTechnique();e.bindProgram(i.program),this.isOcclusionSlot||(this.bindTexture(e,i.program),this.bindTextureScale(e,i.program)),i.bindPass(e,this.material.params,t)}}class je extends qe{constructor(e){super({...e,output:4})}}function Ne(e,t,i,a,r,s,n,o){let l=t-r-(o[0]>0?a[0]*o[0]:0),c=l+a[0]+2*r,h=i-r-(o[1]>0?a[1]*o[1]:0),u=h+a[1]+2*r;if(n.textureIsSignedDistanceField){const e=n.distanceFieldBoundingBox;l+=a[0]*e[0],h+=a[1]*e[1],c-=a[0]*(1-e[2]),u-=a[1]*(1-e[3]),l-=s,c+=s,h-=s,u+=s}return e[0]>l&&e[0]<c&&e[1]>h&&e[1]<u}const Xe={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Qe=(0,ue.c)(),Ye=(0,E.c)(),$e=(0,E.c)(),Ke=(0,j.J$)(),Je=(0,E.c)(),et=(0,E.c)(),tt=(0,he.c)(),it=(0,he.c)(),at=(0,N.c)(),rt=(0,E.c)(),st={normal:Je,cosAngle:0},nt=(0,N.c)(),ot=1,lt=2,ct=[0,0],ht=(0,E.f)(0,0,1),ut={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:(0,ue.f)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...be.zh},pt=(0,ge.U$)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class dt{constructor(e){this.material=e,this.vertexBufferLayout=pt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,a){(0,xe.ho)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,a,6),(0,xe.s5)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,a,6);{const e=t.vertexAttributes.get("uv0").data;let r,s,n,o;if(null==e||e.length<4){const e=this.material.params;r=0,s=0,n=e.texCoordScale[0],o=e.texCoordScale[1]}else r=e[0],s=e[1],n=e[2],o=e[3];n=Math.min(1.99999,n+1),o=Math.min(1.99999,o+1);const l=t.indices.get("position").length,c=i.uv0;let h=a;for(let e=0;e<l;++e)c.set(h,0,r),c.set(h,1,s),h+=1,c.set(h,0,n),c.set(h,1,s),h+=1,c.set(h,0,n),c.set(h,1,o),h+=1,c.set(h,0,n),c.set(h,1,o),h+=1,c.set(h,0,r),c.set(h,1,o),h+=1,c.set(h,0,r),c.set(h,1,s),h+=1}(0,xe.Vs)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,a,6);{const e=t.indices.get("size"),r=t.vertexAttributes.get("size").data,s=e.length,n=i.size;let o=a;for(let t=0;t<s;++t){const i=r[2*e[t]],a=r[2*e[t]+1];for(let e=0;e<6;++e)n.set(o,0,i),n.set(o,1,a),o+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&(0,xe.SW)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,a,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&(0,xe.SW)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,a,6)}}var gt=i(81718),mt=i(98160),ft=(i(30927),i(58722));const vt=o.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function yt(e){return null!=e.cachedResult}class _t{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,mt.Z7)(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=function(e){if(null!=e){if(yt(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,mt.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,n.Pt)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if((0,n.Wi)(e))return void(this._featureExpressionInfoContext=null);const a=e&&e.arcade;a&&(0,n.pC)(t)&&(0,n.pC)(i)?(this._featureExpressionInfoContext=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}(e),function(e,t){if(null!=e&&!yt(e)){if(!t||!e.arcade)return void vt.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,ft.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}(this._featureExpressionInfoContext,function(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}(a.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new _t;return(0,n.pC)(e)&&t.setFromElevationInfo(e),t}}function bt(e,t,i){switch(e){case"circle":return xt(t,i);case"square":return function(e,t){return Mt(e,t,!1)}(t,i);case"cross":return function(e,t){return wt(e,t,!1)}(t,i);case"x":return function(e,t){return wt(e,t,!0)}(t,i);case"kite":return function(e,t){return Mt(e,t,!0)}(t,i);case"triangle":return function(e,t){const i=new Uint8Array(4*e*e),a=1,r=-.5,s=Math.sqrt(a*a+r*r),n=(e-t)/2;for(let o=0;o<e;o++)for(let l=0;l<e;l++){const c=o*e+l,h=(l-n)/t,u=(o-n+.75)/t,p=-(a*h+r*u)/s,d=(a*(h-1)+r*-u)/s,g=-u,m=Math.max(p,d,g);(0,pe.I0)(m*t/e+.5,i,4*c)}return i}(t,i);default:return xt(t,i)}}function xt(e,t){const i=e,a=new Uint8Array(4*i*i),r=i/2-.5,s=t/2;for(let t=0;t<i;t++)for(let n=0;n<i;n++){const o=n+i*t,l=n-r,c=t-r;let h=Math.sqrt(l*l+c*c)-s;h=h/e+.5,(0,pe.I0)(h,a,4*o)}return a}function Mt(e,t,i){i&&(t/=Math.SQRT2);const a=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){let n=s-.5*e+.25,o=.5*e-r-.75;const l=r*e+s;if(i){const e=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=e}let c=Math.max(Math.abs(n),Math.abs(o))-.5*t;c=c/e+.5,(0,pe.I0)(c,a,4*l)}return a}function wt(e,t,i){i&&(t*=Math.SQRT2);const a=.5*t,r=new Uint8Array(4*e*e);for(let t=0;t<e;t++)for(let s=0;s<e;s++){let n=s-.5*e,o=.5*e-t-1;const l=t*e+s;if(i){const e=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=e}let c;n=Math.abs(n),o=Math.abs(o),c=n>o?n>a?Math.sqrt((n-a)*(n-a)+o*o):o:o>a?Math.sqrt(n*n+(o-a)*(o-a)):n,c=c/e+.5,(0,pe.I0)(c,r,4*l)}return r}var St=i(43473),Ct=i(80621),Pt=i(88909),At=i(81667);class Ot{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,n.pC)(this._resources)?this._resources.object:null}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if((0,n.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{2===t.type&&e.remove(t)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new At.F({isPickable:!1});e.add(t);const i=new Pt.T({castShadow:!1}),a=this.resourceFactory.createResources(i,t);a.forEach((t=>e.add(t))),e.add(i),t.add(i),e.processDirtyLayer(t.id),i.setVisible(this._visible);const r=this.resourceFactory.cameraChanged?(0,Ct.init)(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:t,object:i,external:a,cameraHandle:r}}_destroyResources(){if((0,n.Wi)(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){(0,n.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}class Et{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,se.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,se.f)(1,1,1,1),this._elevationInfo=null,this.resources=new Ot({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),(0,n.pC)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?(0,n.pC)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){(0,T.g)(e,this._color)||((0,T.c)(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,(0,n.pC)(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,T.g)(e,this._outlineColor)||((0,T.c)(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;(0,n.Wi)(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if((0,n.Wi)(e)||(0,n.Wi)(t))return;const i=e.geometry;if((0,n.Wi)(i))return;const a=i.getMutableAttribute("size").data,r=this.geometrySize;a[0]=r,a[1]=r,t.geometryVertexAttrsUpdated(0)}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Tt,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Dt}recreateGeometry(e,t){const i=this.createRenderGeometry();return(0,n.pC)(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new Be(this.materialParameters(t.id)),a=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:a,forEach(e){e(t),e(i),(0,n.pC)(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return(0,ie.uZ)((0,ie.Sf)(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new St.x(bt(this._primitive,e,e*Dt),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if((0,n.Wi)(this.resources.resources)||(0,n.Wi)(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get("position");return(0,ae.SH)(t.data,this.view.renderCoordsHelper.spatialReference,Rt,this.view.spatialReference),(0,re.G1)(e,Rt),!0}createRenderGeometry(){const e=this.geometry;if((0,n.Wi)(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,a=(0,gt.w7)(e,i,_t.fromElevationInfo(this.elevationInfo),t),r=(0,x.s)(ne.WM.get(),e.x,e.y,a),s=ne.WM.get();(0,ae.SH)(r,e.spatialReference,s,t.spatialReference);const o=this.geometrySize;return G.Z.createPointGeometry(null,s,null,[o,o],[0,0,0,1])}}const Dt=.5,Tt=[Dt/2,Dt/2,1-Dt/2,1-Dt/2],Rt=(0,E.c)();var zt=i(68500),Gt=i(94589);class It extends U._{constructor(e){super(e),this._handles=new D.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,E.c)(),this._up=(0,E.c)(),this._right=(0,E.c)(),this._renderOccluded=4,this._color=(0,H.f)(1,0,0,1),this._outlineColor=(0,H.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,T.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,T.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,x.i)(t,e),(0,x.i)(t,i))/3,(0,x.n)(this._up,(0,x.f)(this._up,e,t)),(0,x.n)(this._right,(0,x.f)(this._right,i,t)),(0,x.g)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Gt.E(this.quadMaterialParameters),this._outlineMaterial=new I.U(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,x.b)(ne.WM.get(),this._up,this._right),i=G.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);(0,oe.i)(Ht),(0,oe.t)(Ht,Ht,this._position),(0,oe.s)(Ht,Ht,[a,a,a]),(0,n.pC)(e)&&(e.transformation=Ht)}_quadGeometryData(e,t){const i=(0,x.b)(ne.WM.get(),e,t);return new zt.Z([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const Ht=(0,N.c)();class Vt extends class{draw(e,t){const i=this.getUniqueHints(e),a=[];for(const e of i)e instanceof O.w&&a.push(this.visualizeIntersectionPoint(e,t)),e instanceof S.w&&a.push(this.visualizeLine(e,t)),e instanceof P.L&&a.push(this.visualizeParallelSign(e,t)),e instanceof A.y&&a.push(this.visualizeRightAngleQuad(e,t)),e instanceof C.n&&a.push(this.visualizePoint(e,t));return(0,_.AL)(a)}getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const a of t)if(i.equals(a)){e=!1;break}e&&t.push(i)}return t}}{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return(0,_.ed)(new Et({view:r,primitive:"circle",geometry:i.createPoint(e.intersectionPoint),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:b.default.toUnitRGBA(M.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return(0,_.ed)(new Et({view:r,primitive:"circle",geometry:i.createPoint(e.point),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:b.default.toUnitRGBA(M.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return(0,_.ed)(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,a,r,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t,s=(0,w.$r)(e.lineStart,i,a,t.view),n=(0,w.$r)(e.lineEnd,i,a,t.view),o=(0,x.e)(n,s,n,.5),l=new Q({view:r,attached:!1,offset:M.c.parallelLineHintOffset,length:M.c.parallelLineHintLength,width:M.c.parallelLineHintWidth,color:b.default.toUnitRGBA(M.c.orange),location:o,renderOccluded:16});return l.setDirectionFromPoints(s,o),l.attached=!0,(0,_.ed)(l)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:a,view:r}=t;return(0,_.ed)(new It({view:r,attached:!0,color:b.default.toUnitRGBA(M.c.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:b.default.toUnitRGBA(M.c.orange),outlineSize:M.c.rightAngleHintOutlineSize,size:M.c.rightAngleHintSize,geometry:{previous:(0,w.$r)(e.previousVertex,i,a,r),center:(0,w.$r)(e.centerVertex,i,a,r),next:(0,w.$r)(e.nextVertex,i,a,r)}}))}createLineSegmentHintFromMap(e,t,i,a,r,s,n=!0,o=!0){return this.createLineSegmentHint(e,s,(0,w.$r)(t,a,r,s),(0,w.$r)(i,a,r,s),n,o)}createLineSegmentHint(e,t,i,a,r=!0,s=!0){const n=new F({view:t,extensionType:3,start:i,end:a,color:b.default.toUnitRGBA(M.c.orange),renderOccluded:16});switch(e){case 0:n.width=M.c.lineHintWidthTarget,n.fadedExtensions={start:0,end:M.c.lineHintFadedExtensions};break;case 2:n.width=M.c.lineHintWidthReference,n.fadedExtensions={start:0,end:0};break;case 1:n.width=M.c.lineHintWidthReference,n.fadedExtensions={start:r?M.c.lineHintFadedExtensions:0,end:s?M.c.lineHintFadedExtensions:0}}return n.attached=!0,n}}var Ut=i(43019),Ft=i(48430);const Wt={main:new b.default([255,127,0]),selected:new b.default([255,255,255]),staged:new b.default([12,207,255]),outline:new b.default([0,0,0,.5]),selectedOutline:new b.default([255,255,255])},Lt=.3;function kt(e,t){const i=e.clone();return i.a*=t,i}function Bt(e,t){const i=e.clone(),a=(0,Ut._Y)(i);a.s*=t;const r=(0,Ut.xr)(a);return i.r=r.r,i.g=r.g,i.b=r.b,i}function qt(e,t){if(t)for(const i in t)e[i]=t[i]}class Zt{constructor(e){this.color=Wt.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,qt(this,e)}}class jt{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Wt.main,this.outlineColor=Wt.outline,this.renderOccluded=16,this.hoverOutlineColor=Wt.selectedOutline,qt(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:ti(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class Nt{constructor(e){this.vertex=new jt({color:Wt.main,outlineColor:Wt.outline}),this.edge=new jt({color:Bt(kt(Wt.main,2/3),.5),outlineColor:kt(Wt.outline,.5),size:8,collisionPadding:8}),this.selected=new jt({color:Wt.selected,outlineColor:Wt.outline}),qt(this,e)}}class Xt{constructor(e){this.color=Wt.selected,this.width=1.5,this.stipplePattern=(0,Ft.i2)([5,5]),this.stippleOffColor=Wt.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Wt.selected,this.renderOccluded=4,qt(this,e)}apply(e){e.color=ti(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=ti(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=ti(this.innerColor),e.renderOccluded=this.renderOccluded}}class Qt{constructor(e){this.color=Wt.selected,this.size=4,this.outlineSize=1,this.outlineColor=Wt.outline,this.shape="square",qt(this,e)}apply(e){e.color=ti(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=ti(this.outlineColor),e.primitive=this.shape}}class Yt{constructor(e){this.innerColor=Wt.selected,this.innerWidth=1,this.glowColor=Wt.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Lt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Wt.main,qt(this,e)}apply(e,t=1){const i={glowColor:b.default.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:b.default.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class $t{constructor(e){this.outline=new Xt({color:Wt.outline,renderOccluded:8,stippleOffColor:Wt.selected,stipplePattern:(0,Ft.i2)([5,5]),width:1.5,innerWidth:0}),this.staged=new Xt({color:Wt.selected,renderOccluded:8,innerColor:Wt.staged,stippleOffColor:Wt.outline,stipplePattern:(0,Ft.i2)([5,5]),width:1.5}),this.shadowStyle=new Yt({globalAlpha:Lt,glowColor:Wt.main,glowFalloff:8,glowWidth:8,innerColor:Wt.selected,innerWidth:1}),qt(this,e)}}class Kt{constructor(e){this.outline=new Qt({color:Wt.selected,outlineColor:Wt.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Yt({globalAlpha:Lt,glowColor:Wt.main,glowFalloff:1.5,glowWidth:6,innerColor:Wt.selected,innerWidth:1,radius:2}),qt(this,e)}}class Jt extends Xt{constructor(e){super(),this.extensionType=2,qt(this,e)}}class ei{constructor(e){this.lineGraphics=new $t,this.pointGraphics=new Kt,this.heightPlane=new Yt({globalAlpha:Lt,glowColor:Wt.main,glowFalloff:8,glowWidth:8,innerColor:Wt.selected,innerWidth:1}),this.heightBox=new Yt({globalAlpha:Lt,glowColor:Wt.main,glowFalloff:8,glowWidth:8,innerColor:Wt.selected,innerWidth:0,heightFillColor:Wt.main}),this.zVerticalLine=new Jt({color:kt(Wt.main,.5),falloff:2,innerColor:kt(Wt.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,qt(this,e)}}function ti(e){return(0,se.b)(b.default.toUnitRGBA(e))}const ii=new class{constructor(e){this.visualElements=new ei,this.reshapeManipulators=new Nt,this.zManipulator=new Zt,qt(this,e)}colorToVec4(e){return ti(e)}};var ai=i(45201),ri=i(17154),si=i(85450);class ni{constructor(e,t,i=null,a=null,r,s,n,o,l){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=a,this.boundingSphere=(0,se.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=r,this.material=t,this.origin=null,this.transformation=null,this.calculateShaderTransformation=n,s&&this.updateTransformation(s,o),this.castShadow=l}updateTransformation(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}computeBoundingSphere(e,t,i){(0,n.Wi)(this.boundingInfo)||(t=t||(0,ri.u1)(e),(0,x.k)(i,this.boundingInfo.getCenter(),e),i[3]=this.boundingInfo.getBSRadius()*t)}get hasShaderTransformation(){return(0,n.pC)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return(0,n.Wi)(this.calculateShaderTransformation)?(0,n.Pt)(this.transformation,N.I):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=(0,N.c)()),(0,oe.e)(this.shaderTransformation,this.calculateShaderTransformation((0,n.Pt)(this.transformation,N.I))),this.shaderTransformationDirty=!1),this.shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&((0,n.pC)(this.transformation)&&(0,x.k)(e,e,this.transformation),!0);const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!(0,me.cM)(i,t,e)&&((0,n.pC)(this.transformation)&&(0,x.k)(e,e,this.transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new si.O(0),t=this.instanceParameters;return t.highlights=(0,de.lr)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=(0,de.U_)(t.highlights,e)}}var oi=i(17282),li=i(82677),ci=i(35326);class hi{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?(0,n.Wi)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,n.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new ui({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if((0,n.Wi)(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!(0,n.Wi)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){(0,n.Wi)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let ui=class extends((0,ci.I)(li.default)){constructor(e){super(e),this.drapeSourceType=1}};(0,r._)([(0,c.Cb)({constructOnly:!0})],ui.prototype,"view",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],ui.prototype,"drapeSourceType",void 0),ui=(0,r._)([(0,h.j)("DrapedVisualElementLayerView")],ui);class pi{constructor(e){this.view=null,this._attachmentOrigin=(0,ai.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new u.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,H.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,H.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new Ot({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new hi({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new V.W({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&(0,n.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){(0,T.g)(e,this._color)||((0,T.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,T.g)(e,this._innerColor)||((0,T.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,n.pC)(e)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,T.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,H.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,(0,n.pC)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(0,n.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;(0,x.s)(mi,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),a=i.indices.get("position"),r=(0,n.Wg)(this.resources.resources).material.isClosed(e.data,a);(0,me.qZ)(e,a,r,gi)&&((0,x.b)(mi,mi,gi),t++)}return 0===t?null:((0,x.a)(mi,mi,1/t),this.view.renderCoordsHelper.fromRenderCoords(mi,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){(0,n.pC)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),(0,n.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return(0,n.pC)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const a=this.createRenderGeometries();for(const r of a)e.addGeometry(r,t),i.push(r);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new I.U(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new I.U(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if((0,n.Wi)(t))return[];const i=(0,oi.rm)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:t}of i.lines){const i={attributeData:{position:t},removeDuplicateStartEnd:this.isClosed?1:0},r=new ni((0,oi.YU)(i),e),s=(0,re.cS)(di);(0,re.G1)(s,t),(0,T.s)(r.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),a.push(r)}return a}calculateMapBounds(e){if((0,n.Wi)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.vertexAttributes.get("position"),r=new Float64Array(a.data.length);(0,ae.CM)(a.data,t.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),(0,re.G1)(e,r)}return!0}createRenderGeometries(){const e=this.geometry;if((0,n.Wi)(e))return[];const t=(0,oi.VP)(e,this.view.elevationProvider,this.view.renderCoordsHelper,_t.fromElevationInfo(this.elevationInfo)),i=[],a=[];for(const{position:e,mapPosition:r}of t.lines){const t={attributeData:{position:e,mapPosition:r},removeDuplicateStartEnd:this.isClosed?1:0};i.push((0,oi.YU)(t)),a.push(e)}return this._laserline.pathVerticalPlane=a,i}}const di=(0,re.Ue)(),gi=(0,E.c)(),mi=(0,E.c)();i(92232),i(74218);(0,E.c)();var fi=i(71279);class vi extends U._{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=ii.colorToVec4(ii.reshapeManipulators.vertex.color),this._size=ii.reshapeManipulators.vertex.size,this._outlineColor=ii.colorToVec4(ii.reshapeManipulators.vertex.outlineColor),this._outlineSize=ii.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,T.g)(e,this._color)||((0,T.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,T.g)(e,this._outlineColor)||((0,T.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if((0,n.Wi)(e)||0===e.length)return[];const t=function(e,t,i,a,r){const s=new Float64Array(3*e.length),n=new Float64Array(s.length);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const o=(0,gt.rR)(s,t,0,n,0,s,0,s.length/3,i,a,r),l=null!=o;return{numVertices:e.length,position:s,mapPosition:n,projectionSuccess:l,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,_t.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,r=t.position;for(let e=0;e<a;++e){const t=(0,x.s)(yi,r[3*e+0],r[3*e+1],r[3*e+2]),a=_i(.5,t),s=_i(.5,t);i.push({vertexGeometry:a,vertexOutlineGeometry:s})}return i}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new fi.Q({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new fi.Q({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const yi=(0,E.c)();function _i(e,t){return G.Z.createSphereGeometry(e,16,16,{offset:t})}var bi=i(48016);let xi=class extends(u.Z.EventedMixin(v.m)){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._stagedVerticesVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingOptions=new m.g,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=(0,n.Pt)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new d.default({elevationInfo:e,listMode:"hide"}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new a.w({view:this.view,manipulators:this.manipulators,geometryType:Mi(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new f.i(this.view,e,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:e,snappingOptions:this.snappingOptions,snappingVisualizer:new Vt}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e,t=!1){if(null==this.drawOperation)return null;const i=(0,n.pC)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,a=this.drawOperation.vertices;if(0===a.length)return null;const r=this.drawOperation.spatialReference,s=a,o=s.slice(),l=[];(0,n.pC)(i)&&(o.splice(i,1),l.push(s[i]));const c={regularVertices:null,stagedVertices:null,full:null,outline:null},h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=o,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":c.regularVertices=o,c.stagedVertices=l,s.length>0&&(c.full=(0,bi.createPolyline)([s],r,h));break;case"polygon":c.regularVertices=o,c.stagedVertices=l,s.length>0&&(c.full=(0,bi.createPolygon)([s],r,h,!0));break;case"circle":if(s.length>0){const e=(0,y.Gn)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+wi*this.view.resolution,t[1]);c.full=(0,bi.createCircle)([t,i],e,!0)}else 2===s.length&&(c.full=this.forceUniformSize?(0,bi.createCircle)(a,e,this.centered):(0,bi.createEllipse)(a,e,this.centered))}break;case"rectangle":if(s.length>0){const e=(0,y.Gn)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+wi*this.view.resolution,t[1]);c.full=(0,bi.createSquare)([t,i],e,!0)}else 2===s.length&&(c.full=this.forceUniformSize?(0,bi.createSquare)(a,e,this.centered):(0,bi.createRectangle)(a,e,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":s.length>1&&(c.outline=(0,bi.createPolyline)([s],r,h));break;case"polygon":s.length>1&&(c.outline=(0,bi.createPolygon)([s],r,h));break;case"circle":case"rectangle":(0,n.pC)(c.full)&&"polygon"===c.full.type&&(c.outline=(0,bi.createPolygon)(c.full.rings,r,h))}return c}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){(0,n.pC)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)}_destroyOutlineVisualElement(){(0,n.pC)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}_destroyVerticesVisualElement(){(0,n.pC)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}_destroyStagedVerticesVisualElement(){(0,n.pC)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}_updateCreateGraphic(e=null){const t=this._getCreateGeometry(e);if((0,n.Wi)(t))return void this._destroyAllVisualisations();const i=this._internalGraphicsLayer.elevationInfo,a="on-the-ground"===(0,g.Zz)(this.hasZ,i);(0,n.pC)(t.outline)?(0,n.Wi)(this._outlineVisualElement)?(this._outlineVisualElement=new pi({view:this.view,geometry:t.outline,elevationInfo:(0,n.Wg)(i),isDraped:a,attached:!1}),ii.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),ii.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),(0,n.pC)(t.regularVertices)?(0,n.Wi)(this._verticesVisualElement)?(this._verticesVisualElement=new vi({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:(0,n.Wg)(this._internalGraphicsLayer.elevationInfo),renderOccluded:ii.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),(0,n.pC)(t.stagedVertices)?(0,n.Wi)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new vi({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:(0,n.Wg)(this._internalGraphicsLayer.elevationInfo),renderOccluded:ii.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=ii.colorToVec4(ii.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),(0,n.pC)(t.full)?(0,n.Wi)(this._createGraphic)?(this._createGraphic=new p.default({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry(null,!0);(0,n.pC)(e)&&(t=new p.default({geometry:e.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:t,...e})}};function Mi(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"view",void 0),(0,r._)([(0,c.Cb)()],xi.prototype,"createGraphicSymbol",void 0),(0,r._)([(0,c.Cb)()],xi.prototype,"createGraphic",null),(0,r._)([(0,c.Cb)({value:!0})],xi.prototype,"enabled",null),(0,r._)([(0,c.Cb)({value:!0})],xi.prototype,"centered",null),(0,r._)([(0,c.Cb)({value:!0})],xi.prototype,"forceUniformSize",null),(0,r._)([(0,c.Cb)({constructOnly:!0})],xi.prototype,"hasZ",void 0),(0,r._)([(0,c.Cb)({nonNullable:!0})],xi.prototype,"defaultZ",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0})],xi.prototype,"elevationInfo",void 0),(0,r._)([(0,c.Cb)()],xi.prototype,"snapToScene",void 0),(0,r._)([(0,c.Cb)()],xi.prototype,"snappingOptions",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0})],xi.prototype,"mode",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0})],xi.prototype,"geometryType",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],xi.prototype,"type",void 0),xi=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],xi);const wi=48;var Si=i(28293),Ci=i(53640),Pi=i(50777),Ai=i(12217);function Oi(e,t=(0,g.RL)(e)){return"on-the-ground"!==t.mode&&!((0,n.Wi)(e.geometry)||!e.geometry.hasZ)}let Ei=class extends u.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,r._)([(0,c.Cb)({constructOnly:!0})],Ei.prototype,"graphic",void 0),(0,r._)([(0,c.Cb)()],Ei.prototype,"tracking",void 0),(0,r._)([(0,c.Cb)()],Ei.prototype,"displaying",void 0),(0,r._)([(0,c.Cb)()],Ei.prototype,"isDraped",void 0),Ei=(0,r._)([(0,h.j)("esri.views.3d.layers.graphics.GraphicState")],Ei);var Di=i(59492);class Ti{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof Di.Z&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),(0,n.Wi)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}function Ri(e){const{view:t,graphic:i}=e,a=new Ei({graphic:i}),r=function(e,t){const{view:i,graphic:a}=e,r=new pi({view:i,geometry:Gi(a)?a.geometry:null,elevationInfo:(0,g.RL)(a),attached:!1});ii.visualElements.lineGraphics.shadowStyle.apply(r);const s=()=>{r.attached=t.displaying};ii.visualElements.lineGraphics.outline.apply(r);const n=[t.watch("displaying",s),t.watch("isDraped",(e=>r.isDraped=e)),t.on("changed",(()=>r.geometry=Gi(a)?a.geometry:null)),(0,_.ed)(r)];return s(),{visualElement:r,remove:()=>(0,_.AL)(n).remove()}}(e,a),s=[r,zi(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>(0,_.AL)(s).remove()}}function zi(e,t,i){const{graphic:a,view:r}=e,s=[],o=(0,g.RL)(a),l="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new Ti,h=new F({view:r,extensionType:ii.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});ii.visualElements.pointGraphics.shadowStyle.apply(h);const u=(0,ie.Vl)(ii.visualElements.heightPlaneAngleCutoff),p=new V.W({view:r,attached:!1,angleCutoff:u});ii.visualElements.heightPlane.apply(p);let d=1,m=1;const f=()=>{if(c.update(e),!i.displaying||l&&(i.isDraped||!Gi(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(p.attached=!1);t.laserlineEnabled=!0;{const e=4&c.grabbingState?ii.visualElements.laserlineAlphaMultiplier:1;e!==d&&(d=e,ii.visualElements.lineGraphics.shadowStyle.apply(t,e),ii.visualElements.pointGraphics.shadowStyle.apply(h,e))}{const e=2&c.grabbingState?ii.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,ii.visualElements.heightPlane.apply(p,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,n.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,n.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(h,c),function(e,t,i,a){if(a.numSelected>0){(0,x.s)(Ii,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{1===i&&e.selected&&e instanceof Di.Z&&((0,x.b)(Ii,Ii,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,x.a)(Ii,Ii,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;(0,n.pC)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,Ii)?(i.heightManifoldTarget=Ii,i.attached=!0):i.attached=!1}}(e,t,p,c)};ii.visualElements.zVerticalLine.apply(h),s.push(i.on("changed",f),i.watch("displaying",f),t.events.on("attachment-origin-changed",f),(0,_.ed)(h),(0,_.ed)(p));const v=[],y=()=>{(0,_.AL)(v).remove(),v.length=0,e.forEachManipulator((e=>v.push(e.events.on("grab-changed",f)))),e.forEachManipulator((e=>v.push(e.events.on("select-changed",f)))),f()};return y(),s.push(e.onManipulatorsChanged(y),(0,_.iU)((()=>(0,_.AL)(v)))),(0,_.AL)(s)}function Gi(e){return(0,n.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const Ii=(0,E.c)();function Hi(e){const{view:t,graphic:i}=e,a=new Ei({graphic:i}),r=[],s=function(e,t,i){const{view:a,graphic:r}=e,s=new Et({view:a,geometry:Vi(r)?r.geometry:null,elevationInfo:(0,g.RL)(r),attached:!1});return function(e,t,i,a){const r=()=>t.attached=i.displaying;(function(e,t,i,a){const{view:r,graphic:s}=e;let o=null;const l=()=>{(0,n.pC)(o)&&(o.remove(),o=null),i.isDraped&&Vi(s)&&(o=function(e,t,i){const a=e.elevationProvider.spatialReference;(0,ae.KC)(t,Ui,a);const r=Ui[0],s=Ui[1];return e.elevationProvider.on("elevation-change",(e=>{(0,le.jE)(e.extent,r,s)&&i()}))}(r,s.geometry,(()=>{t.geometry=s.geometry})))},c=()=>{l(),t.geometry=Vi(s)?s.geometry:null};a.push(i.on("changed",c),(0,_.iU)((()=>o))),c()})(e,t,i,a),ii.visualElements.pointGraphics.outline.apply(t),a.push((0,Ct.init)(i,"displaying",r))}(e,s,t,i),i.push((0,_.ed)(s)),s}(e,a,r);return function(e,t,i,a){const{view:r,graphic:s}=e,n=new F({view:r,extensionType:ii.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});ii.visualElements.zVerticalLine.apply(n);const o=new V.W({view:r,intersectsLineInfinite:!0,attached:!1});ii.visualElements.pointGraphics.shadowStyle.apply(o);const l=(0,ie.Vl)(ii.visualElements.heightPlaneAngleCutoff),c=new V.W({view:r,attached:!1,angleCutoff:l});ii.visualElements.heightPlane.apply(c);const h=(0,g.RL)(e.graphic),u=_t.fromElevationInfo(h),p="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,d=new Ti;let m=1,f=1;const v=()=>{d.update(e);const i=p&&(t.isDraped||!Vi(s)||!s.geometry.hasZ);let l=!0;if(!i&&Vi(s)){const e=s.geometry,t=(0,gt.w7)(s.geometry,r.elevationProvider,u,r.renderCoordsHelper);(0,x.s)(Ui,e.x,e.y,t),(0,ae.SH)(Ui,e.spatialReference,Ui,r.renderCoordsHelper.spatialReference),n.setStartEndFromWorldDownAtLocation(Ui),o.intersectsWorldUpAtLocation=Ui}else l=!1;const h=2&d.grabbingState?ii.visualElements.laserlineAlphaMultiplier:1;h!==m&&(m=h,ii.visualElements.heightPlane.apply(c,h));const g=(0,re.cS)(Fi);!i&&t.displaying&&a.calculateMapBounds(g)&&(0,ae.SH)((0,re.KE)(g,Ui),r.spatialReference,Ui,r.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=Ui,c.attached=!0):c.attached=!1;const v=4&d.grabbingState?ii.visualElements.laserlineAlphaMultiplier:1;v!==f&&(f=v,ii.visualElements.pointGraphics.shadowStyle.apply(o,v));const y=l&&t.displaying&&!i;o.attached=y,n.attached=y};i.push(t.watch(["displaying","isDraped"],v),t.on("changed",v)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",v))})),i.push((0,_.ed)(o)),i.push((0,_.ed)(n)),i.push((0,_.ed)(c)),v()}(e,a,r,s),r.push(t.trackGraphicState(a)),{visualElement:s,remove(){(0,_.AL)(r).remove()}}}function Vi(e){return(0,n.pC)(e.geometry)&&"point"===e.geometry.type}const Ui=(0,E.c)(),Fi=(0,re.Ue)();function Wi(e){switch((0,n.Wg)(e.graphic.geometry).type){case"point":return Hi(e);case"polygon":case"polyline":return Ri(e);default:return null}}const Li=[1,.5,0],ki=70,Bi=Math.ceil(ki/3*2),qi=160,Zi=5*Math.PI/12,ji=1*Math.PI/3,Ni=1e6;var Xi=i(70642),Qi=i(60418);function Yi(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=i[0],l=i[1],c=i[2],h=i[3];return e[0]=a*o+s*l,e[1]=r*o+n*l,e[2]=a*c+s*h,e[3]=r*c+n*h,e}function $i(e,t){const i=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=i,e[2]=-i,e[3]=a,e}function Ki(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}const Ji=Yi,ea=Ki;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},set:function(e,t,i,a,r){return e[0]=t,e[1]=i,e[2]=a,e[3]=r,e},transpose:function(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){const i=t[0],a=t[1],r=t[2],s=t[3];let n=i*s-r*a;return n?(n=1/n,e[0]=s*n,e[1]=-a*n,e[2]=-r*n,e[3]=i*n,e):null},adjoint:function(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:Yi,rotate:function(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=Math.sin(i),l=Math.cos(i);return e[0]=a*l+s*o,e[1]=r*l+n*o,e[2]=a*-o+s*l,e[3]=r*-o+n*l,e},scale:function(e,t,i){const a=t[0],r=t[1],s=t[2],n=t[3],o=i[0],l=i[1];return e[0]=a*o,e[1]=r*o,e[2]=s*l,e[3]=n*l,e},fromRotation:$i,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)},LDU:function(e,t,i,a){return e[2]=a[2]/a[0],i[0]=a[0],i[1]=a[1],i[3]=a[3]-e[2]*i[1],[e,t,i]},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},subtract:Ki,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){const i=e[0],a=e[1],r=e[2],s=e[3],n=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(i-n)<=Qi.E*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(a-o)<=Qi.E*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(r-l)<=Qi.E*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=Qi.E*Math.max(1,Math.abs(s),Math.abs(c))},multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},multiplyScalarAndAdd:function(e,t,i,a){return e[0]=t[0]+i[0]*a,e[1]=t[1]+i[1]*a,e[2]=t[2]+i[2]*a,e[3]=t[3]+i[3]*a,e},mul:Ji,sub:ea});function ta(){return[1,0,0,1]}Object.freeze({__proto__:null,create:ta,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,i,a){return[e,t,i,a]},createView:function(e,t){return new Float64Array(e,t,4)}});function ia(e,t,i){const a=e.graphic,r=(e,i)=>t({action:e,graphic:a,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{t.next((e=>("start"===e.action&&r("start",e),e))).next((0,Ci.a9)(a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e})),i.next((0,Ci.bD)(a)).next((()=>{r("end",{screenDeltaX:0,screenDeltaY:0})}))}))}function aa(e){if((0,n.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=(0,Xi.convexHull)(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){let t=0,i=0;for(const a of e)t+=a[0],i+=a[1];t/=e.length,i/=e.length;for(const a of e)a[0]-=t,a[1]-=i}(i);const a=[];for(let e=0;e<i.length-1;e++){const t=Math.atan2(i[e+1][1]-i[e][1],i[e+1][0]-i[e][0]),r=ri.c5.normalize(t)%(Math.PI/2);a.push(r)}const r=a.sort(((e,t)=>e-t));let s=null,o=0,l=Number.POSITIVE_INFINITY,c=0;for(const e of r){if(e===s)continue;s=e,$i(ra,e),(0,le.cS)(sa);for(const e of i)(0,X.o)(na,e,ra),(0,le.Ho)(sa,na);const t=(0,le.SO)(sa);((t>l?l/t:t/l)>=.99&&e<o||t<l)&&(o=e,l=t),c=Math.max(c,t)}return l/c>=.95?0:o}const ra=[1,0,0,1],sa=(0,le.Ue)(),na=(0,ue.c)();class oa{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Di.Z&&e(t,i)}))}}var la=i(34937);class ca extends oa{constructor(e){super(),this._handles=new D.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=ki,this._updateAfterDrag=!1,this.events=new u.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t){const i=e.graphic,a=(0,g.RL)(i),r=(0,n.Wg)(i.geometry).spatialReference;return ia(e,t,(e=>this.createDragPipeline(e,a,r)))}createDragPipeline(e,t,i){return(0,_.AL)(this._arrowManipulatorInfos.map((({manipulator:a},r)=>(0,Ci.Xd)(a,((a,s,n,o,l)=>{const c=s.next((e=>({...e,manipulatorType:1}))).next((0,Ci.kY)(this._view,a.elevationAlignedLocation)).next((0,la.G)(this._view,a.elevationAlignedLocation,t,i)).next((0,Ci.M2)(a.location,this.angle+(r+1)*Math.PI*.5)).next((0,Ci.zh)());e(a,c,n,o,l)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/ki,r=54*a,s=Math.sqrt(r*r*3/4),n=G.Z.createExtrudedTriangle(s,r/2,r/2,.02);G.Z.transformInPlace(n,(0,oe.w)(ne.MP.get(),(0,x.s)(ne.WM.get(),0,-s/3,0))),e.renderObjects=[{geometry:n,material:this._opaqueMaterial,stateMask:2},{geometry:n,material:this._transparentMaterial,stateMask:1}],e.radius=s/3*2*1.2;const o=(0,oe.i)(ne.MP.get());(0,oe.x)(o,i*Math.PI/2);const l=(0,oe.i)(ne.MP.get());(0,oe.w)(l,(0,x.s)(ne.WM.get(),0,100*a,0)),(0,oe.m)(t,o,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,oe.i)(ne.MP.get());(0,oe.r)(t,t,e,(0,E.f)(0,0,1));const i=(0,oe.p)(ne.MP.get(),(0,x.s)(ne.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,oe.i)(ne.MP.get());(0,oe.m)(a,i,t);for(const e of this._arrowManipulatorInfos){const t=(0,oe.m)(ne.MP.get(),a,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new Di.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,E.f)(0,0,1)}}),i={manipulator:t,transform:(0,N.c)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){const t=b.default.toUnitRGBA(Wt.main);return t[3]*=e,new Gt.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class ha{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Ci.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,n.pC)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if((0,n.pC)(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){const t=(0,n.pC)(this.view)?this.view.toMap(e,{exclude:[]}):null;return(0,n.pC)(t)&&(0,n.pC)(this.view)&&(t.z=(0,g.Ou)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return(0,n.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class ua extends oa{constructor(e){super(),this._handles=new D.Z,this._snapToScene=new ha,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=ki,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t){const i=e.graphic,a=(0,g.RL)(i),r=(0,n.Wg)(i.geometry).spatialReference;return ia(e,t,(e=>this.createDragPipeline(e,a,r)))}createDragPipeline(e,t,i){const a=this._view;return(0,Ci.Xd)(this._manipulator,((r,s,n,o,l)=>{const c=s.next((0,Ci.kY)(a,r.elevationAlignedLocation)).next((0,la.G)(a,r.elevationAlignedLocation,t,i)).next(this._snapToScene.createDragEventPipelineStep(a,t),this._snapToScene.next).next((e=>({...e,manipulatorType:1}))).next((0,Ci.zh)());e(r,c,n,o,l)}))}_updateManipulatorTransform(){const e=(0,oe.p)(ne.MP.get(),(0,x.s)(ne.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Di.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,E.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=G.Z.createCylinderGeometry(.02,1,128,(0,E.f)(0,0,1),(0,E.f)(0,0,0)),t=(0,oe.p)((0,N.c)(),(0,E.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/ki*80}_createMaterial(e=1){const t=b.default.toUnitRGBA(Wt.main);return t[3]*=e,new Gt.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class pa extends oa{constructor(e){super(),this._handles=new D.Z,this._radius=ki,this.events=new u.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t){const i=(0,n.Wg)(e.graphic.geometry).spatialReference;return ia(e,t,(e=>this.createDragPipeline(e,i)))}createDragPipeline(e,t){const i=this._view;return(0,Ci.Xd)(this._manipulator,((a,r,s,n,o)=>{const l=r.next((e=>({...e,manipulatorType:0}))).next((0,la.Sp)(i,a.renderLocation,t)).next((0,Ci.zh)());e(a,l,s,n,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/ki,t=ii.zManipulator.height*e,i=ii.zManipulator.coneHeight*e,a=ii.zManipulator.coneWidth*e,r=ii.zManipulator.width*e,s=[(0,E.f)(0,0,0),(0,E.f)(0,0,t)],n=G.Z.createTubeGeometry(s,r/2,16,!1),o=G.Z.createConeGeometry(i,a/2,16,!1),l=[(0,E.f)(0,0,0),(0,E.f)(0,0,t+i)],c=(e=>{const i=(0,N.c)();return(0,oe.t)(i,i,[0,0,t]),(0,oe.b)(i,i,Math.PI/2),i})(),h=(e,t)=>{const i=(0,Ut._j)(ii.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,ii.zManipulator.color.a*e]},u=(0,Pi.EA)(h(1,.25),1),p=(0,Pi.EA)(h(1,0),1),d=(0,Pi.EA)(h(.7,0),ii.zManipulator.renderOccluded),g=(0,Pi.EA)(h(.85,0),ii.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:c,material:u,stateMask:1},{geometry:n,material:u,stateMask:1},{geometry:o,transform:c,material:p,stateMask:2},{geometry:n,material:p,stateMask:2},{geometry:o,transform:c,material:d,stateMask:1},{geometry:n,material:d,stateMask:1},{geometry:o,transform:c,material:g,stateMask:2},{geometry:n,material:g,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}createManipulator(){const e=new Di.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=da;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,x.j)(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),s=(0,x.f)(ga,i,t.eye);(0,x.n)(s,s);const n=ma;this._view.renderCoordsHelper.worldUpAtPosition(da,n);const o=Math.abs((0,x.d)(s,n)),l=(0,x.c)(ga,s,n),c=(0,x.c)(ga,l,n),h=(0,ie.uZ)(o,.01,1),u=1-Math.sqrt(1-h*h)/h/t.fullWidth,p=this._radius/ki,d=ii.zManipulator.width*p;(0,x.a)(c,(0,x.n)(c,c),(1/u-1)*a+r*d),e[12]-=ga[0],e[13]-=ga[1],e[14]-=ga[2]},this._manipulator=e,this.updateManipulator()}}const da=(0,E.c)(),ga=(0,E.c)(),ma=(0,E.c)();class fa extends oa{constructor(e){super(),this._handles=new D.Z,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new ua({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new ca({tool:t,view:i,radius:r}),this.zManipulation=new pa({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t){return(0,_.AL)([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])}createDragPipeline(e,t,i){return(0,_.AL)([this.xyManipulation.createDragPipeline(e,t,i),this.xyAxisManipulation.createDragPipeline(e,t,i),this.zManipulation.createDragPipeline(e,i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,s.Z)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this.xyAxisVisible?(0,n.pC)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(va),this._handles.add(t,va)};for(const e of i)this._handles.add(e.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=(0,n.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?Bi:ki}}const va="disable-xy-axis-display";var ya=i(65865);class _a extends oa{constructor(e){super(),this._handles=new D.Z,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return ia(this._graphicState,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=(0,n.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,Ci.Xd)(this._manipulator,((r,s,n,o,l)=>{const c=s.next((0,la._y)(l,t,i,a)).next((0,Ci.AN)()).next((0,Ci.zh)());e(r,c,n,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new ya.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}class ba{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class xa{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Ma{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let wa=class extends(u.Z.EventedMixin(v.m)){constructor(e){super(e),this.graphics=new Si.Z,this.enableZ=!0,this.type="move-3d",this._toolHandles=new D.Z,this._handles=new D.Z}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators()}destroy(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}reset(){}_refreshManipulators(){this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>0===(0,Ai.P)(e))).map((e=>new Sa(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this._handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new _a({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this._handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this._handles.add(t.manipulationXY.createDragPipeline(((t,i,a)=>this.buildDragEventPipeline(t,i,a,e))))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new fa({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?fa.radiusForSymbol(e[0].graphic.symbol):ki});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this._handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this.updateMoveManipulation(e);for(const t of e)this._handles.add([t.state.on("changed",i),t.state.watch("displaying",i)]);const a=e[e.length-1];this._handles.add(a.state.on("changed",(()=>this.updateMoveManipulationAngle(a)))),this._handles.add(t.createDragPipeline(((t,i,a)=>{this.buildDragEventPipeline(t,i,a,e)}),(0,g.RL)(a.graphic),(0,n.Wg)(a.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const i=t.graphic,a=Wi({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>(0,_.kB)()});t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof pi&&this._handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this.updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this.updateMoveManipulation(e)))]),this._handles.add(a)}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>aa(e.graphic.geometry)}updateMoveManipulation(e){const t=(0,ai.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const r=this._moveManipulation;for(const r of e){if(!r.state.displaying)continue;const e=r.state.graphic;this.enableZ&&Oi(e)&&(a=!0);const s=r.geometryRepresentation instanceof pi&&!r.state.isDraped?r.geometryRepresentation.attachmentOrigin:(0,Pi.du)(this.view,e);(0,n.pC)(s)&&(t.x+=s.x,t.y+=s.y,t.z+=s.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}buildDragEventPipeline(e,t,i,a){const r=[],s=[];let n=null,o=null;const l=()=>{for(const e of r)e.dragging=!1;r.length=0,s.length=0,n=null,o=null,this._moveManipulation.interactive=!0};t.next((t=>{if("start"===t.action){r.length=0,s.length=0;for(const t of a)t.dragging||!t.manipulationXY.hasManipulator(e)&&t.manipulationXY.grabbing||(r.push(t),s.push(t.graphic),t.dragging=!0);if(0!==s.length&&(this._moveManipulation.interactive=!1,n=(0,Ci.oq)(s),o=(0,Ci.QY)(s),this.emit("graphic-move-start",new ba(s)),this.destroyed))return null}return 0!==s.length?t:null})).next((e=>n(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,r=i.y-t.y;if(this.emit("graphic-move",new xa(a,r,s)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Ma(s)),this.destroyed)return null;l()}})),i.next((e=>o(e))).next((()=>{if(this.emit("graphic-move-stop",new Ma(s)),this.destroyed)return null;l()}))}};(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],wa.prototype,"view",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],wa.prototype,"graphics",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],wa.prototype,"enableZ",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],wa.prototype,"type",void 0),wa=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],wa);class Sa{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Ei({graphic:e})}get graphic(){return this.state.graphic}}var Ca=i(91700),Pa=i(97450),Aa=i(46896),Oa=i(80532),Ea=i(49659),Da=i(92078);let Ta=class extends u.Z.EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=(0,Pi.EA)(ii.colorToVec4(ii.reshapeManipulators.vertex.color),ii.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,Pi.qJ)(ii.colorToVec4(ii.reshapeManipulators.vertex.outlineColor),ii.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,Pi.qJ)(ii.colorToVec4(ii.reshapeManipulators.vertex.hoverOutlineColor),ii.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,Pi.EA)(ii.colorToVec4(ii.reshapeManipulators.edge.color),ii.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,Pi.qJ)(ii.colorToVec4(ii.reshapeManipulators.edge.outlineColor),ii.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=(0,Pi.EA)(ii.colorToVec4(ii.reshapeManipulators.selected.color),ii.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,Pi.qJ)(ii.colorToVec4(ii.reshapeManipulators.selected.outlineColor),ii.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,Pi.qJ)(ii.colorToVec4(ii.reshapeManipulators.selected.hoverOutlineColor),ii.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new D.Z,this._manipulatorHandles=new D.Z,this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new Da.n,this._snappingPipelineHandle=new Da.n,this._vertexLaserLineVisualElement=null,this.snappingManager=new Oa.N({view:e.tool.view,options:e.tool.snappingOptions,visualizer:new Vt})}initialize(){const e=new Ei({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy(),this.snappingManager.destroy()}get inputGeometry(){return(0,n.pC)(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=(0,n.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,n.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),(0,n.Wi)(e))return;this._reshapeHelper=new Va(Pa.XE.fromGeometry(e,this.view.viewingMode),e.type);const t=(0,g.RL)(this.graphic);for(const e of this._reshapeHelper.editGeometry.components){for(const i of e.vertices)this._createPerVertexManipulator(i,t);for(const i of e.edges)this._createPerVertexManipulator(i,t)}this._createGraphicMoveManipulators(t)}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;const i=[],a=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),r=1===e&&a,s=(0,n.Wg)(this._reshapeHelper);for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&(e.manipulator.grabbing||r&&!e.manipulator.selected||((0,n.Wg)(s).moveVertices([e.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(e.handle.pos),this._updateManipulatorPosition(e)));if(0===i.length)return;let o=0;for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&o++;if(this.outputGeometry=s.geometry,i.length===o){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)za(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(!t&&!i&&!a)return;const r=[];for(const t of this._manipulatorInfos)za(t)&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&r.push(t);const s=(0,n.Wg)(this._reshapeHelper);for(const e of r)s.moveVertices([e.handle],t,i,a);this.outputGeometry=s.geometry;for(const e of r)this._updateManipulatorPosition(e);this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new _a({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,t,i)=>{t.next((e=>this._trackNumDragging(e))).next((e=>{this._perGraphicManipulatorDragAction(0,e)})),i.next(this._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click"),e.stopPropagation()}))]))),this._moveManipulation=new fa({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Oi(this.graphic),snapToScene:!1,radius:fa.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click"),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=(0,n.Wg)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline(((t,i,a,r)=>{i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action){const t=this._manipulatorInfos.filter((e=>za(e)&&e.manipulator.selected));if(1===e.manipulatorType&&1===t.length)return{...e,info:t[0]}}return{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:a,snappingManager:this.snappingManager,snappingContext:new Ea.N({geometry:(0,n.Wg)(this._reshapeHelper),elevationInfo:e,pointer:r})}),this._snappingPipelineHandle.next).next((0,Ci.AN)()).next((e=>{this._perGraphicManipulatorDragAction(1,e)})),a.next(this._cancelDragOperation())}),e,t),(0,Ct.init)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),(0,Ct.init)(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this._handles.remove(e)}))]),this._updateMoveManipulationPosition();const i=Wi({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){(0,n.pC)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=i.visualElement instanceof pi?i.visualElement:null,(0,n.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createPerVertexManipulator(e,t=(0,g.RL)(this.graphic)){if((0,n.Wi)(this._vertexManipulatorGeometry)||(0,n.Wi)(this._vertexManipulatorOutlineGeometry)){const e=ii.reshapeManipulators.vertex,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._vertexManipulatorGeometry=G.Z.createSphereGeometry(a,16,16);const r=(t+e.outlineSize)/i;this._vertexManipulatorOutlineGeometry=G.Z.createSphereGeometry(r,16,16)}if((0,n.Wi)(this._edgeManipulatorGeometry)||(0,n.Wi)(this._edgeManipulatorOutlineGeometry)){const e=ii.reshapeManipulators.edge,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._edgeManipulatorGeometry=G.Z.createSphereGeometry(a,16,16);const r=(t+e.outlineSize)/i;this._edgeManipulatorOutlineGeometry=G.Z.createSphereGeometry(r,16,16)}const i=new Di.Z({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Ha.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Ha.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Ha.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Ha.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Ha.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Ha.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Ha.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(i,e,t);const a="edge"===e.type?{manipulator:i,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:i,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(a),this.manipulators.add(i),this._updateManipulatorPosition(a),"edge"===a.type){const e=this._getManipulatorInfoFromHandle(a.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(a))),t=this._getManipulatorInfoFromHandle(a.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(a)));a.locationUpdateHandle=(0,_.AL)([e,t]),this._manipulatorHandles.add(a.locationUpdateHandle,i)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(i,!0),i);const r=(0,Ci.Xd)(i,((e,i,r,s)=>{i.next((e=>this._trackNumDragging(e))).next((e=>Ga(a)?{...e,info:this._splitEdgeManipulator(a)}:{...e,info:a})).next((0,Ci.kY)(this.view,e.elevationAlignedLocation)).next((0,la.VG)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:r,snappingManager:this.snappingManager,snappingContext:new Ea.N({geometry:(0,n.Wg)(this._reshapeHelper),elevationInfo:t,pointer:s})}),this._snappingPipeline.next).next((0,Ci.AN)()).next((e=>{this._perVertexManipulatorDragAction(e)})),r.next(this._cancelDragOperation())}));return this._manipulatorHandles.add(r,i),this._manipulatorHandles.add([i.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,a))),i.events.on("select-changed",(()=>{a.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),i}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){const e=(0,n.pC)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,this.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Ha.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=ii.reshapeManipulators.vertex.size/2+ii.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=Ha.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=ii.reshapeManipulators.edge.size/2+ii.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=(0,n.Wg)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,Ia),e.manipulator.grabbing&&(0,n.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if((0,n.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=i.location,s=a.location,n=.5,o=r.x+n*(s.x-r.x),l=r.y+n*(s.y-r.y),c=r.hasZ&&s.hasZ?0:void 0;e.manipulator.location=(0,ai.Tx)(o,l,c,t.geometry.spatialReference)}else{const r=i.elevationAlignedLocation,s=a.elevationAlignedLocation,n=.5,o=r.x+n*(s.x-r.x),l=r.y+n*(s.y-r.y),c=r.hasZ&&s.hasZ?r.z+n*(s.z-r.z):void 0;e.manipulator.elevationAlignedLocation=(0,ai.Tx)(o,l,c,t.geometry.spatialReference)}}}_splitEdgeManipulator(e){const t=(0,n.Wg)(this._reshapeHelper),i=(0,n.Wg)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const a=e;a.handle=i,a.type="vertex";const r=(0,g.RL)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(a),this._updateSelection(e.manipulator);const s=this._updateEventState(2),o=t.editGeometry.coordinateHelper.toArray(a.handle.pos),l=t.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:(0,n.Wg)(i.index)}],added:o}),s&&this._updateEventState(0),a}_updateMoveManipulationPosition(){const e=ne.WM.get();(0,x.s)(e,0,0,0);let t=0,i=!1,a=null,r=null;for(const s of this._manipulatorInfos)za(s)&&(s.manipulator.selected?(t++,(0,x.b)(e,e,s.manipulator.renderLocation),(0,n.Wi)(a)||s.selectedIndex>a.selectedIndex?(r=a,a=s):((0,n.Wi)(r)||s.selectedIndex>r.selectedIndex)&&(r=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Oi(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Oi(this.graphic)}if(0!==t){let e=0;if((0,n.pC)(a)){const t=a.handle.pos,i=(0,n.pC)(r)?r.handle.pos:a.handle.left&&a.handle.left.left?a.handle.left.left.pos:null,s=!(0,n.pC)(r)&&a.handle.right&&a.handle.right.right?a.handle.right.right.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=Ra(i,t):s&&(e=Ra(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=Bi}else this._moveManipulation.angleDeferred=()=>aa((0,n.Wg)(this.graphic.geometry)),this._moveManipulation.radius=fa.radiusForSymbol(this.graphic.symbol);0!==t&&i?((0,x.a)(e,e,1/t),Ia.spatialReference=(0,n.Wg)(this._reshapeHelper).geometry.spatialReference,Ia.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Ia),this._moveManipulation.elevationAlignedLocation=Ia):(0,n.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,n.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,Pi.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=(0,n.Wg)(this._reshapeHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=(0,n.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createPerVertexManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:(0,n.Wg)(e.index)}}));this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Ga(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Ra(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function za(e){return"vertex"===e.handle.type}function Ga(e){return"edge"===e.handle.type}(0,r._)([(0,c.Cb)({constructOnly:!0})],Ta.prototype,"tool",void 0),(0,r._)([(0,c.Cb)()],Ta.prototype,"inputGeometry",null),(0,r._)([(0,c.Cb)()],Ta.prototype,"outputGeometry",void 0),(0,r._)([(0,c.Cb)()],Ta.prototype,"snappingManager",void 0),Ta=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ta);const Ia=(0,ai.Tx)(0,0,null,null);var Ha;!function(e){e.Vertex=16,e.Edge=32}(Ha||(Ha={}));class Va extends Aa.hE{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}let Ua=class extends(u.Z.EventedMixin(v.m)){constructor(e){super(e),this._handles=new D.Z,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingOptions=new m.g}destroy(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;0!==(0,Ca.P)(this.graphic)||!(0,n.pC)(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==(0,Ca.P)(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){(0,n.Wi)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new Ta({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(()=>this.emit("immediate-click"))),(0,Ct.init)(this,"graphic",(()=>{this._updateGraphic()}),!0)])}beforeUndo(){this._reshapeOperation.snappingManager.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}};(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"view",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0})],Ua.prototype,"graphic",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"enableZ",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"enableMoveGraphic",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],Ua.prototype,"type",void 0),(0,r._)([(0,c.Cb)()],Ua.prototype,"snappingOptions",void 0),Ua=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Ua);var Fa,Wa=i(74386);!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(Fa||(Fa={}));class La{constructor(e){this.mode=null,this._handles=new D.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new u.Z,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>(0,n.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._scaleRotateDragData.scale:1,this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}destroy(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,Wa.A)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,2)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=(0,Ci.Xd)(e,((e,i,a)=>{this._scaleRotateDragData=null;const r=function(e,t){const i=e.allLayerViews.find((e=>e.layer===t.layer));if((0,n.Wi)(t.symbol))return null;const a=t.symbol;return{symbolLayers:a.symbolLayers.map((e=>{let t=null,r=null;return"object"===e.type&&(t=e.heading),r=i.getSymbolLayerSize(a,e),{heading:t,size:r}})).toArray()}}(this.tool.view,t);if((0,n.Wi)(r))return this.updateDragState(),null;const s={mode:"none",origin:(0,E.a)(e.renderLocation),angle:0,startAngle:this.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};this._scaleRotateDragData=s,this.updateDragState();const o=ne.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next((0,la._N)(this.tool.view,z.yC.fromPositionAndNormal(e.renderLocation,o))).next((e=>{const i=z.yC.normal(e.plane),a=(0,Pi.Gd)(e.renderStart,e.renderEnd,s.origin,i),r=ri.Q4.shortestSignedDiff(s.angle,a);s.angleDir=(0,ie.uZ)(s.angleDir+r,-.3,.3),s.angle=a;const o=function(e,t){const i=(0,x.f)(ne.WM.get(),t.renderStart,e.origin),a=(0,x.f)(ne.WM.get(),t.renderEnd,e.origin),r=(0,x.l)(i),s=(0,x.l)(a);return 0===r?0:s/r}(s,e),l=o-s.scale;if(s.scaleDir=(0,ie.uZ)(s.scaleDir+l,-.2,.2),s.scale=o,this.onScaleChanged(),"none"===s.mode){const i=this.mode||function(e,t,i,a){const{renderStart:r,renderEnd:s}=e,n=ka(r,a,ne.WM.get()),o=ka(s,a,ne.WM.get());if((0,x.h)(n,o)<100)return null;const l=(0,x.f)(ne.WM.get(),r,i),c=(0,x.c)(ne.WM.get(),l,t),h=r,u=(0,x.b)(ne.WM.get(),h,c),p=ka(i,a,ne.WM.get()),d=n,g=ka(u,a,ne.WM.get()),m=(0,x.f)(ne.WM.get(),g,d),f=(0,x.f)(ne.WM.get(),n,p),v=z.kx.wrap(d,m),y=z.kx.wrap(p,f);return z.kx.distance2(v,o)<z.kx.distance2(y,o)?"rotate":"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if((0,n.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,scale:s.scale})}s.mode=i}}if(this.updateDragState(),(0,n.pC)(t.symbol)){const e=t.symbol.clone();let i=0,a=1;switch(s.mode){default:case"none":break;case"scale":a=s.scale;break;case"rotate":i=s.angle}this.applySymbolData(e,s.startSymbolData,i,a),t.symbol=e,this.updateManipulatorTransform()}switch(e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,scale:s.scale})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:s.angle});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,scale:s.scale});break;default:case"none":}}"end"===e.action&&(this.startAnimation(Ba(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),a.next((0,Ci.nh)(t)).next((()=>{if((0,n.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:this._scaleRotateDragData.startAngle});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}this.startAnimation(Ba(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,Ct.init)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e)),this.tool.graphicState.on("changed",(()=>(0,Pi.u2)(this.tool.view,this.ringManipulator,t)))]),(0,Pi.u2)(this.tool.view,this.ringManipulator,t)}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Fa.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Fa.Unlocked,!((0,n.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,n.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Fa.ScaleIn|Fa.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Fa.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Fa.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Fa.RotateLeft|Fa.RotateRight,!1),this.ringManipulator.updateStateEnabled(Fa.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Fa.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Fa.ScaleIn|Fa.ScaleOut|Fa.RotateLeft|Fa.RotateRight,!1)}updateManipulatorTransform(){const e=(0,oe.i)(ne.MP.get()),t=this.tool.symbolRotationAngle;(0,oe.r)(e,e,t,(0,E.f)(0,0,1));const i=this.getScale(),a=(0,oe.p)(ne.MP.get(),(0,x.s)(ne.WM.get(),i,i,i)),r=(0,oe.i)(ne.MP.get());(0,oe.m)(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){const e=(e,t,i)=>{const a=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<r+1;s++){const n=e+s*(t-e)/r;a.push((0,E.f)(i*Math.cos(n),i*Math.sin(n),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>G.Z.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(qi),r=i(a,24),s={left:[],right:[]},n=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-Zi,o=a+r,l=a+Math.PI/2-r,c=e(o,l,190),h=i(c,9);n.push(c),n.push(e(o,l,201)),s.left.push(h),s.right.push(h);for(let e=0;e<2;e++){const t=0===e,i=(0,N.c)();if(t){(0,oe.s)(i,i,[1,-1,1]),(0,oe.r)(i,i,-o,[0,0,1]);const e=Math.round(.2*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{(0,oe.r)(i,i,l,[0,0,1]);const e=Math.round(.8*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const a=G.Z.createExtrudedTriangle(60,0,23,.5);G.Z.transformInPlace(a,i),(t?s.left:s.right).push(a)}}const o=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-ji,s=a+r,n=a+Math.PI/2-r,l=e(s,n,213);o.push(i(l,9))}const l=t(190),c=t(213),h=i(l,9),u=i(c,9),p=t(130),d=t(107),m=i(p,9),f=i(d,9),v=this.createMaterial(),y=this.createMaterial(.66),_=this.createMaterial(.5),b=this.createMaterial(.33);let x=[{geometry:r,material:v,stateMask:Fa.DelayedFocused},{geometry:r,material:_,stateMask:0}];this.mode&&"scale"!==this.mode||(x=x.concat([{geometry:o,material:v,stateMask:Fa.DelayedFocused|Fa.Unlocked},{geometry:h,material:y,stateMask:Fa.DelayedFocused|Fa.ScaleIn},{geometry:u,material:b,stateMask:Fa.DelayedFocused|Fa.ScaleIn},{geometry:m,material:y,stateMask:Fa.DelayedFocused|Fa.ScaleOut},{geometry:f,material:b,stateMask:Fa.DelayedFocused|Fa.ScaleOut}])),this.mode&&"rotate"!==this.mode||(x=x.concat([{geometry:s.right,material:v,stateMask:Fa.DelayedFocused|Fa.Unlocked},{geometry:s.left,material:v,stateMask:Fa.DelayedFocused|Fa.RotateLeft},{geometry:s.right,material:v,stateMask:Fa.DelayedFocused|Fa.RotateRight}]));const M=[a,...n];return new Di.Z({view:this.tool.view,renderObjects:x,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,g.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:M,direction:(0,E.f)(0,0,1)}})}createMaterial(e=1){const t=[...Li,e];return new Gt.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}applySymbolData(e,t,i,a){e.symbolLayers.forEach(((e,r)=>{const{heading:s,size:o}=t.symbolLayers[r];"object"===e.type&&(e.heading=((0,n.pC)(s)?s:0)-(0,Qi.a)(i),(0,n.pC)(o)&&"width"in o&&(o.width=this.enforceNonZeroSize(o.width),o.height=this.enforceNonZeroSize(o.height),o.depth=this.enforceNonZeroSize(o.depth),e.width=o.width*a,e.depth=o.depth*a,e.height=o.height*a))}))}enforceNonZeroSize(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}get test(){return{ringManipulator:this.ringManipulator}}}function ka(e,t,i){const a=t.projectToRenderScreen(e,(0,j.So)(qa)),r=t.renderToScreen(a,Za);return(0,x.s)(i,r[0],r[1],0)}function Ba(e,t){let i=null,a=1;const r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const qa=(0,E.c)(),Za=(0,j.s1)();let ja=class extends(u.Z.EventedMixin(v.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.handles=new D.Z,this.scaleRotate=null}initialize(){if(this.graphicState=new Ei({graphic:this.graphic}),this.moveManipulation=new fa({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Oi(this.graphic),radius:fa.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>e.stopPropagation()))))),this.moveManipulation.elevationInfo=(0,g.RL)(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,s={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",s);break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new La({tool:this,mode:e}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([Wi({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>(0,_.kB)()}),this.graphic.watch("symbol",(()=>this.updateMoveAngle())),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),(0,n.pC)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Oi(this.graphic)}))}destroy(){this.handles.destroy(),this.moveManipulation.destroy(),(0,n.pC)(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get symbolRotationAngle(){const e=this.graphic.symbol;if(e){const t=e.symbolLayers.find((e=>"object"===e.type)),i=t&&t.heading||0;return(0,Qi.t)(-i)}return 0}reset(){}onDetach(){(0,n.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){(0,n.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if((0,n.Wi)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<Ni?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}onGeometryChanged(){(0,Pi.u2)(this.view,this.moveManipulation,this.graphic)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:(0,n.pC)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ja.prototype,"view",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ja.prototype,"graphic",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ja.prototype,"enableZ",void 0),(0,r._)([(0,c.Cb)()],ja.prototype,"enableRotation",void 0),(0,r._)([(0,c.Cb)()],ja.prototype,"enableScaling",void 0),(0,r._)([(0,c.Cb)({value:!1})],ja.prototype,"snapToScene",null),(0,r._)([(0,c.Cb)({readOnly:!0})],ja.prototype,"type",void 0),ja=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ja);var Na=i(25026),Xa=(i(94588),i(61106)),Qa=(i(36348),i(69987)),Ya=(i(2847),i(12608)),$a=i(26701),Ka=i(6048),Ja=i(38391),er=i(31343);class tr extends Se.A{constructor(e,t){super(e,t),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=tr.shader.get(),i=this.configuration,a=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new Ae.Z(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Pe.i)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t,i){if(Ee.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e}if(this.configuration.stippleEnabled){const t=(0,n.pC)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const e=(0,n.Wg)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",e[0],e[1],e[2],e.length>3?e[3]:1)}4===this.configuration.output&&Ie.bA.bindOutputHighlight(e,this.program,i)}bindDraw(e){Ee.G.bindView(this.program,e),De.p.bindUniformsWithOrigin(this.program,this.configuration,e)}initializePipeline(){const e=this.configuration,t=(0,Oe.wK)(770,1,771,771),i=(t,i=null,a=null)=>(0,Oe.sm)({blending:i,depthTest:Ja.JN,depthWrite:a,colorWrite:Oe.BK,stencilWrite:e.sceneHasOcludees?Ja.s3:null,stencilTest:e.sceneHasOcludees?t?Ja.eD:Ja.RY:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,Oe.LZ),i(!1,e.transparent||e.stippleEnabled?t:null,Oe.LZ)):i(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}tr.shader=new we.J(er.N,(()=>i.e(9979).then(i.bind(i,49979))));class ir extends Ce.m{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.vertexColors=!1,this.transparent=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}(0,r._)([(0,Ce.o)({count:8})],ir.prototype,"output",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"sliceHighlightDisabled",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"vertexColors",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"transparent",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"stippleEnabled",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"stippleOffColorEnabled",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"stippleIntegerRepeatsEnabled",void 0),(0,r._)([(0,Ce.o)()],ir.prototype,"sceneHasOcludees",void 0);const ar=o.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class rr extends be.F5{constructor(e){super(e,or),this.techniqueConfig=new ir}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;const t=(0,n.pC)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&(0,n.pC)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,a,r,s,n,o,l){l?(0,_e.TT)(e,a,s,1,n):this.intersectLineGeometry(e,t,i,a,n)}intersectLineGeometry(e,t,i,a,r){if(!a.options.selectionMode||(0,de.PD)(t))return;if(!(0,pe.kG)(i))return void ar.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes.get("position").data,n=a.camera,o=yr;(0,X.c)(o,a.point);(0,x.s)(_r[0],o[0]-2,o[1]+2,0),(0,x.s)(_r[1],o[0]+2,o[1]+2,0),(0,x.s)(_r[2],o[0]+2,o[1]-2,0),(0,x.s)(_r[3],o[0]-2,o[1]-2,0);for(let e=0;e<4;e++)if(!n.unprojectFromRenderScreen(_r[e],br[e]))return;z.yC.fromPoints(n.eye,br[0],br[1],xr),z.yC.fromPoints(n.eye,br[1],br[2],Mr),z.yC.fromPoints(n.eye,br[2],br[3],wr),z.yC.fromPoints(n.eye,br[3],br[0],Sr);let l=Number.MAX_VALUE;for(let e=0;e<s.length-5;e+=3){if(lr[0]=s[e]+i[12],lr[1]=s[e+1]+i[13],lr[2]=s[e+2]+i[14],cr[0]=s[e+3]+i[12],cr[1]=s[e+4]+i[13],cr[2]=s[e+5]+i[14],z.yC.signedDistance(xr,lr)<0&&z.yC.signedDistance(xr,cr)<0||z.yC.signedDistance(Mr,lr)<0&&z.yC.signedDistance(Mr,cr)<0||z.yC.signedDistance(wr,lr)<0&&z.yC.signedDistance(wr,cr)<0||z.yC.signedDistance(Sr,lr)<0&&z.yC.signedDistance(Sr,cr)<0)continue;if(n.projectToRenderScreen(lr,pr),n.projectToRenderScreen(cr,dr),pr[2]<0&&dr[2]>0){(0,x.f)(hr,lr,cr);const e=n.frustum,t=-z.yC.signedDistance(e[4],lr)/(0,x.d)(hr,z.yC.normal(e[4]));(0,x.a)(hr,hr,t),(0,x.b)(lr,lr,hr),n.projectToRenderScreen(lr,pr)}else if(pr[2]>0&&dr[2]<0){(0,x.f)(hr,cr,lr);const e=n.frustum,t=-z.yC.signedDistance(e[4],cr)/(0,x.d)(hr,z.yC.normal(e[4]));(0,x.a)(hr,hr,t),(0,x.b)(cr,cr,hr),n.projectToRenderScreen(cr,dr)}else if(pr[2]<0&&dr[2]<0)continue;pr[2]=0,dr[2]=0;const t=z.KD.distance2(z.KD.fromPoints(pr,dr,fr),o);t<l&&(l=t,(0,x.g)(gr,lr),(0,x.g)(mr,cr))}const c=a.rayBeginPoint,h=a.rayEndPoint;if(l<4){let e=Number.MAX_VALUE;if(z.KD.closestLineSegmentPoint(z.KD.fromPoints(gr,mr,fr),z.KD.fromPoints(c,h,vr),ur)){(0,x.f)(ur,ur,c);const t=(0,x.l)(ur);(0,x.a)(ur,ur,1/t),e=t/(0,x.i)(c,h)}r(e,ur)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const a=i.get("position");return(0,me.qZ)(a,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?Ka.IM:Ka.wp;return(0,n.Wi)(this.params.stipplePattern)?new Ka.G_(e):new nr(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new sr(e):void 0}}class sr extends $a.Z{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(tr,this.material.getTechniqueConfig(this.output),this.technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this.output&&this._updateOccludeeState(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}class nr{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){(0,xe.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.writeAuxpos1(e,t,i,a)}writeAuxpos1(e,t,i,a){const r=i.getField("auxpos1",Ya.ct),s=t.indices.get("position"),n=t.vertexAttributes.get("position").data,o=e.transformation,l=r.typedBufferStride,c=r.typedBuffer;a*=l;for(let e=0;e<s.length;e+=2){const t=3*s[e],i=n[t],r=n[t+1],h=n[t+2],u=o[0]*i+o[4]*r+o[8]*h+o[12],p=o[1]*i+o[5]*r+o[9]*h+o[13],d=o[2]*i+o[6]*r+o[10]*h+o[14];for(let e=0;e<2;++e)c[a]=u,c[a+1]=p,c[a+2]=d,a+=l}}}const or={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...be.zh},lr=(0,E.c)(),cr=(0,E.c)(),hr=(0,E.c)(),ur=(0,E.c)(),pr=(0,j.J$)(),dr=(0,j.J$)(),gr=(0,E.c)(),mr=(0,E.c)(),fr=z.KD.create(),vr=z.KD.create(),yr=(0,E.c)(),_r=[(0,j.J$)(),(0,j.J$)(),(0,j.J$)(),(0,j.J$)()],br=[(0,E.c)(),(0,E.c)(),(0,E.c)(),(0,E.c)()],xr=z.yC.create(),Mr=z.yC.create(),wr=z.yC.create(),Sr=z.yC.create();i(20241);(0,s.Z)("mac"),Math.cos((0,ie.Vl)(45)),Math.cos((0,ie.Vl)(5));const Cr=[1,.5,0],Pr=[...Cr,1];var Ar=i(17126);class Or extends Se.A{initializeProgram(e){const t=Or.shader.get().build();return new Ae.Z(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Pe.i)}bindPass(e,t,i){Ee.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}bindDraw(e){Ee.G.bindView(this.program,e)}initializePipeline(){return(0,Oe.sm)({blending:(0,Oe.wK)(1,1,771,771),depthTest:{func:513},colorWrite:Oe.BK})}}Or.shader=new we.J(Ar.S,(()=>i.e(4166).then(i.bind(i,44166))));be.zh;var Er=i(88214),Dr=i(37450);class Tr extends Se.A{initializeProgram(e){const t=Tr.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Ae.Z(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Pe.i)}bindPass(e,t,i){Ee.G.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("viewportDim",[e.getViewport().width,e.getViewport().height]),(0,Er.C)(this.program,e,i))}bindDraw(e){Ee.G.bindView(this.program,e),De.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,a=3===e,r=2===e;return(0,Oe.sm)({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?zr:(0,Ue.$L)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(i.cullFace),depthTest:{func:(0,Ue.$x)(e)},depthWrite:a?i.writeDepth&&Oe.LZ:(0,Ue.Vc)(e),colorWrite:Oe.BK,stencilWrite:i.sceneHasOcludees?Ja.s3:null,stencilTest:i.sceneHasOcludees?t?Ja.eD:Ja.RY:null,polygonOffset:a||r?i.polygonOffset&&Rr:(0,Ue.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}Tr.shader=new we.J(Dr.I,(()=>i.e(9356).then(i.bind(i,49356))));const Rr={factor:1,units:1},zr=(0,Oe.if)(1,771);class Gr extends Ce.m{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}(0,r._)([(0,Ce.o)({count:8})],Gr.prototype,"output",void 0),(0,r._)([(0,Ce.o)({count:3})],Gr.prototype,"cullFace",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"sliceHighlightDisabled",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"transparent",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"polygonOffset",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"enableOffset",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"writeDepth",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"sceneHasOcludees",void 0),(0,r._)([(0,Ce.o)({count:4})],Gr.prototype,"transparencyPassType",void 0),(0,r._)([(0,Ce.o)()],Gr.prototype,"cullAboveGround",void 0);class Ir extends be.F5{constructor(e){super(e,Vr),this.supportsEdges=!0,this.techniqueConfig=new Gr}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<Ue.ve,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,r,s,n){(0,_e.Bw)(e,t,a,r,s,void 0,n)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new Hr(e):void 0}createBufferWriter(){return new Ka.G_(Ka.W1)}}class Hr extends ye.Z{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(Tr,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const Vr={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...be.zh};var Ur,Fr=i(82550),Wr=i(60263),Lr=i(24862),kr=i(58385);let Br=Ur=class extends kr.wq{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new Ur({position:(0,Fr.d9)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,n.pC)(this.position)&&(0,n.pC)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};(0,r._)([(0,c.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Br.prototype,"type",void 0),(0,r._)([(0,c.Cb)({type:Xa.Z}),(0,Lr.B)()],Br.prototype,"position",void 0),(0,r._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Lr.B)(),(0,Wr.p)((e=>ri.LU.normalize((0,l.q9)(e),0,!0)))],Br.prototype,"heading",void 0),(0,r._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Lr.B)(),(0,Wr.p)((e=>ri.LU.normalize((0,l.q9)(e),0,!0)))],Br.prototype,"tilt",void 0),(0,r._)([(0,c.Cb)({type:Number,nonNullable:!0}),(0,Lr.B)()],Br.prototype,"width",void 0),(0,r._)([(0,c.Cb)({type:Number,nonNullable:!0}),(0,Lr.B)()],Br.prototype,"height",void 0),Br=Ur=(0,r._)([(0,h.j)("esri.widgets.Slice.SlicePlane")],Br);o.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function qr(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:(0,x.b)(ne.WM.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:(0,x.b)(ne.WM.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:(0,x.f)(ne.WM.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:(0,x.f)(ne.WM.get(),e.origin,e.basis2),edge:t}}}function Zr(e,t,i){const a=i.projectToRenderScreen((0,x.b)(ne.WM.get(),e,t),(0,j.Wv)(ne.WM.get())),r=i.projectToRenderScreen((0,x.f)(ne.WM.get(),e,t),(0,j.Wv)(ne.WM.get()));return(0,x.p)((0,x.f)(a,a,r))}function jr(e){const t=(0,x.l)(e.basis1),i=(0,x.l)(e.basis2);return.3*Math.min(t,i)}function Nr(e){return jr(e)}function Xr(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Qr(e,t){const i=Xr(t),a=i?[(0,E.f)(1,0,0),(0,E.f)(0,0,0),(0,E.f)(0,1,0)]:[(0,E.f)(1,0,0),(0,E.f)(-1,0,0)],r=G.Z.createPolylineGeometry(a),s=[...Cr,1],n=i?4:1,o=2*n,l=e=>e>1?(e=>new I.U({color:s,width:e,renderOccluded:4}))(e):new rr({color:s,renderOccluded:4});return new Di.Z({view:e,renderObjects:[{geometry:r,material:l(n),stateMask:1},{geometry:r,material:l(o),stateMask:2}],collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4})}function Yr(e,t){return(0,Qa.b)(t,e.basis2,e.basis1)+Kr}const $r=16,Kr=(z.kx.create(),Math.PI/2);let Jr=class extends(u.Z.EventedMixin(v.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.inputState=null,this.type="transform-3d",this.handles=new D.Z,this.resizeManipulators=null,this.rotateManipulator=null,this.displayBoundsStart=z.Sh.create(),this.mapBounds=z.Sh.create(),this.displayBounds=z.Sh.create(),this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new Ei({graphic:this.graphic});const e=this.graphic.geometry;this.reshapeHelper=new Va(Pa.XE.fromGeometry(e,this.view.viewingMode),e.type),this.moveManipulation=new fa({tool:this,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Oi(this.graphic),snapToScene:this.snapToScene,radius:ki}),this.moveManipulation.elevationInfo=(0,g.RL)(this.graphic),this.handles.add(this._createMoveDragPipeline()),this.moveManipulation.angle=0,this.resizeManipulators=this.resizeHandles.map(((e,t)=>{const i=Qr(this.view,e);return i.events.on("grab-changed",(e=>{this._onResizeGrab(e,t)})),this.handles.add(this._createResizeDragPipeline(i)),i})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new St.x("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAQ3wAAEN8BdFVeMAAAArhQTFRF/34A/34A/20A/34A/30A/1UA/34AR3BM/34A/34A/30A/34A/3wA/30A/wAA/8mV//79/4AG/4AC/////4AA/34A//Xs/3EA/34A/30A/4AA/3gA/4AA//jx/4AA/34A/30A/3wA/30A/3QA/34A/4AA/+nT/30A/4QM/4MK//r2/59B/8+h//Hi/34A/4gT//fv/5Uu/9q4//r2/+TK/4wc//38/5Yv/34A/30A/4AA/7+A/+nU/4EI/34A/3wA//fu/9Gk/30A/9ex/34A//7+//jw/30A//z5/+fQ/9/B/4cR/5Mq//fv//38/82d//n0/+LG//37//Xt/30A/7Vt/40e/50//30A/34A/65h/6tZ/+DB/6VN/4sZ/7Bi//79/8+f/+LH/4AE/30A/6BC/9/A/5Al/+rX/4AA/8WN/4AA/7Zw/+3a/6hT/3wA/34A/3sA/3wA/4AA/3wA/3oA/4AA/4AA//Xt/6lW/8uX/5k0//Pn/719/+7d//Po/6BF/8+g//v2/8eR/5Qs/4AA/8WN/71+/30A//ny/+rV/8eP/+fQ//Tq/4AA/30A/7dy/34A/7Vv/+vY/8uZ/3sA/6ZR/4kX/+rW/6hS//v4/8mT/9Oo/9Oq//79/6NK/6JH/8eR/7Vu/+bN/5k3/9q2//Xs//37/8yb/34A/7p5//78//jx/+bN/7x7/7Nr/+/h/4QO/48j/61d//jw/508/9Wr/82b/65e/6xc/7h0/6BE/4AA/65g/30A/5w6/30A/6NL/+nU/4AA/8iT//Ll/3wA//Tp/9Km/9q2/+3c//v4/8OJ/3oA/9Cj//r1/7p2/6VP/+7d/+DE//z6/+LF//Hj//n0//r1/5o5/9av/+PH/+vZ/+XM//Po/6hV/928/8SL/9at/+7e/7p3/+zZ/+3b////JwwhsQAAAOd0Uk5TgH0Hb2oDUwB3fz9HKXgBtf6BgP4qYe0JdXYSEQjzOkU5RmYLawraL4OC9pK75kGF8IzI99OH/I1naD6q24J5SPC8YsRj/vIr+tfOhIvx/bj10fzvfKKIklpbnpvNloae/bnSgXCTzYrdBrFApN+ZUmUbVBpAGVIY7pq1juqp4euUuveyjCiwqi3z3LHY7CwzpFGj3rc4mIbcmPizvsD8lZSzo9aPx+77uE+n/PLVqKLlg4mc8ZHAt52cpZMCnTGQdJbaMrTnUOu9xuD5rzC89aaX4tD60Of09pDC0d7V6pnLsMHip9/g/7fLIQAAA8lJREFUWMOll/VbGzEYx0NpaWkLpQVW3GUbMHzYYMhgA7axMQeGbeiE4XN3d3d3d3d3d9/u31iba7nkLlfunr2/wPNN3k+TS/IKkPOYv1NTQ7y1wspKYR1vo3Ty55sHiGq9SmoLMLOVqhqFAiReAYBoAV4SAQB9FwXgNcUofXuAYBdg0RRr7C0B3HqAdi3djR+gtgMCLGUpD8C+OxBoKnsSQGYDBJuNjAuQDTOPRgogDJVxACvaBj+XCFmDPQvA7H+449sRAgi+OKAnM/KGomrhP9smRgWFhR0PejBrOIkwHwW4MecX15Wi3sWCIVEDKMY6ZIRwAHbuCAC5Px+NDpUxDhRuDv05CGcGcItRw98bp289RHGsdIuWRXhiBuhdGVFjWjNFsIeTcICLhwnQhdF090yTZ9J/DntGOzKEPkNwgpIGSJD3+9s815OifoVuyDVI6wrTwsxqVgX+NCUQ4IVIY9p+7W8hIp9ab1LHx2IEHwiQMsJYZrnRVdjUpGhaPoLHKCOgHhE+IZ/sO77fkAharsXUZgNABbBLxJz8C5xwjSZ4huMXGqA7qCiL+vIyoq+JMIZ17BNo/FNUS5ADf1v2DdPN/vZc8/NV9dfRrIFQCOiXjEb7QOAkPIx0pJ/HclRTg1HCAeA2BPTH7hJoEAEYnA8/Iyq1AD8RANANLqE3oowDI8UAzkLASkSxBgoxgCQImIsorsBKDGAnBGgQZaA4QAkElGEAUVs4CgGbsC2I+ojnIOAi9hFFHWM5BNzAjlFERgS6BUb/XicQqQ404XOKf/w5zwsYBBcQhEqJ2GPSji5/TVHZvIBqCFiNPyb0OX8oNU7ILLC4gPxI/DmjAQXEwClLcon+xalwtAjV4vGQBsbSSWCXluDfiX5JmdNR0dsAaESFIjqa5SRzowm9OmoPpraywjqIPU1PW3WS5d97qinnhXPCOpZYwDFTSO23CK0ytJrOtLzvCiGxSLDn8NicC/eG7jZJZ+6nmkP9FFJqQ5OrwfKYbNonuzIjZ3EWkyp2EJOrXI+Xt/N6UWR7dBD3v25O7/Kr+MDayUT/O9tZHzaYKXHSWUeet5Hj3lmj5S9x0CKLtqoZeI0ybf9gi0WWnJufdAWbF9Jn9+xm2gUd92aq8UJTRU5mcZciO5Fflje71L0LRBmn1EWKbSFGKLbllw8I96+TETsWX4Hutt58Lc8cQUkipSd/0+Xu3L6/s/v/tX3L2ms8PZQW9uGq9BDQ+tb4SMnuUp8aoc13s28Cu/lO8G4V0b0bLFCdaONHt/9+LYnqQL55/wAoaTsIDs69HgAAAABJRU5ErkJggg==",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){const i=new Ir({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=40,r=27*1.1,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new zt.Z([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},n=G.Z.createPolylineGeometry([[0,0,0],[13,0,0]]),o=G.Z.createPolylineGeometry([[0,0,0],[a-r,0,0]]),l=new rr({color:Pr,renderOccluded:4}),c=[{geometry:s(27),material:i,stateMask:1|$r},{geometry:n,material:l,stateMask:1|$r},{geometry:s(r),material:i,stateMask:2|$r},{geometry:o,material:l,stateMask:2|$r}];return new Di.Z({view:e,renderObjects:c,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:$r})}(this.view,this.rotateManipulatorTexture),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.calculateDisplayBounds(this.mapBounds),this.handles.add(Wi({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>(0,_.kB)()})),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle())),this.view.trackGraphicState(this.graphicState)]),this.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))})),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((t=>e(t,2))),e(this.rotateManipulator,2)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Oi(this.graphic)}))}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.moveManipulation.destroy(),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}updateMoveAngle(){if("local"===this.view.viewingMode||this.view.scale<Ni){const e=(0,x.E)(E.U,this.mapBounds.basis1)*Math.sign(this.mapBounds.basis1[1]);this.moveManipulation.angle=e}else this.moveManipulation.angle=0}onGeometryChanged(){(0,Pi.u2)(this.view,this.moveManipulation,this.graphic),this.updateMoveAngle(),((0,n.Wi)(this.inputState)||Na.Z.EDITING_RECALCULATE_MANIPULATORS_DURING_TRANSFORM)&&this.calculateDisplayBounds(this.mapBounds)}calculateMapBounds(){const e=this.graphic.geometry.extent;(0,x.s)(this.mapBounds.origin,e.center.x,e.center.y,0),(0,x.s)(this.mapBounds.basis1,e.width/2,0,0),(0,x.s)(this.mapBounds.basis2,0,e.height/2,0)}calculateDisplayBounds(e){const t=this.graphic.geometry,i=(0,Pi.du)(this.view,this.graphic),a=(0,n.pC)(i)?i.z:(0,gt.w7)(t.extent.center,this.view.elevationProvider,_t.fromElevationInfo((0,g.RL)(this.graphic)),this.view.renderCoordsHelper),r=(0,x.s)(this.displayBounds.origin,e.origin[0],e.origin[1],a),s=(0,x.b)(this.displayBounds.basis1,r,e.basis1),o=(0,x.b)(this.displayBounds.basis2,r,e.basis2);this.view.renderCoordsHelper.toRenderCoords(r,t.spatialReference,r),this.view.renderCoordsHelper.toRenderCoords(s,t.spatialReference,s),(0,x.f)(s,s,r),this.view.renderCoordsHelper.toRenderCoords(o,t.spatialReference,o),(0,x.f)(o,o,r),z.Sh.updateUnboundedPlane(this.displayBounds),this.updateManipulators()}_createMoveDragPipeline(){return this.moveManipulation.createDragPipeline(((e,t,i)=>{t.next((e=>{if("start"===e.action){const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};this.emit("graphic-translate-start",t)}return e})).next((0,Ci.AN)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.emit("graphic-translate-stop",t)}}))}),(0,g.RL)(this.graphic),this.reshapeHelper.geometry.spatialReference)}_moveDragUpdateGeometry(){return e=>{const t=[];for(const e of this.reshapeHelper.editGeometry.components)t.push(...e.vertices);const i="start"===e.action?0:1;return this.reshapeHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),(0,x.s)(this.mapBounds.origin,this.mapBounds.origin[0]+e.mapDeltaX,this.mapBounds.origin[1]+e.mapDeltaY,0),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onResizeGrab(e,t){if("end"===e.action&&(this.inputState=null,this.calculateDisplayBounds(this.mapBounds)),"start"!==e.action)return;const i=this._calculatePickRay(e.screenPoint),a=ne.WM.get();z.yC.intersectRay(this.displayBounds.plane,i,a)&&(z.Sh.copy(this.displayBounds,this.displayBoundsStart),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,E.a)(a),startMapBounds:z.Sh.copy(this.mapBounds)})}_createResizeDragPipeline(e){return(0,Ci.Xd)(e,((e,t,i)=>{const a=this.inputState;(0,n.Wi)(a)||"resize"!==a.type||t.next((0,la._N)(this.view,this.displayBounds.plane)).next(this._resizeDragUpdatePlane(a)).next(this._resizeDragUpdateGeometry(a))}))}_resizeDragUpdatePlane(e){return t=>(function(e,t,i,a,r,s){const n=(0,x.g)(ne.WM.get(),r.origin);(0,x.b)(n,n,(0,x.a)(ne.WM.get(),r.basis1,e.direction[0]<0?1:-1)),(0,x.b)(n,n,(0,x.a)(ne.WM.get(),r.basis2,e.direction[1]<0?1:-1));const o=(0,x.l)(r.basis1),l=(0,x.l)(r.basis2),c=(0,x.f)(ne.WM.get(),i,n),h=(0,x.f)(ne.WM.get(),t,n);let u=0,p=0;if(Xr(e)){const t=Nr(r),i=Nr(s);u=o-.5*e.direction[0]*(0,x.d)(r.basis1,h)/o,p=l-.5*e.direction[1]*(0,x.d)(r.basis2,h)/l;const a=i/t;u*=a,p*=a}const d=u+.5*e.direction[0]*(0,x.d)(r.basis1,c)/o,g=p+.5*e.direction[1]*(0,x.d)(r.basis2,c)/l,m=(0,x.a)(ne.WM.get(),r.basis1,d/o),f=(0,x.a)(ne.WM.get(),r.basis2,g/l);(d<=0||Zr(s.origin,m,a)<=1600)&&(0,x.g)(m,s.basis1),(g<=0||Zr(s.origin,f,a)<=1600)&&(0,x.g)(f,s.basis2);const v=(0,x.g)(ne.WM.get(),n);(0,x.b)(v,v,(0,x.a)(ne.WM.get(),m,e.direction[0]<0?-1:1)),(0,x.b)(v,v,(0,x.a)(ne.WM.get(),f,e.direction[1]<0?-1:1)),z.Sh.fromValues(v,m,f,s)}(this.resizeHandles[e.activeHandleIdx],e.startPoint,t.renderEnd,this.view.state.camera,this.displayBoundsStart,this.displayBounds),this.updateManipulators(),t)}_resizeDragUpdateGeometry(e){return t=>{const i=this.resizeHandles[e.activeHandleIdx],a=(0,X.l)(this.displayBounds.basis1)/(0,X.l)(this.displayBoundsStart.basis1),r=(0,X.l)(this.displayBounds.basis2)/(0,X.l)(this.displayBoundsStart.basis2),s=(0,x.g)((0,E.c)(),e.startMapBounds.origin);(0,x.D)(s,s,e.startMapBounds.basis1,-i.direction[0]),(0,x.D)(s,s,e.startMapBounds.basis2,-i.direction[1]);const n=(0,X.s)((0,ue.c)(),e.startMapBounds.basis1[0],e.startMapBounds.basis1[1]);(0,X.f)(n,n);const o=[];for(const e of this.reshapeHelper.editGeometry.components)o.push(...e.vertices);const l="start"===t.action?0:1;this.reshapeHelper.scaleVertices(o,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(s),n,a,r,l,1),(0,x.a)(this.mapBounds.basis1,e.startMapBounds.basis1,a),(0,x.a)(this.mapBounds.basis2,e.startMapBounds.basis2,r),(0,x.D)(this.mapBounds.origin,e.startMapBounds.origin,e.startMapBounds.basis1,Math.sign(i.direction[0])*(a-1)),(0,x.D)(this.mapBounds.origin,this.mapBounds.origin,e.startMapBounds.basis2,Math.sign(i.direction[1])*(r-1)),this.graphic.geometry=this.reshapeHelper.geometry}}_onRotateGrab(e){if("end"===e.action&&(this.inputState=null,this.calculateDisplayBounds(this.mapBounds)),"start"!==e.action)return;const t=function(e,t,i,a){const r=t.worldUpAtPosition(e.origin,ne.WM.get()),s=ne.WM.get();switch(i){case 1:(0,x.g)(s,r);break;case 2:(0,x.g)(s,e.basis1)}return z.yC.fromPositionAndNormal(e.origin,s,a)}(this.displayBounds,this.view.renderCoordsHelper,1,z.yC.create()),i=this._calculatePickRay(e.screenPoint),a=(0,E.c)();z.yC.intersectRay(t,i,a)&&(z.Sh.copy(this.displayBounds,this.displayBoundsStart),this.inputState={type:"rotate",rotatePlane:t,startPoint:a,startMapBounds:z.Sh.copy(this.mapBounds)})}_createRotateDragPipeline(e){return(0,Ci.Xd)(e,((e,t)=>{const i=this.inputState;i&&"rotate"===i.type&&t.next((0,la._N)(this.view,i.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(i)).next(this._rotateDragUpdatePlaneFromRotate()).next(this._rotateDragUpdateGeometry(i))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=z.yC.normal(e.rotatePlane),a=(0,Pi.Gd)(e.startPoint,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{const t=(0,oe.i)(ne.MP.get());(0,oe.r)(t,t,e.rotateAngle,e.rotateAxis);const i=(0,x.k)(ne.WM.get(),this.displayBoundsStart.basis1,t),a=(0,x.k)(ne.WM.get(),this.displayBoundsStart.basis2,t);return z.Sh.fromValues(this.displayBounds.origin,i,a,this.displayBounds),this.updateManipulators(),e}}_rotateDragUpdateGeometry(e){return t=>{const i=(0,x.g)((0,E.c)(),e.startMapBounds.origin),a=[];for(const e of this.reshapeHelper.editGeometry.components)a.push(...e.vertices);const r="start"===t.action?0:1;this.reshapeHelper.rotateVertices(a,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(i),t.rotateAngle,r,1),(0,x.F)(this.mapBounds.basis1,e.startMapBounds.basis1,E.Z,t.rotateAngle),(0,x.F)(this.mapBounds.basis2,e.startMapBounds.basis2,E.Z,t.rotateAngle),this.graphic.geometry=this.reshapeHelper.geometry}}_calculatePickRay(e){const t=z.kx.create(),i=(0,j.md)(e);return z.kx.fromScreen(this.view.state.camera,i,t),(0,x.n)(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;this.rotateManipulator.available=!0,this.resizeManipulators.forEach((e=>{e.available=!0}));const e=function(e,t){return(0,Pi.Aq)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,ne.MP.get());(function(e,t,i,a){const r=a.worldUpAtPosition(i.origin,ne.WM.get()),s=qr(i,0),n=(0,oe.i)(ne.MP.get());(0,oe.a)(n,n,s.edge*Math.PI/2),(0,oe.b)(n,n,-Yr(i,r)),(0,oe.m)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,a){const r=(0,x.l)(a.basis1),s=(0,x.l)(a.basis2),n=jr(a),o=Nr(a),l=(0,x.s)(ne.WM.get(),0,0,0);(0,x.b)(l,(0,x.a)(ne.WM.get(),a.basis1,t.direction[0]),(0,x.a)(ne.WM.get(),a.basis2,t.direction[1])),(0,x.b)(l,a.origin,l);let c=0,h=1;if(Xr(t))1===t.direction[0]&&-1===t.direction[1]?c=Kr:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;c=1===e?Kr:0,h=(1===e?s:r)-n}const u=(0,oe.i)(ne.MP.get());(0,oe.a)(u,u,c),(0,oe.s)(u,u,(0,x.s)(ne.WM.get(),h,h,h)),(0,oe.m)(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=l}(t,this.resizeHandles[i],e,this.displayBounds)}))}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Jr.prototype,"view",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Jr.prototype,"graphic",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Jr.prototype,"enableZ",void 0),(0,r._)([(0,c.Cb)()],Jr.prototype,"enableRotation",void 0),(0,r._)([(0,c.Cb)()],Jr.prototype,"enableScaling",void 0),(0,r._)([(0,c.Cb)({value:!1})],Jr.prototype,"snapToScene",null),(0,r._)([(0,c.Cb)()],Jr.prototype,"inputState",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],Jr.prototype,"type",void 0),Jr=(0,r._)([(0,h.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Jr)},76789:(e,t,i)=>{"use strict";i.d(t,{L:()=>s});var a=i(85461),r=i(91930);function s(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r.c),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(a.H`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?a.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:a.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?a.H`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:a.H`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(a.H`
    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }
    `)}function n(e,t,i,a=o){return a.screenLength=e.screenLength,a.perDistance=Math.tan(.5*t)/(.5*i),a.minWorldLength=e.minWorldLength,a.maxWorldLength=e.maxWorldLength,a}!function(e){e.bindUniforms=function(e,t,i){if(!t.verticalOffset)return;const a=n(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),r=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",a.screenLength*r,a.perDistance,a.minWorldLength,a.maxWorldLength)}}(s||(s={}));const o={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},73192:(e,t,i)=>{"use strict";i.d(t,{H:()=>r});var a=i(85461);function r(e){const t=a.H`
    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `,i=a.H`

    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},2489:(e,t,i)=>{"use strict";i.d(t,{R:()=>s});var a=i(85461),r=i(91930);function s(e,t){const i=e;i.include(r.c),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(a.H`
    struct ProjectHUDAux {
      vec3 posModel;
      vec3 posView;
      vec3 vnormal;

      float distanceToCamera;
      float absCosAngle;
    };
  `),i.vertex.code.add(a.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = sign(pointGroundDistance);

      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation
      // we take the absolute value because the sign that is dropped is
      // instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);

        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.isDraped||i.vertex.code.add(a.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `),i.vertex.code.add(a.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?a.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?a.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(a.H`
    bool testVisibilityHUD(vec4 posProj) {
      // For occlusion testing, use the nearest pixel center to avoid
      // subpixel filtering messing up the color we use to test for
      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);

      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written
      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)
      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts

      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here
      if (uRenderTransparentlyOccludedHUD > 0.5) {
        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if
        // uRenderTransparentlyOccludedHUD = 0.75
        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
      }

      // and visible pixels that are not occluded by semi-transparent geometry here
      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
    }
  `)}!function(e){e.bindUniforms=function(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)},e.bindVisibilityTexture=function(e,t,i){t.setUniform1i("hudVisibilityTexture",4),e.bindTexture(i.hudVisibilityTexture,4),e.setActiveTexture(0)}}(s||(s={}))},79431:(e,t,i)=>{"use strict";i.d(t,{A:()=>a,R:()=>n});var a,r=i(85461),s=i(86894);function n(e,t){const i=e;t.multipassGeometryEnabled&&e.include(s.S),i.vertex.code.add(r.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?r.H`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    }
    else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),i.fragment.uniforms.add("color","vec4"),i.fragment.code.add(r.H`
  void main() {
    gl_FragColor = color;
  }
  `)}!function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(a||(a={}))},86894:(e,t,i)=>{"use strict";i.d(t,{d:()=>n,S:()=>s});var a=i(85461),r=i(4071);function s(e){e.vertex.include(r.S),e.vertex.uniforms.add("geometryDepthTexture","sampler2D"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(a.H`
    //Compare the linearized depths of the vertex and the geometry in the scene. If vertex is behind geometry, don't draw it.
    bool geometryDepthTest(vec2 pos, float vertexDepth){

      float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
      if(vertexDepth < (geometryDepth - 1.0)){
        return true;
      }
      return false;
    }
  `)}function n(e,t,i){i.multipassGeometryEnabled&&(e.setUniform1i("geometryDepthTexture",i.geometryLinearDepthTextureUnit),t.bindTexture(i.geometryLinearDepthTexture,i.geometryLinearDepthTextureUnit))}},91930:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});var a=i(85461),r=i(30090);function s(e){e.vertex.code.add(a.H`
    float screenSizePerspectiveMinSize(float size, vec4 factor) {
      float nonZeroSize = 1.0 - step(size, 0.0);

      return (
        factor.z * (
          1.0 +
          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding
          nonZeroSize *
          2.0 * factor.w / (
            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1
          )
        )
      );
    }
  `),e.vertex.code.add(a.H`
    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
      return absCosAngle * absCosAngle * absCosAngle;
    }
  `),e.vertex.code.add(a.H`
    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
      return vec4(
        min(params.x / (distanceToCamera - params.y), 1.0),
        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
        params.z,
        params.w
      );
    }
  `),e.vertex.code.add(a.H`
    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
    }
  `),e.vertex.code.add(a.H`
    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorFloat(
        size,
        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
      );
    }
  `),e.vertex.code.add(a.H`
    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
    }
  `),e.vertex.code.add(a.H`
    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
    }
  `)}!function(e){e.bindUniforms=function(e,t){if(t.screenSizePerspective){(0,r.bj)(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;(0,r.bj)(i,e,"screenSizePerspectiveAlignment")}}}(s||(s={}))},82976:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var a=i(59472),r=i(68397),s=i(26701);class n extends s.Z{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquireIfNotUndefined(this._textureId),this._textureNormal=this._acquireIfNotUndefined(e.normalTextureId),this._textureEmissive=this._acquireIfNotUndefined(e.emissiveTextureId),this._textureOcclusion=this._acquireIfNotUndefined(e.occlusionTextureId),this._textureMetallicRoughness=this._acquireIfNotUndefined(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))}bindTexture(e,t){(0,a.pC)(this._texture)&&(t.setUniform1i("tex",r.G.DIFFUSE),e.bindTexture(this._texture.glTexture,r.G.DIFFUSE)),(0,a.pC)(this._textureNormal)&&(t.setUniform1i("normalTexture",r.G.NORMAL),e.bindTexture(this._textureNormal.glTexture,r.G.NORMAL)),(0,a.pC)(this._textureEmissive)&&(t.setUniform1i("texEmission",r.G.EMISSION),e.bindTexture(this._textureEmissive.glTexture,r.G.EMISSION)),(0,a.pC)(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",r.G.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,r.G.OCCLUSION)),(0,a.pC)(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",r.G.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,r.G.METALLIC_ROUGHNESS))}bindTextureScale(e,t){const i=(0,a.pC)(this._texture)&&this._texture.glTexture;i&&i.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",i.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquireIfNotUndefined(e){if(!(0,a.Wi)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_releaseIfNotUndefined(e){(0,a.Wi)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}const o=n},43473:(e,t,i)=>{"use strict";i.d(t,{x:()=>T});var a=i(94588),r=i(6962),s=i(59472),n=i(32656),o=i(10923),l=i(39105),c=i(35470),h=i(33655),u=i(4094),p=i(49326),d=i(56469),g=i(41419),m=i(6091),f=i(8634),v=i(57319),y=i(10346),_=i(84570),b=i(12973);let x,M=null,w=null;async function S(){return(0,s.Wi)(w)&&(w=function(){if((0,s.Wi)(x)){const e=e=>(0,b.V)(`esri/libs/basisu/${e}`);x=i.e(3886).then(i.bind(i,33886)).then((function(e){return e.b})).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return x}(),M=await w),w}const C=i(36544).Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function P(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const A=P("DXT1"),O=P("DXT3"),E=P("DXT5");function D(e,t){const i=new Int32Array(e,0,31);if(542327876!==i[0])return C.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return C.error("Unsupported format, must contain a FourCC code"),null;const a=i[21];let r,s;switch(a){case A:r=8,s=33776;break;case O:r=16,s=33778;break;case E:r=16,s=33779;break;default:return C.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(a)),null}let n=1,o=i[4],l=i[3];0==(3&o)&&0==(3&l)||(C.warn("Rounding up compressed texture size to nearest multiple of 4."),o=o+3&-4,l=l+3&-4);const c=o,u=l;let p,d;131072&i[2]&&!1!==t&&(n=Math.max(1,i[7])),1===n||(0,h.wt)(o)&&(0,h.wt)(l)||(C.warn("Ignoring mipmaps of non power of two sized compressed texture."),n=1);let g=i[1]+4;const m=[];for(let t=0;t<n;++t)d=(o+3>>2)*(l+3>>2)*r,p=new Uint8Array(e,g,d),m.push(p),g+=d,o=Math.max(1,o>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:m},internalFormat:s,width:c,height:u}}class T extends p.c{constructor(e,t){super(),this.data=e,this.type=4,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new c.Z,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=T.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;(0,s.Wi)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){(0,o.jc)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){(0,o.HK)(e.src)||(0,o.jc)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if((0,s.Wi)(e))return 0;if((0,r.eP)(e)||(0,r.lq)(e))return t.encoding===T.BASIS_ENCODING?function(e){if((0,s.Wi)(M))return e.byteLength;const t=new M.BasisFile(new Uint8Array(e));if(t.getNumImages()<1)return 0;const i=t.getNumLevels(0),a=t.getHasAlpha(),r=t.getImageWidth(0,0),n=t.getImageHeight(0,0);t.close(),t.delete();const o=(0,v.RG)(a?37496:37492),l=(4**i-1)/(3*4**(i-1));return Math.ceil(r*n*o*l)}(e):e.byteLength;const{width:i,height:a}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?T.getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*a*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){const t=this.params.mipmap&&!this.params.disableAnisotropy;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:t?e.parameters.maxMaxAnisotropy:void 0}}load(e,t){if((0,s.pC)(this.glTexture))return this.glTexture;if((0,s.pC)(this.loadingPromise))return this.loadingPromise;const i=this.data;return(0,s.Wi)(i)?(this.glTexture=new f.Z(e,this.createDescriptor(e),null),e.bindTexture(this.glTexture,0),this.glTexture):"string"==typeof i?this.loadFromURL(e,t,i):i instanceof Image?this.loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(e,i,t):((0,r.eP)(i)||(0,r.lq)(i))&&this.params.encoding===T.DDS_ENCODING?this.loadFromDDSData(e,i):((0,r.eP)(i)||(0,r.lq)(i))&&this.params.encoding===T.BASIS_ENCODING?this.loadFromBasis(e,i):(0,r.lq)(i)?this.loadFromPixelData(e,i):(0,r.eP)(i)?this.loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||(0,s.Wi)(this.glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if((0,s.pC)(this.powerOfTwoStretchInfo)){const{framebuffer:i,vao:a,sourceTexture:r}=this.powerOfTwoStretchInfo;r.setData(this.data),this.drawStretchedTexture(e,t,i,a,r,this.glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:a}=this.glTexture.descriptor;e!==i||t!==a?this.glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,a),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=function(e,t,i,a){const{textureData:r,internalFormat:s,width:n,height:o}=D(i,a);t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o;const l=new f.Z(e,t,r);return e.bindTexture(l,0),l}(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture,0),this.glTexture}loadFromBasis(e,t){return this.loadAsync((()=>async function(e,t,i){(0,s.Wi)(M)&&(M=await S());const a=new M.BasisFile(new Uint8Array(i));if(a.getNumImages()<1)return null;const r=a.getNumLevels(0),n=a.getHasAlpha(),o=a.getImageWidth(0,0),l=a.getImageHeight(0,0),{compressedTextureETC:c,compressedTextureS3TC:h}=e.capabilities,[u,p]=c?n?[1,37496]:[0,37492]:h?n?[3,33779]:[2,33776]:[13,6408];a.startTranscoding();const d=[];for(let e=0;e<r;e++)d.push(new Uint8Array(a.getImageTranscodedSizeInBytes(0,e,u))),a.transcodeImage(d[e],0,e,u,0,0);a.close(),a.delete();const g={...t,samplingMode:r>1?9987:9729,hasMipmap:r>1,internalFormat:p,width:o,height:l};return new f.Z(e,g,{type:"compressed",levels:d})}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromPixelData(e,t){(0,d.hu)(this.params.width>0&&this.params.height>0);const i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this.glTexture=new f.Z(e,i,t),e.bindTexture(this.glTexture,0),this.glTexture}async loadAsync(e){const t=(0,l.createAbortController)();this.loadingController=t;const i=e(t.signal);this.loadingPromise=i;const a=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===i&&(this.loadingPromise=null)};return i.then(a,a),i}loadFromURL(e,t,i){return this.loadAsync((async a=>{const r=await(0,g.t)(i,{signal:a});return this.loadFromImage(e,r,t)}))}loadFromImageElement(e,t,i){return i.complete?this.loadFromImage(e,i,t):this.loadAsync((async a=>{const r=await(0,u.f)(i,i.src,!1,a);return this.loadFromImage(e,r,t)}))}loadFromVideoElement(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}loadFromVideoElementAsync(e,t,i){return this.loadAsync((a=>new Promise(((r,o)=>{const c=()=>{i.removeEventListener("loadeddata",h),i.removeEventListener("error",u),(0,s.pC)(p)&&p.remove()},h=()=>{i.readyState>=2&&(c(),r(this.loadFromImage(e,i,t)))},u=e=>{c(),o(e||new n.Z("Failed to load video"))};i.addEventListener("loadeddata",h),i.addEventListener("error",u);const p=(0,l.onAbort)(a,(()=>u((0,l.createAbortError)())))}))))}loadFromImage(e,t,i){const a=T.getDataDimensions(t);this.params.width=a.width,this.params.height=a.height;const r=this.createDescriptor(e);return r.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,r)||(0,h.wt)(a.width)&&(0,h.wt)(a.height)?(r.width=a.width,r.height=a.height,this.glTexture=new f.Z(e,r,t),e.bindTexture(this.glTexture,0),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,a,r,i),e.bindTexture(this.glTexture,0),this.glTexture)}requiresPowerOfTwo(e,t){const i=33071,a="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!(0,m.Z)(e.gl)&&(t.hasMipmap||!a)}makePowerOfTwoTexture(e,t,i,r,s){const{width:n,height:o}=i,l=(0,h.Sf)(n),c=(0,h.Sf)(o);let u;switch(r.width=l,r.height=c,this.params.powerOfTwoResizeMode){case 2:r.textureCoordinateScaleFactor=[n/l,o/c],u=new f.Z(e,r),u.updateData(0,0,0,n,o,t);break;case 1:case null:case void 0:u=this.stretchToPowerOfTwo(e,t,r,s);break;default:(0,a.Bg)(this.params.powerOfTwoResizeMode)}return r.hasMipmap&&u.generateMipmap(),u}stretchToPowerOfTwo(e,t,i,a){const r=new f.Z(e,i),s=new _.Z(e,{colorTarget:0,depthStencilTarget:0},r),n=new f.Z(e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=(0,y.ow)(e);return this.drawStretchedTexture(e,a,s,o,n,r),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:o,sourceTexture:n,framebuffer:s}:(o.dispose(!0),n.dispose(),s.detachColorTexture(),e.bindFramebuffer(null),s.dispose()),r}drawStretchedTexture(e,t,i,a,r,s){e.bindFramebuffer(i);const n=e.getViewport();e.setViewport(0,0,s.descriptor.width,s.descriptor.height);const o=t.program;e.bindProgram(o),o.setUniform4f("color",1,1,1,1),o.setUniform1i("tex",0),e.bindTexture(r,0),e.bindVAO(a),e.setPipelineState(t.pipeline),e.drawArrays(5,0,(0,v._V)(a,"geometry")),e.bindFramebuffer(null),e.setViewport(n.x,n.y,n.width,n.height)}unload(){if((0,s.pC)(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this.powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if((0,s.pC)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),(0,s.pC)(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}T.DDS_ENCODING="image/vnd-ms.dds",T.BASIS_ENCODING="image/x.basis"},48016:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createCircle:()=>w,createEllipse:()=>S,createMultipoint:()=>y,createPoint:()=>v,createPolygon:()=>b,createPolyline:()=>_,createRectangle:()=>M,createSquare:()=>x,makeMapPoint:()=>f});var a=i(82550),r=i(59472),s=i(19677),n=i(27780),o=i(61106),l=i(3470),c=i(92232),h=i(53817),u=i(93833),p=(i(36348),i(93533)),d=i(7646),g=i(70642),m=i(14425);function f(e,t,i=null){return(0,r.pC)(i)?[e,t,i]:[e,t]}function v(e,t){const i=new o.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function y(e,t){return new l.Z({points:e,spatialReference:t})}function _(e,t,i){const a=new u.Z({paths:e,spatialReference:t});return i&&(0,c.nc)(a),a}function b(e,t,i,r=!0){const o=(0,a.d9)(e);o.forEach((e=>{const t=e[0],i=e[e.length-1];(0,s.fS)(t,i)&&1!==e.length||e.push(e[0])}));let l=new h.Z({rings:o,spatialReference:t});return l.rings.forEach((e=>{(0,c.bu)(e,!1,!1)||e.reverse()})),i&&(0,c.nc)(l),r&&l.isSelfIntersecting&&(0,n.JY)(t)&&(l=(0,g.simplify)(l)),l}function x(e,t,i){const a=t.mapToLocalMultiple(e),s=[],n={x:a[0].x,y:a[0].y},o=a[1].x,l=a[1].y,c=Math.round(o-n.x),h=Math.round(l-n.y),u=Math.max(Math.abs(c),Math.abs(h));if(i){const e={x:n.x+u,y:n.y+u},t={x:n.x-u,y:n.y-u};s.push((0,m.Q8)(e.x,t.y),(0,m.Q8)(t.x,t.y),(0,m.Q8)(t.x,e.y),(0,m.Q8)(e.x,e.y))}else{const e={x:c>0?n.x+u:n.x-u,y:h>0?n.y+u:n.y-u};s.push((0,m.Q8)(n.x,n.y),(0,m.Q8)(e.x,n.y),(0,m.Q8)(e.x,e.y),(0,m.Q8)(n.x,e.y))}return b([(0,r.lV)(s.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function M(e,t,i){let a=t.mapToLocalMultiple(e);if(1===a.length){const e=48,t=a[0];a=[(0,m.Q8)(t.x-e,t.y+e),(0,m.Q8)(t.x+e,t.y-e),(0,m.Q8)(t.x+e,t.y-e),(0,m.Q8)(t.x-e,t.y+e)]}const s=[],n={x:a[0].x,y:a[0].y},o={x:a[1].x,y:a[1].y};if(i){const e=Math.round(o.x-n.x),t=Math.round(o.y-n.y);s.push((0,m.Q8)(n.x-e,n.y-t),(0,m.Q8)(o.x,n.y-t),(0,m.Q8)(o.x,o.y),(0,m.Q8)(n.x-e,o.y))}else s.push((0,m.Q8)(n.x,n.y),(0,m.Q8)(o.x,n.y),(0,m.Q8)(o.x,o.y),(0,m.Q8)(n.x,o.y));return b([(0,r.lV)(s.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function w(e,t,i,a){const s=t.mapToLocalMultiple(e);let o=null,l=null;if(i)o=s[0],l=s[1];else{const e=s[0],t=s[1],i=Math.round(t.x-e.x),a=Math.round(t.y-e.y),r=Math.max(Math.abs(i),Math.abs(a));o=(0,m.Q8)(i>0?e.x+r/2:e.x-r/2,a>0?e.y+r/2:e.y-r/2),l=(0,m.Q8)(Math.abs(i)>Math.abs(a)?o.x-r/2:o.x,Math.abs(i)>Math.abs(a)?o.y:o.y-r/2)}const h=t.localToMap(o),u=t.localToMap(l);if((0,r.Wi)(h)||(0,r.Wi)(u))return null;t.doUnnormalization&&(0,c.Sq)([[h,u]],t.spatialReference);const f=v(h,t.spatialReference),y=v(u,t.spatialReference),_=(0,p.c9)(t.spatialReference);let x=0;if((0,n.JY)(t.spatialReference))x=_*(0,g.distance)(f,y,null);else{const e=o.x-l.x,t=o.y-l.y;x=_*Math.sqrt(e*e+t*t)*(a||1)}const M=new d.Z({center:f,radius:x,radiusUnit:"meters",spatialReference:t.spatialReference});return b(M.rings,M.spatialReference,!1)}function S(e,t,i){const a=t.mapToLocalMultiple(e),s=a[0],n=a[1],o=Math.round(n.x-s.x),l=Math.round(n.y-s.y),c=(0,m.Q8)(i?s.x:s.x+o/2,i?s.y:s.y+l/2),h=i?o:o/2,u=i?l:l/2,p=[],d=2*Math.PI/60;for(let e=0;e<60;e++){const t=Math.cos(e*d),i=Math.sin(e*d),a=(0,m.Q8)(h*t+c.x,u*i+c.y);p.push(a)}return p.push(p[0]),b([(0,r.lV)(p.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}},65865:(e,t,i)=>{"use strict";i.d(t,{L:()=>b});var a=i(56140),r=(i(95830),i(59472)),s=i(36544),n=(i(68055),i(79881)),o=i(87566),l=(i(10923),i(57002),i(86035),i(82677)),c=i(35470),h=i(96071),u=i(77625),p=i(17387),d=i(17333),g=i(79710),m=i(14286),f=i(5684),v=i(46970),y=i(37694);const _=s.Z.getLogger("esri.views.interactive.GraphicManipulator");let b=class extends l.default{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new c.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){"mesh"!==(0,r.U2)(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):_.error("Mesh geometries are not supported")}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,v.vu)(this.graphic),i=e?e.offset:0;return new g.Z({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if((0,r.Wi)(i))return null;const a=this._get("focusedSymbol"),s=(0,r.pC)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,s):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),(0,r.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,r.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{(0,r.pC)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&(0,r.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){(0,r.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,r.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||(0,f.js)(i),(0,r.Wi)(a))return null;let s=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,y.D)(t,i,e)?1:null;if((0,r.Wi)(s)||!s.originalPoint.equals(i)){const t=i,r=e.spatialReference;if((0,d.Up)(t.spatialReference,r)){const e=(0,d.iV)(t,r);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,h.F2)(a.size)},this._circleCollisionCache=s}}if((0,r.pC)(s)){const i=(0,h.md)(t,M),r=e.toScreen(s.mapPoint),n=s.radiusPx,o=r.x+(0,h.F2)(a.xoffset),l=r.y-(0,h.F2)(a.yoffset);return(0,m.j)(i,[o,l])<n*n?1:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&(0,d.KC)(a,x,e.renderSpatialReference)?(0,p.i)(x,e.state.camera.eye):null}};(0,a._)([(0,n.Cb)({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",null),(0,a._)([(0,n.Cb)({readOnly:!0})],b.prototype,"elevationInfo",null),(0,a._)([(0,n.Cb)({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0),(0,a._)([(0,n.Cb)({value:null})],b.prototype,"focusedSymbol",null),(0,a._)([(0,n.Cb)({constructOnly:!0})],b.prototype,"layer",void 0),(0,a._)([(0,n.Cb)()],b.prototype,"interactive",void 0),(0,a._)([(0,n.Cb)()],b.prototype,"selectable",void 0),(0,a._)([(0,n.Cb)()],b.prototype,"grabbable",void 0),(0,a._)([(0,n.Cb)({value:!1})],b.prototype,"grabbing",null),(0,a._)([(0,n.Cb)()],b.prototype,"dragging",void 0),(0,a._)([(0,n.Cb)()],b.prototype,"hovering",null),(0,a._)([(0,n.Cb)({value:!1})],b.prototype,"selected",null),(0,a._)([(0,n.Cb)()],b.prototype,"cursor",void 0),b=(0,a._)([(0,o.j)("esri.views.interactive.GraphicManipulator")],b);const x=(0,u.c)(),M=(0,h.s1)()},37694:(e,t,i)=>{"use strict";i.d(t,{K:()=>o,D:()=>l});var a=i(59472),r=i(52937),s=(i(36348),i(93533)),n=i(83873);function o(e,t,i,n=new r.Z){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),n=i.basemapSpatialReference;o=(0,a.pC)(n)&&!n.equals(i.spatialReference)?(0,s.c9)(n)/(0,s.c9)(i.spatialReference):t*r}const l=e.x-o,c=e.y-o,h=e.x+o,u=e.y+o,{spatialReference:p}=i;return n.xmin=Math.min(l,h),n.ymin=Math.min(c,u),n.xmax=Math.max(l,h),n.ymax=Math.max(c,u),n.spatialReference=p,n}function l(e,t,i){const r=i.toMap(e);return!(0,a.Wi)(r)&&o(r,(0,n.k)(),i,c).intersects(t)}const c=new r.Z}}]);
//# sourceMappingURL=7905.js.map