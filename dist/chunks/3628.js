(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[3628],{23229:(t,e,s)=>{"use strict";s.d(e,{Hg:()=>p,uD:()=>_,V7:()=>f});var i=s(59472),r=s(65575),n=s(82677),o=s(83477);const a=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function h(t){return t instanceof n.default}function u(t){return t instanceof o.Z?Object.keys(t.items):h(t)?(0,r.vw)(t).keys():t?Object.keys(t):[]}function l(t,e){return t instanceof o.Z?t.items[e]:t[e]}function d(t){return t?t.declaredClass:null}function c(t,e){const s=t.diff;if(s&&"function"==typeof s)return s(t,e);const r=u(t),n=u(e);if(0===r.length&&0===n.length)return;if(!r.length||!n.length||function(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}(t,e))return{type:"complete",oldValue:t,newValue:e};const o=n.filter((t=>-1===r.indexOf(t))),_=r.filter((t=>-1===n.indexOf(t))),f=r.filter((s=>n.indexOf(s)>-1&&l(t,s)!==l(e,s))).concat(o,_).sort(),p=d(t);if(p&&a.indexOf(p)>-1&&f.length)return{type:"complete",oldValue:t,newValue:e};let g;const m=h(t)&&h(e);for(const r of f){const n=l(t,r),o=l(e,r);let a;(m||"function"!=typeof n&&"function"!=typeof o)&&n!==o&&(null==n&&null==o||(a=s&&s[r]&&"function"==typeof s[r]?s[r](n,o):"object"==typeof n&&"object"==typeof o&&d(n)===d(o)?c(n,o):{type:"complete",oldValue:n,newValue:o},(0,i.pC)(a)&&((0,i.pC)(g)?g.diff[r]=a:g={type:"partial",diff:{[r]:a}})))}return g}function _(t,e){if((0,i.Wi)(t))return!1;const s=e.split(".");let r=t;for(const t of s){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const e=r.diff[t];if(!e)return!1;r=e}}return!0}function f(t,e){for(const s of e)if(_(t,s))return!0;return!1}function p(t,e){if("function"!=typeof t&&"function"!=typeof e&&(t||e))return!t||!e||"object"==typeof t&&"object"==typeof e&&d(t)!==d(e)?{type:"complete",oldValue:t,newValue:e}:c(t,e)}},50682:(t,e,s)=>{"use strict";s.d(e,{a:()=>h});var i=s(36544),r=s(32656),n=s(31514),o=s(83302);const a=i.Z.getLogger("esri.views.2d.engine.webgl");function h(t){return(0,o.hj)(t.minDataValue)&&(0,o.hj)(t.maxDataValue)&&null!=t.minSize&&null!=t.maxSize?n.X.SIZE_MINMAX_VALUE:(t.expression&&"view.scale"===t.expression||t.valueExpression&&"$view.scale"===t.valueExpression)&&Array.isArray(t.stops)?n.X.SIZE_SCALE_STOPS:(null!=t.field||t.expression&&"view.scale"!==t.expression||t.valueExpression&&"$view.scale"!==t.valueExpression)&&(Array.isArray(t.stops)||"levels"in t&&t.levels)?n.X.SIZE_FIELD_STOPS:(null!=t.field||t.expression&&"view.scale"!==t.expression||t.valueExpression&&"$view.scale"!==t.valueExpression)&&null!=t.valueUnit?n.X.SIZE_UNIT_VALUE:(a.error(new r.Z("mapview-bad-type","Found invalid size VisualVariable",t)),n.X.NONE)}},28487:(t,e,s)=>{"use strict";s.d(e,{ZP:()=>A,nE:()=>x});var i=s(95830),r=s(59472),n=s(36544),o=s(32656),a=s(39105),h=s(33655),u=s(23229),l=s(61121),d=s(71286),c=s(83302),_=s(22127),f=s(5358);const p=n.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=(0,_.g)(_.J,p),m=t=>(2147483648&t)>>>31,y=t=>2147483647&t;function x(t){return 1===m(t)}const b={sharedArrayBuffer:(0,i.Z)("esri-shared-array-buffer"),atomics:(0,i.Z)("esri-atomics")};function I(t,e){return s=>e(t(s))}class S{constructor(t,e,s,i){this.size=0,this.texelSize=4;const{pixelType:r,layout:n,textureOnly:o}=i;this.textureOnly=o||!1,this.pixelType=r,this._ctype=e,this.layout=n,this._resetRange(),this._shared=t,this.size=s,o||(this.data=this._initData(r,s,t,e))}get buffer(){return(0,r.Po)(this.data,(t=>t.buffer))}unsetComponentAllTexels(t,e){const s=(0,r.Wg)(this.data);for(let i=0;i<this.size*this.size;i++)s[i*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const s=(0,r.Wg)(this.data);for(let i=0;i<this.size*this.size;i++)s[i*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,s){const i=(0,r.Wg)(this.data);for(const r of s)i[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,s){(0,r.Wg)(this.data)[s*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)}unsetComponentTexel(t,e,s){(0,r.Wg)(this.data)[s*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)}getData(t,e){const s=y(t);return(0,r.Wg)(this.data)[s*this.texelSize+e]}setData(t,e,s){const i=y(t),r=1<<e;0!=(this.layout&r)?(this.data[i*this.texelSize+e]=s,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):p.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&b.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&b.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t,this._shared,this._ctype),s=(0,r.Wg)(this.data);e.set(s),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,s=this.texelSize;if(t>e)return null;this._resetRange();const i=!(this._shared||"local"===this._ctype),n=this.pixelType,o=this.layout,a=(0,r.Wg)(this.data);return a.slice?{start:t,end:e,data:i&&a.slice(t*s,(e+1)*s)||null,pixelType:n,layout:o}:i?{start:t,end:e,data:new((0,c.UK)(this.pixelType))(Array.prototype.slice.call(this.data,t*s,(e+1)*s)),pixelType:n,layout:o}:{start:t,end:e,data:null,pixelType:n,layout:o}}_initData(t,e,s,i){const r=s&&"local"!==i?SharedArrayBuffer:ArrayBuffer,n=(0,c.UK)(t),o=new n(new r(e*e*4*n.BYTES_PER_ELEMENT));for(let t=0;t<o.length;t+=4)o[t+1]=255;return o}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}const A=class{constructor(t,e){this._client=t,this.config=e,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(d.m4),this._targetType=0,this._abortController=(0,a.createAbortController)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const s=e.supportsTextureFloat?5126:5121;g(`Creating AttributeStore ${b.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:s,layout:15},{pixelType:s,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(t,e){this.config=e;const s=e.schema.processors[0].storage,n=(0,u.Hg)(this._schema,s);if((t.targets.feature||t.targets.aggregate)&&(t.storage.data=!0),n&&((0,i.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",n),t.storage.data=!0,this._schema=s,this._attributeComputeMap.clear(),!(0,r.Wi)(s))){switch(s.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const t of s.mapping)this._bindAttribute(t)}}onTileData(t,e){if((0,r.Wi)(e.addOrUpdate))return;const s=e.addOrUpdate.getCursor();for(;s.next();){const t=s.getDisplayId();this.setAttributeData(t,s)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=(0,a.createAbortController)()}async setHighlight(t,e){const s=this._getBlock(0),i=e.map((t=>y(t)));s.lock(),s.unsetComponentAllTexels(0,1),s.setComponent(0,1,i),s.unlock(),this._idsToHighlight.clear();for(const e of t)this._idsToHighlight.add(e);await this.sendUpdates()}async updateFilters(t,e){const{config:s,service:r,spatialReference:n}=e,{filters:o}=s,h=o.map(((t,e)=>this._updateFilter(t,e,r,n)));(await(0,a.all)(h)).some((t=>t))&&(t.storage.filters=!0,(0,i.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(t,e,s,i){const r=y(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,s,i)}getData(t,e,s){return this._getBlock(e).getData(t,s)}getHighlightFlag(t){return this._idsToHighlight.has(t)?d.uG:0}unsetAttributeData(t){const e=y(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e){const s=y(t);if(this._ensureSizeForTexel(s),this._getBlock(0).setData(s,0,this.getFilterFlags(e)),this._targetType!==m(t))return;const i=this._attributeComputeMap,r=this.config.supportsTextureFloat?1:2;i.size&&i.forEach(((t,i)=>{const n=i*r%4,o=Math.floor(i*r/4),a=this._getBlock(o+d.aK),u=t(e);if(this.config.supportsTextureFloat)a.setData(s,n,u);else if(u===d.AI)a.setData(s,n,255),a.setData(s,n+1,255);else{const t=(0,h.uZ)(Math.round(u),-32767,32766)+32768,e=255&t,i=(65280&t)>>8;a.setData(s,n,e),a.setData(s,n+1,i)}}))}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,a.createResolver)(),this._nextUpdate.promise;const t={blocks:this._blocks.map((t=>(0,r.pC)(t)?t.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const e=()=>{if(this._currUpdate=null,this._nextUpdate){const t=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>t.resolve()))}},s=this._client.update(t,this._signal).then(e).catch(e);return this._client.render(this._signal),s})).catch((t=>(0,a.isAbortError)(t)?(this._createResourcesPromise=null,this._createResources()):(p.error(new o.Z("mapview-attribute-store","Encountered an error during client update",t)),(0,a.resolve)()))),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t){let e;if(null!=t.fieldIndex)t.normalizationField&&p.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),e=e=>e.getComputedNumericAtIndex(t.fieldIndex);else{if(!t.field)return;e=t.normalizationField?e=>{const s=e.readAttribute(t.normalizationField);return s?e.readAttribute(t.field)/s:null}:e=>e.readAttribute(t.field)}t.valueRepresentation&&(e=I(e,(e=>(0,f.qc)(e,t.valueRepresentation)))),this._attributeComputeMap.set(t.binding,I(e,(t=>null===t||isNaN(t)||t===1/0?d.AI:t)))}_createResources(){if((0,r.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(d.xl),g("Initializing AttributeStore");const t={shared:b.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:(0,r.Fd)(this._blocks,(t=>({textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType})))},e=this._client.initialize(t,this._signal).catch((t=>{(0,a.isAbortError)(t)?this._createResourcesPromise=null:p.error(new o.Z("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=e,e.then((()=>(0,r.Wi)(this._createResourcesPromise)?this._createResources():void 0)),e}_getBlock(t){const e=this._blocks[t];if((0,r.pC)(e))return e;g(`Initializing AttributeBlock at index ${t}`);const s=b.sharedArrayBuffer,i=this._client.type,n=new S(s,i,this._size,this._blockDescriptors[t]);return this._blocks[t]=n,this._createResourcesPromise=null,n}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return g("Expanding block size to",t,this._blocks),(0,r.JR)(this._blocks,(e=>e.expand(t))),this._createResourcesPromise=null,this._size=t,0}return p.error(new o.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(t,e,s,i){const n=this._filters[e],o=(0,r.pC)(n)&&n.hash;if(!n&&!t)return!1;if(o===JSON.stringify(t))return!1;if((0,r.Wi)(t)){const t=1<<e+1,s=this._getBlock(0);return this._filters[e]=null,s.setComponentAllTexels(0,t),this.sendUpdates(),!0}const a=await this._getFilter(e,s);return await a.update(t,i),!0}async _getFilter(t,e){const i=this._filters[t];if((0,r.pC)(i))return i;const{default:n}=await s.e(7042).then(s.bind(s,97042)),o=new n({geometryType:e.geometryType,hasM:!1,hasZ:!1,timeInfo:e.timeInfo,fieldsIndex:new l.Z(e.fields)});return this._filters[t]=o,o}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let e=0;const s=(i=t.getDisplayId(),1===m(i)?254:255);var i;for(let i=0;i<this._filters.length;i++){const n=!!(s&1<<i),o=this._filters[i];e|=(!n||(0,r.Wi)(o)||o.check(t)?1:0)<<i}let n=0;if(this._idsToHighlight.size){const e=t.getObjectId();n=this.getHighlightFlag(e)}return e<<1|n}}},27191:(t,e,s)=>{"use strict";s.d(e,{O:()=>o});class i{constructor(){this._freeIds=[],this._idCounter=1}createId(t=!1){return function(t,e){return((e?2147483648:0)|t)>>>0}(this._getFreeId(),t)}releaseId(t){this._freeIds.push(t)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}class r{constructor(t,e){this._mask=0,this._buf=t,this._mask=e}static fromBuffer(t,e){return new r(t,e)}static create(t,e=4294967295){const s=new Uint32Array(Math.ceil(t/32));return new r(s,e)}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}set(t){const e=this._mask&t,s=this._getIndex(e),i=1<<e%32;this._buf[s]|=i}unset(t){const e=this._mask&t,s=this._getIndex(e),i=1<<e%32;this._buf[s]&=4294967295^i}resize(t){const e=this._buf,s=new Uint32Array(Math.ceil(t/32));s.set(e),this._buf=s}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new r(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0}forEachSet(t){for(let e=0;e<this._buf.length;e++){let s=this._buf[e],i=32*e;if(s)for(;s;)1&s&&t(i),s>>>=1,i++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}function n(t,e,s){if(!(t.length>e))for(;t.length<=e;)t.push(s)}class o{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new i,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const t=this._bitsets.length;return this._bitsets.push(r.create(this._allocatedSize,2147483647)),t+1}getBitset(t){return this._bitsets[t-1]}_expand(){this._allocatedSize<<=1;for(const t of this._bitsets)t.resize(this._allocatedSize)}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),n(this._numerics[t],e,0)}_ensureInstanceId(t){n(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),n(this._strings[t],e,null)}createDisplayId(t=!1){const e=this._idGenerator.createId();return e>this._allocatedSize&&this._expand(),((t,e)=>((e?2147483648:0)|t)>>>0)(e,t)}releaseDisplayId(t){for(const e of this._bitsets)e.unset(t);return this._idGenerator.releaseId(2147483647&t)}getComputedNumeric(t,e){return this.getComputedNumericAtIndex(2147483647&t,0)}setComputedNumeric(t,e,s){return this.setComputedNumericAtIndex(2147483647&t,s,0)}getComputedString(t,e){return this.getComputedStringAtIndex(2147483647&t,0)}setComputedString(t,e,s){return this.setComputedStringAtIndex(2147483647&t,0,s)}getComputedNumericAtIndex(t,e){const s=2147483647&t;return this._ensureNumeric(e,s),this._numerics[e][s]}setComputedNumericAtIndex(t,e,s){const i=2147483647&t;this._ensureNumeric(e,i),this._numerics[e][i]=s}getInstanceId(t){const e=2147483647&t;return this._ensureInstanceId(e),this._instanceIds[e]}setInstanceId(t,e){const s=2147483647&t;this._ensureInstanceId(s),this._instanceIds[s]=e}getComputedStringAtIndex(t,e){const s=2147483647&t;return this._ensureString(e,s),this._strings[e][s]}setComputedStringAtIndex(t,e,s){const i=2147483647&t;this._ensureString(e,i),this._strings[e][i]=s}getXMin(t){return this._bounds[4*(2147483647&t)]}getYMin(t){return this._bounds[4*(2147483647&t)+1]}getXMax(t){return this._bounds[4*(2147483647&t)+2]}getYMax(t){return this._bounds[4*(2147483647&t)+3]}setBounds(t,e){const s=e.readHydratedGeometry();if(!s||!s.coords.length)return!1;let i=1/0,r=1/0,o=-1/0,a=-1/0;s.forEachVertex(((t,e)=>{i=Math.min(i,t),r=Math.min(r,e),o=Math.max(o,t),a=Math.max(a,e)}));const h=2147483647&t;return n(this._bounds,4*h+4,0),this._bounds[4*h]=i,this._bounds[4*h+1]=r,this._bounds[4*h+2]=o,this._bounds[4*h+3]=a,!0}}},45386:(t,e,s)=>{"use strict";s.d(e,{s:()=>h});var i=s(56885),r=(s(36348),s(73127)),n=s(31036),o=s(24179);let a=0;class h{constructor(t){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._joined=[],this.instance=t}static createInstance(){return a++,a=a>65535?0:a,a}get _hasFilter(){return-1!==this._xmin}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(t){return this.getComputedNumericAtIndex(0)}setComputedNumeric(t,e){return this.setComputedNumericAtIndex(e,0)}getComputedString(t){return this.getComputedStringAtIndex(0)}setComputedString(t,e){return this.setComputedStringAtIndex(0,e)}getComputedNumericAtIndex(t){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),t)}setComputedNumericAtIndex(t,e){this._storage.setComputedNumericAtIndex(this.getDisplayId(),t,e)}getComputedStringAtIndex(t){return this._storage.getComputedStringAtIndex(this.getDisplayId(),t)}setComputedStringAtIndex(t,e){return this._storage.setComputedStringAtIndex(this.getDisplayId(),t,e)}transform(t,e){const s=this.copy();return s._tx=t,s._ty=e,s}extent(t,e,s,i){const r=this.copy();return r._xmin=t,r._xmax=s,r._ymin=e,r._ymax=i,r}hasFilter(){return this._hasFilter}readAttribute(t,e=!1){const s=this._readAttribute(t,e);if(void 0!==s)return s;for(const s of this._joined){s.setIndex(this.getIndex());const i=s._readAttribute(t,e);if(void 0!==i)return i}}readAttributes(){return this._readAttributes()}joinAttributes(t){this._joined.push(t)}readArcadeFeature(){return this}geometry(){const t=this.readHydratedGeometry(),e=(0,n.di)(t,this.geometryType,this.hasZ,this.hasM),s=(0,i.im)(e);return s.spatialReference=this._arcadeSpatialReference,s}field(t){return this.readAttribute(t,!0)}hasField(t){return!0}setField(t,e){}keys(){return[]}castToText(){return""}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const t=this.readUnquantizedGeometry();if(!t||t.hasIndeterminateRingOrder)return null;const e=this.getQuantizationTransform();return(0,o.Y)(new r.Z,t,this.hasM,this.hasZ,e)}copyInto(t){t.seen=this.seen,t._storage=this._storage,t._arcadeSpatialReference=this._arcadeSpatialReference,t._joined=this._joined,t._tx=this._tx,t._ty=this._ty,t._xmin=this._xmin,t._xmax=this._xmax,t._ymin=this._ymin,t._ymax=this._ymax}}},46639:(t,e,s)=>{"use strict";s.d(e,{i:()=>n});var i=s(31036),r=s(45386);class n extends r.s{constructor(t,e,s){super(t),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=s,this._features=e}static fromFeatures(t,e,s){const r=(0,i.Yn)([],t,e,!1,!1,s);for(let e=0;e<r.length;e++)r[e].displayId=t[e].displayId;return n.fromOptimizedFeatures(r,e)}static fromFeatureSet(t,e){const s=(0,i.h_)(t,e);return n.fromOptimizedFeatureSet(s)}static fromOptimizedFeatureSet(t){const{features:e,geometryType:s}=t,i=n.fromOptimizedFeatures(e,s);i._exceededTransferLimit=t.exceededTransferLimit,i._transform=t.transform;for(const e of t.fields)"esriFieldTypeDate"===e.type&&i._dateFields.add(e.name);return i}static fromOptimizedFeatures(t,e,s){const i=r.s.createInstance(),o=new n(i,t,e);return o._transform=s,o}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getIndex(){return this._featureIndex}setIndex(t){this._featureIndex=t}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){this._current.displayId=t}getGroupId(){return this._current.groupId}setGroupId(t){this._current.groupId=t}copy(){const t=new n(this.instance,this._features,this.geometryType);return this.copyInto(t),t}next(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,i.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){const t=this.readGeometry();return t?{x:t.coords[0],y:t.coords[1]}:null}readLegacyGeometry(){const t=this.readGeometry();return(0,i.di)(t,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const t=this.readCentroid();return t?{x:t.coords[0],y:t.coords[1]}:null}readGeometryArea(){return(0,i.lz)(this._current.geometry,2)}readUnquantizedGeometry(){const t=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!t)return t;const e=t.clone();return function({coords:t,lengths:e}){let s=0;for(const i of e){for(let e=1;e<i;e++)t[2*(s+e)]+=t[2*(s+e)-2],t[2*(s+e)+1]+=t[2*(s+e)-1];s+=i}}(e),e}readHydratedGeometry(){const t=this._current.geometry;if(!t)return null;const e=t.clone();return(0,i.$g)(e,e,this.hasZ,this.hasM,this._transform),e}getXHydrate(){const t=this._current.geometry.coords[0]+this._tx,e=this.getQuantizationTransform();return t*e.scale[0]+e.translate[0]}getYHydrate(){const t=this._current.geometry.coords[1]+this._ty,e=this.getQuantizationTransform();return e.translate[1]-t*e.scale[1]}readGeometry(){if(!this._current.hasGeometry)return null;const t=this._current.geometry.clone();if(t.isPoint)return t.coords[0]+=this._tx,t.coords[1]+=this._ty,t;let e=0;for(const s of t.lengths)t.coords[2*e]+=this._tx,t.coords[2*e+1]+=this._ty,e+=s;return t}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const t=this._computeCentroid();if(!t)return null;t.coords[0]-=this._tx,t.coords[1]-=this._ty,this._current.centroid=t}const t=this._current.centroid.clone();return t.coords[0]+=this._tx,t.coords[1]+=this._ty,t}_readAttribute(t,e){const s=this._current.attributes[t];if(void 0!==s)return e&&this._dateFields.has(t)?new Date(s):s;const i=this.readAttributes(),r=t.toLocaleLowerCase().trim();for(const t in i)if(t.toLocaleLowerCase().trim()===r){const e=this._current.attributes[t];return this._dateFields.has(t)?new Date(e):e}}copyInto(t){super.copyInto(t),t._featureIndex=this._featureIndex,t._transform=this._transform,t._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let t=0,e=0;switch(this.geometryType){case"esriGeometryPoint":{const s=this._current.geometry;if(!s)return!1;[t,e]=s.coords;break}case"esriGeometryPolygon":{const s=this.readCentroid();if(!s)return!1;[t,e]=s.coords,t-=this._tx,e-=this._ty;break}default:return!1}return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax}}},75191:(t,e,s)=>{"use strict";s.d(e,{n9:()=>h});var i=s(42148),r=s(52937),n=s(50897),o=s(57360),a=s(5201);class h{constructor(t,e){this.key=new a.Z(0,0,0,0),this.bounds=(0,n.Ue)(),this.objectIds=new Set,this.key.set(e);const s=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=s.resolution,this.scale=s.scale,this.level=s.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return r.Z.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const t=this.bounds;return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}}clone(){return new h(this.tileInfoView,this.key)}createChildTiles(){const t=this.key.getChildKeys(),e=i.Z.acquire();for(let s=0;s<t.length;s++)e[s]=new h(this.tileInfoView,t[s]);return e}getQuantizationParameters(){return o.Z.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},55407:(t,e,s)=>{"use strict";s.d(e,{Z:()=>c});var i=s(95830),r=s(35470),n=s(5201),o=s(73978),a=s(96233),h=s(75191);const u={added:[],removed:[]},l=new Set,d=new n.Z(0,0,0,0),c=class extends r.Z{constructor(t){super(),this._tiles=new Map,this._index=(0,a.r)(9,(0,i.Z)("csp-restrictions")?t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}findByKey(t){return this._tiles.get(t.id)}intersections(t,e){const s="string"==typeof t?this.get(t):t;if(!s)return[];const i=e*s.resolution,r=s.bounds[0]-i,n=s.bounds[1]-i,o=s.bounds[2]+i,a=s.bounds[3]+i,h=[];for(const t of this._index.search({minX:r,minY:n,maxX:o,maxY:a})){const e=t.bounds.slice();e[0]=Math.max(e[0],r),e[1]=Math.max(e[1],n),e[2]=Math.min(e[2],o),e[3]=Math.min(e[3],a),e[2]-e[0]>0&&e[3]-e[1]>0&&h.push({bounds:e,tile:t})}return h}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){const e={added:[],removed:[]};for(const s of t.added)if(!this.has(s)){const t=new h.n9(this.tileScheme,s);this._tiles.set(s,t),this._index.insert(t),e.added.push(t)}for(const s of t.removed)if(this.has(s)){const t=this.get(s);this._tiles.delete(s),this._index.remove(t),e.removed.push(t)}this.tiles.length=0,this._tiles.forEach((t=>this.tiles.push(t))),(e.added.length||e.removed.length)&&this.emit("update",e)}setViewState(t){const e=this.tileScheme.getTileCoverage(t,0);if(!e)return;const{spans:s,lodInfo:i}=e,{level:r}=i;if(s.length>0)for(const{row:t,colFrom:e,colTo:n}of s)for(let s=e;s<=n;s++){const e=d.set(r,t,i.normalizeCol(s),i.getWorldForColumn(s)).id;if(l.add(e),!this.has(e)){const t=new h.n9(this.tileScheme,e);this._tiles.set(e,t),this._index.insert(t),this.tiles.push(t),u.added.push(t)}}for(let t=this.tiles.length-1;t>=0;t--){const e=this.tiles[t];l.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(t,1),this._index.remove(e),u.removed.push(e))}(u.added.length||u.removed.length)&&this.emit("update",u),o.Z.pool.release(e),l.clear(),u.added.length=0,u.removed.length=0}}}}]);
//# sourceMappingURL=3628.js.map