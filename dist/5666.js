(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[5666],{64345:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(59472);const s=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete((0,n.j0)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},83500:(e,t,i)=>{"use strict";i.d(t,{f:()=>zt,t:()=>Ut});var n=i(56140),s=(i(95830),i(36544)),o=(i(68055),i(79881)),r=i(87566),a=(i(10923),i(57002),i(86035),i(74386)),l=i(80621),u=i(77827),c=i(82677),d=i(28293),h=i(45671),p=(i(38836),i(79618));let _=class extends c.default{constructor(){super(...arguments),this.items=new d.Z,this._watchUpdatingTracking=new h.t,this._callbacks=new Map,this._projector=(0,p.E)(),this._hiddenProjector=(0,p.E)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n=null;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const e=n.domNode.getBoundingClientRect();o.left=e.left,o.top=e.top,o.right=e.right,o.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return o}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};(0,n._)([(0,o.Cb)({readOnly:!0})],_.prototype,"surface",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],_.prototype,"items",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],_.prototype,"needsRender",null),(0,n._)([(0,o.Cb)({readOnly:!0})],_.prototype,"_watchUpdatingTracking",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],_.prototype,"updating",void 0),_=(0,n._)([(0,r.j)("esri.views.overlay.ViewOverlay")],_);const g=_;var v=i(51894),m=i(60263),f=i(87765),y=i(10180),b=i(61398),w=(i(89771),i(59691)),C=i(69065),M=i(40450),k=i(24258),P=i(9200),E=i(30818),F=i(19401),A=i(90806),I=i(22020),x=i(14334),O=i(39105),T=i(35470);let S=class extends T.Z.EventedAccessor{constructor(...e){super(...e),this._anchorHandles=new w.Z,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([(0,l.watch)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),(0,l.watch)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",n=(0,l.pausable)(t,i,(()=>this._viewpointChange()));this._anchorHandles.add(n,e),this._viewpointHandle=n,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,n=this.get("view.ready"),s=i&&e&&n?t.toScreen(e):null;this._set("screenLocation",s)}};(0,n._)([(0,o.Cb)()],S.prototype,"location",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],S.prototype,"screenLocation",void 0),(0,n._)([(0,o.Cb)()],S.prototype,"screenLocationEnabled",void 0),(0,n._)([(0,o.Cb)()],S.prototype,"view",void 0),S=(0,n._)([(0,r.j)("esri.widgets.support.AnchorElementViewModel")],S);const N=S;let B=class extends N{constructor(e){super(e),this.visible=!1}};(0,n._)([(0,o.Cb)()],B.prototype,"visible",void 0),B=(0,n._)([(0,r.j)("esri.widgets.CompassViewModel")],B);const L=B,H="esri-spinner",j="esri-spinner--start",V="esri-spinner--finish";let R=class extends A.default{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new L,this.visible=!1}initialize(){this.own([(0,l.watch)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,n={[j]:e&&i,[V]:!e&&i},s=this._getPositionStyles();return(0,F.j)("div",{class:this.classes(H,n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,O.after)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||!e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,n._)([(0,v.B)("viewModel.location")],R.prototype,"location",void 0),(0,n._)([(0,v.B)("viewModel.view")],R.prototype,"view",void 0),(0,n._)([(0,o.Cb)({type:L})],R.prototype,"viewModel",void 0),(0,n._)([(0,v.B)("viewModel.visible")],R.prototype,"visible",void 0),R=(0,n._)([(0,r.j)("esri.widgets.Spinner")],R);const D=R;var z=i(59472),U=i(32656),W=i(41241),Z=i(61106),K=(i(36348),i(89350)),G=i(73186),$=i(59359),q=i(56700),Y=i(69948),X=i(45598),J=i(69829),Q=i(69642),ee=i(4338);const te=d.Z.ofType({key:"type",defaultKeyValue:"button",base:K.Z,typeMap:{button:G.Z,toggle:$.Z}}),ie="esri.widgets.Popup.PopupViewModel",ne=s.Z.getLogger(ie);let se=class extends((0,ee._)(N)){constructor(e){super(e),this._handles=new w.Z,this._pendingPromises=new Set,this._zoomToLocation=null,this._fetchFeaturesController=null,this.actions=new te([Q.OO.clone()]),this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.content=null,this.featureViewModels=[],this.highlightEnabled=!0,this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4}initialize(){this._handles.add([(0,l.init)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),(0,l.watch)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),(0,l.watch)(this,"view.animation.state",(e=>this._animationStateChange(e))),(0,l.watch)(this,"location",(e=>this._locationChange(e))),(0,l.watch)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),this.on("trigger-action",(e=>(0,Q.aG)({event:e,view:this.view}))),(0,l.whenFalse)(this,"waitingForResult",(()=>this._waitingForResultChange())),(0,l.watch)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new te;e.removeAll();const t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),i=t&&t.actions,n=t&&t.overwriteActions?i:i?i.concat(this.actions):this.actions;return n&&n.filter(Boolean).forEach((t=>e.add(t))),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&t.length;o&&i&&-1===s?this.selectedFeatureIndex=0:o&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,W.$)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e);e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=this._getSelectedTarget();if(!t){const i=new U.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return ne.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new U.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return ne.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}zoomToLocation(){const{location:e,selectedFeature:t,view:i,zoomFactor:n}=this,s=this._getSelectedTarget();if(!s){const e=new U.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});return ne.error(e),Promise.reject(e)}const o=i.scale/n,r=this.get("selectedFeature.geometry")||e,a=r&&"point"===r.type&&this._isZoomScreenSize(t);Q.OO.active=!0,Q.OO.disabled=!0;const l=this.callGoTo({target:{target:s,scale:a?o:void 0}}).catch((()=>{Q.OO.active=!1,Q.OO.disabled=!1,this._zoomToLocation=null})).then((()=>{a&&(this.location=r)}));return this._zoomToLocation=l,l}_animationStateChange(e){this._zoomToLocation||(Q.OO.disabled="waiting-for-target"===e)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=(0,z.Wg)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,n=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[n,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{features:e,featureViewModels:t}=this;if(this._destroyFeatureVMs(),!e||!e.length)return;const i=t.slice(0),n=[];e.forEach(((e,t)=>{if(!e)return;let s=null;if(i.some(((t,n)=>(t&&t.graphic===e&&(s=t,i.splice(n,1)),!!s))),s)n[t]=s;else{var o,r;const i=new X.Z({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,graphic:e,spatialReference:null==(o=this.view)?void 0:o.spatialReference,map:null==(r=this.view)?void 0:r.map,view:this.view});n[t]=i}})),i.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_getSelectedTarget(){const{selectedFeature:e,location:t,view:i}=this;return i?"3d"===i.type?e||t:this.get("selectedFeature.geometry")||t:null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),Y.f.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=(0,O.createAbortController)(),{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:o}=e,r=[Promise.resolve(t),...s.map((e=>e.promise))];return n.popup.open({location:o||i,promises:r}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_isZoomScreenSize(e){const{view:t}=this;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new U.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});ne.error(t)})),t}return!0}_getPointFromGeometry(e){return(0,z.Wi)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;const{layer:o}=t;if(!(o&&o instanceof q.Z))return;const r=this._getLayerView(n,o);this._highlightPromise=r;const a=await r;if(!(a&&(0,J.tl)(a)&&this._highlightPromise===r&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l="objectIdField"in o&&o.objectIdField,u=t.attributes,c=u&&l&&u[l],d=a.highlight(c||t);this._handles.add(d,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};(0,n._)([(0,o.Cb)({type:te})],se.prototype,"actions",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"active",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"allActions",null),(0,n._)([(0,o.Cb)({type:Boolean})],se.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"content",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"featureCount",null),(0,n._)([(0,o.Cb)()],se.prototype,"features",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"featureViewModels",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"highlightEnabled",void 0),(0,n._)([(0,o.Cb)({type:Z.Z})],se.prototype,"location",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"pendingPromisesCount",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"waitingForResult",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"promiseCount",null),(0,n._)([(0,o.Cb)()],se.prototype,"promises",null),(0,n._)([(0,o.Cb)({value:null,readOnly:!0})],se.prototype,"selectedFeature",null),(0,n._)([(0,o.Cb)({value:-1})],se.prototype,"selectedFeatureIndex",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"selectedFeatureViewModel",null),(0,n._)([(0,o.Cb)({readOnly:!0})],se.prototype,"state",null),(0,n._)([(0,o.Cb)()],se.prototype,"title",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"view",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"visible",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"zoomFactor",void 0),(0,n._)([(0,o.Cb)()],se.prototype,"centerAtLocation",null),(0,n._)([(0,o.Cb)()],se.prototype,"zoomToLocation",null),se=(0,n._)([(0,r.j)(ie)],se);const oe=se,re="selected-index",ae="popup-spinner",le="esri-icon-left-triangle-arrow",ue="esri-icon-right-triangle-arrow",ce="esri-icon-maximize",de="esri-icon-dock-bottom",he="esri-icon-dock-left",pe="esri-icon-dock-right",_e="esri-icon-close",ge="esri-icon-minimize",ve="esri-icon-check-mark",me="esri-icon-loading-indicator",fe="esri-icon-default-action",ye="esri-icon-handle-horizontal",be="esri-rotating",we="esri-popup",Ce="esri-widget",Me="esri-popup__main-container",ke="esri-popup__loading-container",Pe="esri-popup--is-collapsible",Ee="esri-popup--is-collapsed",Fe="esri-popup--shadow",Ae="esri-popup--is-docked",Ie="esri-popup--is-docked-top-left",xe="esri-popup--is-docked-top-center",Oe="esri-popup--is-docked-top-right",Te="esri-popup--is-docked-bottom-left",Se="esri-popup--is-docked-bottom-center",Ne="esri-popup--is-docked-bottom-right",Be="esri-popup--aligned-top-center",Le="esri-popup--aligned-bottom-center",He="esri-popup--aligned-top-left",je="esri-popup--aligned-bottom-left",Ve="esri-popup--aligned-top-right",Re="esri-popup--aligned-bottom-right",De="esri-popup--feature-menu-open",ze="esri-popup--actions-menu-open",Ue="esri-popup--feature-updated",We="esri-popup__header",Ze="esri-popup__header-buttons",Ke="esri-popup__header-container",Ge="esri-popup__header-container--button",$e="esri-popup__header-title",qe="esri-popup__content",Ye="esri-popup__footer",Xe="esri-popup__footer--has-pagination",Je="esri-popup__footer--has-actions",Qe="esri-popup__footer--has-actions-menu",et="esri-popup__button",tt="esri-popup__button--disabled",it="esri-popup__button--dock",nt="esri-popup__icon",st="esri-popup__icon--dock-icon",ot="esri-popup__inline-actions-container",rt="esri-popup__actions-menu-button",at="esri-popup__actions",lt="esri-popup__action",ut="esri-popup__action-image",ct="esri-popup__action-text",dt="esri-popup__action-toggle",ht="esri-popup__action-toggle--on",pt="esri-popup__pointer",_t="esri-popup__pointer-direction",gt="esri-popup__navigation",vt="esri-popup__pagination-previous",mt="esri-popup__pagination-next",ft="esri-popup__pagination-previous-icon",yt="esri-popup__pagination-previous-icon--rtl",bt="esri-popup__pagination-next-icon",wt="esri-popup__pagination-next-icon--rtl",Ct="esri-popup__feature-menu",Mt="esri-popup__feature-menu-list",kt="esri-popup__feature-menu-item",Pt="esri-popup__feature-menu-viewport",Et="esri-popup__feature-menu-header",Ft="esri-popup__feature-menu-item--selected",At="esri-popup__feature-menu-button",It="esri-popup__feature-menu-title",xt={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Ot="esri-popup";function Tt(e,t){return void 0===t?`${Ot}__${e}`:`${Ot}__${e}-${t}`}const St="esri.widgets.Popup",Nt=s.Z.getLogger(St),Bt={closeButton:!0,featureNavigation:!0};let Lt=class extends((0,I.q)(A.default)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new w.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._displaySpinnerThrottled=(0,C.P)((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new oe,this.visible=null,this.visibleElements={...Bt},this._addSelectedFeatureIndexHandle(),this.own([(0,l.watch)(this,"viewModel.screenLocation",(()=>this._positionContainer())),(0,l.watch)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),(0,l.watch)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),(0,l.watch)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),(0,l.watch)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),(0,l.watch)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,l.watch)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),(0,l.watch)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),(0,l.watch)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,l.watch)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),(0,l.watch)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),(0,l.whenFalse)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),(0,l.on)(this,"viewModel.allActions","change",(()=>this._watchActions())),(0,l.init)(this,"viewModel.allActions",(()=>this._watchActions()))])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,n,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(n=i.viewModel)?void 0:n.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||xt}set dockOptions(e){const t={...xt},i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},o={...t.breakpoint,...n},{breakpoint:r}=s;!0===r?s.breakpoint=o:"object"==typeof r&&(s.breakpoint={...o,...r}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}set featureNavigationEnabled(e){(0,f.Mr)(Nt,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements={...this.visibleElements,featureNavigation:e}}get selectedFeatureWidget(){const{_feature:e,visibleElements:t}=this,{selectedFeatureViewModel:i}=this.viewModel,n={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=n):this._feature=new x.default({viewModel:i,visibleElements:n}),this._feature):null}castVisibleElements(e){return{...Bt,...e}}blur(){const{active:e}=this.viewModel;e||Nt.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Nt.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(re);const n=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:n};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,n;const{actionsMenuOpen:s,dockEnabled:o,featureMenuVisible:r,dividedActions:a,currentAlignment:l,currentDockPosition:u}=this,{active:c}=this.viewModel,{menuActions:d}=a,h=c&&d.length>1&&s,p=c&&o,_=c&&!o,g=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,v=null==(i=this.selectedFeature)||null==(n=i.layer)?void 0:n.id,m={[Be]:"top-center"===l,[Le]:"bottom-center"===l,[He]:"top-left"===l,[je]:"bottom-left"===l,[Ve]:"top-right"===l,[Re]:"bottom-right"===l,[Ae]:p,[Fe]:_,[Ie]:"top-left"===u,[xe]:"top-center"===u,[Oe]:"top-right"===u,[Te]:"bottom-left"===u,[Se]:"bottom-center"===u,[Ne]:"bottom-right"===u,[De]:r,[ze]:h};return(0,F.j)("div",{class:this.classes(we,m),role:"presentation","data-layer-title":g,"data-layer-id":v,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},c?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,F.j)("span",{"aria-hidden":"true",class:this.classes(nt,me,be)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?(0,F.j)("div",{key:Tt("loading-container"),role:"presentation",class:ke,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=(0,M.dZ)(),t={[ue]:e,[yt]:e,[le]:!e,[ft]:!e};return(0,F.j)("span",{"aria-hidden":"true",class:this.classes(nt,t)})}renderPreviousButton(){const{messages:e}=this;return(0,F.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(et,vt),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=(0,M.dZ)(),t={[le]:e,[wt]:e,[ue]:!e,[bt]:!e};return(0,F.j)("span",{"aria-hidden":"true",class:this.classes(nt,t)})}renderNextButton(){const{messages:e}=this;return(0,F.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(et,mt),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return(0,F.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(et,At),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[ge]:e,[st]:!e,[pe]:!e&&("top-right"===t||"bottom-right"===t),[he]:!e&&("top-left"===t||"bottom-left"===t),[ce]:!e&&"top-center"===t,[de]:!e&&"bottom-center"===t};return(0,F.j)("span",{"aria-hidden":"true",class:this.classes(i,nt)})}renderDockButton(){var e,t,i;const{dockEnabled:n,messages:s}=this,o=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,r=n?s.undock:s.dock;return"xsmall"!==o&&null!=(i=this.dockOptions)&&i.buttonEnabled?(0,F.j)("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(et,it)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[Ge]:i},r=(0,F.j)("h2",{class:$e,innerHTML:e}),a=i?(0,F.j)("button",{key:`${e}--collapsible`,id:t,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ke,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed},r):(0,F.j)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ke,o)},r);return e?a:null}renderCloseIcon(){return(0,F.j)("span",{"aria-hidden":"true",class:this.classes(nt,_e)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?(0,F.j)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:et,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,F.j)("header",{class:We},this.renderTitle(),(0,F.j)("div",{class:Ze},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:n}=this.viewModel;return t&&!i?(0,F.j)("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:qe},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:r}=n;return r.length?(0,F.j)("div",{key:Tt("actions-menu-button"),class:this.classes(et,rt),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},(0,F.j)("span",{"aria-hidden":"true",class:ye})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s,inlineActions:o}=n;return s.length&&i?(0,F.j)("ul",{id:e,role:"menu","aria-labelledby":t,key:Tt("actions"),class:at,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+o.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,n=!!t.length;return i||n?(0,F.j)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:ot},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,F.j)("section",{key:Tt("navigation"),class:this.classes(gt)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:n}=t,s=!!i.length,o=!!n.length,r={[Xe]:e,[Je]:s,[Qe]:o};return e||s?(0,F.j)("div",{key:Tt("feature-buttons"),class:this.classes(Ye,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t}=this.viewModel,i=(0,b.n)(e.selectedFeatures,{total:t.length});return(0,F.j)("section",{key:Tt("menu"),class:Ct},(0,F.j)("h2",{class:Et},i),(0,F.j)("nav",{class:Pt,afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu()))}renderPointer(){return this.dockEnabled?null:(0,F.j)("div",{key:Tt("pointer"),class:pt,role:"presentation"},(0,F.j)("div",{class:this.classes(_t,Fe)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:r,contentCollapsed:a,visibleElements:l}=this,{title:u}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,d="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,h={[Fe]:e,[Pe]:o,[Ee]:a};return(0,F.j)("div",{class:this.classes(Me,Ce,h),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":u?n:"","aria-describedby":r&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?(0,F.j)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return(0,F.j)("span",{key:"text",class:ct},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),n={[me]:e.active,[be]:e.active,[nt]:!!t,[ut]:!e.active&&!!i};return t&&(n[t]=!e.active),(0,F.j)("span",{key:"icon","aria-hidden":"true",class:this.classes(nt,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:n}=e,s=this._getActionTitle(t),o={[lt]:"toggle"!==t.type,[dt]:"toggle"===t.type,[ht]:"toggle"===t.type&&t.value,[tt]:t.disabled},r=[this.renderActionIcon(t),this.renderActionText(s)],a="menu-item"===n?(0,F.j)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(et,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r):(0,F.j)("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(et,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,r=e===o,a={[Ft]:r},l=r?(0,F.j)("span",{key:Tt(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:ve}):null,u=(0,F.j)("span",{innerHTML:e.title||n.untitled});return(0,F.j)("li",{role:"menuitem",tabIndex:-1,key:Tt(`feature-menu-feature-${s}`),class:this.classes(a,kt),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},(0,F.j)("span",{class:It},u,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?(0,F.j)("ol",{class:Mt,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=null==i?void 0:i.attributes,r="zoom-to-feature"===s?(0,b.n)(e.title,{messages:t}):"remove-selected-feature"===s?(0,b.n)(e.title,{messages:n}):e.title;return r&&o?(0,b.n)(r,o):r}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:n,image:s}=e,o=s||n?n:fe;return o&&i?(0,b.n)(o,i):o}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:n}=e;return n&&i?(0,b.n)(n,i):n}_createFeatureUpdatedAnimation(){return(0,M.vU)("enter",Ue)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add((0,l.watch)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,n=0===t;return{inlineActions:i?e.slice(0):n?new d.Z:e.slice(0,t),menuActions:i?new d.Z:n?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_handleFeatureMenuKeyup(e){"Escape"===(0,y.kK)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===(0,y.kK)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=(0,y.kK)(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const t=(0,y.kK)(e),{_actionsMenuNode:i}=this,n=e.currentTarget["data-action-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleMainKeyup(e){const t=(0,y.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=(0,l.watch)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,re)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!n)return!1;const r=o.padding;return"right"===s&&n.x+i/2>o.width-r.right||"left"===s&&n.x-i/2<r.left||"top"===s&&n.y-t<r.top||"bottom"===s&&n.y+t>o.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:r}=s;if(!o||!r||!i)return"top-center";if(!this._isScreenLocationWithinView(o,r))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=n?window.getComputedStyle(n,null):null,u=l?a(l.getPropertyValue("max-height")):0,c=l?a(l.getPropertyValue("height")):0,{height:d,width:h}=i.getBoundingClientRect(),p=h+t,_=Math.max(d,u,c)+t,g=this._isOutsideView({popupHeight:_,popupWidth:p,screenLocation:o,side:"right",view:r}),v=this._isOutsideView({popupHeight:_,popupWidth:p,screenLocation:o,side:"left",view:r}),m=this._isOutsideView({popupHeight:_,popupWidth:p,screenLocation:o,side:"top",view:r}),f=this._isOutsideView({popupHeight:_,popupWidth:p,screenLocation:o,side:"bottom",view:r});return v?m?"bottom-right":"top-right":g?m?"bottom-left":"top-left":m?f?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,M.dZ)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,n=(0,M.dZ)()?"top-left":"top-right";if(!i)return n;const s=i.padding||{left:0,right:0,top:0,bottom:0},o=i.width-s.left-s.right,{breakpoints:r}=i;return r&&o<=r.xsmall?"bottom-center":n}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this,r=n/2,a=i.height-t,l=i.width-e,{padding:u}=this.view;return"bottom-center"===s?{top:t+o-u.top,left:e-r-u.left}:"top-left"===s?{bottom:a+o-u.bottom,right:l+o-u.right}:"bottom-left"===s?{top:t+o-u.top,right:l+o-u.right}:"top-right"===s?{bottom:a+o-u.bottom,left:e+o-u.left}:"bottom-right"===s?{top:t+o-u.top,left:e+o-u.left}:"top-center"===s?{bottom:a+o-u.bottom,left:e-r-u.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(!e||!t)return;const s=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:void 0!==o.top?`${o.top}px`:"auto",left:void 0!==o.left?`${o.left}px`:"auto",bottom:void 0!==o.bottom?`${o.bottom}px`:"auto",right:void 0!==o.right?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[o,r]=t,{width:a,height:l}=i;return n<=a&&o>a||n>a&&o<=a||s<=l&&r>l||s>l&&r<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=e[0]-n,o[1]=e[1]-s,r[0]=t[0]-n,r[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(o,r,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportNodeUpdated(e){e&&(e.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const n=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:o,height:r}=s;if(isNaN(o)||isNaN(r))return!1;const a=n.hasOwnProperty("width")&&o<=n.width,l=n.hasOwnProperty("height")&&r<=n.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?(0,b.n)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,ae),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new D({view:e}),e.ui.add(this._spinner,{key:ae,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"actionsMenuId",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"actionsMenuButtonId",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"featureMenuId",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"titleId",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"contentId",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"hasContent",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"featureNavigationVisible",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"collapsible",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"featureMenuVisible",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"contentCollapsed",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"dividedActions",null),(0,n._)([(0,v.B)("viewModel.actions")],Lt.prototype,"actions",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"actionsMenuOpen",null),(0,n._)([(0,o.Cb)()],Lt.prototype,"alignment",void 0),(0,n._)([(0,v.B)("viewModel.autoCloseEnabled")],Lt.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,v.B)("viewModel.autoOpenEnabled")],Lt.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,v.B)("viewModel.defaultPopupTemplateEnabled")],Lt.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,v.B)("viewModel.content")],Lt.prototype,"content",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"collapsed",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"collapseEnabled",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"currentAlignment",null),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"currentDockPosition",null),(0,n._)([(0,o.Cb)()],Lt.prototype,"dockOptions",null),(0,n._)([(0,o.Cb)()],Lt.prototype,"dockEnabled",void 0),(0,n._)([(0,v.B)("viewModel.featureCount")],Lt.prototype,"featureCount",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"featureMenuOpen",void 0),(0,n._)([(0,v.B)("viewModel.features")],Lt.prototype,"features",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"featureNavigationEnabled",null),(0,n._)([(0,v.B)("viewModel.goToOverride")],Lt.prototype,"goToOverride",void 0),(0,n._)([(0,v.B)("viewModel.highlightEnabled")],Lt.prototype,"highlightEnabled",void 0),(0,n._)([(0,v.B)("viewModel.location")],Lt.prototype,"location",void 0),(0,n._)([(0,o.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Lt.prototype,"label",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"maxInlineActions",void 0),(0,n._)([(0,o.Cb)(),(0,P.H)("esri/widgets/Popup/t9n/Popup")],Lt.prototype,"messages",void 0),(0,n._)([(0,o.Cb)(),(0,P.H)("esri/t9n/common")],Lt.prototype,"messagesCommon",void 0),(0,n._)([(0,v.B)("viewModel.promises")],Lt.prototype,"promises",void 0),(0,n._)([(0,v.B)("viewModel.selectedFeature")],Lt.prototype,"selectedFeature",void 0),(0,n._)([(0,v.B)("viewModel.selectedFeatureIndex")],Lt.prototype,"selectedFeatureIndex",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],Lt.prototype,"selectedFeatureWidget",null),(0,n._)([(0,o.Cb)()],Lt.prototype,"spinnerEnabled",void 0),(0,n._)([(0,v.B)("viewModel.title")],Lt.prototype,"title",void 0),(0,n._)([(0,v.B)("viewModel.updateLocationEnabled")],Lt.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,v.B)("viewModel.view")],Lt.prototype,"view",void 0),(0,n._)([(0,o.Cb)({type:oe}),(0,E.s)(["triggerAction","trigger-action"])],Lt.prototype,"viewModel",void 0),(0,n._)([(0,v.B)("viewModel.visible")],Lt.prototype,"visible",void 0),(0,n._)([(0,o.Cb)()],Lt.prototype,"visibleElements",void 0),(0,n._)([(0,m.p)("visibleElements")],Lt.prototype,"castVisibleElements",null),(0,n._)([(0,k.h)()],Lt.prototype,"_close",null),(0,n._)([(0,k.h)()],Lt.prototype,"_toggleDockEnabled",null),(0,n._)([(0,k.h)()],Lt.prototype,"_toggleFeatureMenu",null),(0,n._)([(0,k.h)()],Lt.prototype,"_toggleActionsMenu",null),(0,n._)([(0,k.h)()],Lt.prototype,"_triggerAction",null),(0,n._)([(0,k.h)()],Lt.prototype,"_selectFeature",null),(0,n._)([(0,k.h)()],Lt.prototype,"_next",null),(0,n._)([(0,k.h)()],Lt.prototype,"_previous",null),Lt=(0,n._)([(0,r.j)(St)],Lt);const Ht=Lt,jt=[0,0];function Vt(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return jt[0]=i.left+t.pageXOffset,jt[1]=i.top+t.pageYOffset,jt}function Rt(e){e&&((0,u.cS)(e),e.parentNode&&e.parentNode.removeChild(e))}const Dt=750,zt=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:Dt},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Rt(this.root),this._set("root",null),(0,u.YD)(this.userContent,t),Rt(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",(0,u.YD)(e,t),e.appendChild(t),this._set("userContent",t);const n=document.createElement("div");n.className="esri-view-root",e.insertBefore(n,e.firstChild),this._set("root",n);const s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,n.appendChild(s),this._set("surface",s);const o=new g;n.appendChild(o.surface),this._set("overlay",o),o.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,a.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,l.init)(this,"size",(e=>{const[t,i]=e,n="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?s.classList.add(n):s.classList.remove(n)})),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new Ht({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const n=this.position;return e-=n[0],t-=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const n=this.position;return e+=n[0],t+=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,l.init)(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),(0,l.init)(this,"popup",((t,i)=>{const n="popup";i&&e.remove(i,n),t&&(t.view=e.view,e.add(t,{key:n,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=Dt,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=Dt};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),(0,a.A)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const n=this._position();i.freq=n||t?16:Math.min(Dt,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const n=this.width,s=this.height;return t===n&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=Vt(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return(0,n._)([(0,o.Cb)({value:null,cast:e=>(0,u.L7)(e)})],t.prototype,"container",null),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"focused",null),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,n._)([(0,o.Cb)({type:Ht})],t.prototype,"popup",null),(0,n._)([(0,o.Cb)({type:g})],t.prototype,"overlay",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,n._)([(0,o.Cb)({value:null,readOnly:!0})],t.prototype,"size",null),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,n._)([(0,o.Cb)()],t.prototype,"ui",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,n._)([(0,o.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,n._)([(0,r.j)("esri.views.DOMContainer")],t),t};function Ut(e){return e&&"focus"in e}},46539:(e,t,i)=>{"use strict";i.d(t,{a:()=>r});var n=i(36544);class s{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const o=n.Z.getLogger("esri.views.input.InputHandler");class r{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?o.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const o="string"==typeof e?new s(e,n):e,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},u=new a(o,i,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),r(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[o.eventType];return c||(c=[],this._incoming[o.eventType]=c),c.push(u),r(),this._manager&&this._manager.updateDependencies(),u}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new l(e,{onEmit:(e,t,i,n)=>{this._manager.emit(e.eventType,t,i,n)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):o.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class a{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class l{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}},69948:(e,t,i)=>{"use strict";i.d(t,{$:()=>p,f:()=>g});var n=i(56140),s=(i(95830),i(36544)),o=(i(68055),i(79881)),r=i(87566),a=(i(10923),i(57002),i(86035),i(82677)),l=i(64345),u=i(63345),c=i(46539);class d extends c.a{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const h=s.Z.getLogger("esri.views.input.InputManager");let p=class extends a.default{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=u.CK,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=g.INTERNAL){if(this._nameToGroup[e])return void h.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void h.error("Can't register a group of zero handlers");const n={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=n;for(let e=n.handlers.length-1;e>=0;e--){const t=n.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,n,s,o)=>{this._emitInputEvent(t.priorityIndex+1,e,i,n,o,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(n,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):h.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s)for(const t of n.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of n.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)(0,u.wj)(e)||t.add(e)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(n(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(n(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const o=t.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new d((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,g.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],g.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),0===o.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,o){const r=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new _(t,i,r,o||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new l.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),n=t.data&&t.data.eventId;if(null==n||!this._stoppedPropagationEventIds.has(n))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=n&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}}_pausePropagation(e){const t=new l.Z;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};(0,n._)([(0,o.Cb)({readOnly:!0})],p.prototype,"hasPendingInputs",null),(0,n._)([(0,o.Cb)()],p.prototype,"eventSource",void 0),(0,n._)([(0,o.Cb)()],p.prototype,"recognizers",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],p.prototype,"latestPointerType",void 0),p=(0,n._)([(0,r.j)("esri.views.input.InputManager")],p);class _{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const g={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3}},63345:(e,t,i)=>{"use strict";i.d(t,{kK:()=>a,wj:()=>l,CK:()=>o});var n=i(95830),s=i(10180);const o=(0,n.Z)("mac")?"Meta":"Ctrl",r={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)r[e]=String.fromCharCode(e);for(let e=1;e<25;e++)r[111+e]=`F${e}`;for(let e=65;e<91;e++)r[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function a(e){if(void 0!==e.key)return(0,s.kK)(e);const t=r[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function l(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},17519:(e,t,i)=>{"use strict";i.d(t,{a6:()=>u,J1:()=>c,To:()=>l,Iv:()=>r,LF:()=>a});var n=i(59472),s=i(28293),o=i(83500);function r(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,(0,o.t)(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function a(e,t,i){const s=e.activeTool;t!==s&&((0,n.pC)(s)&&s.deactivate&&s.deactivate(),i(t),(0,n.pC)(t)&&t.activate&&t.activate())}function l(){const e=new s.Z;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;r(t,!1),t.destroyed||t.detach()})),e}function u(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function c(e){return(0,n.Wi)(e)?{}:"function"==typeof e?e():e}},2887:(e,t,i)=>{"use strict";i.d(t,{vT:()=>s,Eu:()=>o,s6:()=>r,Rw:()=>a});i(95830);var n=i(96071);function s(e){return(0,n.vW)(e.x,e.y)}function o(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,n.vW)(t.clientX-i.left,t.clientY-i.top)}function r(e,t){return t instanceof Event?o(e,t):s(t)}function a(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}},69642:(e,t,i)=>{"use strict";i.d(t,{tP:()=>l,aG:()=>u,OO:()=>a});var n=i(32656),s=i(73186);const o="esri-icon-zoom-in-magnifying-glass",r="esri-icon-trash",a=new s.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:o}),l=new s.Z({id:"remove-selected-feature",title:"{messages.remove}",className:r}),u=function(e){const{event:t,view:i}=e,{action:s}=t,o=i&&i.popup;if(!s)return Promise.reject(new n.Z("trigger-action:missing-arguments","Event has no action"));if(!o)return Promise.reject(new n.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:r,id:u}=s;if(!u)return Promise.reject(new n.Z("trigger-action:invalid-action","action.id is missing"));if(r)return Promise.reject(new n.Z("trigger-action:invalid-action","Action is disabled"));if(u===a.id)return o.viewModel.zoomToLocation();if(u===l.id){o.close();const{selectedFeature:e}=o;if(!e)return Promise.reject(new n.Z(`trigger-action:${l.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()}}}]);
//# sourceMappingURL=5666.js.map