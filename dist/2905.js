(self.webpackChunkimaps=self.webpackChunkimaps||[]).push([[2905],{69065:(e,t,n)=>{"use strict";function i(e,t,n,i){let r=null,s=1e3;"number"==typeof t?(s=t,i=n):(r=null!=t?t:null,s=n);let o,a=0;const l=()=>{a=0,e.apply(i,o)},c=(...e)=>{r&&r.apply(i,e),o=e,s?a||(a=setTimeout(l,s)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}n.d(t,{P:()=>i})},56888:(e,t,n)=>{"use strict";n.d(t,{VG:()=>a,sS:()=>f,yc:()=>u,Ud:()=>c,ld:()=>d,Rd:()=>l});var i=n(88263),r=n(17427),s=n(33655),o=n(93533);function a(e,t,n,i=2,s="abbr"){return`${(0,r.uf)(t,{minimumFractionDigits:i,maximumFractionDigits:i})} ${function(e,t,n){return e.units[t][n]}(e,n,s)}`}function l(e,t,n,i=2,r="abbr"){const s=(0,o.KU)(t,n);return a(e,(0,o.En)(t,n,s),s,i,r)}function c(e,t,n,i=2,r="abbr"){const s=(0,o.FN)(t,n);return a(e,(0,o.En)(t,n,s),s,i,r)}function d(e,t,n,i=2,r="abbr"){const s=(0,o.tQ)(t,n);return a(e,(0,o.En)(t,n,s),s,i,r)}function u(e,t,n,i=2,r="abbr"){const s=(0,o.Yl)(t,n);return a(e,(0,o.En)(t,n,s),s,i,r)}const h=["B","kB","MB","GB","TB"];function f(e,t){let n=0===t?0:Math.floor(Math.log(t)/Math.log(1024));n=(0,s.uZ)(n,0,h.length-1);const o=(0,r.uf)(t/1024**n,{maximumFractionDigits:2});return(0,i.gx)(e.units.bytes[h[n]],{fileSize:o})}},44195:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class i{constructor(e=null,t={},n,i){this.displayId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),n&&(this.centroid=n),null!=i&&(this.objectId=i)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashIndexed=this.geohashIndexed,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}const r=i},60151:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}const r=i},73127:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class i{constructor(e=[],t=[],n=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=n}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let n=0;n<this.lengths.length;n++){const i=this.lengths[n];for(let n=0;n<i;n++)e(this.coords[2*(n+t)],this.coords[2*(n+t)+1]);t+=i}}clone(){return new i(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}const r=i},31036:(e,t,n)=>{"use strict";n.d(t,{XA:()=>U,h_:()=>Q,Yn:()=>G,GH:()=>H,E7:()=>D,ks:()=>O,Uy:()=>B,u0:()=>P,EI:()=>W,cn:()=>K,di:()=>Y,Iv:()=>Z,fQ:()=>w,eG:()=>S,J6:()=>N,oB:()=>de,zj:()=>ne,$:()=>se,lz:()=>ce,RZ:()=>ee,Nh:()=>te,Jd:()=>y,IN:()=>b,hY:()=>ae,lM:()=>J,$g:()=>oe});var i=n(36544),r=n(32656),s=n(56885),o=n(44195),a=n(60151),l=n(73127);function c(e,t){return e?t?4:3:t?3:2}const d=i.Z.getLogger("esri.tasks.support.optimizedFeatureSet"),u={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},h=(e,t,n,i,r,s)=>{e[n]=r,e[n+1]=s},f=(e,t,n,i,r,s)=>{e[n]=r,e[n+1]=s,e[n+2]=t[i+2]},p=(e,t,n,i,r,s)=>{e[n]=r,e[n+1]=s,e[n+2]=t[i+3]},m=(e,t,n,i,r,s)=>{e[n]=r,e[n+1]=s,e[n+2]=t[i+2],e[n+3]=t[i+3]};function g(e,t,n,i){if(e){if(n)return t&&i?m:f;if(t&&i)return p}else if(t&&i)return f;return h}function y({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function b({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function _({scale:e,translate:t},n){return n*e[0]+t[0]}function v({scale:e,translate:t},n){return t[1]-n*e[1]}function w(e,t,n){return e?t?n?x(e):C(e):n?A(e):I(e):null}function I(e){const t=e.coords;return{x:t[0],y:t[1]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function F(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function x(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function j(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function k(e,t){return e&&t?j:e?F:t?T:M}function E(e,t,n,i,r){const s=k(n,i);for(const n of t){const{geometry:t,attributes:i}=n;let a;t&&(a=s(new l.Z,t)),e.push(new o.Z(a,i,null,i[r]))}return e}function Z(e,t,n){if(!e)return null;const i=c(t,n),r=[];for(let t=0;t<e.coords.length;t+=i){const n=[];for(let r=0;r<i;r++)n.push(e.coords[t+r]);r.push(n)}return t?n?{points:r,hasZ:t,hasM:n}:{points:r,hasZ:t}:n?{points:r,hasM:n}:{points:r}}function $(e,t,n,i,r){const s=c(n,i);for(const n of t){const t=n.geometry,i=n.attributes;let a;t&&(a=L(new l.Z,t,s)),e.push(new o.Z(a,i,null,i[r]))}return e}function L(e,t,n=c(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let r=0;for(const e of t.points)for(let t=0;t<n;t++)i[r++]=e[t];return e}function N(e,t,n){if(!e)return null;const i=c(t,n),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<i;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?n?{paths:o,hasZ:t,hasM:n}:{paths:o,hasZ:t}:n?{paths:o,hasM:n}:{paths:o}}function R(e,t,n,i,r){const s=c(n,i);for(const n of t){const t=n.geometry,i=n.attributes;let a;t&&(a=P(new l.Z,t,s)),e.push(new o.Z(a,i,null,i[r]))}return e}function P(e,t,n=c(t.hasZ,t.hasM)){const{lengths:i,coords:r}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<n;e++)r[s++]=t[e];i.push(e.length)}return e}function S(e,t,n){if(!e)return null;const i=c(t,n),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<i;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?n?{rings:o,hasZ:t,hasM:n}:{rings:o,hasZ:t}:n?{rings:o,hasM:n}:{rings:o}}function q(e,t,n,i,r){for(const s of t){const t=s.geometry,a=s.centroid,c=s.attributes;let d;t&&(d=B(new l.Z,t,n,i)),a?e.push(new o.Z(d,c,M(new l.Z,a),c[r])):e.push(new o.Z(d,c,null,c[r]))}return e}function B(e,t,n=t.hasZ,i=t.hasM){return O(e,t.rings,n,i),e}function O(e,t,n,i){const r=c(n,i),{lengths:s,coords:o}=e;let a=0;s.length=o.length=0;for(const e of t){for(const t of e)for(let e=0;e<r;e++)o[a++]=t[e];s.push(e.length)}return e}const z=[],V=[];function U(e,t,n,i,r){z[0]=e;const[s]=G(V,z,t,n,i,r);return z.length=V.length=0,s}function G(e,t,n,i,s,a){if(e.length=0,!n){for(const n of t){const t=n.attributes[a];e.push(new o.Z(null,n.attributes,null,t))}return e}switch(n){case"esriGeometryPoint":return E(e,t,i,s,a);case"esriGeometryMultipoint":return $(e,t,i,s,a);case"esriGeometryPolyline":return R(e,t,i,s,a);case"esriGeometryPolygon":return q(e,t,i,s,a);default:d.error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`)),e.length=0}return e}function D(e,t,n,i,s,o){const a=e.length;switch(n){case"esriGeometryPoint":E(e,t,i,s,o);break;case"esriGeometryMultipoint":$(e,t,i,s,o);break;case"esriGeometryPolyline":R(e,t,i,s,o);break;case"esriGeometryPolygon":q(e,t,i,s,o);break;default:d.error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`))}for(let i=0;i<t.length;i++)e[i+a].geometryType=n,e[i+a].insertAfter=t[i].insertAfter,e[i+a].groupId=t[i].groupId;return e}function W(e,t,n,i){V[0]=e,X(z,V,t,n,i);const r=z[0];return z.length=V.length=0,r}function H(e,t,n){if(!e)return null;const i=new l.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),(0,s.wp)(e)?k(null!=t?t:null!=e.z,null!=n?n:null!=e.m)(i,e):(0,s.oU)(e)?B(i,e,t,n):(0,s.l9)(e)?P(i,e,c(t,n)):(0,s.aW)(e)?L(i,e,c(t,n)):void d.error("convertFromGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${e}'`))}function Y(e,t,n,i){const s=e&&("coords"in e?e:e.geometry);if(!s)return null;switch(t){case"esriGeometryPoint":{let e=I;return n&&i?e=x:n?e=C:i&&(e=A),e(s)}case"esriGeometryMultipoint":return Z(s,n,i);case"esriGeometryPolyline":return N(s,n,i);case"esriGeometryPolygon":return S(s,n,i);default:return void d.error("convertToGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${t}'`))}}function X(e,t,n,i,s){switch(e.length=0,n){case"esriGeometryPoint":return function(e,t,n,i){let r=I;n&&i?r=x:n?r=C:i&&(r=A);for(const n of t){const{geometry:t,attributes:i}=n,s=t?r(t):null;e.push({attributes:i,geometry:s})}return e}(e,t,i,s);case"esriGeometryMultipoint":return function(e,t,n,i){for(const r of t){const{geometry:t,attributes:s}=r;let o;t&&(o=Z(t,n,i)),e.push({attributes:s,geometry:o})}return e}(e,t,i,s);case"esriGeometryPolyline":return function(e,t,n,i){for(const r of t){const{geometry:t,attributes:s}=r;let o;t&&(o=N(t,n,i)),e.push({attributes:s,geometry:o})}return e}(e,t,i,s);case"esriGeometryPolygon":return function(e,t,n,i){for(const r of t){const{geometry:t,attributes:s,centroid:o}=r;let a;if(t&&(a=S(t,n,i)),o){const t=I(o);e.push({attributes:s,centroid:t,geometry:a})}else e.push({attributes:s,geometry:a})}return e}(e,t,i,s);default:d.error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`))}return e}function K(e){const{objectIdFieldName:t,spatialReference:n,transform:i,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:d,queryGeometry:u,queryGeometryType:h}=e,f={features:X([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:t,spatialReference:n,uniqueIdField:d,queryGeometry:Y(u,h,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function Q(e,t){const n=new a.Z,{hasM:i,hasZ:s,features:o,objectIdFieldName:l,spatialReference:c,geometryType:u,exceededTransferLimit:h,transform:f,fields:p}=e;return p&&(n.fields=p),n.geometryType=u,n.objectIdFieldName=l||t,n.spatialReference=c,n.objectIdFieldName?(o&&G(n.features,o,u,s,i,n.objectIdFieldName),h&&(n.exceededTransferLimit=h),i&&(n.hasM=i),s&&(n.hasZ=s),f&&(n.transform=f),n):(d.error(new r.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)}function J(e){const{transform:t,features:n,hasM:i,hasZ:r}=e;if(!t)return e;for(const e of n)e.geometry&&oe(e.geometry,e.geometry,i,r,t),e.centroid&&oe(e.centroid,e.centroid,i,r,t);return e.transform=null,e}function ee(e,t){const{geometryType:n,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(let t=0;t<i.length;t++){const o=i[t],a=o.weakClone();a.geometry=new l.Z,te(a.geometry,o.geometry,r,s,n,e),o.centroid&&(a.centroid=new l.Z,te(a.centroid,o.centroid,r,s,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t}function te(e,t,n,i,r,s,o=n,a=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=u[r],{coords:d,lengths:h}=t,f=c(n,i),p=c(n&&o,i&&a),m=g(n,i,o,a);if(!h.length)return m(e.coords,d,0,0,y(s,d[0]),b(s,d[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let _,v,w,I,M=0,C=0,F=C;for(const t of h){if(t<l)continue;let n=0;C=F,w=_=y(s,d[M]),I=v=b(s,d[M+1]),m(e.coords,d,C,M,w,I),n++,M+=f,C+=p;for(let i=1;i<t;i++,M+=f)w=y(s,d[M]),I=b(s,d[M+1]),w===_&&I===v||(m(e.coords,d,C,M,w-_,I-v),C+=p,n++,_=w,v=I);n>=l&&(e.lengths.push(n),F=C)}return e.coords.length=F,e.coords.length?e:null}function ne(e,t,n,i,r,s,o=n,a=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=u[r],{coords:d,lengths:h}=t,f=c(n,i),p=c(n&&o,i&&a),m=g(n,i,o,a);if(!h.length)return m(e.coords,d,0,0,d[0],d[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let y=0;const b=s*s;for(const t of h){if(t<l){y+=t*f;continue}const n=e.coords.length/p,i=y,r=y+(t-1)*f;m(e.coords,d,e.coords.length,i,d[i],d[i+1]),re(e.coords,d,f,b,m,i,r),m(e.coords,d,e.coords.length,r,d[r],d[r+1]);const s=e.coords.length/p-n;s>=l?e.lengths.push(s):e.coords.length=n*p,y+=t*f}return e.coords.length?e:null}function ie(e,t,n,i){const r=e[t],s=e[t+1],o=e[n],a=e[n+1],l=e[i],c=e[i+1];let d=o,u=a,h=l-d,f=c-u;if(0!==h||0!==f){const e=((r-d)*h+(s-u)*f)/(h*h+f*f);e>1?(d=l,u=c):e>0&&(d+=h*e,u+=f*e)}return h=r-d,f=s-u,h*h+f*f}function re(e,t,n,i,r,s,o){let a,l=i,c=0;for(let e=s+n;e<o;e+=n)a=ie(t,e,s,o),a>l&&(c=e,l=a);l>i&&(c-s>n&&re(e,t,n,i,r,s,c),r(e,t,e.length,c,t[c],t[c+1]),o-c>n&&re(e,t,n,i,r,c,o))}function se(e,t,n,i){if(!t||!t.coords||!t.coords.length)return null;const r=c(n,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=r){const n=e[t],i=e[t+1];s=Math.min(s,n),a=Math.max(a,n),o=Math.min(o,i),l=Math.max(l,i)}}return e[0]=s,e[1]=o,e[2]=a,e[3]=l,e}function oe(e,t,n,i,r){const{coords:s,lengths:o}=t,a=n?i?m:f:i?f:h,l=c(n,i);if(!s.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,s,0,0,_(r,s[0]),v(r,s[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[d,u]=r.scale;let p=0;for(let t=0;t<o.length;t++){const n=o[t];e.lengths[t]=n;let i=_(r,s[p]),c=v(r,s[p+1]);a(e.coords,s,p,p,i,c),p+=l;for(let t=1;t<n;t++,p+=l)i+=s[p]*d,c-=s[p+1]*u,a(e.coords,s,p,p,i,c)}return e!==t&&(e.lengths.length=o.length,e.coords.length=s.length),e}function ae(e,t,n,i,r,s){const o=c(n,i),a=g(n,i,r,s),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1]);return e}function le(e,t,n,i){let r=0,s=e[i*t],o=e[i*(t+1)];for(let a=1;a<n;a++){const n=s+e[i*(t+a)],l=o+e[i*(t+a)+1],c=(n-s)*(l+o);s=n,o=l,r+=c}return.5*r}function ce(e,t){const{coords:n,lengths:i}=e;let r=0,s=0;for(let e=0;e<i.length;e++)s+=le(n,r,i[e],t),r+=e;return Math.abs(s)}function de(e,t){const n=e.clone(),i=e.coords,r=e.lengths;let s=0;for(let e=0;e<r.length;e++){const o=r[e];let a=i[t*s],l=i[t*s+1];for(let e=1;e<o;e++){const r=a+i[t*(s+e)],o=l+i[t*(s+e)+1];n.coords[t*(s+e)]=r,n.coords[t*(s+e)+1]=o,a=r,l=o}s+=o}return n}},89867:(e,t,n)=>{"use strict";n.d(t,{p:()=>r});var i=n(72094);function r(e,t,n){if(!n||!n.features||!n.hasZ)return;const r=(0,i.k)(n.geometryType,t,e.outSpatialReference);if(r)for(const e of n.features)r(e.geometry)}},72094:(e,t,n)=>{"use strict";n.d(t,{k:()=>o,P:()=>l});var i=n(59472),r=n(27780),s=n(93533);function o(e,t,n){if((0,i.Wi)(t)||(0,i.Wi)(n)||n.vcsWkid||(0,r.fS)(t,n))return null;const o=(0,s._R)(t)/(0,s._R)(n);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){e&&null!=e.z&&(e.z*=t)}(e,o);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const n of e.paths)for(const e of n)e.length>2&&(e[2]*=t)}(e,o);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const n of e.rings)for(const e of n)e.length>2&&(e[2]*=t)}(e,o);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const n of e.points)n.length>2&&(n[2]*=t)}(e,o);default:return null}}function a(e,t,n){if(null==e.hasM||e.hasZ)for(const e of t)for(const t of e)t.length>2&&(t[2]*=n)}function l(e,t,n){if(!e&&!t||!n)return;const i=(0,s._R)(n);c(e,n,i),c(t,n,i)}function c(e,t,n){if(e)for(const i of e)d(i.geometry,t,n)}function d(e,t,n){if(!e||!e.spatialReference||(0,r.fS)(e.spatialReference,t))return;const i=(0,s._R)(e.spatialReference)/n;if(1!==i)if("x"in e)null!=e.z&&(e.z*=i);else if("rings"in e)a(e,e.rings,i);else if("paths"in e)a(e,e.paths,i);else if("points"in e&&(null==e.hasM||e.hasZ))for(const t of e.points)t.length>2&&(t[2]*=i)}},69829:(e,t,n)=>{"use strict";function i(e){return e&&"function"==typeof e.highlight}n.d(t,{tl:()=>i})},95627:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var i=n(56140),r=(n(95830),n(59472)),s=(n(36544),n(79881)),o=n(60263),a=n(87566),l=n(32656),c=(n(10923),n(57002),n(86035),n(28293)),d=n(15988),u=n(80621),h=n(7354),f=n(82905),p=n(77204),m=n(29209);const g={editing:!1,operations:{add:!0,update:!0,delete:!0}},y=c.Z.ofType(f.Z);let b=class extends p.r{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...g},this.activeAttachmentInfo=null,this.attachmentInfos=new y,this.graphic=null,this.mode="view",this.handles.add([(0,u.init)(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...g,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new l.Z("invalid-layer","getAttachments(): A valid layer is required.");const n=this._getFeatureId(),i=new h.Z({objectIds:[n],returnMetadata:!0}),r=[],s=e.queryAttachments(i).then((e=>e[n]||r)).catch((()=>r));this._getAttachmentsPromise=s,this.notifyChange("state");const o=await s;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:n,graphic:i,abilities:r}=this;if(!e)throw new l.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!r.operations.add)throw new l.Z("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new l.Z("invalid-layer","addAttachment(): A valid layer is required.");const s=t.addAttachment(i,e).then((e=>this._queryAttachment(e.objectId))),o=await s;return n.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:n,graphic:i,abilities:r}=this;if(!e)throw new l.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!r.operations.delete)throw new l.Z("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new l.Z("invalid-layer","deleteAttachment(): A valid layer is required.");const s=t.deleteAttachments(i,[e.id]).then((()=>e)),o=await s;return n.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:n,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new l.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new l.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!s.operations.update)throw new l.Z("invalid-abilities","updateAttachment(): Update abilities are required.");const o=i.findIndex((e=>e===t));if(!n||"function"!=typeof n.updateAttachment)throw new l.Z("invalid-layer","updateAttachment(): A valid layer is required.");const a=n.updateAttachment(r,t.id,e).then((e=>this._queryAttachment(e.objectId))),c=await a;return i.splice(o,1,c),c}async _queryAttachment(e){if(!e)throw new l.Z("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,n=this._getFeatureId(),i=new h.Z({objectIds:[n],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(i).then((e=>e[n][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:n}=e,{attributes:i}=t;return i&&i[n]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,m.l$)(e);this._attachmentLayer=t?"scene"===t.type&&(0,r.pC)(t.associatedLayer)?t.associatedLayer:t:null}};(0,i._)([(0,s.Cb)()],b.prototype,"abilities",void 0),(0,i._)([(0,o.p)("abilities")],b.prototype,"castAbilities",null),(0,i._)([(0,s.Cb)()],b.prototype,"activeAttachmentInfo",void 0),(0,i._)([(0,s.Cb)({readOnly:!0,type:y})],b.prototype,"attachmentInfos",void 0),(0,i._)([(0,s.Cb)({type:d.default})],b.prototype,"graphic",void 0),(0,i._)([(0,s.Cb)()],b.prototype,"mode",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],b.prototype,"state",null),(0,i._)([(0,s.Cb)({readOnly:!0})],b.prototype,"supportsResizeAttachments",null),b=(0,i._)([(0,a.j)("esri.widgets.Attachments.AttachmentsViewModel")],b);const _=b},14334:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Nt});var i=n(56140),r=(n(95830),n(36544),n(79881)),s=n(51894),o=n(60263),a=n(87566),l=(n(10923),n(57002),n(86035),n(61398)),c=(n(89771),n(80621)),d=n(40450),u=n(9200),h=n(19401),f=n(90806),p=(n(68055),n(32656)),m=n(56888),g=n(95627),y=n(12973);const b={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},_="esri-attachments",v="esri-attachments__loader-container",w="esri-attachments__loader",I="esri-attachments__container",M="esri-attachments__container--list",C="esri-attachments__container--preview",F="esri-attachments__actions",A="esri-attachments__delete-button",T="esri-attachments__add-attachment-button",x="esri-attachments__error-message",j="esri-attachments__items",k="esri-attachments__item",E="esri-attachments__item-button",Z="esri-attachments__item-mask",$="esri-attachments__item-mask--icon",L="esri-attachments__image",N="esri-attachments__image--resizable",R="esri-attachments__label",P="esri-attachments__filename",S="esri-attachments__item-chevron-icon",q="esri-attachments__item-link",B="esri-attachments__item-link-overlay",O="esri-attachments__item-link-overlay-icon",z="esri-attachments__item-add-icon",V="esri-attachments__form-node",U="esri-attachments__file-fieldset",G="esri-attachments__file-label",D="esri-attachments__file-name",W="esri-attachments__file-input",H="esri-attachments__metadata",Y="esri-attachments__metadata-fieldset",X="esri-attachments__progress-bar",K="esri-widget",Q="esri-button",J="esri-button--disabled",ee="esri-button--secondary",te="esri-button--tertiary",ne="esri-button--third",ie="esri-button--small",re="esri-button--half",se="esri-widget__content--empty",oe="esri-icon-right",ae="esri-icon-left",le="esri-icon-plus",ce=window.CSS;let de=class extends f.default{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new g.Z,this.visibleElements={...b},this._supportsImageOrientation=ce&&ce.supports&&ce.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own((0,c.on)(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),(0,c.init)(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return{...b,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new p.Z("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new p.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new p.Z("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:n}=t;return(0,h.j)("div",{class:this.classes(_,K)},e?this.renderProgressBar():null,"loading"===n?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?(0,h.j)("div",{key:"error-message",class:x},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return(0,h.j)("div",{class:v,key:"loader"},(0,h.j)("div",{class:w}))}renderProgressBar(){return this.visibleElements.progressBar?(0,h.j)("div",{class:X,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,n=e||!t,i=this.visibleElements.cancelAddButton?(0,h.j)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Q,te,ie,re,e&&J)},this.messages.cancel):null,r=this.visibleElements.addSubmitButton?(0,h.j)("button",{type:"submit",disabled:n,class:this.classes(Q,ee,ie,re,{[J]:n})},this.messages.add):null,s=t?(0,h.j)("span",{key:"file-name",class:D},t.name):null,o=(0,h.j)("form",{bind:this,afterCreate:d.Se,afterRemoved:d.pV,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,h.j)("fieldset",{class:U},s,(0,h.j)("label",{class:this.classes(G,Q,ee)},t?this.messages.changeFile:this.messages.selectFile,(0,h.j)("input",{class:W,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),r,i);return(0,h.j)("div",{key:"add-form-container",class:V},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:n,selectedFile:i,submitting:r}=this,{contentType:s,size:o,url:a}=e,{abilities:l}=n,c=r||!i,u=l.editing&&l.operations.delete&&t.deleteButton?(0,h.j)("button",{key:"delete-button",type:"button",disabled:r,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(Q,ie,te,A,{[J]:r})},this.messages.delete):null,f=l.editing&&l.operations.update&&t.updateButton?(0,h.j)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(Q,ie,ne,{[J]:c})},this.messages.update):null,p=this.visibleElements.cancelUpdateButton?(0,h.j)("button",{disabled:r,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Q,ie,te,ne,{[J]:r})},this.messages.cancel):null,g=i?(0,h.j)("span",{key:"file-name",class:D},i.name):null,y=l.editing&&l.operations.update?(0,h.j)("fieldset",{key:"file",class:U},g,(0,h.j)("label",{class:this.classes(G,Q,ee)},this.messages.changeFile,(0,h.j)("input",{class:W,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,b=(0,h.j)("fieldset",{key:"size",class:Y},(0,h.j)("label",null,(0,m.sS)(this.messagesUnits,o))),_=(0,h.j)("fieldset",{key:"content-type",class:Y},(0,h.j)("label",null,s)),v=(0,h.j)("form",{bind:this,afterCreate:d.Se,afterRemoved:d.pV,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},(0,h.j)("div",{class:H},b,_),y,(0,h.j)("div",{class:F},u,p,f));return(0,h.j)("div",{key:"edit-form-container",class:V},(0,h.j)("a",{class:q,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),(0,h.j)("div",{class:B},(0,h.j)("span",{class:O},(0,h.j)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(0,h.j)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),(0,h.j)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),v)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:n}=this.viewModel,{contentType:i,name:r,url:s}=e,o=n&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(i),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=-1===s.indexOf("?")?"?":"&",d=o?`${s}${c}w=${t}`:function(e){const t=(0,y.V)("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:-1!==e.indexOf("image/")?`${t}image-32.svg`:-1!==e.indexOf("audio/")?`${t}sound-32.svg`:-1!==e.indexOf("video/")?`${t}video-32.svg`:-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?`${t}excel-32.svg`:-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?`${t}word-32.svg`:-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(i),u={[$]:!o},f={[N]:n};return(0,h.j)("div",{class:this.classes(u,Z)},(0,h.j)("img",{styles:l,alt:r,src:d,class:this.classes(f,L)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:n}=this,{abilities:i}=n,{name:r,url:s}=e,o=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),a=i.editing?(0,h.j)("span",{"aria-hidden":"true",class:this.classes(S,(0,d.dZ)()?ae:oe)}):null,l=[o,(0,h.j)("label",{class:R},(0,h.j)("span",{class:P},r||this.messages.noTitle),a)],c=i.editing?(0,h.j)("button",{key:"details-button",bind:this,class:E,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):(0,h.j)("a",{key:"details-link",class:E,href:s,target:"_blank"},l);return(0,h.j)("li",{class:k,key:e},c)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:n}=this,{attachmentInfos:i,abilities:r}=t,s=i&&i.length,o={[M]:"preview"!==e,[C]:"preview"===e},a=r.editing&&r.operations.add&&n.addButton?(0,h.j)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Q,te,T),type:"button"},(0,h.j)("span",{"aria-hidden":"true",class:this.classes(z,le)}),this.messages.add):null,l=s?(0,h.j)("ul",{class:j},i.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):(0,h.j)("div",{class:se},this.messages.noAttachments);return(0,h.j)("div",{key:"attachments-container",class:this.classes(I,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,n=t&&t.files&&t.files.item(0);this._set("selectedFile",n)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:n}=e;return!this._supportsImageOrientation&&t&&n?[n.rotation?`rotate(${n.rotation}deg)`:"",n.mirrored?"scaleX(-1)":""].join(" "):""}};(0,i._)([(0,s.B)("viewModel.abilities")],de.prototype,"abilities",void 0),(0,i._)([(0,r.Cb)()],de.prototype,"displayType",void 0),(0,i._)([(0,s.B)("viewModel.graphic")],de.prototype,"graphic",void 0),(0,i._)([(0,r.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],de.prototype,"label",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/Attachments/t9n/Attachments")],de.prototype,"messages",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/core/t9n/Units")],de.prototype,"messagesUnits",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],de.prototype,"selectedFile",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],de.prototype,"submitting",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],de.prototype,"error",void 0),(0,i._)([(0,r.Cb)({type:g.Z})],de.prototype,"viewModel",void 0),(0,i._)([(0,r.Cb)()],de.prototype,"visibleElements",void 0),(0,i._)([(0,o.p)("visibleElements")],de.prototype,"castVisibleElements",null),de=(0,i._)([(0,a.j)("esri.widgets.Attachments")],de);const ue=de;var he=n(74181);const fe="esri-feature-element-info",pe="esri-feature-element-info__title",me="esri-feature-element-info__description";let ge=class extends f.default{constructor(e,t){super(e,t),this.description=null,this.title=null}render(){return(0,h.j)("div",{class:fe},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?(0,h.j)("h2",{key:"title",class:pe},e):null}renderDescription(){const{description:e}=this;return e?(0,h.j)("div",{key:"description",class:me},e):null}};(0,i._)([(0,r.Cb)()],ge.prototype,"description",void 0),(0,i._)([(0,r.Cb)()],ge.prototype,"title",void 0),ge=(0,i._)([(0,a.j)("esri.widgets.Feature.support.FeatureElementInfo")],ge);const ye=ge,be="esri-feature-attachments";let _e=class extends f.default{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new ue,this.description=null,this.displayType=null,this.graphic=null,this.title=null,this.viewModel=new he.Z}initialize(){this._featureElementInfo=new ye,(0,c.init)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())),(0,c.init)(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return(0,h.j)("div",{class:be},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}};(0,i._)([(0,r.Cb)({readOnly:!0})],_e.prototype,"attachmentsWidget",void 0),(0,i._)([(0,s.B)("viewModel.description")],_e.prototype,"description",void 0),(0,i._)([(0,s.B)("attachmentsWidget.displayType")],_e.prototype,"displayType",void 0),(0,i._)([(0,s.B)("viewModel.graphic")],_e.prototype,"graphic",void 0),(0,i._)([(0,s.B)("viewModel.title")],_e.prototype,"title",void 0),(0,i._)([(0,r.Cb)({type:he.Z})],_e.prototype,"viewModel",void 0),_e=(0,i._)([(0,a.j)("esri.widgets.Feature.FeatureAttachments")],_e);const ve=_e;var we=n(88266),Ie=n(29209),Me=n(39498);const Ce="esri-feature-content",Fe="esri-feature-content__loader-container",Ae="esri-feature-content__loader";let Te=class extends f.default{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{(0,Ie.or)(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return(0,h.j)("div",{class:Fe,key:"loader"},(0,h.j)("div",{class:Ae}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?(0,h.j)("div",{key:t,bind:t,afterCreate:this._attachToNode}):(0,we.isWidget)(t)?(0,h.j)("div",{key:t},!t.destroyed&&t.render()):(0,h.j)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return(0,h.j)("div",{class:Ce},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};(0,i._)([(0,s.B)("viewModel.creator")],Te.prototype,"creator",void 0),(0,i._)([(0,s.B)("viewModel.graphic")],Te.prototype,"graphic",void 0),(0,i._)([(0,r.Cb)({type:Me.Z})],Te.prototype,"viewModel",void 0),Te=(0,i._)([(0,a.j)("esri.widgets.Feature.FeatureContent")],Te);const xe=Te;var je=n(54881),ke=n(88263);const Ee=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Ze(e){let t=null;return Ee.some((n=>(n.pattern.test(e)&&(t=n),!!t))),t}function $e(e,t){if("string"!=typeof t||!t)return t;const n=Ze(t);if(!n)return t;const i=t.match(n.pattern),r=i&&i[2],s=(0,ke.gx)((0,ke.gx)(n.label,{messages:e,hierPart:r}),{appName:n.appName}),o=n.target?` target="${n.target}"`:"",a="_blank"===n.target?' rel="noreferrer"':"";return t.replace(n.pattern,`<a${o} href="$1"${a}>${s}</a>`)}const Le="esri-feature-fields",Ne="esri-feature-fields__field-header",Re="esri-feature-fields__field-data",Pe="esri-feature-fields__field-data--date",Se="esri-widget__table";let qe=class extends f.default{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new je.Z,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ye,(0,c.init)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:n}=this.viewModel,i=e.fieldName,r=e.label||i,s=n?null==n[i]?"":n[i]:"",o=!(!e.format||!e.format.dateFormat),a="number"!=typeof s||o?$e(this.messagesURIUtils,s):this._forceLTR(s),l={[Pe]:o};return(0,h.j)("tr",{key:`fields-element-info-row-${i}-${t}`},(0,h.j)("th",{key:`fields-element-info-row-header-${i}-${t}`,class:Ne,innerHTML:r}),(0,h.j)("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(Re,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?(0,h.j)("table",{class:Se,summary:this.messages.fieldsSummary},(0,h.j)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return(0,h.j)("div",{class:Le},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};(0,i._)([(0,s.B)("viewModel.attributes")],qe.prototype,"attributes",void 0),(0,i._)([(0,s.B)("viewModel.description")],qe.prototype,"description",void 0),(0,i._)([(0,s.B)("viewModel.expressionInfos")],qe.prototype,"expressionInfos",void 0),(0,i._)([(0,s.B)("viewModel.fieldInfos")],qe.prototype,"fieldInfos",void 0),(0,i._)([(0,s.B)("viewModel.title")],qe.prototype,"title",void 0),(0,i._)([(0,r.Cb)({type:je.Z})],qe.prototype,"viewModel",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/Feature/t9n/Feature")],qe.prototype,"messages",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/support/t9n/uriUtils")],qe.prototype,"messagesURIUtils",void 0),qe=(0,i._)([(0,a.j)("esri.widgets.Feature.FeatureFields")],qe);const Be=qe;var Oe=n(10180),ze=n(36861),Ve=n(3766),Ue=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Ge=[].concat(Ue.slice(30,39),Ue.slice(28,30).reverse()),De=[{name:"default",colors:Ge},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const We="en-us",He=new Map([["ar",()=>n.e(5740).then(n.bind(n,75740)).then((function(e){return e.a}))],["bs-ba",()=>n.e(2094).then(n.bind(n,2094)).then((function(e){return e.b}))],["ca-es",()=>n.e(8340).then(n.bind(n,98340)).then((function(e){return e.c}))],["cs-cz",()=>n.e(4562).then(n.bind(n,44562)).then((function(e){return e.c}))],["da-dk",()=>n.e(6983).then(n.bind(n,76983)).then((function(e){return e.d}))],["de-de",()=>n.e(8973).then(n.bind(n,28973)).then((function(e){return e.d}))],["de-ch",()=>n.e(9645).then(n.bind(n,59645)).then((function(e){return e.d}))],["el-gr",()=>n.e(965).then(n.bind(n,50965)).then((function(e){return e.e}))],["en-us",()=>n.e(8724).then(n.bind(n,8724)).then((function(e){return e.e}))],["en-ca",()=>n.e(4488).then(n.bind(n,14488)).then((function(e){return e.e}))],["es-es",()=>n.e(699).then(n.bind(n,699)).then((function(e){return e.e}))],["et-ee",()=>n.e(8093).then(n.bind(n,48093)).then((function(e){return e.e}))],["fi-fi",()=>n.e(4894).then(n.bind(n,74894)).then((function(e){return e.f}))],["fr-fr",()=>n.e(7467).then(n.bind(n,47467)).then((function(e){return e.f}))],["he-il",()=>n.e(3824).then(n.bind(n,73824)).then((function(e){return e.h}))],["hr-hr",()=>n.e(3058).then(n.bind(n,83058)).then((function(e){return e.h}))],["hu-hu",()=>n.e(3952).then(n.bind(n,33952)).then((function(e){return e.h}))],["id-id",()=>n.e(4840).then(n.bind(n,94840)).then((function(e){return e.i}))],["it-it",()=>n.e(613).then(n.bind(n,20613)).then((function(e){return e.i}))],["ja-jp",()=>n.e(8613).then(n.bind(n,88613)).then((function(e){return e.j}))],["ko-kr",()=>n.e(152).then(n.bind(n,80152)).then((function(e){return e.k}))],["lt-lt",()=>n.e(9713).then(n.bind(n,99713)).then((function(e){return e.l}))],["lv-lv",()=>n.e(58).then(n.bind(n,58)).then((function(e){return e.l}))],["nb-no",()=>n.e(8745).then(n.bind(n,70169)).then((function(e){return e.n}))],["nl-nl",()=>n.e(6734).then(n.bind(n,46734)).then((function(e){return e.n}))],["pl-pl",()=>n.e(86).then(n.bind(n,70086)).then((function(e){return e.p}))],["pt-br",()=>n.e(3973).then(n.bind(n,13973)).then((function(e){return e.p}))],["pt-pt",()=>n.e(3566).then(n.bind(n,23566)).then((function(e){return e.p}))],["ro-ro",()=>n.e(885).then(n.bind(n,30885)).then((function(e){return e.r}))],["ru-ru",()=>n.e(2907).then(n.bind(n,22907)).then((function(e){return e.r}))],["sl-sl",()=>n.e(4294).then(n.bind(n,94294)).then((function(e){return e.s}))],["sr-rs",()=>n.e(8899).then(n.bind(n,78899)).then((function(e){return e.s}))],["sv-se",()=>n.e(3528).then(n.bind(n,33528)).then((function(e){return e.s}))],["th-th",()=>n.e(6311).then(n.bind(n,66311)).then((function(e){return e.t}))],["tr-tr",()=>n.e(8817).then(n.bind(n,8817)).then((function(e){return e.t}))],["uk-ua",()=>n.e(7863).then(n.bind(n,97863)).then((function(e){return e.u}))],["vi-vn",()=>n.e(4658).then(n.bind(n,74658)).then((function(e){return e.v}))],["zh-cn",()=>n.e(7892).then(n.bind(n,77892)).then((function(e){return e.z}))],["zh-hk",()=>n.e(5541).then(n.bind(n,45541)).then((function(e){return e.z}))],["zh-tw",()=>n.e(5541).then(n.bind(n,45541)).then((function(e){return e.z}))]]);function Ye(e){return e?He.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let n=null;for(const e of He.keys())if(e.startsWith(t)){n=e;break}return n}(e)||We:We}let Xe,Ke;function Qe(e,t="default"){const n=De.find((e=>e.name===t));return n?n.colors.map((t=>e.color(t))):null}const Je="esri-feature-media",et="esri-feature-media__container",tt="esri-feature-media__item-container",nt="esri-feature-media__item",it="esri-feature-media__item-title",rt="esri-feature-media__item-caption",st="esri-feature-media__previous",ot="esri-feature-media__previous-icon",at="esri-feature-media__previous-icon--rtl",lt="esri-feature-media__next",ct="esri-feature-media__next-icon",dt="esri-feature-media__next-icon--rtl",ut="esri-feature-media__chart",ht="esri-feature-media__button",ft="esri-feature-media__icon",pt="esri-icon-left-triangle-arrow",mt="esri-icon-right-triangle-arrow",gt=.05,yt=.95;let bt=class extends f.default{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new ze.Z,this.messages=null}initialize(){this._featureElementInfo=new ye,this.own((0,c.init)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),(0,c.init)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return(0,h.j)("div",{bind:this,class:Je,onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?(0,h.j)("div",{key:"media-element-container",class:et},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:n,formattedMediaInfoCount:i}=this.viewModel,{value:r,refreshInterval:s,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:d}=r,u=(0,Ie.or)(d)?"_blank":"_self",f="_blank"===u?"noreferrer":"",p=s?t:null,m=p?p.timestamp:0,g=p?p.sourceURL:c,y=(0,h.j)("img",{alt:o||a,key:`media-${l}-${n}-${i}-${m}`,src:g});return(d?(0,h.j)("a",{title:a,href:d,rel:f,target:u},y):null)||y}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:n}=this.viewModel;return(0,h.j)("div",{key:`media-${e.type}-${t}-${n}`,bind:this,class:ut,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel,t=e.title?(0,h.j)("div",{key:"media-title",class:it,innerHTML:e.title}):null,n=e.caption?(0,h.j)("div",{key:"media-caption",class:rt,innerHTML:e.caption}):null;return(0,h.j)("div",{key:"media-container",class:tt},t,n,(0,h.j)("div",{key:"media-item-container",class:nt},this.renderMediaInfoType()))}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,n=t?this.messages.previous:this.messages.next,i=t?this.classes(ht,st):this.classes(ht,lt),r=t?this.classes(ft,ot,pt):this.classes(ft,ct,mt),s=t?this.classes(ft,at,mt):this.classes(ft,dt,pt),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return(0,h.j)("button",{type:"button",key:o,title:n,"aria-label":n,tabIndex:0,class:i,bind:this,onclick:a},(0,h.j)("span",{"aria-hidden":"true",class:r}),(0,h.j)("span",{"aria-hidden":"true",class:s}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=(0,Ve.Kd)()){if(e=Ye(e),Xe&&e===Ke)return Xe;Xe=n.e(5959).then(n.bind(n,95959)).then((function(e){return e.i})),Ke=e;try{const[t,n]=await Promise.all([Xe,He.get(Ke)()]);Ke===e&&(t.am4core.options.defaultLocale=n.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Xe=null,Ke=null,null}return Xe}(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:i,chartsModule:t})}_handleMediaKeyup(e){const t=(0,Oe.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:n,mediaInfo:i}=e,{value:r,type:s}=i,{am4core:o}=t,a=Qe(o);(0,d.$o)()&&o.useTheme(t.am4themes_dark),o.useTheme(t.am4themes_animated),o.useTheme((function(e){e instanceof o.ColorSet&&a&&(e.list=a)}));const l="pie-chart"===s?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",i.altText||i.title),l.data=r.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==s||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:n}=e,{am4core:i,am4charts:r}=n,s=i.create(t,r.PieChart);s.rtl=(0,d.dZ)();const o=s.series.push(new r.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,i),s}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:n,mediaInfo:i}=t,{value:r}=i,{am4core:s,am4charts:o}=n,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,s),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=gt,l.renderer.maxLabelPosition=yt,l.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const d=e.series.push(new o.ColumnSeries);d.dataFields.valueY="value",d.dataFields.categoryX="tooltip",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarX=new s.Scrollbar)}_createBarChart(e,t){const{chartsModule:n,mediaInfo:i}=t,{value:r}=i,{am4core:s,am4charts:o}=n,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,s),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=gt,l.renderer.maxLabelPosition=yt,l.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const d=e.series.push(new o.ColumnSeries);d.dataFields.valueX="value",d.dataFields.categoryY="tooltip",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarY=new s.Scrollbar)}_createLineChart(e,t){const{chartsModule:n,mediaInfo:i}=t,{value:r}=i,{am4core:s,am4charts:o}=n,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,s),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=gt,l.renderer.maxLabelPosition=yt,l.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const d=e.series.push(new o.LineSeries);d.dataFields.categoryX="tooltip",d.dataFields.valueY="value",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarX=new s.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:n,mediaInfo:i}=e,{type:r}=i,{am4core:s,am4charts:o}=n,a=s.create(t,o.XYChart);return a.rtl=(0,d.dZ)(),"column-chart"===r&&this._createColumnChart(a,e),"bar-chart"===r&&this._createBarChart(a,e),"line-chart"===r&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:n}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(n.sourceURL);const r=setInterval((()=>{this._updateMediaInfoTimestamp(n.sourceURL)}),i);this._refreshTimer=r}_getImageSource(e,t){const n=-1!==e.indexOf("?")?"&":"?",[i,r=""]=e.split("#");return`${i}${n}timestamp=${t}${r?"#":""}${r}`}};(0,i._)([(0,s.B)("viewModel.attributes")],bt.prototype,"attributes",void 0),(0,i._)([(0,s.B)("viewModel.activeMediaInfoIndex")],bt.prototype,"activeMediaInfoIndex",void 0),(0,i._)([(0,s.B)("viewModel.description")],bt.prototype,"description",void 0),(0,i._)([(0,s.B)("viewModel.fieldInfoMap")],bt.prototype,"fieldInfoMap",void 0),(0,i._)([(0,s.B)("viewModel.layer")],bt.prototype,"layer",void 0),(0,i._)([(0,s.B)("viewModel.mediaInfos")],bt.prototype,"mediaInfos",void 0),(0,i._)([(0,s.B)("viewModel.popupTemplate")],bt.prototype,"popupTemplate",void 0),(0,i._)([(0,s.B)("viewModel.relatedInfos")],bt.prototype,"relatedInfos",void 0),(0,i._)([(0,s.B)("viewModel.title")],bt.prototype,"title",void 0),(0,i._)([(0,r.Cb)({type:ze.Z})],bt.prototype,"viewModel",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/Feature/t9n/Feature")],bt.prototype,"messages",void 0),bt=(0,i._)([(0,a.j)("esri.widgets.Feature.FeatureMedia")],bt);const _t=bt;var vt=n(45598),wt=n(22020);const It="esri-icon-loading-indicator esri-rotating",Mt="esri-widget",Ct="esri-feature",Ft="esri-feature__size-container",At="esri-feature__title",Tt="esri-feature__main-container",xt="esri-feature__content-element",jt="esri-feature__text",kt="esri-feature__last-edited-info",Et="esri-feature__loading-container",Zt="esri-feature__loading-spinner",$t={title:!0,content:!0,lastEditedInfo:!0};let Lt=class extends((0,wt.q)(f.default)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...$t},this.map=null,this.view=null,this.viewModel=new vt.Z}initialize(){this.own((0,c.init)(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...$t,...e}}render(){const{waitingForContent:e}=this.viewModel;return(0,h.j)("div",{class:this.classes(Ct,Mt)},(0,h.j)("div",{class:Ft},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return(0,h.j)("div",{key:"loading-container",class:Et},(0,h.j)("span",{class:this.classes(It,Zt)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?(0,h.j)("div",{class:Tt},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?(0,h.j)("h4",{class:At,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,h.j)("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:(0,h.j)("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:i}=t.viewModel;return"loading"===n||i.length>0?(0,h.j)("div",{key:this._buildKey("attachments-element",e),class:this.classes(xt)},t.render()):null}renderCustom(e,t){const{creator:n}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:n?(0,h.j)("div",{key:this._buildKey("custom-element",t),class:xt},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,h.j)("div",{key:this._buildKey("fields-element",e),class:xt},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,h.j)("div",{key:this._buildKey("media-element",e),class:xt},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:i,user:r}=n,s="edit"===n.type?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,o=(0,l.n)(s,{date:i,user:r});return(0,h.j)("div",{key:"edit-info-element",class:this.classes(kt,xt)},o)}renderText(e,t){const n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?(0,h.j)("div",{key:this._buildKey("text-element",t),class:this.classes(xt,jt)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,n)=>{"attachments"===e.type&&(this._contentWidgets[n]=new ve({displayType:e.displayType,viewModel:t[n]})),"fields"===e.type&&(this._contentWidgets[n]=new Be({viewModel:t[n]})),"media"===e.type&&(this._contentWidgets[n]=new _t({viewModel:t[n]})),"text"===e.type&&(this._contentWidgets[n]=new xe({viewModel:t[n]})),"custom"===e.type&&(this._contentWidgets[n]=new xe({viewModel:t[n]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new xe({viewModel:e}))}this.scheduleRender()}};(0,i._)([(0,s.B)("viewModel.graphic")],Lt.prototype,"graphic",void 0),(0,i._)([(0,s.B)("viewModel.defaultPopupTemplateEnabled")],Lt.prototype,"defaultPopupTemplateEnabled",void 0),(0,i._)([(0,r.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Lt.prototype,"label",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/Feature/t9n/Feature")],Lt.prototype,"messages",void 0),(0,i._)([(0,r.Cb)(),(0,u.H)("esri/widgets/support/t9n/uriUtils")],Lt.prototype,"messagesURIUtils",void 0),(0,i._)([(0,s.B)("viewModel.spatialReference")],Lt.prototype,"spatialReference",void 0),(0,i._)([(0,s.B)("viewModel.title")],Lt.prototype,"title",void 0),(0,i._)([(0,r.Cb)()],Lt.prototype,"visibleElements",void 0),(0,i._)([(0,o.p)("visibleElements")],Lt.prototype,"castVisibleElements",null),(0,i._)([(0,s.B)("viewModel.map")],Lt.prototype,"map",void 0),(0,i._)([(0,s.B)("viewModel.view")],Lt.prototype,"view",void 0),(0,i._)([(0,r.Cb)({type:vt.Z})],Lt.prototype,"viewModel",void 0),Lt=(0,i._)([(0,a.j)("esri.widgets.Feature")],Lt);const Nt=Lt},74181:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881)),s=n(87566),o=(n(10923),n(57002),n(86035),n(95627));let a=class extends o.Z{constructor(e){super(e),this.description=null,this.title=null}};(0,i._)([(0,r.Cb)()],a.prototype,"description",void 0),(0,i._)([(0,r.Cb)()],a.prototype,"title",void 0),a=(0,i._)([(0,s.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],a);const l=a},39498:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881)),s=n(87566),o=(n(10923),n(57002),n(86035),n(82677)),a=n(15988),l=n(80621),c=n(77204),d=n(29209);let u=class extends((0,c.p)(o.default)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add((0,l.init)(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:n}=this;e&&((0,d.vD)(n,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,n=(0,d.vD)(e,{graphic:t}).catch((()=>null));this._loadingPromise=n,this.notifyChange("state");const i=await n;n===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};(0,i._)([(0,r.Cb)({readOnly:!0})],u.prototype,"created",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"creator",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"destroyer",void 0),(0,i._)([(0,r.Cb)({type:a.default})],u.prototype,"graphic",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],u.prototype,"state",null),u=(0,i._)([(0,s.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],u);const h=u},54881:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881)),s=n(87566),o=(n(10923),n(57002),n(86035),n(82677)),a=n(20628),l=n(7417),c=n(29209);let d=class extends o.default{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,n=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const i=t.clone();i.label=(0,c.JD)(i,e),n.push(i)})),n}};(0,i._)([(0,r.Cb)()],d.prototype,"attributes",void 0),(0,i._)([(0,r.Cb)({type:[l.Z]})],d.prototype,"expressionInfos",void 0),(0,i._)([(0,r.Cb)()],d.prototype,"description",void 0),(0,i._)([(0,r.Cb)({type:[a.Z]})],d.prototype,"fieldInfos",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],d.prototype,"formattedFieldInfos",null),(0,i._)([(0,r.Cb)()],d.prototype,"title",void 0),d=(0,i._)([(0,s.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],d);const u=d},36861:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881)),s=n(87566),o=(n(10923),n(57002),n(86035),n(82677)),a=n(20628),l=n(62813),c=n(29209),d=n(47873);let u=class extends o.default{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,n=(e+t)%t;this.activeMediaInfoIndex=n}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,n=t+e;this._setContentElementMedia(n)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:n,fieldInfoMap:i,layer:r}=this,s={...n,...e};return null==t?void 0:t.map((t=>{if(!t)return null;const o=t.title?(0,c.f5)(t.title,s,r):"";t.title=o?(0,c.ar)({formattedAttributes:n,template:o,fieldInfoMap:i}):"";const a=t.caption?(0,c.f5)(t.caption,s,r):"";t.caption=a?(0,c.ar)({formattedAttributes:n,template:a,fieldInfoMap:i}):"";const l=t.altText?(0,c.f5)(t.altText,s,r):"";if(t.altText=l?(0,c.ar)({formattedAttributes:n,template:l,fieldInfoMap:i}):"","image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:n,layer:r}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:i}=t;return this._setChartValue({value:i,chartType:t.type,attributes:e,formattedAttributes:n,layer:r}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:n,formattedAttributes:i,layer:r}=e,{linkURL:s,sourceURL:o}=n;if(o){const e=(0,c.Qu)(o,r);n.sourceURL=(0,c.ar)({formattedAttributes:i,template:e,fieldInfoMap:t})}if(s){const e=(0,c.Qu)(s,r);n.linkURL=(0,c.ar)({formattedAttributes:i,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:n,formattedAttributes:i,chartType:r,layer:s}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:d}=t;if(t.fields=(0,c.iJ)(l,s),d&&(t.normalizeField=(0,c.k6)(d,s)),!l.some((e=>!!(null!=i[e]||(0,c.oM)(e)&&a.size))))return;const u=null==o?void 0:o.fieldInfos;l.forEach((e=>{if((0,c.oM)(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:e,formattedAttributes:i,chartType:r,value:t})]);const s=this._getChartOption({value:t,attributes:n,chartType:r,formattedAttributes:i,fieldName:e,fieldInfos:u});t.series.push(s)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:n,fieldName:i,formattedAttributes:r,chartType:s,value:o}=e,a=[],l=(0,d.Bt)(i),{layerId:c,fieldName:u}=l,h=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!h)return a;const{relatedFeatures:f,relation:p}=h;if(!p||!f)return a;const{cardinality:m}=p;return f.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===u&&a.push(this._getChartOption({value:o,attributes:t,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:e,fieldInfos:n}))}))})),"one-to-many"===m||"many-to-many"===m?a:[a[0]]}_getTooltip({label:e,value:t,chartType:n}){return"pie-chart"===n?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:n,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:o,fieldInfos:u,chartType:h}=e,{layer:f}=this,{normalizeField:p,tooltipField:m}=n,g=p?(0,c.oM)(p)?i[(0,d.Bt)(p).fieldName]:i[p]:null,y=o&&void 0!==i[o]?i[o]:void 0!==i[s]?i[s]:r[s],b=void 0===y?null:y&&g?y/g:y,_=new l.Z({value:b});if((0,c.oM)(s)){const e=(0,d.Bt)(s),t=(0,d.Bt)(m),n=t?t.fieldName:null,r=(0,c.P_)(b,{fieldInfos:u,fieldName:o,layer:f,preventPlacesFormatting:!!g}),a=e?e.label||e.fieldName:o,l=n&&void 0!==i[n]?i[n]:a;return _.tooltip=this._getTooltip({label:l,value:r,chartType:h}),_}const v=(0,c._R)(u,s),w=(0,c.k6)(s,f),I=m&&void 0!==r[m]?r[m]:(0,c.JD)(v||new a.Z({fieldName:w}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),M=r[w];return _.tooltip=this._getTooltip({label:I,value:M,chartType:h}),_}};(0,i._)([(0,r.Cb)()],u.prototype,"activeMediaInfoIndex",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],u.prototype,"activeMediaInfo",null),(0,i._)([(0,r.Cb)()],u.prototype,"attributes",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"description",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"fieldInfoMap",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"formattedAttributes",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],u.prototype,"formattedMediaInfos",null),(0,i._)([(0,r.Cb)()],u.prototype,"layer",void 0),(0,i._)([(0,r.Cb)({readOnly:!0})],u.prototype,"formattedMediaInfoCount",null),(0,i._)([(0,r.Cb)()],u.prototype,"mediaInfos",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"popupTemplate",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"relatedInfos",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"title",void 0),u=(0,i._)([(0,s.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],u);const h=u},45598:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var i=n(56140),r=(n(95830),n(59472)),s=n(36544),o=(n(68055),n(79881)),a=n(87566),l=(n(10923),n(57002),n(86035),n(39105)),c=n(82677),d=n(75107),u=n(15988),h=n(59691),f=n(80621),p=n(69065),m=n(29209),g=n(74181),y=n(39498),b=n(54881),_=n(47873),v=n(36861),w=n(89632);const I=["$datastore","$map","$layer","$aggregatedfeatures"],M=s.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function C({graphic:e,view:t}){const{isAggregate:n,layer:i}=e;if(!n||!i||"2d"!==(null==t?void 0:t.type))return[];const r=await t.whenLayerView(i);if(!r.createQuery||!r.queryFeatures)return[];const s=r.createQuery();s.aggregateIds=[e.getObjectId()];const{features:o}=await r.queryFeatures(s);return o}async function F({expressionAttributes:e,info:t,arcadeUtils:n,spatialReference:i,map:r,graphic:s,view:o}){const a=`expression/${t.name}`,l=n.createSyntaxTree(t.expression),c=I.filter((e=>n.hasVariable(l,e)));await n.loadScriptDependencies(l,!0,c);const d=n.getViewInfo({spatialReference:i}),u=n.createExecContext(s,d);u.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:n,context:i,viewInfo:r,map:s,graphic:o}){n.forEach((n=>{const a=n.toLowerCase(),l={map:s,spatialReference:r.sr};if("$map"===a&&(i.vars[a]=t.convertMapToFeatureSetCollection(l)),"$layer"===a&&(i.vars[a]=t.convertFeatureLayerToFeatureSet(o.sourceLayer,r.sr)),"$datastore"===a&&(i.vars[a]=t.convertServiceUrlToWorkspace(o.sourceLayer.url,r.sr)),"$aggregatedfeatures"===a){const n=o.layer,{fields:s,objectIdField:l,geometryType:c,spatialReference:d,displayField:u}=n,h=new w.default({fields:s,objectIdField:l,geometryType:c,spatialReference:d,displayField:u,..."feature"===n.type?{templates:n.templates,typeIdField:n.typeIdField,types:n.types}:null,source:e});i.vars[a]=t.convertFeatureLayerToFeatureSet(h,r.sr)}}))}({aggregatedFeatures:await C({graphic:s,view:o}),arcadeUtils:n,featureSetVars:c,context:u,viewInfo:d,map:r,graphic:s});const h=n.createFunction(l,u),f=await n.executeAsyncFunction(h,u).catch((e=>M.error("arcade-execution-error",{error:e,graphic:s,expressionInfo:t})));e[a]="string"==typeof f?(0,m.qD)((0,m.M3)(f)):Array.isArray(f)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?(0,m.qD)((0,m.M3)(e)):e}</li>`)).join("")}</ul>`}(f):f&&"esri.arcade.Dictionary"===f.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const n=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof n?(0,m.qD)((0,m.M3)(n)):n}</td></tr>`})).join("")}</table>`}(f):f}async function A({popupTemplate:e,spatialReference:t,graphic:i,map:r,view:s}){const o=e.expressionInfos,a=[],c={};if(!o||!o.length)return c;const d=await n.e(9043).then(n.bind(n,9043));for(const e of o)a.push(F({expressionAttributes:c,info:e,arcadeUtils:d,spatialReference:t,map:r,graphic:i,view:s}));return await(0,l.eachAlways)(a),c}const T="esri.widgets.FeatureViewModel",x=s.Z.getLogger(T);let j=class extends c.default{constructor(e){super(e),this._handles=new h.Z,this._featureAbortController=null,this.graphicChangedThrottled=(0,p.P)(this.graphicChanged,1,this),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add((0,f.init)(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return(0,r.pC)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return(0,m.cT)((0,m.Hs)(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return(0,m.l$)(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const n=this.contentViewModels[e];n instanceof v.Z&&n.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof v.Z&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof v.Z&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=(0,l.createAbortController)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){x.error("error","error loading popupTemplate for graphic",{error:t,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new d.Z({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:n}=this,{description:i,title:r}=e;return this.contentViewModels[t]=new g.Z({description:i,graphic:n,title:r}),e}_compileCustom(e,t){const{graphic:n}=this,{creator:i,destroyer:r}=e;return this.contentViewModels[t]=new y.Z({graphic:n,creator:i,destroyer:r}),e}_compileFields(e,t){const{_effectivePopupTemplate:n,formattedAttributes:i}=this,r=e.clone(),s=(null==e?void 0:e.fieldInfos)||(null==n?void 0:n.fieldInfos),o=null==n?void 0:n.expressionInfos,a={...i.global,...i.content[t]},{description:l,title:c}=r,d=new b.Z({attributes:a,description:l,expressionInfos:o,fieldInfos:s,title:c});return this.contentViewModels[t]=d,r.fieldInfos=d.formattedFieldInfos.slice(0),r}_compileMedia(e,t){const{graphic:n,_fieldInfoMap:i,_effectivePopupTemplate:r,relatedInfos:s,_sourceLayer:o}=this,{attributes:a}=n,l=this.formattedAttributes.global,c=e.clone(),{description:d,mediaInfos:u,title:h}=c,f=new v.Z({activeMediaInfoIndex:c.activeMediaInfoIndex||0,attributes:a,description:d,layer:o,fieldInfoMap:i,formattedAttributes:l,mediaInfos:u,popupTemplate:r,relatedInfos:s,title:h});return c.mediaInfos=f.formattedMediaInfos.slice(0),this.contentViewModels[t]=f,c}_compileText(e,t){const n=e.clone(),{graphic:i,_fieldInfoMap:r,_sourceLayer:s}=this;if(n&&n.text){const{attributes:e}=i,t=this.formattedAttributes.global,o=(0,m.f5)(n.text,{...t,...e},s);n.text=(0,m.ar)({formattedAttributes:t,template:o,fieldInfoMap:r})}return this.contentViewModels[t]=new y.Z({graphic:i,creator:n.text}),n}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:n}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,r=null==t?void 0:t.editFieldsInfo;return i&&r?(0,m.Tj)(r,n.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:n,graphic:i}=this,{attributes:r}=i,s=this.formattedAttributes.global;if(e){const i=(0,m.f5)(e,{...s,...r},n);return(0,m.ar)({formattedAttributes:s,template:i,fieldInfoMap:t})}return""}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,n=null==e?void 0:e.title;return(0,m.vD)(n,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,n=null==e?void 0:e.content;return(0,m.vD)(n,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:n,graphic:i,_effectivePopupTemplate:r,spatialReference:s,map:o,view:a}=this,{content:{value:c},title:{value:d}}=await(0,l.eachAlways)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!i)return;const{expressionAttributes:{value:u}}=await(0,l.eachAlways)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:A({popupTemplate:this._effectivePopupTemplate,spatialReference:s,graphic:i,map:o,view:a}),queryUpdatedFeature:(0,m.Xh)({graphic:i,popupTemplate:r,layer:n,spatialReference:s},e)});t===this._featureAbortController&&i&&(this._set("formattedAttributes",this._createFormattedAttributes(c,u)),this._set("title",this._compileTitle(d)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:n,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:o}=this,a=null==n?void 0:n.fieldInfos,l={...i.attributes,...t},c={global:(0,m.uI)({fieldInfos:a,graphic:i,attributes:l,layer:s,fieldInfoMap:o,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(c.content[t]=(0,m.uI)({fieldInfos:e.fieldInfos,graphic:i,attributes:l,layer:s,fieldInfoMap:o,relatedInfos:r}))})),c}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:n}=this;return this._queryRelatedInfos(t,(0,m.Hs)(n),e)}async _queryRelatedInfos(e,t,n){const{relatedInfos:i,_sourceLayer:s}=this;i.clear();const o=(0,r.pC)(s.associatedLayer)?await s.associatedLayer.load(n):s;if(!o)return;const a=t.filter((e=>e&&(0,m.oM)(e.fieldName)));if(!a||!a.length)return;t.forEach((e=>this._configureRelatedInfo(e,o)));const l=await(0,_.Vb)({relatedInfos:i,layer:o},n);Object.keys(l).forEach((e=>{var t;const n=i.get(e.toString()),r=null==(t=l[e])?void 0:t.value;n&&r&&(n.layerInfo=r.data)}));const c=await(0,_.kp)({graphic:e,relatedInfos:i,layer:o},n);Object.keys(c).forEach((e=>{var t;(0,_.lg)(null==(t=c[e])?void 0:t.value,i.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:n}=this,i=(0,_.Bt)(e.fieldName);if(!i)return;const{layerId:r,fieldName:s}=i;if(!r)return;const o=n.get(r.toString())||(0,_.uc)(r,t);o&&((0,_.NF)({relatedInfo:o,fieldName:s,fieldInfo:e}),this.relatedInfos.set(r,o))}};(0,i._)([(0,o.Cb)()],j.prototype,"_featureAbortController",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"_effectivePopupTemplate",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"_fieldInfoMap",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"_sourceLayer",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"content",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"contentViewModels",void 0),(0,i._)([(0,o.Cb)({type:Boolean})],j.prototype,"defaultPopupTemplateEnabled",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"formattedAttributes",void 0),(0,i._)([(0,o.Cb)({type:u.default,value:null})],j.prototype,"graphic",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"lastEditInfo",void 0),(0,i._)([(0,o.Cb)()],j.prototype,"relatedInfos",void 0),(0,i._)([(0,o.Cb)()],j.prototype,"spatialReference",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"title",void 0),(0,i._)([(0,o.Cb)()],j.prototype,"map",null),(0,i._)([(0,o.Cb)({readOnly:!0})],j.prototype,"waitingForContent",null),(0,i._)([(0,o.Cb)()],j.prototype,"view",void 0),j=(0,i._)([(0,a.j)(T)],j);const k=j},22020:(e,t,n)=>{"use strict";n.d(t,{q:()=>a});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881),n(87566)),s=(n(10923),n(57002),n(86035),n(19401)),o=n(88266);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>(0,o.isWidget)(e)&&!e.destroyed?(0,s.j)("div",{key:e},e.render()):e instanceof HTMLElement?(0,s.j)("div",{key:e,bind:e,afterCreate:this._attachToNode}):(0,o.hasDomNode)(e)?(0,s.j)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=(0,i._)([(0,r.j)("esri.widgets.Feature.ContentMixin")],t),t}},29209:(e,t,n)=>{"use strict";n.d(t,{qD:()=>O,cT:()=>S,Qu:()=>$,uI:()=>V,Tj:()=>P,P_:()=>N,Hs:()=>q,_R:()=>R,JD:()=>A,k6:()=>T,iJ:()=>x,l$:()=>I,vD:()=>M,M3:()=>B,oM:()=>D,f5:()=>L,Xh:()=>G,or:()=>C,ar:()=>E});var i=n(59472),r=n(88263),s=n(36544),o=n(32656),a=n(4665),l=n(21979),c=n(17427),d=n(99217);n(89771);const u=s.Z.getLogger("esri.widgets.Feature.support.featureUtils"),h=/href=(""|'')/gi,f=/(\{([^\{\r\n]+)\})/g,p=/\'/g,m=/^\s*expression\//i,g=/(\n)/gi,y=/[\u00A0-\u9999<>\&]/gim,b=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,_=/^(?:mailto:|tel:)/,v="relationships/",w=(0,l.Ze)("short-date-short-time");function I(e){if(!(0,i.Wi)(e))return e.get("sourceLayer")||e.get("layer")}async function M(e,t){return"function"==typeof e?e.call(null,t):e}function C(e=""){if(e)return!_.test(e.trim().toLowerCase())}function F(e,t){if(!function(e){return m.test(e)}(t)||!e)return null;const n=t.replace(m,"").toLowerCase();let i;return e.some((e=>e.name.toLowerCase()===n&&(i=e,!0))),i}function A(e,t){const n=F(t,null==e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function T(e,t){const n=j(t,e);return n?n.name:e}function x(e,t){return e&&e.map((e=>T(e,t)))}function j(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function k(e){return`${e}`.trim()}function E({formattedAttributes:e,template:t,fieldInfoMap:n}){return k(function(e){return e.replace(h,"")}((0,r.gx)((0,r.gx)(t,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n&&n.fieldName||e}}`}(e,n))),e)))}function Z(e,t=!1){const n={...e};return Object.keys(n).forEach((e=>function(e,t,n=!1){const i=t[e];if("string"==typeof i){const r="%27",s=(n?encodeURIComponent(i):i).replace(p,r);t[e]=s}}(e,n,t))),n}function $(e,t){return e.replace(f,((e,n,i)=>{const r=j(t,i);return r?`{${r.name}}`:n}))}function L(e,t,n){const i=$(e,n);return i?i.replace(b,((e,n,i)=>function(e,t,n){const i=(t=k(t))&&"{"!==t[0];return(0,r.gx)(e,Z(n,i))}(e,n||i,t))):i}function N(e,t){const n=t.fieldInfos,i=t.fieldName,r=R(n,i),s=null==r?void 0:r.clone(),o=t.preventPlacesFormatting,a=j(t.layer,i);if(s&&a&&"date"===a.type){const e=s.format||new d.Z;e.dateFormat=e.dateFormat||"short-date-short-time",s.format=e}const l=s&&s.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?e:o?(0,c.uf)(e,{...(0,c.sh)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function R(e,t){if(!e||!e.length||!t)return;const n=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==n||(i=e,0)))),i}function P(e,t){const{creatorField:n,creationDateField:i,editorField:r,editDateField:s}=e;if(!t)return;const o=t[s];if("number"==typeof o){const e=t[r];return{type:"edit",date:(0,l.p6)(o,w),user:e}}const a=t[i];if("number"==typeof a){const e=t[n];return{type:"create",date:(0,l.p6)(a,w),user:e}}return null}function S(e,t){const n=new Map;return e&&e.forEach((e=>{const i=T(e.fieldName,t);e.fieldName=i,n.set(i.toLowerCase(),e)})),n}function q(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach((e=>{if("fields"===e.type){const n=e&&e.fieldInfos;n&&t.push(...n)}})),t):t}function B(e){return e.replace(y,(e=>`&#${e.charCodeAt(0)};`))}function O(e){return"string"==typeof e?e.replace(g,'<br class="esri-text-new-line" />'):e}function z(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:r,layer:s,graphic:o}=e;if(null==t)return"";const a=function({fieldName:e,value:t,graphic:n,layer:i}){if(D(e))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;const r=i.getFieldDomain(e,{feature:n});return r&&"coded-value"===r.type?r.getName(t):null}({fieldName:n,value:t,graphic:o,layer:s});if(a)return a;const c=function({fieldName:e,graphic:t,layer:n}){if(D(e))return null;if(!n||"function"!=typeof n.getFeatureType)return null;const{typeIdField:i}=n;if(!i||e!==i)return null;const r=n.getFeatureType(t);return r?r.name:null}({fieldName:n,graphic:o,layer:s});if(c)return c;if(r.get(n.toLowerCase()))return N(t,{fieldInfos:i,fieldName:n,layer:s});const d=s&&s.fieldsIndex;return d&&d.isDateField(n)?(0,l.p6)(t,w):O(t)}function V({fieldInfos:e,attributes:t,layer:n,graphic:i,fieldInfoMap:r,relatedInfos:s}){const o={...t};return null==s||s.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((n=>W({attributes:e,graphic:n,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((n=>W({attributes:e,graphic:n,relatedInfo:t}))))}(o,e))),Object.keys(o).forEach((t=>{const s=o[t];o[t]=z({fieldName:t,fieldInfos:e,fieldInfoMap:r,layer:n,value:s,graphic:i})})),o}async function U(e,t){const{layer:n,graphic:i,outFields:r,objectIds:s,returnGeometry:a,spatialReference:l}=e,c=s[0];if("number"!=typeof c){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:i,objectId:c,requiredFields:r},s=new o.Z("layer-query-features-invalid-objectid",e,t);throw u.warn(e,t),s}if("function"!=typeof n.queryFeatures){const e="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",t={layer:n,graphic:i,requiredFields:r},s=new o.Z("layer-query-features-unsupported",e,t);throw u.warn(e,t),s}const d=n.createQuery();return d.objectIds=s,d.outFields=r,d.returnGeometry=!!a,d.outSpatialReference=l,(await n.queryFeatures(d,t)).features[0]}async function G({graphic:e,popupTemplate:t,layer:n,spatialReference:i},r){if(!n||!t)return;const{returnGeometry:s}=t;"function"==typeof n.load&&await n.load(r);const o=e.attributes[n.objectIdField];if(null==o)return;const l=[o],c=await t.getRequiredFields(n.fields),d=(0,a.R9)(c,e),u=d?[]:c;if(d&&!s)return;const h=await U({layer:n,graphic:e,outFields:u,objectIds:l,returnGeometry:s,spatialReference:i},r);h&&(h.geometry&&(e.geometry=h.geometry),h.attributes&&(e.attributes={...e.attributes,...h.attributes}))}function D(e=""){return!!e&&-1!==e.indexOf(v)}function W({attributes:e,graphic:t,relatedInfo:n}){e&&t&&n&&Object.keys(t.attributes).forEach((i=>{const r=function(e){return e?`${v}${e.layerId}/${e.fieldName}`:""}({layerId:n.relation.id.toString(),fieldName:i});e[r]=t.attributes[i]}))}},47873:(e,t,n)=>{"use strict";n.d(t,{uc:()=>g,Bt:()=>m,Vb:()=>_,kp:()=>v,lg:()=>y,NF:()=>w});var i=n(36544),r=n(32656),s=n(39105),o=n(4665),a=n(36654),l=n(20624),c=n(31518),d=n(11047),u=n(92551),h=n(29209);const f=i.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),p=new Map;function m(e){if(!(0,h.oM)(e))return null;const[t,n]=e.split("/").slice(1);return{layerId:t,fieldName:n}}function g(e,t){const n=function(e,t){if(!t.relationships)return null;let n=null;const{relationships:i}=t;return i.some((t=>t.id===parseInt(e,10)&&(n=t,!0))),n}(e,t);if(!n)return;const i=`${t.url}/${n.relatedTableId}`;return{url:i,queryTask:new u.Z({url:i,sourceSpatialReference:t.spatialReference}),relation:n,relatedFields:[],outStatistics:[]}}function y(e,t){if(!t)return;if(!e)return;const{features:n,statsFeatures:i}=e,r=n&&n.value;t.relatedFeatures=r?r.features:[];const s=i&&i.value;t.relatedStatsFeatures=s?s.features:[]}async function b(e,t,n,i){const r=n.layerId.toString(),{layerInfo:a,queryTask:l,relation:u,relatedFields:h,outStatistics:f}=t,p=function({originRelationship:e,relationships:t,layerId:n}){let i;return t&&t.some((t=>(`${t.relatedTableId}`===n&&t.id===e.id&&(i=t),!!i))),i}({originRelationship:u,relationships:a.relationships,layerId:r});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const t=(await function(e,t,n,i){const r=new d.Z;return r.outFields=["*"],r.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),r.objectIds=[e.attributes[n.objectIdField]],n.queryRelatedFeatures(r,i)}(e,p,n,i))[e.attributes[n.objectIdField]];if(!t)return null;const r=t.features.map((e=>e.attributes[a.objectIdField]));if((null==f?void 0:f.length)>0&&a.supportsStatistics){const e=new c.Z;e.where=function(e,t,n){let i=0;const r=[];for(;i<t.length;)r.push(`${e} IN (${t.slice(i,n+i)})`),i+=n;return r.join(" OR ")}(a.objectIdField,r,1e3),e.outFields=h,e.outStatistics=f;const n={features:Promise.resolve(t),statsFeatures:l.execute(e)};return(0,s.eachAlways)(n)}}const m=null==p?void 0:p.keyField;if(m){const n=(0,o.H7)((0,o.rz)(a.fields,m)),r=function(e,t){const n=t.toLowerCase();for(const t in e)if(t.toLowerCase()===n)return e[t];return null}(e.attributes,u.keyField),d=n?`${m}=${r}`:`${m}='${r}'`,h=l.execute(new c.Z({where:d,outFields:t.relatedFields}),i),f=t.outStatistics&&t.outStatistics.length>0&&a.supportsStatistics?l.execute(new c.Z({where:d,outFields:t.relatedFields,outStatistics:t.outStatistics}),i):null,p={features:h};return f&&(p.statsFeatures=f),(0,s.eachAlways)(p)}return null}function _({relatedInfos:e,layer:t},n){const i={};return e.forEach(((e,s)=>{const{relation:o}=e;if(!o){const e=new r.Z("relation-required","A relation is required on a layer to retrieve related records.");throw f.error(e),e}const{relatedTableId:l}=o;if("number"!=typeof l){const e=new r.Z("A related table ID is required on a layer to retrieve related records.");throw f.error(e),e}const c=`${t.url}/${l}`,d=p.get(c),u=d||function(e,t){return(0,a.default)(e,{query:{f:"json"},signal:t&&t.signal})}(c,n);d||p.set(c,u),i[s]=u})),(0,s.eachAlways)(i)}function v({graphic:e,relatedInfos:t,layer:n},i){const r={};return t.forEach(((t,s)=>{t.layerInfo&&(r[s]=b(e,t,n,i))})),(0,s.eachAlways)(r)}function w({relatedInfo:e,fieldName:t,fieldInfo:n}){if(e.relatedFields.push(t),n.statisticType){const i=new l.Z({statisticType:n.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(i)}}},4338:(e,t,n)=>{"use strict";n.d(t,{_:()=>o});var i=n(56140),r=(n(95830),n(36544),n(68055),n(79881)),s=n(87566);n(10923),n(57002),n(86035);const o=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return(0,i._)([(0,r.Cb)()],t.prototype,"goToOverride",void 0),(0,i._)([(0,r.Cb)()],t.prototype,"view",void 0),t=(0,i._)([(0,s.j)("esri.widgets.support.GoTo")],t),t}}}]);
//# sourceMappingURL=2905.js.map